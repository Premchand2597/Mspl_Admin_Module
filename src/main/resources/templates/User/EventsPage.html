<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Announcements</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  
  <!-- Google Fonts -->
 <!--  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
 -->
   <link rel="stylesheet" href="/assets/font/fonts.css"> 
   
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
<!--   <script src="https://code.highcharts.com/highcharts.js"></script> -->
  <script src="assets/js/highcharts.js"></script>
  <script src="assets/js/chart.min.js"></script>
  
 <!--  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
    <script src="assets/js/jquery-3.6.4.min.js"></script> 
    
  <!--  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
  <script src="assets/js/sweetalert2@11.js"></script>

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
  
  .editAnnouncementPopupOuterBox{
	width: 100%;
	height: 100%;
	background-color: rgba(0,0,0,0.2);
	position: fixed;
	z-index: 9900;
	top: 0;
	left: 0;
	padding: 10px;
	display: none;
}

.announcementEditPopupInnerBox{
	width: 40%;
	height: 550px;
	background-color: #fff;
	padding: 20px;
	margin: 1% auto;
	overflow: auto;
	border-radius: 10px;
}
/* Ensure version number appears on a new line */
						.release-note-text {
						  display: flex;
						  flex-direction: column; /* Stacks elements vertically */
						  font-size: 1rem;
						}

						/* Optional: Adjust the version number styling */
						.version-number {
						  font-size: 0.9rem;
						  font-weight: bold;
						  color: #555;
						}
						
.eventPopupClosePara{
	margin-top: -15px;
	margin-bottom: 5px;
	display: flex;
	justify-content: space-between;
}

.eventFormHeading{
	font-size: 20px;
	font-weight: bold;
	cursor: pointer;
	color: #808B96;
}

.eventFormCloseIcon{
	font-size: 25px;
	font-weight: bold;
	cursor: pointer;
	color: #808B96;
	margin-top: -8px;
}

.editPopupClosePara span:hover,.eventFormCloseIcon:hover{
	color: #566573;
}

.addEventFormOuterBox{
	width: 100%;
	height: auto;
	background-color: #fff;
	padding: 10px;
}

.announcementEditFormBox{
	width: 100%;
	height: auto;
	background-color: #fff;
	padding: 10px;
}

.compProjectEditPopupOuterBox{
	width: 100%;
	height: 100%;
	background-color: rgba(0,0,0,0.2);
	position: fixed;
	z-index: 9900;
	top: 0;
	left: 0;
	padding: 10px;
	display: none;
}

.eventPopupInnerBox{
	width: 40%;
	height: 550px;
	background-color: #fff;
	padding: 20px;
	margin: 2% auto;
	overflow: auto;
	border-radius: 10px;
}
  
	  .main{
	  	font-size: 14px;
	  }
  
       .info-card {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #attendence-chart{
            width: 100%;
            height: 190px; /* Adjust the height as needed */
        }
        /* Example CSS to style disabled items */
		.activity-item .disabled {
		    pointer-events: none; /* Disable interactions */
		    opacity: 0.5; /* Make the item appear grayed out */
		}
		
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
       
        .info-card {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #attendence-chart{
            width: 100%;
            height: 190px; /* Adjust the height as needed */
        }
        
        /* Example CSS to style disabled items */
		.activity-item .disabled {
		    pointer-events: none; /* Disable interactions */
		    opacity: 0.5; /* Make the item appear grayed out */
		}
		.eventCardsRow{
			display: flex;
		    flex-wrap: wrap;  /* Allow wrapping to the next line */
		    width: 100%; 
		    height: auto;
		    margin-top: 10px;
		    /* background-color: red; */
		}

		.eventsHiddenCards {
		    width: calc(32% - 3px);  /* Ensure 3 cards per row, adjust for margin */
		    cursor: default;
		    height: 100%;
		    /*background-color: green;*/
		    margin-left: 10px;
		    margin-bottom: 10px;
		}

		/*.eventsCardBody{
			padding: 10px 15px;
			height: 100%;
			width: 100%;
			background: blue;
			border-radius: 10px;
		}*/

		.eventImageAndEventHeadingMerger{
			/* background: red; */
			display: flex;
			align-items: center;
		}

		.imageViewBox{
			width: 110px;
			height: 90px;
			/* background: gray; */
			border-radius: 10px;
			overflow: hidden;
		}

		.event_image_pic {
		    width: 100%; /* Ensures the image scales properly */
		    height: 100%;
		}

		.eventHeadingBox{
			/* background: green; */
			margin-left: 10px;
		}

		.eventHeadingBox p{
			font-size: 15px;
			font-weight: bold;
			/* background: red; */
			margin: 0;
		}

		.eventHeadingBox .eventStatusPara{
			color: #b3b6b7;
			font-weight: bold;
			font-size: 14px;
			/* background: yellow; */
		}

		.eventDescriptionMerger{
			display: flex;
			/* background: green; */
			margin-top: 10px;
			gap: 10px;
		}

		.eventDateBox,.eventFromTimeBox,.eventToTimeBox{
			width: 33%;
			height: auto;
			/* background: yellow; */
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
			padding: 2px;
		}

		.eventDateBox p,.eventFromTimeBox p,.eventToTimeBox p{
			margin: 0;
			font-size: 14px;
			font-weight: bold;
		}

		.eventDateBox h6,.eventFromTimeBox h6,.eventToTimeBox h6{
			color: #b3b6b7;
			font-weight: bold;
		}

		.viewEventLinkBox{
			/* background: red; */
			padding: 5px;
			text-align: center;
			border-top: 1px solid #b3b6b7;
			margin-top: 5px;
		}

		.viewEventLinkBox a{
			font-size: 14px;
			font-weight: bold;
		}    
		
		.profile-picture {
					width: 40px;
					/* Adjust the size as needed */
					height: 150px;
					/* Ensure the height and width are the same */
					border-radius: 50%;
					/* This makes the image a circle */
					object-fit: cover;
					/* Ensures the image fits within the circle */
				}
				.compProjectHiddenCards,.eventsHiddenCards {
				    width: calc(25% - 10px);  /* Ensure 4 cards per row, adjust for margin */
				    cursor: default;
				    height: 100%;
				    display: flex;
				    justify-content: center;
				    margin: 5px;  /* Add margin to ensure spacing between cards */
				    /*background-color: green;*/
				}
				.eventCard_dateDetail_box{
					width: 30%;
					height: 100%;
					/*background-color: #7DCEA0;*/
					text-align: center;
					color: #fff;
				}

				.eventCard_headingDetail_box{
					width: 70%;
					height: 100%;
					background-color: #fff;
					font-size: 14px;
					overflow: auto;
				}

				.eventLeftDetailBox{
					/*background-color: orange;*/
					width: 100%;
					height: 85%;
					margin-top: 8px;
				}

				.eventDateNumberPara{
					/*background-color: red;*/
					padding: 2px;
					font-size: 30px;
					margin: 0;
					font-weight: bold;
				}

				.eventMonthYearPara{
					/*background-color: green;*/
					padding: 2px;
					font-size: 14px;
					margin: 0;
				}

				.eventStartTimePara{
					/*background-color: blue;*/
					padding: 2px;
					font-size: 14px;
					margin: 0;
				}

				.eventHeadingPara{
					/*background-color: red;*/
					padding: 4px 6px;
					margin: 5px 0 0 0;
					cursor: pointer;
				}

				.eventHeadingPara:hover{
					text-decoration: underline;
					color: red;
				}

				.eventLocationPara{
					/*background-color: yellow;*/
					padding: 4px 6px;
					margin: 0;
					color: #BDC3C7;
				}

				.event_location_img{
					width: 12px;
					height: 12px;
					margin-top: -4px;
					/*background-color: red;*/
				}

				.eventStatusPara{
					/*background-color: yellow;*/
					padding: 4px 6px;
					margin: 20px 0 0 0;
				}
				
				.eventImage {
				    width: 100%;
				    height: auto;
				    border-radius: 8px;
				    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				    transition: transform 0.3s ease-in-out;
				}

				.eventImage:hover {
				    transform: scale(1.05);
				}

				.eventVideoBox video {
				    width: 100%;
				    border-radius: 8px;
				    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				    transition: transform 0.3s ease-in-out;
				}

				.eventVideoBox video:hover {
				    transform: scale(1.05);
				}

				.eventCardsBody {
				    display: flex;
				    flex-wrap: wrap;
				    gap: 20px;
				}

				/*.eventsHiddenCards {
				    width: 300px;
				}*/

				.eventsHiddenCards {
				    width: calc(32% - 3px); /* Ensures 3 cards per row */
				    cursor: default;
				    margin-left: 10px;
				    margin-bottom: 10px;
				    height: auto; /* Allow the card to expand based on content */
				}
				
				/*.eventsCardBody {
				    padding: 20px;
				    border: 1px solid #ddd;
				    border-radius: 10px;
				    background-color: #fff;
					max-height: auto;
					
				}*/
				.eventsCardBody {
				    padding: 10px 10px;
				    width: 100%;
				    background: #fff;
				    border-radius: 10px;
				    height: auto; /* Let the content dictate the height */
				}
				.modal {
				    display: none; /* Hidden by default */
				    position: fixed; /* Stay in place */
				    z-index: 1; /* Sit on top */
				    left: 0;
				    top: 0;
				    width: 100%; /* Full width */
				    height: 100%; /* Full height */
				    overflow: auto; /* Enable scroll if needed */
				    background-color: rgb(0,0,0); /* Fallback color */
				    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
				}

				.modal-content {
				    background-color: #fefefe;
				    margin: 1.75rem auto; /* Adjust margin to give more space at the top */
				    padding: 1.5rem; /* Adjust padding for a more compact appearance */
				    border: 1px solid #888;
				    width: 800px; /* Set width to match Bootstrap large modal */
				    max-width: 90%; /* Set a maximum width for responsiveness */
				}

				.close-button {
				    color: #aaa;
				    float: right;
				    font-size: 28px;
				    font-weight: bold;
				}

				.close-button:hover,
				.close-button:focus {
				    color: black;
				    text-decoration: none;
				    cursor: pointer;
				}

				 
				/* Adjust image size inside the modal */
				.modal-image-box img {
				    max-width: 100px; /* Make image smaller */
				    height: auto; /* Maintain aspect ratio */
				    border-radius: 8px;
				}

				/* Align modal content (title, date, time) next to the image */
				

				.modal-date-time h4 {
				    margin: 0;
				    font-size: 1.25rem;
				}

				.modal-date-time p {
				    margin: 0;
				    font-size: 1rem;
				    color: #666; /* Optional: Add some styling for the text */
				} 
				/* Adjust the video box */
				.modal-video-box {
				    margin-top: 20px; /* Space above the video */
				}

				.modal-video-box video {
				    max-height: 250px; /* Adjust the height of the video */
				    border-radius: 8px;
				}

				/* Ensure modal elements stack properly */
				.modal-content {
				    padding: 1.5rem;
				}

				/* Optional styling for modal header */
				.modal-header h5 {
				    font-size: 1.5rem;
				    margin: 0;
				}
				
				/* Ensure modal is displayed above the backdrop */
				.modal {
				    z-index: 1050 !important; /* Standard Bootstrap modal z-index */
				}

				/* Ensure the modal backdrop is behind the modal content */
				.modal-backdrop {
				    z-index: 1040 !important; /* Backdrop should be lower than the modal */
				}
				
				/* Fullscreen overlay with dim background */
				#loadingPopup {
				    position: fixed;
				    top: 0;
				    left: 0;
				    width: 100%;
				    height: 100%;
				    background: rgba(0, 0, 0, 0.5); /* Dim background */
				    display: flex;
				    flex-direction: column;
				    justify-content: center;
				    align-items: center;
				    z-index: 9999;
				    font-family: Arial, sans-serif;
				    color: white; /* Text color for better contrast */
				}
				
				/* Spinner animation */
				.spinner {
				    width: 50px;
				    height: 50px;
				    border: 6px solid rgba(255, 255, 255, 0.3); /* Semi-transparent border */
				    border-top-color: white; /* Bright top border */
				    border-radius: 50%;
				    animation: spin 1s linear infinite;
				}
				
				/* Loading text */
				#loadingPopup p {
				    margin-top: 20px;
				    font-size: 18px;
				    font-weight: bold;
				    color: white;
				}
				/* Spinner keyframe animation */
				@keyframes spin {
				    to {
				        transform: rotate(360deg);
				    }
				}

  </style>
</head>

<body>

  <!-- ======= Header ======= -->
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId>0}">

   <!--  <div class="app-branding" style="width:100%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/dashboard}>
				        <img class="logo-icon" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				</div> --><!-- End Logo -->
	
		   <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/userDashboard}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				   <!--  <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
			</div>
				
   <!--  <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

	<div th:replace="fragments/header :: header" ></div>
	
  </header><!-- End Header -->
  
  <!-- =======Super Admin Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId == 0}">

    <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/navbar}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				   <!--  <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
	</div><!-- End Logo -->

    <!-- <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

    <div th:replace="fragments/superAdminHeader :: header"></div>

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  
<aside id="sidebar" class="sidebar">
	
<input type="hidden" id="employee-id" th:value="${empDetailsByEmpId.deptId}">
<input type="hidden" id="employeeId1" name="empId" th:value="${empDetailsByEmpId.empid}" />
<input type="hidden" id="loggedEmpEmail" th:value="${empDetailsByEmpId.email}">

    <ul class="sidebar-nav" id="sidebar-nav">
		 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/userDashboard}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link " th:href="@{/navbar}">
		        <i class="bi bi-grid"></i>
		        <span>Dashboard</span>
		    </a>
	    </li>
	    <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>
		
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>  
		<li class="nav-item" th:if="${session.permissions.dispatch && empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/dispatchIframe}">
                <i class="bi bi-truck"></i>
                <span>Dispatched Details</span>
            </a>
        </li>
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminProfile(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-person"></i>
                 <span>My Profile</span>
            </a>
        </li>  
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a> 
        </li>      
       <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-telephone"></i>
                <span>Employee Contacts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/adminHoliday}">
                <i class="bi bi-calendar4-week"></i>
                <span>Holiday List</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>	
		        <span>Employee</span>
		    </a>
	   </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-card-text"></i>
                <span>Team Leaves</span>
            </a>
        </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link active" th:href="@{/events}">
                <i class="bi bi-megaphone"></i>
                <span>Announcement</span>
            </a>
        </li>               
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/ongoingProject}">
                <i class="bi bi-card-heading"></i>
                <span>Projects</span>
            </a>
        </li>   
         <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminPayslip(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-file-text"></i>
                <span>Payslip</span>
            </a>
        </li>  -->    
         <!-- Loop through the permissions map -->
       <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
         <!-- <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li> -->
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.apprisalAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" id="apprisalLink" th:href="@{/apprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Appraisal</span>
		    </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" id="apprisalLink" th:href="@{/employeeApprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Employee Appraisal</span>
		    </a>
		</li>
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
				<li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(V.0.1.2)</span>
					        </span>
					    </a>
		</li>
        
	    <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a>
      </li>  -->
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/adminHoliday}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Holiday List</span>
		    </a>
	 </li>	
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/addInterComm}">
                <i class="bi bi-telephone"></i>
                <span>Communication</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-envelope-open"></i>
                <span>Group Mail Id</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/hikeRatingForm}">
			<i class="bi bi-arrow-up-circle"></i><span>Appraisal Ratings</span>
		</a>
	</li>
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/apprisalEmployee}">
			<i class="bi bi-check-square"></i><span>Submitted Appraisals</span>
		</a>
	</li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
          <a class="nav-link" href="hrActivity">
	        <i class="bi bi-file-lock"></i><span>Permissions</span>
	    </a>
      </li>
	  <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
      </li> -->
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Employee Leaves</span>
		    </a>
	 </li> 
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:classappend="${empDetailsByEmpId.deptId==0} ? ' active'"  th:href="@{/events}">
		        <i class="bi bi-megaphone"></i>
		        <span>Announcement</span>
		    </a>
	 </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/addDepartment}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Department</span>
		    </a>
	   </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/addRole}">
		        <i class="bi bi-receipt"></i>
		        <span>Role</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>
		        <span>Employee</span>
		    </a>
	 </li> 
	 
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/ongoingProject}">
                <i class="bi bi-calendar3"></i>
                <span>Projects</span>
            </a>
      </li>  
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
      </li> 
      <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
              <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#interview-summary-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Interview Summary</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="interview-summary-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
		            <a href="totalCandidatesList">
		              <i class="bi bi-circle"></i><span>Total Candidates</span>
			            </a>
			          </li>
			        <li>
		            <a href="selectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Selected Candidates</span>
		            </a>
		          </li>
		          <li>
		            <a href="rejectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Rejected Candidates</span>
		            </a>
		          </li>
			    </ul>
			</li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link" href="feedbackReports">
			        <i class="bi bi-chat-square-text"></i>
			        <span>Feedback Reports</span>
			    </a>
		 </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
		<li class="nav-item new-feature"  th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(Policy Update)</span>
					        </span>
					    </a>
		</li>  
    </ul>
</aside>


<div id="loadingPopup">
    <div class="spinner"></div>
    <p>Loading, please wait...</p>
</div>


  <main id="main" class="main" style="display: none;">
  
  <input type="hidden" id="loggedAdminEmpId2" th:value="${session.loggedAdminEmpId}">
  <input type="hidden" id="loggedAdminEmailId2" th:value="${session.email}">
  
  <div class="chat-app" style="display: none;">
                <div id="plist" class="people-list">
                        <div class="input-group mb-3">
                                <input type="text" id="searchInputModal" class="form-control" placeholder="Search..."
                                        aria-label="Search">
                                <span class="input-group-text">
                                        <i class="bi bi-search"></i>
                                </span>

                        </div>
                        <ul id="employeeNames" class="list-unstyled chat-list mt-2 mb-0">
                                <!-- Employee names will be dynamically populated here -->
                        </ul>
                </div>

                <div class="chat">
                        <div class="chat-header clearfix">
                                <div class="row w-100">

                                        <!-- Employee Photo and Name Section -->
                                        <div class="col-lg-6 d-flex align-items-center">
                                                <div class="chat-about d-flex align-items-center">
                                                        <img id="employeePhoto" class="employee-photo" src="default-avatar.png"
                                                                alt="Employee Photo" />
                                                        <h6 class="m-b-0 ml-2" id="employeeName">Select an Employee</h6>
                                                </div>
                                        </div>
                                        <!-- Right aligned three dots (Vertical) -->
                                        <div class="col-lg-6 text-right">
                                                <div class="dropdown custom-dropdown">
                                                        <button class="btn btn-outline-secondary" type="button" id="dropdownMenuButton"
                                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                                <i class="fa fa-ellipsis-v"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                                                <li><a class="dropdown-item" href="#">Delete Chat</a></li>
                                                                <li><a class="dropdown-item" href="#">Mute</a></li>
                                                                <li><a class="dropdown-item" href="#">Contact Info</a></li>
                                                        </ul>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        <div id="chat-window" class="chat-history">
                                <ul class="m-b-0">
                                        <!-- Chat messages will be populated here dynamically -->

                                </ul>
                                <div id="message-icon-container" class="message-icon" style="display: none;">

                                        <!-- Plain square message icon SVG (behind) -->
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                        <path
                                                                d="M10 9H17M10 13H17M7 9H7.01M7 13H7.01M21 20L17.6757 18.3378C17.4237 18.2118 17.2977 18.1488 17.1656 18.1044C17.0484 18.065 16.9277 18.0365 16.8052 18.0193C16.6672 18 16.5263 18 16.2446 18H6.2C5.07989 18 4.51984 18 4.09202 17.782C3.71569 17.5903 3.40973 17.2843 3.21799 16.908C3 16.4802 3 15.9201 3 14.8V7.2C3 6.07989 3 5.51984 3.21799 5.09202C3.40973 4.71569 3.71569 4.40973 4.09202 4.21799C4.51984 4 5.0799 4 6.2 4H17.8C18.9201 4 19.4802 4 19.908 4.21799C20.2843 4.40973 20.5903 4.71569 20.782 5.09202C21 5.51984 21 6.0799 21 7.2V20Z"
                                                                stroke="#94b7db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </g>
                                        </svg>

                                        <!-- SVG with animation -->
                                        <svg class="animated-icon" viewBox="0 0 374 374" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0)">
                                                        <path
                                                                d="M318.084 132.622C311.339 101.37 287.642 82 256.652 82C238.423 82 217.459 89.3248 197.954 102.509C191.574 106.904 182.642 106.904 176.079 102.672C155.298 88.9992 135.246 82 116.652 82C85.6626 82 61.9647 101.533 55.2199 133.111C44.2824 183.896 80.923 252.26 187.017 291C292.746 251.446 329.204 183.082 318.084 132.622Z" />
                                                        <path
                                                                d="M187.466 0C187.366 0 187.166 0 186.866 0C85.666 0 3.36603 82.3 3.36603 183.5C3.36603 224.8 17.466 264.9 43.266 297.2L16.566 359.3C14.366 364.4 16.766 370.3 21.766 372.4C23.566 373.2 25.566 373.4 27.466 373.1L125.366 355.9C144.966 363 165.566 366.6 186.366 366.5C287.566 366.5 369.866 284.2 369.866 183C370.066 82.1 288.366 0.1 187.466 0ZM192.966 269.8C188.966 271.3 184.666 271.3 180.666 269.8C149.066 257.1 124.466 238.3 109.466 215.4C95.966 194.7 90.766 171.4 94.866 149.9C100.466 121.4 121.866 102.3 148.266 102.3C160.966 102.3 173.866 106.5 186.766 114.7C199.366 106.5 212.466 102.3 225.066 102.3C251.866 102.3 272.866 120.9 278.466 149.6C286.066 188.8 262.666 241.3 192.966 269.8Z" />
                                                </g>
                                                <defs>
                                                        <clipPath id="clip0">
                                                                <rect width="373.232" height="373.232" fill="white" />
                                                        </clipPath>
                                                </defs>
                                        </svg>



                                        <!-- Dots Animation -->
                                        <div class="dots">
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                        </div>




                                </div>


                        </div>
                        <!-- Move the paragraph outside the chat window -->
                        <p id="logo-text"
                                style="text-align: center; font-size: 14px; color: #6c757d; margin-top: 10px; display: none;">
                                "Reach out to your colleagues and stay on top of your projects with quick, seamless communication."
                        </p>
                        <div class="chat-message clearfix">
                                <div class="custom-input-group mb-0">
                                        <input type="text" id="message" class="custom-form-control" placeholder="Enter your message..." />
                                        <div class="custom-input-group-append">
                                                <button class="custom-send-btn" onclick="sendMessage()">
                                                        <i class="ri ri-send-plane-2-fill"></i>
                                                </button>
                                        </div>
                                </div>

                        </div>
                </div>
        </div>
        <input type="hidden" th:value="${empDetailsByEmpId.email}" id="loggedInMail">
<input type="hidden" id="emp_idSessionValue" th:value="${empDetailsByEmpId.empid}">

<div class="editAnnouncementPopupOuterBox" id="editAnnouncementPopupOuterBox">
	<div class="announcementEditPopupInnerBox">
		 <p class="eventPopupClosePara">
			<span class="eventFormHeading" style="font-size: 18px;">Edit Announcement</span>
			<span class="eventFormCloseIcon" onclick="closeEditAnnouncementPopupOuterBox();">&times;</span>
		</p>
		<div class="announcementEditFormBox">
			<div class="container">
				<form class="addEmployeeFormWithValidation" id="announcementEditPopupForm" enctype="multipart/form-data" onsubmit="showLoadingPopup()">
					<div class="row jumbotron box8 mb-3" style="height: 423px; overflow: auto;">
						<input type="hidden" id="announcementAutoIdvalue">
						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">Title<span>*</span></label> <input
								type="text" class="form-control custom_textfield"
								style="font-size: 14px;" id="event_title_popup"
								required> <span id="eventTitle_error"></span>
						</div>

						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">Date<span>*</span></label> <input
								type="date" class="form-control custom_textfield"
								style="font-size: 14px;" id="event_date_popup"
								required> <span id="eventDate_error"></span>
						</div>

						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">From Time<span>*</span></label> <input
								type="time" class="form-control custom_textfield"
								style="font-size: 14px;" id="event_from_time_popup" required>
								<input type="hidden" id="hiddenFromTimeEditPopupValue">
							<span id="eventFromTime_error"></span>
						</div>

						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">To Time<span>*</span></label> <input
								type="time" class="form-control custom_textfield"
								style="font-size: 14px;" id="event_to_time_popup" required> 
								<input type="hidden" id="hiddenToTimeEditPopupValue">
								<span id="eventToTime_error"></span>
						</div>

						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">Location<span>*</span></label>
							<textarea class="form-control" required style="font-size: 14px;" id="eventLocation_popup" rows="2"></textarea>
							<span id="eventLocation_error"></span>
						</div>

						<div class="col-sm-12 form-group mb-2">
							<label style="font-size: 14px;" class="customLabel">Announcement Pic (.png/.jpg)</label><span class="docSizeLabel">(Less than 50 MB only)</span> 
							
							<div class="my-2" style="width: 140px; height: 140px;">
								<img id="announcement_popup_image" alt="Announcement Pic" width="100%" height="100%">
							</div>
							
							<input type="file" id="eventPic_popup" class="form-control" style="font-size: 14px;"> 
						</div>
					</div>

					<div class="form-group mb-0 customize_btn_event_div">
						<button type="submit" style="font-size: 14px;" class="btn btn-outline-primary">Update</button>
						<button type="button" style="font-size: 14px;" class="btn btn-light" onclick="closeEditAnnouncementPopupOuterBox();">Cancel</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

	<div class="modal fade" id="modalDialogScrollable" tabindex="-1">
		<div class="modal-dialog modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Create Announcement</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form class="addCompProjectForm addEmployeeFormWithValidation" onsubmit="return validateForm();"
						action="saveEventsData" method="post"
						enctype="multipart/form-data">
						<input type="date" style="display: none;" name="announced_date"
							id="assignedSubmitDate">
						<div class="row jumbotron box8">

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Title<span>*</span></label> <input
									type="text" class="form-control custom_textfield"
									style="font-size: 14px;" name="event_title" id="event_title"
									required> <span id="eventTitle_error"></span>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Date<span>*</span></label> <input
									type="date" class="form-control custom_textfield"
									style="font-size: 14px;" name="event_date" id="event_date"
									required> <span id="eventDate_error"></span>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">From Time<span>*</span></label> <input
									type="time" class="form-control custom_textfield"
									style="font-size: 14px;" id="event_from_time" required>
								<input type="hidden" id="hiddenFromTimeValue" name="from_time">
								<span id="eventFromTime_error"></span>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">To Time<span>*</span></label> <input
									type="time" class="form-control custom_textfield"
									style="font-size: 14px;" id="event_to_time" required> <input
									type="hidden" id="hiddenToTimeValue" name="to_time"> <span
									id="eventToTime_error"></span>
							</div>

							<!-- <div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Description<span>*</span></label>
								<textarea class="form-control" name="event_desc" required
									style="font-size: 14px;" id="eventDescription" rows="2"></textarea>
								<span id="eventDescription_error"></span>
							</div> -->

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Location<span>*</span></label>
								<textarea class="form-control" name="event_location" required
									style="font-size: 14px;" id="eventLocation" rows="2"></textarea>
								<span id="eventLocation_error"></span>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Announcement Pic (.png/.jpg)<span>*</span></label><span class="docSizeLabel">(Less than 50 MB only)</span> 
								<input type="file" id="eventPic" class="form-control" name="event_pic" style="font-size: 14px;" required> 
								<span id="eventPic_error"></span>
							</div>

							<!-- <div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Video(mp4)<span>*</span></label> <input
									type="file" id="eventVideo" class="form-control"
									name="event_video" style="font-size: 14px;" required> <span
									id="eventVideo_error"></span>
							</div> -->
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<!-- <button type="button" style="font-size: 14px;"
						class="btn btn-outline-dark">Clear</button> -->
					<button type="button" style="font-size: 14px;"
						class="btn btn-outline-primary addEventsBtn">Add</button>
				</div>
			</div>
		</div>
	</div>


		<div class="compProjectEditPopupOuterBox" id="compProjectEditPopupOuterBox">
			<div class="eventPopupInnerBox">
				 <p class="eventPopupClosePara">
					<span style="font-size: 18px;" class="eventFormHeading">Convert as Event</span>
					<span class="eventFormCloseIcon" onclick="closeEditPopup1();">&times;</span>
				</p>
				<div class="addEventFormOuterBox">
					<div class="container">
						<form class="addCompProjectForm addEmployeeFormWithValidation" action="saveEventsConvertedData" method="post" 
																enctype="multipart/form-data" onsubmit="showLoadingPopup()">
							<div class="row jumbotron box8">
							
							<input type="hidden" id="announcement_id_value" name="announcement_id">
							
							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Title</label>
								<input type="text" class="form-control eventCustom_textfield" id="event_title_value"
								 name="event_title" style="font-size: 14px;" placeholder="Event title" readonly>
								</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Date</label> <input
									type="date" class="form-control custom_textfield"
									style="font-size: 14px;" name="event_date" id="event_converted_date"
									readonly>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">From Time</label> 
								<input type="text" class="form-control eventCustom_textfield" id="event_converted_from_time"
								 name="from_time" style="font-size: 14px;" placeholder="Event title" readonly>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">To Time</label> 
								<input type="text" class="form-control eventCustom_textfield" id="event_converted_to_time"
								 name="to_time" style="font-size: 14px;" placeholder="Event title" readonly>
							</div>

							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Location</label>
								<textarea class="form-control" name="event_location" readonly
								 style="font-size: 14px;" id="eventConvertedLocation" rows="2"></textarea>
							</div>

							<!-- <div class="col-sm-12 form-group mb-3">
								<label style="font-size: 14px;" class="customLabel">Announcement Pic</label>
								<div class="eventPicBox" style="width: 110px; height: 90px;"></div>
							</div> -->
							
							<div class="col-sm-12 form-group mb-2">
								<label style="font-size: 14px;" class="customLabel">Event Description<span>*</span></label>
								<textarea class="form-control" name="event_desc" required
								 style="font-size: 14px;" id="eventConvertedDescription" rows="2"></textarea>
								<span id="eventConvertedDescription_error"></span>
							</div>
							
							<div class="col-sm-12 form-group mb-3">
								<label style="font-size: 14px;" class="customLabel">Event Pic (.png/.jpg)<span>*</span></label><span class="docSizeLabel">(Less than 50 MB only)</span> 
								<input
									type="file" id="eventConvertedPic" class="form-control" name="event_converted_pic"
									style="font-size: 14px;" required> <span
									id="eventConvertedPic_error"></span>
							</div>

							<div class="col-sm-12 form-group mb-5">
								<label style="font-size: 14px;" class="customLabel">Event Video (.mp4)<span>*</span></label><span class="docSizeLabel">(Less than 50 MB only)</span>
								<input type="file" id="eventConvertedVideo" class="form-control custom_textfield" name="event_video" required>
								 <span id="eventVideo_error"></span>
							</div>
		
								<div class="form-group mb-0 customize_btn_event_div">
									<button type="submit" style="font-size: 14px;" class="btn btn-outline-primary">Add Event</button>
									<button type="button" style="font-size: 14px;" onclick="closeEditPopup1();" class="btn btn-light">Cancel</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
    
   <!--  <div class="pagetitle"  th:if="${empDetailsByEmpId.deptId==0}">
     <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px"></i>
      
      <nav class="d-flex justify-content-between">
        <ol class="breadcrumb mb-1">
          <li class="breadcrumb-item"><a th:href="@{/navbar}">Home</a></li>
          <li class="breadcrumb-item active">Events</li>
        </ol>
        
       <button type="button" style="font-size: 14px;" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">Create Announcement</button>
      </nav>
    </div>End Page Title  -->
    
    <div class="pagetitle mb-0 d-flex" th:if="${empDetailsByEmpId.deptId==0}">
     <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px"></i>
      
      <nav class="d-flex justify-content-between">
        <ol class="breadcrumb mb-1">
          <li class="breadcrumb-item"><a th:href="@{/navbar}">Home</a></li>
          <li class="breadcrumb-item active">Events</li>
        </ol>
        <!--  <button type="button" style="font-size: 14px;" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">Create Announcement</button>-->
      </nav> 
    </div><!-- End Page Title -->
    
    <div class="pagetitle mb-0 d-flex" th:if="${empDetailsByEmpId.deptId>0}">
     <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px"></i>
      
      <nav class="d-flex justify-content-between">
        <ol class="breadcrumb mb-1">
          <li class="breadcrumb-item"><a th:href="@{/userDashboard}">Home</a></li>
          <li class="breadcrumb-item active">Events</li>
        </ol>
        <!--  <button type="button" style="font-size: 14px;" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">Create Announcement</button>-->
      </nav> 
    </div><!-- End Page Title -->
    
    <input type="hidden" id="roleValue" th:value="${session.role_name}">
    
    <section class="section dashboard">
      <div class="row">

				<div class="card p-2" style="margin:0 15px;">
				
				<div class="d-flex justify-content-between align-items-center">
               		<h5 class="card-title">Announcements &amp; Events</h5>
               		 <div th:if="${empDetailsByEmpId.deptId==0}">
				        <button type="button" style="font-size: 14px;" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">Create Announcement</button>
				      </div>
              	</div>
					<!-- Bordered Tabs Justified -->
					<ul class="nav nav-tabs nav-tabs-bordered d-flex"
						id="borderedTabJustified" role="tablist">
						
						<li class="nav-item flex-fill" role="presentation">
							<button class="nav-link w-100 active" id="profile-tab"
								data-bs-toggle="tab"
								data-bs-target="#bordered-justified-profile" type="button"
								role="tab" aria-controls="profile" aria-selected="false">Announcement</button>
						</li>
						<li class="nav-item flex-fill" role="presentation">
							<button class="nav-link w-100" id="home-tab"
								data-bs-toggle="tab" data-bs-target="#bordered-justified-home"
								type="button" role="tab" aria-controls="home"
								aria-selected="true">Events</button>
						</li>
					</ul>
					<div class="tab-content pt-2" id="borderedTabJustifiedContent">
						
						<div class="tab-pane fade show active" id="bordered-justified-profile"
							role="tabpanel" th:if="${empDetailsByEmpId.deptId!=74}"
							aria-labelledby="profile-tab">
							
								<div class="eventCardsRow" id="announcment">
						
					           </div>
						</div>
						<!-- Home Tab Content -->
						<div class="tab-pane fade "
							id="bordered-justified-home" role="tabpanel"
							aria-labelledby="home-tab">
							<div class="col-lg-12">
								<div class="eventCardsBody">
									<div class="eventCardsRow" id="eventCardsRow">
									
										<div th:each="event : ${events}" class="eventsHiddenCards">
											<div class="eventsCardBody shadow">
												<div class="eventImageAndEventHeadingMerger">
													<div class="imageViewBox">
														<img th:src="${event.eventConvertedPic}" alt="Event Image"
															class="eventImage" />
													</div>
													<div class="eventHeadingBox">
														<p th:text="${event.eventTitle}"></p>
													</div>
												</div>

												<div class="eventDescriptionMerger">
													<div class="eventDateBox">
														<p th:text="${event.eventDate}"></p>
														<h6>Date</h6>
													</div>
													<div class="eventFromTimeBox">
														<p th:text="${event.fromTime}"></p>
														<h6>From</h6>
													</div>
													<div class="eventToTimeBox">
														<p th:text="${event.toTime}"></p>
														<h6>To</h6>
													</div>
												</div>

												<!-- Display Event Video -->
												<div class="eventVideoBox">
													<video width="320" height="240" controls autoplay muted>
														<source th:src="${event.eventVideo}" type="video/mp4">
													</video>
												</div>

												<div class="viewEventLinkBox">
													<a href="#">View Event</a>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- Bootstrap Modal Structure -->
				<div id="eventModal" class="modal fade" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
				    <div class="modal-dialog modal-md custom-modal" style="max-width: 700px;">
				        <div class="modal-content">
				            <div class="modal-header">
				                <h5 class="modal-title" id="eventModalLabel">Event Details</h5>
				                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				            </div>
				            <div class="modal-body d-flex" style="align-items: center; gap: 20px;">
				                <!-- Flexbox container for image and date/time -->
				                <div class="modal-image-box me-3 text-center" style="flex: 1;">
				                    <img id="modalEventImage" alt="Event Image" class="img-fluid" />
				                </div>
				                <div class="modal-date-time" style="flex: 1;">
				                    <h2 id="modalEventTitle" class="mt-3"></h2>
				                    <p id="modalEventDate"></p>
				                    <p id="modalEventFromTime"></p>
				                    <p id="modalEventToTime"></p>
				                </div>
				            </div>
				            <div class="modal-video-box mt-3">
				                <video id="modalEventVideo" class="w-100" controls></video>
				            </div>
				        </div>
				    </div>
				</div>
				<!-- Feedback Modal -->
				<input type="hidden" id="loggedInDeptName" th:value="${empDetailsByEmpId.deptName}">
			<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
			    <div class="modal-dialog">
			        <div class="modal-content rounded-4 shadow-lg p-0">
			            <div class="modal-header border-0">
			                <h5 class="modal-title" id="feedbackModalLabel">Feedback Form</h5>
			                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			            </div>
			            <div class="modal-body">
			                <form id="feedbackForm" method="post" enctype="multipart/form-data">
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackName" class="form-label fw-bold">Your Name</label>
			                        <input type="text" class="form-control" id="feedbackName" name="name" th:value="${empDetailsByEmpId.fullName}" readonly>
			                    </div>
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackEmail" class="form-label fw-bold">Your Email</label>
			                        <input type="email" class="form-control" id="feedbackEmail" name="email" th:value="${empDetailsByEmpId.email}" readonly>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackEmailyy" class="form-label fw-bold">To</label>
			                        <div class="to-field-container">
			                            <span class="to-field rounded-pill px-3 py-2 shadow-sm">bugs_msplconnect@melangesystems.com</span>
			                        </div>
			                    </div>
								<div class="mb-3">
								    <label for="bugType" class="form-label fw-bold">Bug Type</label>
								    <select class="form-control" id="bugType" name="bugType" required>
								        <option value="About Application">About Application</option>
								        <option value="New Feature">New Feature</option>
								    </select>
								</div>

			                    <div class="mb-3">
			                        <label for="feedbackMessage" class="form-label fw-bold">Message</label>
			                        <textarea class="form-control" id="feedbackMessage" name="message" rows="4" placeholder="Enter your feedback here..." required></textarea>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackAttachment" class="form-label fw-bold">Attachment (optional)</label>
			                        <input type="file" class="form-control" id="feedbackAttachment" name="attachment" accept=".png, .jpg, .jpeg" multiple>
			                        <small class="text-muted">Max size: 5MB. You can upload multiple images.</small>
			                    </div>
			                    <button type="submit" class="btn btn-primary w-100 mt-3 py-2 shadow-sm" id="submitFeedbackBtn">Submit Feedback</button>
			                </form>
			            </div>
			        </div>
			    </div>
			</div>

			</div>
			
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
       Copyright &copy; <span id="currentYear"></span> <strong><span>Melange Systems Private Limited</span></strong>. All Rights Reserved
    </div>
  </footer>
  
  <script>
      var currentYear = new Date().getFullYear();
      document.getElementById("currentYear").innerHTML = currentYear;
  </script>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
<script src="assets/js/chart.min.js"></script>

<script>
	function showLoadingPopup(){
		document.getElementById('loadingPopup').style.display = 'flex';
	}
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var dateColumns = document.querySelectorAll(".dateColumn");
        dateColumns.forEach(function(column) {
        	
        	if(column != null){
        		var originalDate = column.textContent;
                var formattedDate = formatDate(originalDate);
                column.textContent = formattedDate;
        	}else{
        		column.textContent = "-";
        	}
        });
        
     // Format the date elements
        var dateElements = document.querySelectorAll('.dateFormatter');
        dateElements.forEach(function(dateElement) {
        	
        	if(dateElement != null){
        		var dateStr = dateElement.innerText; // Get the date string in yyyy-mm-dd format
                var dateParts = dateStr.split('-'); // Split the date string into parts

                // Check if the date format is valid
                if (dateParts.length === 3) {
                    // Format the date as dd-mm-yyyy
                    var formattedDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
                    // Update the text of the date element
                    dateElement.innerText = formattedDate;
                }
        	}else{
        		dateElement.innerText = "-";
        	}
        });
    });

    function formatDate(dateString) {
        var date = new Date(dateString);
        var day = date.getDate();
        var month = date.getMonth() + 1; // Months are zero-based
        var year = date.getFullYear();
        
        // Ensure two digits for day and month
        if (day < 10) {
            day = '0' + day;
        }
        if (month < 10) {
            month = '0' + month;
        }

        return year + '-' + month + '-' + day;
    }
</script>



<script>
	var loggedInRole = document.getElementById('roleValue').value;
	
	if(loggedInRole === "HR"){
		document.getElementById('employeeLink').style.display="block";
		document.getElementById('groupMailIdForm').style.display="block";
		//document.getElementById('compProjectLink').style.display="none";
		//document.getElementById('addEmployeeLink').style.display="block";
	}else if(loggedInRole === "Super Admin"){
		document.getElementById('employeeLink').style.display="none";
		document.getElementById('groupMailIdForm').style.display="none";
		document.getElementById('groupMailIdTable').style.width="100%";
		//document.getElementById('addEmployeeLink').style.display="none";
	}
</script>  

<!-- script to notification -->
<!-- <script>
//Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
    	console.log("admin");
        var leaveRequestCountValue = response;
        console.log(leaveRequestCountValue);
       // If total notification count is greater than 0, show the bell icon
        if (leaveRequestCountValue.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
        } else {
            $("#notificationBellIcon").hide();  // Hide bell icon if no notifications
        }

        if (leaveRequestCountValue.leaveRequestFlagCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        }
        //display the asset notifu=ication based on asset count value
        if(leaveRequestCountValue.asseteRequestFlagCount>0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
              
             $("#assetRequestMessage").text(leaveRequestCountValue.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#asseteRequestFlagCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        	 	
        }
        
        //display the new project notification based on asset count value
        if(leaveRequestCountValue.newPrjectValueCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newProjectNotification").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.newPrjectValueCount + " project request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        //display the appraisal from HR notification ]
        if(leaveRequestCountValue.appraisalCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#hrAppraisal").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.appraisalCount + " Appraisal Form");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
      //display the appraisal from employee notification 
        if(leaveRequestCountValue.empAppraisalflag>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalempNotification").text(leaveRequestCountValue.empAppraisalflag + " employees sent appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        
        //display the appraisal Due date notification 
        if(leaveRequestCountValue.adminAppraisalDuedate>0){
        	 $("#dueAppraisal").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalDueNotification").text("Tomorrow is the due date for submit appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
      //display the announcement notification based on asset count value
        if(leaveRequestCountValue.announcementNotification>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newAnnouncementNotification").show();  // Show specific notification
             
             $("#newannouncement").text(leaveRequestCountValue.announcementNotification + " announcement(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
        }
        //display the leave request status change notification
        if(leaveRequestCountValue.leaveRequestStatusChangeValue > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#leaveRequestSatusChangeNotification").show();  // Show specific notification
             
             $("#leaveRequestSatusChangeMessage").text("Your leave request status has been");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 	
        }
        //display the new feature notification
        if(leaveRequestCountValue.newFeatureNotification > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#new-feature").show();  // Show specific notification
             
             $("#new-featuretext").text("Latest Update, There is " + leaveRequestCountValue.newFeatureNotification + " new feature(s) update is now available.");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 
        } 
        //display the new feature notification
        if(leaveRequestCountValue.newFeatureNotification > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#new-feature").show();  // Show specific notification
             
             $("#new-featuretext").text("Latest Update, There is " + leaveRequestCountValue.newFeatureNotification + " new feature(s) update is now available.");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 
        } 
    });
}

// Periodically fetch flag value every second (adjust as needed)
setInterval(fetchFlag, 1000);

//Function to fetch flag value from the backend
function fetchsuperAdminFlag() {
    $.get("/flag", function(response) {
    	console.log("Super admin");
        var requestCount = response;
         
        // If total notification count is greater than 0, show the bell icon and notifications
        if (requestCount.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(requestCount.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(requestCount.totalNotificationCount);
            $("#leaveRequestFlagCount").text(requestCount.leaveRequestFlagCount);
        } else {
            // If total notification count is 0, hide the bell icon and notification
            $("#notificationBellIcon").hide();
        }
        //display the asset notifu=ication based on asset count value
        if(requestCount.asseteRequestFlagCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
             
             $("#assetRequestMessage").text(requestCount.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(requestCount.totalNotificationCount);
             $("#asseteRequestFlagCount").text(requestCount.asseteRequestFlagCount);
        		
        }
        else {
            // If total notification count is 0, hide the bell icon and notification
            $("#assetRequestNotification").hide();
        }
    });
}

// Periodically fetch flag value every second (adjust as needed)
const employeeId = document.getElementById('employee-id').value; // This is a string
console.log(employeeId);

if(employeeId === "0") {
	//alert("hii");
	setInterval(fetchsuperAdminFlag, 1000);
}
else{
	setInterval(fetchFlag, 1000);
}


</script>


script to notification link redirect
<script th:inline="javascript">
    function redirectToLeaveRequest() {
        var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/viewAdminLeaves?empid=' + empid;
    }
    function redirectToAsset() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/asset';
    }
    function redirectToProject() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/ongoingProject';
    }    
    function redirectToAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/apprisal?empid=' + empid;
    }    
    function redirectToemployeeAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/employeeApprisal?empid=' + empid;
    }    
    function redirectToAnnouncement() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/events';
    }
    
    function redirectToAttendence() {
    	var email = /*[[${empDetailsByEmpId.email}]]*/ 'defaultEmpId';
    	window.location.href = '/attendanceLive?email=' +email;
    }
</script> -->

<!-- script for events -->
 <script>
      var currentYear = new Date().getFullYear();
      document.getElementById("currentYear").innerHTML = currentYear;
  </script>
  
  
    <script>
      // Add click event to each "View Event" link
    /*  document.querySelectorAll('.viewEventLinkBox a').forEach((link) => {
          link.addEventListener('click', (event) => {
              event.preventDefault();
              const eventCard = link.closest('.eventsCardBody');

              // Get event data
              const imageSrc = eventCard.querySelector('.eventImage').src;
              const title = eventCard.querySelector('.eventHeadingBox p').innerText;
              const date = eventCard.querySelector('.eventDateBox p').innerText;
              const fromTime = eventCard.querySelector('.eventFromTimeBox p').innerText;
              const toTime = eventCard.querySelector('.eventToTimeBox p').innerText;
              const videoSrc = eventCard.querySelector('video source').src;

              // Populate modal with event data
              document.getElementById('modalEventImage').src = imageSrc;
              document.getElementById('modalEventTitle').innerText = title;
              document.getElementById('modalEventDate').innerText = 'Date: ' + date;
              document.getElementById('modalEventFromTime').innerText = 'From: ' + fromTime;
              document.getElementById('modalEventToTime').innerText = 'To: ' + toTime;
              document.getElementById('modalEventVideo').src = videoSrc;

              // Display the modal
              document.getElementById('eventModal').style.display = 'block';
          });
      });

      // Close modal when the close button is clicked
      document.querySelector('.close-button').addEventListener('click', () => {
          document.getElementById('eventModal').style.display = 'none';
      });

      // Close modal when clicking outside of the modal
      window.onclick = (event) => {
          const modal = document.getElementById('eventModal');
          if (event.target === modal) {
              modal.style.display = 'none';
          }
      };*/
	  
	  // Add click event to each "View Event" link
	  document.querySelectorAll('.viewEventLinkBox a').forEach((link) => {
	      link.addEventListener('click', (event) => {
	          event.preventDefault();
	          const eventCard = link.closest('.eventsCardBody');

	          // Get event data
	          const imageSrc = eventCard.querySelector('.eventImage').src;
	          const title = eventCard.querySelector('.eventHeadingBox p').innerText;
	          const date = eventCard.querySelector('.eventDateBox p').innerText;
	          const fromTime = eventCard.querySelector('.eventFromTimeBox p').innerText;
	          const toTime = eventCard.querySelector('.eventToTimeBox p').innerText;
	          const videoSrc = eventCard.querySelector('video source').src;

	          // Populate modal with event data
	          document.getElementById('modalEventImage').src = imageSrc;
	          document.getElementById('modalEventTitle').innerText = title;
	          document.getElementById('modalEventDate').innerText = 'Date: ' + date;
	          document.getElementById('modalEventFromTime').innerText = 'From: ' + fromTime;
	          document.getElementById('modalEventToTime').innerText = 'To: ' + toTime;
	          document.getElementById('modalEventVideo').src = videoSrc;

	          // Show the modal using Bootstrap's modal method
	          const eventModal = new bootstrap.Modal(document.getElementById('eventModal'));
	          eventModal.show();
	      });
	  });

  </script>
  
  <script>

function validateForm() {
        // Title Validation
        const title = document.getElementById('event_title').value.trim();
        if (title === '') {
            alert("Please add an event title");
            return false;
        }

        // Date Validation
        const eventDate = document.getElementById('event_date').value;
        if (eventDate === '') {
            alert("Please select a date for the event");
            return false;
        }

        // Time Validation
        const fromTime = document.getElementById('event_from_time').value;
        const toTime = document.getElementById('event_to_time').value;

        if (fromTime === '') {
            alert("Please select a starting time");
            return false;
        }
        if (toTime === '') {
            alert("Please select an ending time");
            return false;
        }
        if (fromTime >= toTime) {
            alert("From Time should be earlier than To Time");
            return false;
        }
        
        const eventLocation = document.getElementById('eventLocation').value.trim();
        if (eventLocation === '') {
            alert("Please add an event location");
            return false;
        }

        // File Validation
        const eventPic = document.getElementById('eventPic');
        if (eventPic.files.length === 0) {
            alert("Please upload an event picture");
            return false;
        }
        /* const allowedExtensions = /(\.jpg|\.jpeg|\.png)$/i;
        if (!allowedExtensions.exec(eventPic.value)) {
            alert("Only JPG, JPEG, or PNG files are allowed");
            return false;
        }
        if (eventPic.files[0].size > 5 * 1024 * 1024) { // 5MB
            alert("File size should not exceed 5MB");
            return false;
        } */

        // All validations passed
        return true;
    }
</script>

<script>

function convertTo24HourFormat(timeStr) {
    const [time, modifier] = timeStr.split(' ');
    let [hours, minutes] = time.split(':');

    if (modifier === 'PM' && hours !== '12') {
        hours = parseInt(hours, 10) + 12;
    } else if (modifier === 'AM' && hours === '12') {
        hours = '00';
    }

    return `${hours}:${minutes}`;
}

	function openAnnouncementEditPopup(id){
		//alert(id);
		document.body.style.overflow = 'hidden';
		$('#editAnnouncementPopupOuterBox').show();
		
		document.getElementById('loadingPopup').style.display = 'flex';
		
		$.ajax({
	        type: 'GET', 
	        url: 'getEventDetailsById', 
	        data:{"id": id},
	        success: function(data) {
				//console.log(JSON.stringify(data));
				
	            let eventTitle = data.event_title ? data.event_title : "-";
	    		let eventDate = data.event_date ? data.event_date : "-";
	    		let formattedFromTime = data.from_time.replace(',', ' ') ? data.from_time.replace(',', ' ') : "-";
	    		let formattedToTime = data.to_time.replace(',', ' ') ? data.to_time.replace(',', ' ') : "-";
	    		let currentStatus = status ? status : "-";
	    		let eventDesc = data.event_desc ? data.event_desc : "-";
	    		let eventLocation = data.event_location ? data.event_location : "-";
	    		let announcedDate = data.announced_date ? data.announced_date : "-";
	    		let eventPicBase64 = data.event_pic_base64 ? data.event_pic_base64 : null;
	    		
	    		// Convert time to 24-hour format
	            let fromTime24 = convertTo24HourFormat(formattedFromTime);
	            let toTime24 = convertTo24HourFormat(formattedToTime);
	    		
	            console.log("Converted To Time:", toTime24, "From Time:", fromTime24);
	    		
	    		$('#event_title_popup').val(eventTitle);
	    		$('#event_date_popup').val(eventDate);
	    		$('#event_from_time_popup').val(fromTime24);
	            $('#event_to_time_popup').val(toTime24);
	    		$('#eventLocation_popup').val(eventLocation);
	    		$('#announcement_popup_image').attr('src', eventPicBase64);
	    		$('#announcementAutoIdvalue').val(id);
	    		
	    		document.getElementById('loadingPopup').style.display = 'none';
				
				},
	        error: function(xhr, status, error) {
	            console.error('Error fetching data:', error);
	            console.log('Error fetching data. Please try again.');
	            document.getElementById('loadingPopup').style.display = 'none';
	        }
	    });
	}
	
	function closeEditAnnouncementPopupOuterBox(){
		// Hide the scroll bar on the body
	    document.body.style.overflow = 'auto';
		$('#editAnnouncementPopupOuterBox').hide();
	}
	
	function convertTo12HourFormat(time) {
	    let [hours, minutes] = time.split(':');
	    let period = 'AM';

	    if (hours >= 12) {
	        period = 'PM';
	        hours = hours > 12 ? hours - 12 : hours;
	    } else if (hours == 0) {
	        hours = 12;
	    }
	    
	   // alert(`${hours.toString().padStart(2, '0')}:${minutes},${period}`);

	    return `${hours.toString().padStart(2, '0')}:${minutes},${period}`;
	}
	
	document.getElementById("announcementEditPopupForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent default form submission
        
     // Get the values from the form
	    let fromTime = document.getElementById('event_from_time_popup').value;
	   // const fromPeriod = document.getElementById('event_from_period').value;
	    let toTime = document.getElementById('event_to_time_popup').value;
	  //  const toPeriod = document.getElementById('event_to_period').value;
	  
	  // Convert to 24-hour format for comparison
	    let fromTime24 = convertTo24HourFormat(fromTime);
	    let toTime24 = convertTo24HourFormat(toTime);
	
	
	 	// Check if time values are valid
	    if (fromTime24 >= toTime24) {
	        alert("From-time should be less than to-time");
	        return;
	    }	
	    
	    
	 	// Convert to 12-hour format
	    let fromTime12 = convertTo12HourFormat(fromTime);
	    //const fromTime24 = convertTo24Hour(fromTime, fromPeriod);
	    let toTime12 = convertTo12HourFormat(toTime);
	    
	    
	    var hiddenFromTimeValue = document.getElementById('hiddenFromTimeEditPopupValue');
		var hiddenToTimeValue = document.getElementById('hiddenToTimeEditPopupValue');
		
		hiddenFromTimeValue.value = fromTime12;
		hiddenToTimeValue.value = toTime12;
		
		// Create a FormData object to handle the file and other fields
	    let formData = new FormData();
	    formData.append("id", $('#announcementAutoIdvalue').val());
	    formData.append("announcementTitle", $('#event_title_popup').val());
	    formData.append("date", $('#event_date_popup').val());
	    formData.append("fromTime", $('#hiddenFromTimeEditPopupValue').val());
	    formData.append("toTime", $('#hiddenToTimeEditPopupValue').val());
	    formData.append("location", $('#eventLocation_popup').val());
	    formData.append("announcementPic", document.getElementById('eventPic_popup').files[0]);


        fetch("updateAnnouncementData", {
            method: "POST",
            body: formData,
        })
        .then(response => {
            if (response.ok) {
                return response.text();
            } else {
                throw new Error("Failed to update announcement Data");
            }
        })
        .then(data => {
        	location.reload();
        })
        .catch(error => {
        	/* const messageDiv = document.getElementById("message");
            messageDiv.style.display = "block";
            messageDiv.className = "alert alert-danger alert-dismissible fade show";
            document.getElementById("messageSpan").innerHTML = error.message;
            messageDiv.focus(); */
        	alert(`Error: ${error.message}`);
        });
    });
</script>
  
  <script>
  
  var deptId = $('#employee-id').val();

  $(document).ready(function() {
	    $('.addEventsBtn').on('click', function(e) {
	        e.preventDefault(); // Prevent default form submission
	        
	        
	     // Get the values from the form
		    let fromTime = document.getElementById('event_from_time').value;
		   // const fromPeriod = document.getElementById('event_from_period').value;
		    let toTime = document.getElementById('event_to_time').value;
		  //  const toPeriod = document.getElementById('event_to_period').value;
		
		    // Convert to 12-hour format
		    let fromTime12 = convertTo12HourFormat(fromTime);
		    //const fromTime24 = convertTo24Hour(fromTime, fromPeriod);
		    let toTime12 = convertTo12HourFormat(toTime);
		
		    // Check if time values are valid
		    if (fromTime12 && toTime12) {
		        document.getElementById('assignedSubmitDate').value = new Date().toISOString().split('T')[0]; // Set assignedSubmitDate
		    } else {
		        // Show an error message
		        document.getElementById('eventFromTime_error').textContent = 'Invalid time format.';
		        document.getElementById('eventToTime_error').textContent = 'Invalid time format.';
		    }
		    
		    
		    var hiddenFromTimeValue = document.getElementById('hiddenFromTimeValue');
			var hiddenToTimeValue = document.getElementById('hiddenToTimeValue');
			
			hiddenFromTimeValue.value = fromTime12;
			hiddenToTimeValue.value = toTime12;
			
			// Perform form validation
	        if (!validateForm()) return;

	        // Get the form data
	        var formData = new FormData($('.addCompProjectForm')[0]);
	        
	        document.getElementById('loadingPopup').style.display = 'flex';
	        // Send the data via AJAX
	        $.ajax({
	            url: '/saveEventsData', // Endpoint to call
	            type: 'POST',
	            data: formData,
	            processData: false, // Important for file uploads
	            contentType: false, // Important for file uploads
	            success: function(response) {
	                //alert('Event added successfully');
	                // Handle success (optional: reset form, close modal, etc.)
	                $('.addCompProjectForm')[0].reset(); // Clear the form
	                document.getElementById('loadingPopup').style.display = 'none';
	                location.reload();
	            },
	            error: function(error) {
	            	document.getElementById('loadingPopup').style.display = 'none';
	                alert('Failed to add event');
	                // Handle error
	                console.log(error);
	            }
	        });
	    });
	});


function convertTo12HourFormat(time) {
    let [hours, minutes] = time.split(':');
    let period = 'AM';

    if (hours >= 12) {
        period = 'PM';
        hours = hours > 12 ? hours - 12 : hours;
    } else if (hours == 0) {
        hours = 12;
    }
    
   // alert(`${hours.toString().padStart(2, '0')}:${minutes},${period}`);

    return `${hours.toString().padStart(2, '0')}:${minutes},${period}`;
}


	
			$.ajax({
			    type: 'GET', 
			    url: 'getEventDetails', 
			    success: function(data) {
					//alert(JSON.stringify(data));
					updateEventsDetailsUsingCardsData(data);
					},
			    error: function(xhr, status, error) {
			        console.error('Error fetching data:', error);
			        console.log('Error fetching data. Please try again.');
			    }
			});
	    
			function updateEventsDetailsUsingCardsData(data) {
			    var cardContainer = document.getElementById("announcment");
			    cardContainer.innerHTML = '';

			    var monthNames = ["Jan", "Feb", "Mar", "April", "May", "June", "July", "Aug", "Sep", "Oct", "Nov", "Dec"];

			    for (var i = 0; i < data.length; i++) {
			        var eventDate = new Date(data[i].event_date);
			        var day = eventDate.getDate();
			        var month = monthNames[eventDate.getMonth()];
			        var year = eventDate.getFullYear();
			        var dayMonthYear = day + '-' + month + '-' + year;

			        var formattedFromTime = data[i].from_time.replace(',', ' ');
			        var formattedToTime = data[i].to_time.replace(',', ' ');
			        var eventTitle = data[i].event_title;
			        var eventPicBase64 = data[i].event_pic_base64 ? data[i].event_pic_base64 : "path/to/default_image.png";

			        var dynamicStatusColor, eventStatusSymbol;
			        var viewEventText, viewEventTextColor;

			        if (data[i].event_status === "Upcoming") {
			            dynamicStatusColor = 'color: #85C1E9';
			            eventStatusSymbol = " !";
			        } else if (data[i].event_status === "Ongoing") {
			            dynamicStatusColor = 'color: #F8C471';
			            eventStatusSymbol = "...";
			        } else if (data[i].event_status === "Completed") {
			            dynamicStatusColor = 'color: #7DCEA0';
			            eventStatusSymbol = "";
			        }

			        if (data[i].event_status === "Completed" && 
			            (data[i].announcement_converted_flag === "1" || 
			             data[i].announcement_converted_flag === "" || 
			             data[i].announcement_converted_flag === null)) {
			            viewEventText = "Convert to Event?";
			            viewEventTextColor = "#e74c3c";
			        } else if (data[i].event_status === "Upcoming" && 
			            (data[i].announcement_converted_flag === "1" || 
			             data[i].announcement_converted_flag === "" || 
			             data[i].announcement_converted_flag === null)) {
			            viewEventText = "New Announcement !";
			            viewEventTextColor = "blue";
			        } else if (data[i].event_status === "Ongoing" && 
			            (data[i].announcement_converted_flag === "1" || 
			             data[i].announcement_converted_flag === "" || 
			             data[i].announcement_converted_flag === null)) {
			            viewEventText = "Announcement is Live...";
			            viewEventTextColor = "#b9770e";
			        } else if (data[i].event_status === "Completed" && data[i].announcement_converted_flag === "0") {
			            viewEventText = "Added to Event List";
			            viewEventTextColor = "#1e8449";
			        }

			        var html = '<div class="eventsCardBody shadow">';

			        if (deptId === "0") {
			            html += '<i onclick="openAnnouncementEditPopup(\'' + data[i].id + '\');" class="bi bi-pencil-fill" title="Edit" style="font-size: 14px; color: #4154f1; cursor: pointer; float: right;"></i>';
			        }

			        html +=
			            '<div class="eventImageAndEventHeadingMerger">' +
			                '<div class="imageViewBox">' +
			                    '<img src="' + eventPicBase64 + '" alt="Event Image" class="event_image_pic">' +
			                '</div>' +
			                '<div class="eventHeadingBox">' +
			                    '<p>' + eventTitle + '</p>' +
			                    '<p class="eventLocationPara"><i class="bi bi-geo-alt-fill"></i>' + data[i].event_location + '</p>' +
			                    '<p class="eventStatusPara" style="' + dynamicStatusColor + '">' + data[i].event_status + '<span>' + eventStatusSymbol + '</span></p>' +
			                '</div>' +
			            '</div>' +
			            '<div class="eventDescriptionMerger">' +
			                '<div class="eventDateBox">' +
			                    '<p>' + dayMonthYear + '</p>' +
			                    '<h6>Date</h6>' +
			                '</div>' +
			                '<div class="eventFromTimeBox">' +
			                    '<p>' + formattedFromTime + '</p>' +
			                    '<h6>From</h6>' +
			                '</div>' +
			                '<div class="eventToTimeBox">' +
			                    '<p>' + formattedToTime + '</p>' +
			                    '<h6>To</h6>' +
			                '</div>' +
			            '</div>';

			        if (deptId === "0") {
			            html +=
			                '<div class="viewEventLinkBox" style="color: ' + viewEventTextColor + '; font-weight: bold;">' +
			                (viewEventText === 'Convert to Event?' 
			                    ? '<a style="color: ' + viewEventTextColor + '; text-decoration: underline;" href="#" onclick="showEditPopup(' + data[i].id + ', \'' + data[i].event_status + '\');">' + viewEventText + '</a>'
			                    : viewEventText) +
			                '</div>';
			        }

			        html += '</div>'; // Close eventsCardBody

			        var cardDiv = document.createElement("div");
			        cardDiv.className = "eventsHiddenCards";
			        cardDiv.innerHTML = html;

			        cardContainer.appendChild(cardDiv);
			    }
			}
	    
	    function formatDates() {
	        var dateElements = document.querySelectorAll('.dateFormatter');
	        dateElements.forEach(function(dateElement) {
	            var dateStr = dateElement.innerText; // Get the date string in yyyy-mm-dd format
	            var dateParts = dateStr.split('-'); // Split the date string into parts
	            
	           // alert("A = " +dateParts);

	            // Format the date as dd-mm-yyyy
	            if(dateParts.length === 3) {
	                var formattedDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
	                // Update the text of the date element
	            //    alert(formattedDate);
	                dateElement.innerText = formattedDate;
	            }
	        });
	    }
				
</script>

<script>
		/* function getLeavePendingCount() {
				$.ajax({
					type: 'GET',
					url: '/getProjectNames',
					success: function (projectNames) {
						console.log('Project namesssss:', projectNames);
						if (projectNames.length > 0) {
							projectNames.forEach(function (projectName) {
								console.log('Fetching notifications for project:', projectName); // Debug log
								getNotificationCounts(projectName); // Pass projectName here
							});
						} else {
							console.error('No project names found for the given user.');
							$('#notification_list_message').text('No projects found for your email.');
							$('#defaultBox').show();
						}
					},
					error: function (xhr, status, error) {
						console.error('Error fetching project names:', error);
						$('#notification_list_message').text('Error fetching project names. Please try again later.');
						$('#defaultBox').show();
					}
				});
			}

			function getNotificationCounts(projectName) {
				console.log('Inside getNotificationCounts for project:', projectName);
				$.ajax({
					type: 'GET',
					url: 'fetchNotificationCountForAllPages',
					data: {projectName: projectName},
					success: function (data) {
						// alert(JSON.stringify(data));

						var totalNotificationCount = data.total_notification;
						var leavePendingCountValue = data.leave_pending_count;
						var newProjectCountValue = data.newProjectCount;

						$('#notificationCount').text(totalNotificationCount);
						updateNotificationDetailData(totalNotificationCount, leavePendingCountValue, newProjectCountValue);
					},
					error: function (xhr, status, error) {
						console.error('Error fetching data:', error);
						console.log('Error fetching data. Please try again.');
					}
				});
			}

			$(document).ready(function () {
				getLeavePendingCount();
				setInterval(getLeavePendingCount, 1000);
			});

			function updateNotificationDetailData(totalNotificationCount, leavePendingCountValue, newprojectCountValue) {
				var emptyNotifyDiv = $('#emptyNotifyDiv');
				//var leaveRequestNotifyDiv = $('#leaveRequestNotifyDiv');

				var leaveRequestNotifyDiv = $('#leaveRequestNotifyDiv');
				var leaveRequestNotifyDivHorizontalRow = $('#leaveRequestNotifyDivHorizontalRow');

				var moatNewCandidateNotifyDiv = $('#moatNewCandidateNotifyDiv');
				var moatNewCandidateNotifyDivHorizontalRow = $('#moatNewCandidateNotifyDivHorizontalRow');


				if (totalNotificationCount > 0) {
					$("#bellIcon").show();
					$("#emptyNotifyDiv").hide();
					$('#emptyNotificationHeaderMessage').text("");

					if (leavePendingCountValue > 0) {
						leaveRequestNotifyDiv.show();
						$('#leaveNotificationMessage').text("You have " + leavePendingCountValue + " new leave request");
						$('#leaveNotificationNumberHeader').text("Leave Request!");
					} else {
						leaveRequestNotifyDiv.hide();
					}
					if (newprojectCountValue > 0) {
						moatNewCandidateNotifyDiv.show();
						moatNewCandidateNotifyDivHorizontalRow.show();
						$('#moatNewCandidateNotificationMessage').text("There is " + newprojectCountValue + " New Project Task Assigned");
						$('#moatNewCandidateNumberHeader').text("Project!");
					} else {
						moatNewCandidateNotifyDiv.hide();
					}
				} else {
					$("#bellIcon").hide();
					$("#emptyNotifyDiv").show();
					$('#emptyNotificationHeaderMessage').text("Currently there are no notifications");
				}
			} */
		</script>
		


<script>
function closeEditPopup1(){
	// Hide the scroll bar on the body
    document.body.style.overflow = 'auto';
	$('#compProjectEditPopupOuterBox').hide();
}

function showEditPopup(id, status){
	//alert(id);
	
	$.ajax({
        type: 'GET', 
        url: 'getEventDetailsById', 
        data:{"id": id},
        success: function(data) {
            let eventTitle = data.event_title ? data.event_title : "-";
    		let eventDate = data.event_date ? data.event_date : "-";
    		let formattedFromTime = data.from_time.replace(',', ' ') ? data.from_time.replace(',', ' ') : "-";
    		let formattedToTime = data.to_time.replace(',', ' ') ? data.to_time.replace(',', ' ') : "-";
    		let currentStatus = status ? status : "-";
    		let eventDesc = data.event_desc ? data.event_desc : "-";
    		let eventLocation = data.event_location ? data.event_location : "-";
    		let announcedDate = data.announced_date ? data.announced_date : "-";
    		let eventPicBase64 = data.event_pic_base64 ? data.event_pic_base64 : null;
    		
            $('#announcement_id_value').val(id);
    		$('#event_title_value').val(eventTitle);
			$('#event_converted_date').val(eventDate);
			$('#event_converted_from_time').val(formattedFromTime);
		    $('#event_converted_to_time').val(formattedToTime);
			$('#eventConvertedLocation').val(eventLocation);
			},
        error: function(xhr, status, error) {
            console.error('Error fetching data:', error);
            console.log('Error fetching data. Please try again.');
        }
    });
	
	// Hide the scroll bar on the body
    document.body.style.overflow = 'hidden';
	$('#compProjectEditPopupOuterBox').show();
}
</script>



<!-- script for profile pic -->
<script>
$.ajax({
    type: "GET",
    url: "fetchEmployeeDocumentDetailsOnlyByEmpId",
    data: {
        "emp_id": $('#emp_idSessionValue').val()
    },
    success: function(data) {
    	console.log("++++data"+JSON.stringify(data));
        $('#dynamicProfilePic').attr('src', `${data.profilePicPath}`);
    },
    error: function(xhr, status, error) {
        console.error("Error invoking data:", error);
    }
});
</script>

<!-- script for spinner -->
<script>

document.addEventListener('DOMContentLoaded', function () {
    const loadingPopup = document.getElementById('loadingPopup');
    const mainContent = document.getElementById('main');

    // Timer to display the loading popup
    const delayTimeout = setTimeout(() => {
        loadingPopup.style.display = 'flex'; // Show the popup
    }, 1000); // Delay of 1 second (adjust as needed)

    // Event listener for page load
    window.addEventListener('load', function () {
        clearTimeout(delayTimeout); // Cancel the timer if the page loads quickly
        loadingPopup.style.display = 'none'; // Ensure the popup is hidden
        mainContent.style.display = 'block'; // Show the main content
    });
});


</script>

<!-- script to notification on bottom of the page-->
<!--CHAT BOOT-->

		<!-- Include SockJS and Stomp.js libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- script to notification on bottom of the page-->
<script>
		//CODE FOR CHATBOOT NOTIFICATION 
		var stompClient = null;
		var employeeMap = {}; // To store the mapping of employee names to emails
		let employeePhotoMap = {};
		let emailToNameMap = {}; // New map for email -> name lookup
		var email = null;
		var visibilityState = document.visibilityState; // Track tab visibility
		var heartbeatInterval = null; // Track heartbeat interval

		function connectWebSocket() {
			
			var socket = new SockJS('/chat-websocket');
						  stompClient = Stomp.over(socket);

						  var email = document.getElementById('loggedInMail').value;
						  console.log(`Connecting WebSocket as: ${email}`);

						  stompClient.connect({ 'email': email }, function (frame) {
						      console.log('Connected to WebSocket:', frame);

							 // subscribeToTypingEvents();
						      // Mark user as active
						      stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));

						      // Subscribe to active users list
						      stompClient.subscribe('/topic/activeUsers', function (message) {
						          var activeUsers = JSON.parse(message.body);
						          updateActiveUserUI(activeUsers);
						      });
							  // Subscribe to user messages
							        stompClient.subscribe('/user/queue/messages', function (message) {
									//	loadMessages();
									//	alert("po2");
							            console.log('Raw WebSocket Message:11', message);
							            var msg = JSON.parse(message.body);
										//alert(msg);
							            console.log('Parsed Messag111e:', msg);
							            console.log(`Received messagesdsd: ${JSON.stringify(msg)}`);
										//alert("(message.read"+msg.read);
									
							            // Display message if it matches the selected employee
							            if (selectedEmployee === msg.senderEmail || selectedEmployee === msg.recipientEmail) {
											console.log(`New message fromss ${msg.senderEmail}: ${msg.content}`);
											console.log("plk "+selectedEmployee);
											console.log("plk "+msg.senderEmail);
											console.log("plk "+msg.recipientEmail);
											//loadMessages();
							                showMessage(
							                    msg.id,               // Message ID
							                    msg.senderEmail,      // Sender's email
							                    msg.content,          // Message content
							                    msg.recipientEmail,   // Recipient's email
							                    msg.timestamp,        // Message timestamp
							                    email,
												msg.read                    // Logged-in user's email
							                );
							            }
								
										loadEmployees();
										loadMessages();
									 	
							        });

							        // Subscribe to notifications
							        stompClient.subscribe('/user/queue/notifications', function (notification) {
										//alert("00");
							            console.log('New Notification:', notification.body);
							            showToastNotification(notification.body);
										loadEmployees();
										//alert("01");
							        });

									//alert("Subscribing to chat updates...");
									stompClient.subscribe('/user/queue/messages', function (message) {
									    console.log('WebSocket Chat Update Received:', message.body); // Log raw message

									    let parsedMessage = JSON.parse(message.body);
									    console.log('Parsed Message:', parsedMessage); // Log parsed JSON

									    if (Array.isArray(parsedMessage)) {
									        parsedMessage.forEach(msg => {
									            console.log(`Message ID: ${msg.id}, Read: ${msg.read}`);
									            if (msg.read) {
									                updateMessageUI(msg);
									            }
									        });
									    } else {
									        console.log("Unexpected message format:", parsedMessage);
									    }

									    // Refresh messages after a delay
									    setTimeout(() => {
									        console.log("Refreshing messages...");
									        loadMessages();
									    }, 3000);
									});

									stompClient.subscribe('/topic/typing', function (message) {
									    console.log(" Typing notification received:", message.body);

									    let typingData;
									    try {
									        typingData = JSON.parse(message.body);
									        console.log(" Parsed Typing Data:", typingData);
									    } catch (error) {
									        console.error(" Error parsing typing notification message:", error);
									        return;
									    }

									    let loggedInUserEmail = document.getElementById('loggedInMail')?.value;
									    if (!loggedInUserEmail) return;

									    if (loggedInUserEmail === typingData.recipientEmail && typingData.senderEmail === selectedEmployee) {
									        // Fetch actual typing status from the backend
									        fetch(`/getTypingStatus?senderEmail=${typingData.senderEmail}&recipientEmail=${typingData.recipientEmail}`)
									            .then(response => response.json())
									            .then(data => {
									                console.log(" Actual Typing Status from DB:", data.typing);
													console.log(" Actual Typing Status from DB:", data);
													                console.log(" Typing Status (0 or 1):", data.typing);
													                
									                let chatMessages = document.querySelector(".chat-history ul");
									                let chatContainer = document.querySelector(".chat-history"); // The scrollable chat area

									                let typingIndicator = document.getElementById("typingIndicator");
									                
									                if (!typingIndicator) {
									                    typingIndicator = document.createElement("li");
									                    typingIndicator.id = "typingIndicator";
									                    typingIndicator.classList.add("typing-indicator");
									                    typingIndicator.innerHTML = `
									                        <img src="${employeePhotoMap[selectedEmployee] || 'default-profile.jpg'}" alt="User Photo" class="typing-photo">
									                        <span>Typing...</span>
									                    `;
									                    chatMessages.appendChild(typingIndicator);
									                }

									                if (data.typing === 1) { // Ensure it checks the latest typing status
									                    typingIndicator.style.display = "flex";

									                    // Move typing indicator to the bottom
									                    chatMessages.appendChild(typingIndicator);

									                    // Auto-scroll to the bottom
									                    setTimeout(() => {
									                        chatContainer.scrollTop = chatContainer.scrollHeight;
									                    }, 100);
									                } else {
									                    typingIndicator.style.display = "none";
									                }
									            })
									            .catch(error => console.error(" Error fetching typing status:", error));
									    }
									});


						      // Start heartbeat initially
						      heartbeatInterval = setInterval(() => {
						          if (stompClient && stompClient.connected) {
						              stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						              console.log("Heartbeat sent for user: " + email);
						          }
						      }, 20000); // 30 seconds

						      // Detect tab visibility change
						  /*    document.addEventListener("visibilitychange", function () {
						          if (document.hidden) {
						              console.log("User switched to another tab. Marking as inactive.");
						              stompClient.send("/app/userInactive", {}, JSON.stringify({ email }));
						              clearInterval(heartbeatInterval); // Stop heartbeat
						              heartbeatInterval = null;
						          } else {
						              console.log("User returned to the application tab. Marking as active.");
						              stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));
						              if (!heartbeatInterval) {
						                  heartbeatInterval = setInterval(() => {
						                      if (stompClient && stompClient.connected) {
						                          stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						                          console.log("Heartbeat sent for user: " + email);
						                      }
						                  }, 30000);
						              }
						          }
						      });*/

						      // Detect tab close or WebSocket disconnect
						      socket.onclose = function () {
						          console.log("WebSocket disconnected. Updating user status.");
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      };

						      window.addEventListener('beforeunload', function () {
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      });

						  });
		}

		function updateActiveUserUI(activeUsers) {
		//	alert("1");
		    const employeeItems = document.getElementById('employeeNames').getElementsByTagName('li');

		    Array.from(employeeItems).forEach(item => {
		        const employeeName = item.querySelector('span').textContent;
		        const email = employeeMap[employeeName]; 
		        const statusIndicator = item.querySelector('.status-indicator'); // Get the status dot

		        if (activeUsers.includes(email)) {
		            item.classList.add('active-user');
		            statusIndicator.style.backgroundColor = '#66cc66'; // Green for active users
		        } else {
		            item.classList.remove('active-user');
		            statusIndicator.style.backgroundColor = '#ff6666'; // Red for inactive users
		        }

		        // If this employee is currently selected, update chat header status
				if (selectedEmployee === email) {
				           const chatStatusIndicator = document.getElementById('chatStatusIndicator');
				           if (activeUsers.includes(email)) {
				               chatStatusIndicator.style.backgroundColor = '#66cc66'; // Green (Online)
				           } else {
				               chatStatusIndicator.style.backgroundColor = '#ff6666'; // Red (Offline)
				           }
				       }
		    });
		}


		// Select an employee to chat with
		function selectEmployee(employeeName) {
			selectedEmployee = employeeMap[employeeName]; // Get the email from the map
			console.log(`Employee selected: ${selectedEmployee}`);

			// Highlight the selected employee
			var employeeItems = document.querySelectorAll('#employeeNames li');
			employeeItems.forEach(function (item) {
				item.classList.remove('active');
			});
			var selectedItem = Array.from(employeeItems).find(item => item.innerHTML === employeeName);
			if (selectedItem) {
				selectedItem.classList.add('active');
			}

			// Update chat header with employee name and photo
			document.querySelector('.chat-about h6').innerText = employeeName;
			document.querySelector('#employeePhoto').src = employeePhotoMap[selectedEmployee] || 'default-profile.jpg';

			// Hide the message icon and dots when an employee is selected
			document.getElementById('message-icon-container').style.display = 'none';
			// Hide the paragraph when an employee is selected
			document.getElementById('logo-text').style.display = 'none';

			// Load messages for the selected employee
			loadMessages();
		}

		function loadEmployees() {
			console.log("Loading employee names...");

			// Fetch employee names from the endpoint
			fetch('/employees/names')
				.then(response => {
					console.log("Response received:", response);
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(data => {
					console.log("Employee data fetched:", data); // Log the raw data

					const employeeList = document.getElementById('employeeNames');
					if (!employeeList) {
						console.error("Element with ID 'employeeNames' not found.");
						return;
					}

					employeeList.innerHTML = ''; // Clear the list before adding new items

					// Iterate through employee data
					data.forEach(employee => {
						console.log("Processing employee:", employee);

						// Create a list item for each employee
						const li = document.createElement('li');
						li.classList.add('d-flex', 'align-items-center', 'employee-item');

						// Handle missing or empty profile photo paths
						const profilePic = employeePhotoMap[employee.email] || '/static/default-profile.jpg';
						console.log(`Profile picture for ${employee.name}: ${profilePic}`);

						li.innerHTML = `
			                    <img src="${profilePic}" 
			                         alt="Employee Photo" 
			                         class="employee-photo mr-2" />
			                    <span>${employee.name}</span>
			                `;

						// Map employee name to email
						employeeMap[employee.name] = employee.email;
						console.log("Mapped employee:", employee.name, "->", employee.email);
						// Add new reverse mapping (email -> name)
						emailToNameMap[employee.email] = employee.name;
						// Add click event to list item
						li.onclick = () => {
							console.log(`Selected employee: ${employee.name}`);
							selectEmployee(employee.name);
						};

						// Append the list item to the employee list
						employeeList.appendChild(li);

					});

					console.log("Employee names loaded successfully. Employee map:", employeeMap);
					// Call the unread messages function after loading employee data
					fetchUnreadMessages();

					// Set interval to check for new messages every 10 seconds
						setInterval(fetchUnreadMessages, 10000);
				})
				.catch(error => {
					console.error("Error loading employees:", error);
				});
		}


		function loadMessages() {
			// alert("Loading messages...");
			// Get the logged-in user's email and selected employee's email
			var loggedInEmail = document.getElementById('loggedInMail').value;
			var selectedEmployeeEmail = selectedEmployee; // Email is already stored in selectedEmployee

			console.log(`Loading messages between: ${loggedInEmail} and ${selectedEmployeeEmail}`);

			fetch(`/messages?loggedInEmail=${encodeURIComponent(loggedInEmail)}&selectedEmployeeEmail=${encodeURIComponent(selectedEmployeeEmail)}`)
				.then(response => response.json())
				.then(data => {
					console.log("Chat messages loaded:", data);
					// Clear the chat window before displaying messages
					var chatWindow = document.getElementById('chat-window').querySelector('ul');
					chatWindow.innerHTML = '';

					// Display messages
					data.forEach(function (msg) {
						// showMessage(msg.senderEmail, msg.content, msg.recipientEmail, loggedInEmail);
						showMessage(msg.id, msg.senderEmail, msg.content, msg.recipientEmail, msg.timestamp, loggedInEmail);
					});
				})
				.catch(error => console.error("Error loading chat messages:", error));
		}
		let activeDeleteDropdown = null;
		function showMessage(id, senderEmail, message, recipientEmail, timestamp, loggedInEmail) {
			console.log("Message ID:", id);
			console.log(`LoggedInEmailrrr: ${loggedInEmail}, SenderEmail: ${senderEmail}`);

			const isSender = senderEmail === loggedInEmail;
			const senderName = isSender ? "Me" : Object.keys(employeeMap).find(name => employeeMap[name] === senderEmail) || senderEmail;
			const senderPhoto = employeePhotoMap[senderEmail] || 'default-avatar.png';
			const formattedTime = new Date(timestamp).toLocaleString(); // Format timestamp

			console.log(`Message ID: ${id}, Time: ${formattedTime}, From: ${senderEmail}, To: ${recipientEmail}, Content: "${message}"`);

			var chatWindow = document.getElementById('chat-window').querySelector('ul');
			var li = document.createElement('li');
			li.className = isSender ? 'clearfix right' : 'clearfix left';

			li.innerHTML = `
					    <div class="message-container" data-message-id="${id}" onclick="toggleDeleteOption(this)">
					        <img class="sender-photo" src="${senderPhoto}" alt="Sender Photo" />
					        <div class="message ${isSender ? 'my-message' : 'other-message'}">
					            <strong>${senderName}:</strong> ${message}
					        </div>
					    </div>
					    <div class="timestamp" style="text-align: ${isSender ? 'right' : 'left'};">
					        ${formattedTime}
					    </div>
					    ${isSender ? `
					        <div class="message-action-dropdown" >
					            <a class="dropdown-item" href="#" onclick="deleteMessage(this, ${id})">Delete Message</a>
					        </div>
					    ` : ''}`;

			chatWindow.appendChild(li);
			chatWindow.scrollTop = chatWindow.scrollHeight;
		}
		
		/*function fetchUnreadMessages() {
			console.log("Fetching unread messages...");
			var loggedInEmail = document.getElementById('loggedInMail').value;

			fetch(`/unread?email=${loggedInEmail}`)
				.then(response => response.json())
				.then(messages => {
					messages.forEach(message => {
						let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;

						// Show notification with sender's email as a parameter
						showToastNotification(`New message from ${senderName}: ${message.content}`, message.senderEmail);
					});
				})
				.catch(error => console.error("Error fetching unread messages:", error));
		}*/

		let displayedMessageIds = new Set(); // Track displayed messages
		let closedMessageIds = new Set(); // Track closed messages

		function fetchUnreadMessages() {
		    console.log("Fetching unread messages...");
		    var loggedInEmail = document.getElementById('loggedInMail').value;

		    fetch(`/unread?email=${loggedInEmail}`)
		        .then(response => response.json())
		        .then(messages => {
		            messages.forEach(message => {
		                console.log("Processing message ID:", message.id); // Print message ID to console
		                
		                // Ignore messages that were previously closed
		                if (!displayedMessageIds.has(message.id) && !closedMessageIds.has(message.id)) {
							//alert(1);
		                    let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;
		                    showToastNotification(`New message from ${senderName}: ${message.content}`, message.id, message.senderEmail);
		                    displayedMessageIds.add(message.id); // Mark message as displayed
		                }
						//alert(2);
		            });
		        })
		        .catch(error => console.error("Error fetching unread messages:", error));
		}
		// Global flag to track if the user manually dismissed notifications
		
		/*function showToastNotification(message, senderEmail) {
			
			var toastContainer = document.createElement('div');
			toastContainer.className = 'toast-notification';

			// Add message and close button
			toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close"></span>`;

			document.body.appendChild(toastContainer);

			// Animate in
			setTimeout(() => {
				toastContainer.classList.add('show');
			}, 100);

			// Auto-hide after 8 seconds
			let autoHideTimeout = setTimeout(() => closeToast(toastContainer), 10000);

			// Prevent opening chat when clicking the close button
			toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
				event.stopPropagation(); // Prevent click from bubbling to toastContainer
				clearTimeout(autoHideTimeout);
				
				closeToast(toastContainer);
			});

			// Open chat when clicking on the notification
			toastContainer.addEventListener('click', () => {
				openChatWithSender(senderEmail);
				closeToast(toastContainer); // Remove notification when chat opens
			});
		}*/
		function showToastNotification(message, messageId, senderEmail) {
			//alert(1);
		    var toastContainer = document.createElement('div');
		    toastContainer.className = 'toast-notification';
		    toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close"></span>`;

		    document.body.appendChild(toastContainer);

		    // Animate in
		    setTimeout(() => {
		        toastContainer.classList.add('show');
		    }, 100);

		    // Auto-hide after 8 seconds
		    let autoHideTimeout = setTimeout(() => closeToast(toastContainer, messageId), 8000);

		    // Prevent opening chat when clicking the close button
		    toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
		        event.stopPropagation(); // Prevent click from bubbling to toastContainer
		        clearTimeout(autoHideTimeout);
		        closedMessageIds.add(messageId); // Mark as closed so it won't be shown again
		        closeToast(toastContainer, messageId);
		    });

		    // Open chat when clicking on the notification
		    toastContainer.addEventListener('click', () => {
		        openChatWithSender(senderEmail);
		        closeToast(toastContainer, messageId); // Remove notification when chat opens
		    });
		}

		// Function to handle toast closing
		/*function closeToast(toast) {
			toast.classList.remove('show');
			setTimeout(() => toast.remove(), 300); // Faster fade-out
		}*/
		// Function to handle toast closing and mark as dismissed
		// Function to handle toast closing
		function closeToast(toast, messageId) {
		    toast.classList.remove('show');
		    setTimeout(() => toast.remove(), 300); // Faster fade-out
		}
		/*	function openChatWithSender(senderEmail) {
				console.log("Opening chat with:", senderEmail);
			    
				// Construct the URL for the UserFavorite page with the senderEmail as a query parameter
				const url = `/my-favorites?email=${encodeURIComponent(senderEmail)}`;
			    
				// Redirect to the UserFavorite page
				window.location.href = url;
			}*/

		function openChatWithSender(senderEmail) {
			console.log("Opening chat with:", senderEmail);

			// Store sender email in sessionStorage
			sessionStorage.setItem("chatSenderEmail", senderEmail);

			// Redirect to the UserFavorite page
			window.location.href = `/my-favorites`;
		}

		// Connect to the WebSocket server and load employees when the page is loaded
		document.addEventListener('DOMContentLoaded', function () {
			//fetchUnreadMessages();
			loadEmployees();
			connectWebSocket();
		});

	</script>
</body>
</html>