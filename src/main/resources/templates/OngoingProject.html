<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title>Project</title>
<meta content="" name="description">
<meta content="" name="keywords">

<!-- Favicons -->
<link href="assets/img/favicon.png" rel="icon">
<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

<!-- Google Fonts -->
<!-- <link href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
	rel="stylesheet"> -->
	
<link rel="stylesheet" href="/assets/font/fonts.css"> 

<!-- Vendor CSS Files -->
<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
<link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- Template Main CSS File -->
<link href="assets/css/style.css" rel="stylesheet">
<!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
<script src="assets/js/highcharts.js"></script>

<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
<script src="assets/js/jquery-3.6.4.min.js"></script> 
<!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->

<style>
.highlight {
	background-color: yellow;
	font-weight: bold;
}
body {
	margin: 0;
	display: flex;
	flex-direction: column;
}
/* Ensure version number appears on a new line */
						.release-note-text {
						  display: flex;
						  flex-direction: column; /* Stacks elements vertically */
						  font-size: 1rem;
						}

						/* Optional: Adjust the version number styling */
						.version-number {
						  font-size: 0.9rem;
						  font-weight: bold;
						  color: #555;
						}
						
.app-footer {
	width: 100%;
	background-color: #fff;
	position: fixed;
	bottom: 0;
	z-index: 1000;
	height: 40px; /* Adjust this value according to your footer height */
	font-size: 12px;
}

#selectTeamMembers1 {
	height: 40px; /* Initial height */
	transition: height 0.3s ease; /* Smooth transition */
}

#selectTeamMembers1.expanded {
	height: 150px; /* Expanded height */
}

.selectedEmployeeItem {
	display: inline-block;
	margin-right: 5px;
	margin-bottom: 5px;
	padding: 2px 5px;
	border: 1px solid #ccc;
	border-radius: 3px;
	background-color: #f0f0f0;
}

.removeButton {
	margin-left: 5px;
	padding: 0;
	border: none;
	background: none;
	color: red;
	cursor: pointer;
}

.emp_photo_img_for_LoggedIn {
	border: 1px solid silver;
	border-radius: 50px;
	padding: 2px;
}

.form-Select {
	width: 100%;
	padding: 10px;
	border-radius: 5px;
	border: 1px solid #E5E7E9;
	color: #566573;
	transition: border-color 0.3s ease;
}

.form-Select:focus {
	border-color: #3498DB; /* Example color, change as needed */
	outline: none; /* Removes the default outline */
}

.form-text-area {
	width: 100%;
	padding: 10px;
	border-radius: 5px;
	border: 1px solid #E5E7E9;
	color: #566573;
	transition: border-color 0.3s ease;
}

.form-text-area:focus {
	border-color: #3498DB; /* Example color, change as needed */
	outline: none; /* Removes the default outline */
}

.delayReason {
	width: 100%;
	padding: 10px;
	border-radius: 5px;
	border: 1px solid #E5E7E9;
	color: #566573;
	transition: border-color 0.3s ease;
}

.startDate {
	width: 100%;
	padding: 10px;
	border-radius: 5px;
	border: 1px solid #E5E7E9;
	color: #566573;
	transition: border-color 0.3s ease;
}

.mutlipleUserContainer {
	width: 100%;
	padding: 10px;
	border-radius: 5px;
	border: 1px solid #E5E7E9;
	color: #566573;
	transition: border-color 0.3s ease;
}

.mutlipleUserContainer:focus {
	border-color: #3498DB; /* Example color, change as needed */
	outline: none; /* Removes the default outline */
}

.shining-card {
	background: linear-gradient(135deg, #FFC5D8 0%, #B5FFFC 100%);
	background-size: 400% 400%;
	animation: slide-shine 3s infinite linear;
	border-radius: 4px;
}

.unassign-card {
	background: white;
	background-size: 400% 400%;
	border-radius: 4px;
}

@keyframes slide-shine {
 0% {
		background-position: 0% 50%;
	}
	
	50%{
	background-position:100% 50%;
	}
	100%{
	background-position:0% 50%;
	}
}
.delay-shining-card {
	background: linear-gradient(135deg, #9999ff 0%, #fad0c4 100%);
	background-size: 400% 400%;
	animation: slide-shine 3s infinite linear;
	border-radius: 4px;
}

.unassigned-shining-card {
	background: linear-gradient(135deg, #F7F9F9 0%, #B2BABB 100%);
	background-size: 400% 400%;
	animation: slide-shine 3s infinite linear;
	border-radius: 4px;
}

/* Custom CSS for modal size and border */
.modal-dialog {
	width: auto;
	max-width: 70%; /* Increase modal size */
}

.table-bordered th, .table-bordered td {
	border: 1px solid #ddd !important;
}

.table-bordered th {
	background-color: #f2f2f2;
	color: #333;
}

.table-responsive {
	margin: 20px 0;
}

.table td, .table th {
	word-wrap: break-word;
	max-width: 400px; /* Adjust the width as needed */
}

.compProjectCardsBody {
	width: 100%;
	height: auto;
	overflow: auto;
	margin: 0;
	padding: 0;
}

.compProjectCardsRow {
	display: flex;
	flex-wrap: wrap; /* Allow wrapping to the next line */
	width: 100%;
	height: auto;
}

.compProjectHiddenCards {
	width: calc(25% - 10px); /* Ensure 4 cards per row, adjust for margin */
	cursor: default;
	height: 100%;
	display: flex;
	justify-content: center;
	margin: 5px; /* Add margin to ensure spacing between cards */
}

.compProjectInnerHiddenCards {
	width: 100%;
	cursor: pointer;
	height: 100%;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	transition: all 0.3s ease;
}

.compProjectInnerHiddenCards:hover {
	transform: translateY(-5px);
}

.compProjectCard_content {
	padding: 10px;
	text-align: center;
	text-decoration: none;
	width: 100%;
	height: 100%;
}

.compProject_card_data_heading_para {
	color: #666;
	font-size: 15px;
	display: none;
}

.fixed-height-container {
	height: 200px; /* Set the desired height */
	overflow-y: auto; /* Enable vertical scrolling */
}

::-webkit-scrollbar {
	width: 5px;
}

::-webkit-scrollbar-thumb {
	background-color: #d6d5d4;
	border-radius: 5px;
}

::-webkit-scrollbar-track {
	background-color: #f1f1f1;
}

/* Adjust scrollbar width, color, etc. */
/* You can add more styles as needed */
::-moz-scrollbar {
	width: 5px;
}

::-moz-scrollbar-thumb {
	background-color: #888;
	border-radius: 5px;
}

::-moz-scrollbar-track {
	background-color: #f1f1f1;
}

.addLink:hover {
	color: #7F8C8D;
}

/* Define the error state */
.error-border {
	border: 2px solid red;
}

.addtaskContainer {
	margin: 0;
	padding: 0;
}

.add-more-task-btn {
	margin: 10px;
}

.task-header {
	background-color: #D6EAF8;
	color: #34495E;
}

.btn.remove-task-btn {
	background-color: #ff4d4d; /* Bright red background */
	border: none;
	color: white;
	font-size: 12px; /* Smaller font size */
	padding: 4px 8px; /* Reduced padding */
	border-radius: 3px; /* Slightly smaller border radius */
	cursor: pointer;
	transition: background-color 0.3s ease, transform 0.2s ease;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-left: 10px;
}

.btn.remove-task-btn i {
	margin-right: 2px; /* Reduced margin */
	font-size: 14px; /* Adjusted icon size */
}

.btn.remove-task-btn:hover {
	background-color: #e03a3a; /* Darker red on hover */
	transform: scale(1.05); /* Slightly larger on hover */
}

.btn.remove-task-btn:focus {
	outline: none;
	box-shadow: 0 0 0 2px rgba(255, 77, 77, 0.5);
	/* Smaller red outline on focus */
}

.btn.remove-task-btn:active {
	background-color: #d62e2e; /* Even darker red when clicked */
	transform: scale(0.98); /* Slightly smaller on click */
}

.cardProjectName {
	font-weight: bold;
	text-align: left;
}

.description {
	font-size: 12px;
	display: -webkit-box;
	-webkit-line-clamp: 1; /* Limit to 2 lines */
	-webkit-box-orient: vertical;
	overflow: hidden;
	text-overflow: ellipsis;
}

.chart-container {
	width: 100%;
	height: 300px; /* Adjust height as needed */
	margin: auto; /* Centering */
}

.chart {
	width: 100%;
	height: 100%;
}

/* Subtask Container Styling */
.subtasks-container {
    background-color: #f9f9f9;
    padding: 10px;
    border-radius: 5px;
    
    margin:10px 20px 0 20px;
    border: 1px solid #ddd;
}

/* Individual Subtask Styling */
.subtask {
    background-color: #fff7e6; /* Light yellowish background */
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    border: 1px solid #ffc107; /* Golden border for subtasks */
}

/* Subtask Remove Icon Styling */
.remove-subtask-icon {
    color: #dc3545; /* Bootstrap danger (red) color */
    font-size: 18px;
}

/* Form Group General Styling */
.form-group {
    margin-bottom: 15px;
}

/* Task Button Styling */
.add-more-task-btn {
    margin-top: 10px;
}

.add-subtask-btn {
    margin-top: 10px;
    background-color: #007bff;
    color: white;
}
 
/* Close button styling */
.modal-header .close {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 1.5rem;
    color: #333;
    opacity: 0.8;
    cursor: pointer;
    background: none;
    border: none;
    outline: none;
}

.modal-header .close:hover {
    color: #000;
    opacity: 1;
}

.select-container select:focus {
		  outline: none;
		}
		
		/* Container styling */
		.select-container {
		    position: relative;
		    width: 100%;
		}
		
		/* Styling the multi-select dropdown */
		#department {
		    display: block;
		    width: 100%;
		    height: 32px; /* Default height when not extended */
		    overflow: hidden; /* Hide overflow */
		    white-space: nowrap;
		    text-overflow: ellipsis; /* Adds ellipsis for overflow text */
		    transition: all 0.3s ease; /* Smooth transition for height */
		}
		
		/* Dropdown expands when clicked */
		#department:focus, #department:hover {
		    height: auto; /* Expands to fit content */
		    overflow: auto; /* Allows scrolling when expanded */
		}
		
		/* Adjust scrollbar visibility (optional) */
		#department::-webkit-scrollbar {
		    width: 6px;
		}
		
		#department::-webkit-scrollbar-thumb {
		    background-color: #ccc;
		    border-radius: 4px;
		}
		
		#department::-webkit-scrollbar-thumb:hover {
		    background-color: #888;
		}
		
		/* Optional: Style error message */
		#dept_error {
		    color: red;
		    font-size: 0.875em;
		    margin-top: 5px;
		}
		
		.custom-add-task-btn {
		    background-color: transparent;
		    border: none;
		    color: blue;
		    cursor: pointer;
		    text-decoration: underline;
		    font-size: 14px;
		}
		
		/* Container for the selected departments */
		#selectedDepartmentsList {
		    list-style-type: none; /* Remove bullets */
		    padding: 10px; /* Add some spacing inside the container */
		    margin: 10px 0; /* Add spacing above and below the list */
		    border: 1px solid #ddd; /* Add a subtle border */
		    border-radius: 5px; /* Round the corners */
		    background-color: #f9f9f9; /* Light background for contrast */
		    max-width: 300px; /* Optional: Limit the width */
		}
		
		/* List items for selected departments */
		#selectedDepartmentsList li {
		    padding: 5px 10px; /* Add spacing inside each list item */
		    margin-bottom: 5px; /* Add spacing between list items */
		    background-color: #e7f3fe; /* Light blue background */
		    border: 1px solid #bcdff1; /* Subtle blue border */
		    border-radius: 4px; /* Round the corners */
		    font-size: 14px; /* Slightly smaller font for clarity */
		    color: #0056b3; /* Dark blue text color */
		    display: flex; /* Optional: Enables additional styling like icons */
		    align-items: center; /* Align items vertically */
		    justify-content: space-between; /* Spread content if needed */
		}
		
		/* Add hover effect to list items */
		#selectedDepartmentsList li:hover {
		    background-color: #d6e9f9; /* Slightly darker blue on hover */
		    cursor: pointer; /* Indicate clickable items */
		}

		.custom-width {
		    max-width: 500px; /* Adjust width as needed */
		    width: 100%; /* Ensure responsiveness */
		}
		.form-group.subtask {
		    margin-bottom: 30px;
		}
		    .dropdown-container {
        position: relative;
        display: inline-block;
        width: 100%;
    }
    .dropdown-container {
        position: relative;
        display: inline-block;
        width: 100%;
    }

    .dropdown-btn {
        width: 100%;
        text-align: left;
        background-color: white;
        border: 1px solid #ccc;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 4px;
    }

    .dropdown-menu1 {
        display: none;
        position: absolute;
        width: 100%;
        background: white;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
    }

    .dropdown-menu1 div {
        padding: 5px;
        display: flex;
        align-items: center;
    }

    .dropdown-menu1 div:hover {
        background-color: #f1f1f1;
    }

    /* Selected departments container */
    .selected-container {
        display: none; /* Hidden by default */
        margin-top: 10px;
    }

    /* Selected department chips */
    .selected-list {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        list-style: none;
        padding: 0;
    }

    .selected-list li {
        display: flex;
        align-items: center;
        background: #f1f1f1;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 14px;
    }

    .remove-icon {
        color: #d9534f;
        cursor: pointer;
        font-weight: bold;
        margin-left: 8px;
    }
    
    .addCompProjectForm label{
    	font-weight:bold;
    }
	.projectAssignClass label{
		font-weight:bold;
	}
	
	.team-members-wrapper {
	    width: 100%;
	    border: 1px solid #ccc;
	    padding: 5px;
	    background-color: white;
	    position: relative;
	    cursor: pointer;
	}
	
	.team-members-toggle {
	    padding: 8px;
	    background: #f9f9f9;
	    border-radius: 4px;
	}
	
	.team-members-container {
	    display: none; /* Initially hidden */
	    position: absolute;
	    width: 100%;
	    background: white;
	    border: 1px solid #ccc;
	    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
	    max-height: 200px;
	    overflow-y: auto;
	    z-index: 1000;
	}
	
	.team-members-container.active {
	    display: block; /* Show when active */
	}
	
	.checkbox-item {
	    padding: 5px;
	    display: flex;
	    align-items: center;
	}
	
</style>
</head>

<body>
<script>
window.onload = function() {
    var statusElement = document.getElementById("status");
    var currentStatus = statusElement.innerText.trim();
    if (currentStatus === "approved") {
    	statusElement.style.color="green";
        statusElement.classList.add("approved");
    } else {
        statusElement.classList.add("not-approved");
        statusElement.style.color="red";
    }
    
    statusElement.addEventListener("click", function() {
        var currentStatus = statusElement.innerText.trim();
        
        // Toggle between approved and not approved
        if (currentStatus === "approved") {
            statusElement.innerText = "not approved";
            statusElement.classList.remove("approved");
            statusElement.style.color="red";
            statusElement.classList.add("not-approved");
        } else if (currentStatus === "not approved") {
            statusElement.innerText = "approved";
            statusElement.style.color="green";
            statusElement.classList.remove("not-approved");
            statusElement.classList.add("approved");
        }
    });
};
</script>
<!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId > 0}">

   <!--  <div class="app-branding" style="width:100%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/dashboard}>
				        <img class="logo-icon" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				</div> --><!-- End Logo -->
	
		   <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/userDashboard}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				    <!-- <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
			</div>	
    <!--  <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

       <!-- Include the header fragment -->
   <div th:replace="fragments/header :: header"></div>

  </header> <!-- End Header -->
   
   <!-- =======Super Admin Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId == 0}">

    <div class="d-flex align-items-center logo-container" style="width:45%;margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/navbar}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				    <!-- <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
	</div><!-- End Logo -->

    <!-- <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

    <div th:replace="fragments/superAdminHeader :: header"></div>

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  
<aside id="sidebar" class="sidebar">
<input type="hidden" id="employee-id" th:value="${empDetailsByEmpId.deptId}">
<input type="hidden" id="employeeId1" name="empId" th:value="${empDetailsByEmpId.empid}" />
<input type="hidden" id="loggedEmpEmail" th:value="${empDetailsByEmpId.email}">

    <ul class="sidebar-nav" id="sidebar-nav">
		 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/userDashboard}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link " th:href="@{/navbar}">
		        <i class="bi bi-grid"></i>
		        <span>Dashboard</span>
		    </a>
	    </li>
	    <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>
		
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>
		<li class="nav-item" th:if="${session.permissions.dispatch && empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/dispatchIframe}">
                <i class="bi bi-truck"></i>
                <span>Dispatched Details</span>
            </a>
        </li>
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminProfile(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-person"></i>
                 <span>My Profile</span>
            </a>
        </li>  
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a> 
        </li>      
       <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-telephone"></i>
                <span>Employee Contacts</span>
            </a>
        </li>
       <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link " th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
        </li> -->
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/adminHoliday}">
                <i class="bi bi-calendar4-week"></i>
                <span>Holiday List</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>	
		        <span>Employee</span>
		    </a>
	   </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-card-text"></i>
                <span>Team Leaves</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/events}">
                <i class="bi bi-megaphone"></i>
                <span>Announcements</span>
            </a>
        </li>               
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link active" th:href="@{/ongoingProject}">
                <i class="bi bi-card-heading"></i>
                <span>Projects</span>
            </a>
        </li>   
        <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminPayslip(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-file-text"></i>
                <span>Payslip</span>
            </a>
        </li>     --> 
         <!-- Loop through the permissions map -->
       <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.apprisalAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" id="apprisalLink" th:href="@{/apprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Appraisal</span>
		    </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" id="apprisalLink" th:href="@{/employeeApprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Employee Appraisal</span>
		    </a>
		</li>
       <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span>
				</a>
		</li>
				<li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(V.0.1.2)</span>
					        </span>
					    </a>
		</li>
        
	    <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a>
        </li>  -->
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/adminHoliday}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Holiday List</span>
		    </a>
	 </li>	
	 
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/addInterComm}">
                <i class="bi bi-telephone"></i>
                <span>Communication</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-envelope-open"></i>
                <span>Group Mail Id</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/hikeRatingForm}">
			<i class="bi bi-arrow-up-circle"></i><span>Appraisal Ratings</span>
		</a>
	</li>
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/apprisalEmployee}">
			<i class="bi bi-check-square"></i><span>Submitted Appraisals</span>
		</a>
	</li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
          <a class="nav-link" href="hrActivity">
	        <i class="bi bi-file-lock"></i><span>Permissions</span>
	    </a>
      </li>
	 <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
      </li> -->
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Team Leaves</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/events}">
		        <i class="bi bi-megaphone"></i>
		        <span>Employee Leaves</span>
		    </a>
	 </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/addDepartment}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Department</span>
		    </a>
	   </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/addRole}">
		        <i class="bi bi-receipt"></i>
		        <span>Role</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>
		        <span>Employee</span>
		    </a>
	 </li> 
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:classappend="${empDetailsByEmpId.deptId==0} ? ' active'"   th:href="@{/ongoingProject}">
                <i class="bi bi-calendar3"></i>
                <span>Projects</span>
            </a>
      </li>  
	
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
      </li>  
      <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
              <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#interview-summary-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Interview Summary</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="interview-summary-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
		            <a href="totalCandidatesList">
		              <i class="bi bi-circle"></i><span>Total Candidates</span>
			            </a>
			          </li>
			        <li>
		            <a href="selectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Selected Candidates</span>
		            </a>
		          </li>
		          <li>
		            <a href="rejectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Rejected Candidates</span>
		            </a>
		          </li>
			    </ul>
			</li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link" href="feedbackReports">
			        <i class="bi bi-chat-square-text"></i>
			        <span>Feedback Reports</span>
			    </a>
		 </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span>
				</a>
		</li> 
		<li class="nav-item new-feature"  th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(Policy Update)</span>
					        </span>
					    </a>
		</li>
    </ul>
</aside>


	<main id="main" class="main">
	
	<input type="hidden" id="loggedAdminEmpId2" th:value="${session.loggedAdminEmpId}">
	<input type="hidden" id="loggedAdminEmailId2" th:value="${session.email}">
	
	<div class="chat-app" style="display: none;">
                <div id="plist" class="people-list">
                        <div class="input-group mb-3">
                                <input type="text" id="searchInputModal" class="form-control" placeholder="Search..."
                                        aria-label="Search">
                                <span class="input-group-text">
                                        <i class="bi bi-search"></i>
                                </span>

                        </div>
                        <ul id="employeeNames" class="list-unstyled chat-list mt-2 mb-0">
                                <!-- Employee names will be dynamically populated here -->
                        </ul>
                </div>

                <div class="chat">
                        <div class="chat-header clearfix">
                                <div class="row w-100">

                                        <!-- Employee Photo and Name Section -->
                                        <div class="col-lg-6 d-flex align-items-center">
                                                <div class="chat-about d-flex align-items-center">
                                                        <img id="employeePhoto" class="employee-photo" src="default-avatar.png"
                                                                alt="Employee Photo" />
                                                        <h6 class="m-b-0 ml-2" id="employeeName">Select an Employee</h6>
                                                </div>
                                        </div>
                                        <!-- Right aligned three dots (Vertical) -->
                                        <div class="col-lg-6 text-right">
                                                <div class="dropdown custom-dropdown">
                                                        <button class="btn btn-outline-secondary" type="button" id="dropdownMenuButton"
                                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                                <i class="fa fa-ellipsis-v"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                                                <li><a class="dropdown-item" href="#">Delete Chat</a></li>
                                                                <li><a class="dropdown-item" href="#">Mute</a></li>
                                                                <li><a class="dropdown-item" href="#">Contact Info</a></li>
                                                        </ul>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        <div id="chat-window" class="chat-history">
                                <ul class="m-b-0">
                                        <!-- Chat messages will be populated here dynamically -->

                                </ul>
                                <div id="message-icon-container" class="message-icon" style="display: none;">

                                        <!-- Plain square message icon SVG (behind) -->
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                        <path
                                                                d="M10 9H17M10 13H17M7 9H7.01M7 13H7.01M21 20L17.6757 18.3378C17.4237 18.2118 17.2977 18.1488 17.1656 18.1044C17.0484 18.065 16.9277 18.0365 16.8052 18.0193C16.6672 18 16.5263 18 16.2446 18H6.2C5.07989 18 4.51984 18 4.09202 17.782C3.71569 17.5903 3.40973 17.2843 3.21799 16.908C3 16.4802 3 15.9201 3 14.8V7.2C3 6.07989 3 5.51984 3.21799 5.09202C3.40973 4.71569 3.71569 4.40973 4.09202 4.21799C4.51984 4 5.0799 4 6.2 4H17.8C18.9201 4 19.4802 4 19.908 4.21799C20.2843 4.40973 20.5903 4.71569 20.782 5.09202C21 5.51984 21 6.0799 21 7.2V20Z"
                                                                stroke="#94b7db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </g>
                                        </svg>

                                        <!-- SVG with animation -->
                                        <svg class="animated-icon" viewBox="0 0 374 374" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0)">
                                                        <path
                                                                d="M318.084 132.622C311.339 101.37 287.642 82 256.652 82C238.423 82 217.459 89.3248 197.954 102.509C191.574 106.904 182.642 106.904 176.079 102.672C155.298 88.9992 135.246 82 116.652 82C85.6626 82 61.9647 101.533 55.2199 133.111C44.2824 183.896 80.923 252.26 187.017 291C292.746 251.446 329.204 183.082 318.084 132.622Z" />
                                                        <path
                                                                d="M187.466 0C187.366 0 187.166 0 186.866 0C85.666 0 3.36603 82.3 3.36603 183.5C3.36603 224.8 17.466 264.9 43.266 297.2L16.566 359.3C14.366 364.4 16.766 370.3 21.766 372.4C23.566 373.2 25.566 373.4 27.466 373.1L125.366 355.9C144.966 363 165.566 366.6 186.366 366.5C287.566 366.5 369.866 284.2 369.866 183C370.066 82.1 288.366 0.1 187.466 0ZM192.966 269.8C188.966 271.3 184.666 271.3 180.666 269.8C149.066 257.1 124.466 238.3 109.466 215.4C95.966 194.7 90.766 171.4 94.866 149.9C100.466 121.4 121.866 102.3 148.266 102.3C160.966 102.3 173.866 106.5 186.766 114.7C199.366 106.5 212.466 102.3 225.066 102.3C251.866 102.3 272.866 120.9 278.466 149.6C286.066 188.8 262.666 241.3 192.966 269.8Z" />
                                                </g>
                                                <defs>
                                                        <clipPath id="clip0">
                                                                <rect width="373.232" height="373.232" fill="white" />
                                                        </clipPath>
                                                </defs>
                                        </svg>



                                        <!-- Dots Animation -->
                                        <div class="dots">
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                        </div>
                                </div>


                        </div>
                        <!-- Move the paragraph outside the chat window -->
                        <p id="logo-text"
                                style="text-align: center; font-size: 14px; color: #6c757d; margin-top: 10px; display: none;">
                                "Reach out to your colleagues and stay on top of your projects with quick, seamless communication."
                        </p>
                        <div class="chat-message clearfix">
                                <div class="custom-input-group mb-0">
                                        <input type="text" id="message" class="custom-form-control" placeholder="Enter your message..." />
                                        <div class="custom-input-group-append">
                                                <button class="custom-send-btn" onclick="sendMessage()">
                                                        <i class="ri ri-send-plane-2-fill"></i>
                                                </button>
                                        </div>
                                </div>
                        </div>
                </div>
        </div>
        <input type="hidden" th:value="${empDetailsByEmpId.email}" id="loggedInMail">
	
	<input type="hidden" id="emp_idSessionValue" th:value="${empDetailsByEmpId.empid}">
	<!-- Confirmation Modal -->
	<div id="confirmModal" class="modal" tabindex="-1" role="dialog">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Extend Project Assignment</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <p>The selected email(s) are already assigned to another project. Do you want to extend their assignment?</p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" id="extendYes" class="btn btn-primary">Yes, Extend</button>
	        <button type="button" id="extendNo" class="btn btn-secondary" data-dismiss="modal">No, Don’t Extend</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Confirmation Modal -->
	<div id="mutlipleDept" class="modal" tabindex="-1" role="dialog">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Extend Project Assignment</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <p>The selected email(s) are already assigned to another project. Do you want to extend their assignment?</p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" id="extendYes" class="btn btn-primary">Yes, Extend</button>
	        <button type="button" id="extendNo" class="btn btn-secondary" data-dismiss="modal">No, Don’t Extend</button>
	      </div>
	    </div>
	  </div>
	</div>
			<!-- Feedback Modal -->
			<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
			    <div class="modal-dialog  custom-width">
			        <div class="modal-content rounded-4 shadow-lg">
			            <div class="modal-header border-0">
			                <h5 class="modal-title" id="feedbackModalLabel">Feedback Form</h5>
			                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			            </div>
			            <div class="modal-body">
			                <form id="feedbackForm" method="post" enctype="multipart/form-data">
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackName" class="form-label fw-bold">Your Name</label>
			                        <input type="text" class="form-control" id="feedbackName" name="name" th:value="${empDetailsByEmpId.fullName}" readonly>
			                    </div>
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackEmail" class="form-label fw-bold">Your Email</label>
			                        <input type="email" class="form-control" id="feedbackEmail" name="email" th:value="${empDetailsByEmpId.email}" readonly>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackEmailyy" class="form-label fw-bold">To</label>
			                        <div class="to-field-container">
			                            <span class="to-field rounded-pill px-3 py-2 shadow-sm">bugs_msplconnect@melangesystems.com</span>
			                        </div>
			                    </div>
								<div class="mb-3">
								    <label for="bugType" class="form-label fw-bold">Bug Type</label>
								    <select class="form-control" id="bugType" name="bugType" required>
								        <option value="About Application">About Application</option>
								        <option value="New Feature">New Feature</option>
								    </select>
								</div>

			                    <div class="mb-3">
			                        <label for="feedbackMessage" class="form-label fw-bold">Message</label>
			                        <textarea class="form-control" id="feedbackMessage" name="message" rows="4" placeholder="Enter your feedback here..." required></textarea>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackAttachment" class="form-label fw-bold">Attachment (optional)</label>
			                        <input type="file" class="form-control" id="feedbackAttachment" name="attachment" accept=".png, .jpg, .jpeg" multiple>
			                        <small class="text-muted">Max size: 5MB. You can upload multiple images.</small>
			                    </div>
			                    <button type="submit" class="btn btn-primary w-100 mt-3 py-2 shadow-sm" id="submitFeedbackBtn">Submit Feedback</button>
			                </form>
			            </div>
			        </div>
			    </div>
			</div>
		<div class="pagetitle d-flex mb-0 justify-content-between" th:if="${empDetailsByEmpId.deptId==0}">
		    <div class="d-flex">
		        <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px;cursor:pointer;"></i>
				<nav>
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a th:href="@{/navbar}">Home</a></li>
						<li class="breadcrumb-item active">Project</li>
					</ol>
				</nav>
		    </div>
			
			<!-- <button type="button" class="btn btn-primary" id="listImageViewButton" onclick="addProject()">Add Project</button> -->
			<button type="button" class="btn btn-primary" id="addProjectButton" onclick="addNewProject()">Add Project</button>
		</div>
		<div class="pagetitle d-flex mb-0 justify-content-between" th:if="${empDetailsByEmpId.deptId>0}">
			<div class="d-flex">
				<i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px;cursor:pointer;"></i>
				<nav>
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a th:href="@{/userDashboard}">Home</a></li>
						<li class="breadcrumb-item active">Project</li>
					</ol>
				</nav>
			</div>
		    
			<!-- <button type="button" class="btn btn-primary" id="listImageViewButton" onclick="addProject()">Add Project</button> -->
			<button type="button" class="btn btn-primary" id="addProjectButton" onclick="addNewProject()">Add Project</button>
		</div>
		<!-- End Page Title    bx-book-add-->

		<section class="section dashboard">

			<!-- add projecy form -->

			<div class="app-wrapper">
				<div class="app-content pt-3 p-md-1 p-lg-1" id="appContent">
					<div th:if="${errorMessage}"
						class="alert alert-danger alert-dismissible fade show"
						role="alert">
						<p th:text="${errorMessage}"></p>
						<button type="button" class="close" data-dismiss="alert"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>

					<div class="container-xl mt-2">
						<!--   <div th:if="${newProjectDetails != null and !newProjectDetails.isEmpty()}">
			            <h2>New Projects</h2>
			            <div class="cards-container">
			                <div th:each="project : ${newProjectDetails}" class="card">
			                    <h3 th:text="${project.project_name}">Project Name</h3>
			                    <p th:text="${project.project_manager}">Project Description</p>
			                    Add more project details as needed
			                </div>
			            </div>
			        </div>   there is no  -->
						<div></div>

						<div class="compProjectCardsBody" id="compProjectCardsBody"
							style="border-radius: 5px;">
							<div class="compProjectCardsRow" id="compProjectCardsRow"></div>
						</div>
						<div class="tab-content mt-2" id="addProject"
							style="display: none; margin-left: 5px;">
							<div class="" id="orders-all1" role="tabpanel"
								aria-labelledby="orders-all-tab">
								<div class="app-card app-card-orders-table shadow-sm mb-5">

									<div class="app-card-body p-4 projectAssignClass" style="font-size:14px">
										<div>
											<form class="addEmployeeForm" th:action="@{/saveProject}"
												method="post" th:object="${projectEntity}" id="myForm">
												<div class="card">
												<div class="d-flex justify-content-between">
													<div class="p-4" style="width: 50%;">
														
														<div class="form-group">
															 
															<label for="projectName">Project Name:</label> 
															<input type="text" class="form-control"
																   th:field="*{project_name}" id="projectName"
																   name="projectName" required>
																   
														</div>

														<input type="hidden" th:field="*{id}" id="id" name="id">
														<input type="hidden" th:field="*{project_id}"
															id="project_id" name="project_id" value="${project_id}">

														<div class="form-group">
															<label for="dept">Department:</label> 
															<!-- <select id="dept" class="form-control" th:field="*{department}"
																name="dept" required>
																<option value="">Select a Department</option>
																<option th:each="dept : ${departments}"
																	th:value="${dept.dept_id}" th:text="${dept.deptName}"></option>
															</select> -->
															
															<input type="text" class="form-control"
																   th:field="*{department}"
																   th:value="${empDetailsByEmpId.deptName}"
																   id="dept" name="dept" required>
														</div>

														<div class="form-group">
															<label for="prjManager">Project Manager:</label> 
															<select 
																id="prjManager" class="form-control"
																th:field="*{project_manager}" name="prjManager" required>
																<option value="">Select a Lead</option>
															</select>
														</div>
														<div class="form-group">
															<label for="selectManager">Under the Guidance Of:</label>
															<select id="selectManager" name="senior_name"
																class="form-control">
																<option value="">Select a Guider</option>
															</select>
														</div>
													</div>
													<div class="p-4" style="width: 50%;">
														<label for="selectTeamMembers">Add Employee:</label>
														<div class="mutlipleUserContainer">
															<div class="form-group">
																<!-- <label for="selectTeamMembers">Team Members:</label> --> 
																<!-- <select
																	id="selectTeamMembers" name="team_members"
																	th:field="*{team_members}" class="form-control"
																	multiple required onchange="updateTextField()">
																	<option value="" disabled>Select Employees</option>
																</select> -->
																<!-- <div id="teamMembersWrapper" class="team-members-wrapper">
																    <div id="selectTeamMembers" class="team-members-container"></div>
																</div> -->
																
																<div id="teamMembersWrapper" class="team-members-wrapper">
																    <div id="teamMembersToggle" class="team-members-toggle">Select Employees ▼</div>
																    <div id="selectTeamMembers" class="team-members-container" style="margin-left:-5px"></div>
																</div>

															</div>
															<div class="form-group">
															    <div>&nbsp;</div>
															    <div id="selectedEmployeesContainer"></div>
															</div>
														</div>
														<div class="form-group">
															<label for="complationDate">Completion Date:</label> <input
																type="date" class="form-control"
																th:field="*{completion_date}" id="complationDate"
																name="complationDate" required>
														</div>
														<div class="form-group">
															<label for="description">Description:</label>
															<textarea class="form-control" id="description"
																th:field="*{description}" name="description" rows="8"
																cols="50"></textarea>
															<br>
														</div>
														<div class="form-group" style="display: none;">
															<label for="status">Status:</label> <input type="text"
																class="form-control" th:field="*{status}" id="status"
																name="status" value="pending">
														</div>
													</div>
												</div>
												</div>
												<hr> 

												<!-- Add Task link and Submit button -->
												<a href="#" class="link-primary"
													style="color: blue !important; text-decoration: none"
													onclick="addTaskForm(event)"> <span class="addLink"><i
														class="fas fa-plus"></i>Add Task</span>
												</a>

												<div id="taskFormsContainer" class="mt-4"></div>
												<input type="hidden" id="extendAssignment" name="extendAssignment" value="false" />
												<input type="hidden" id="addRequirement" name="addRequirement" value="false" />
												<button type="submit" class="btn btn-primary float-right"
													style="margin-bottom: 20px;">Submit</button>  
												<br>
											</form>
										</div>
									</div>
								</div>

							</div>
							<!--//app-card-->
						</div>
						<!--//tab-pane-->
					</div>
					<!--//tab-content-->

					<!-- all ongoing project table  -->
					<nav id="orders-table-tab"
						class="orders-table-tab app-nav-tabs nav shadow-sm flex-column flex-sm-row mt-2"
						style="background-color: white;display:none">
						<a class="flex-sm-fill text-sm-center nav-link active"
							id="orders-all-tab" data-bs-toggle="tab" href="#orders-all"
							role="tab" aria-controls="orders-all" aria-selected="true"
							style="color: black;">Ongoing</a> <a
							class="flex-sm-fill text-sm-center nav-link" id="orders-paid-tab"
							data-bs-toggle="tab" href="#orders-paid" role="tab"
							aria-controls="orders-paid" aria-selected="false"
							style="color: black;">Completed</a>
					</nav>

					<div class="tab-content" id="orders-table-tab-content"
						style="margin-top: -10px; display:none">
						<div class="tab-pane fade show active" id="orders-all"
							role="tabpanel" aria-labelledby="orders-all-tab">
							<div class="app-card app-card-orders-table shadow-sm mb-5">
								<div class="app-card-body">
									<div class="table-responsive p-2">
										<table id="projectTable" class="table mb-0 holidayTable">
											<thead>
												<tr>
													<th class="cell">Project Name</th>
													<th class="cell">Project Manager</th>
													<th class="cell">Department</th>
													<th class="cell">Team Members</th>
													<th class="cell">Expected Date</th>
													<th class="cell">Status</th>
												</tr>
											</thead>
											<tbody>
												<tr th:if="${#lists.isEmpty(pendingProjectDetails)}">
													<td colspan="7">No data available</td>
												</tr>
												<tr th:each="projectDetail : ${pendingProjectDetails}"
													th:unless="${#lists.isEmpty(pendingProjectDetails)}">
													<td th:text="${projectDetail.project_name}"></td>
													<td th:text="${projectDetail.project_manager}"></td>
													<td th:text="${projectDetail.department}"></td>
													<td><span
														th:utext="${#strings.replace(projectDetail.team_members, ',', '<br/>')}"></span>
													</td>
													<td class="dateColumn"
														th:text="${projectDetail.completion_date}"></td>
													<td style="color: red" th:text="${projectDetail.status}"
														th:onclick="updateStatus([[${projectDetail.id}]])"></td>

													<!-- <td th:text="${projectDetail.reason}"></td>			
										        <td th:text="${projectDetail.status}" id="status" th:class="${leaveRequestList.status == 'approved' ? 'green-text' : 'red-text'}"></td> -->
													<!-- Add more columns as needed -->
												</tr>
											</tbody>
										</table>
									</div>
									<!--//table-responsive-->
								</div>
								<!--//app-card-body-->
							</div>
							<!--//app-card-->
						</div>
						<!--//tab-pane-->

						<!--//tab-pane-->

						<div class="tab-pane fade" id="orders-paid" role="tabpanel"
							aria-labelledby="orders-paid-tab">
							<div class="app-card app-card-orders-table mb-5">
								<div class="app-card-body">
									<div class="table-responsive">
										<table id="projectTable"
											class="table table-hover mb-0 text-center">
											<thead>
												<tr>
													<th class="cell">Project Name</th>
													<th class="cell">Project Manager</th>
													<th class="cell">Department</th>
													<th class="cell">Team Members</th>
													<th class="cell">Expected Date</th>
													<th class="cell">Completed Date</th>
													<th class="cell">Description</th>
													<th class="cell">Status</th>
												</tr>
											</thead>
											<tbody>
												<!-- Check if completedProjectDetails is empty or null -->
												<tr th:if="${#lists.isEmpty(completedProjectDetails)}">
													<td colspan="7">No data available</td>
												</tr>
												<tr th:each="projectDetail : ${completedProjectDetails}"
													th:unless="${#lists.isEmpty(completedProjectDetails)}">
													<td th:text="${projectDetail.project_name}"></td>


													<td th:text="${projectDetail.project_manager}"></td>
													<td th:text="${projectDetail.department}"></td>
													<td><span
														th:utext="${#strings.replace(projectDetail.team_members, ',', '<br/>')}"></span>
													</td>
													<td class="dateColumn"
														th:text="${projectDetail.completion_date}"></td>
													<td class="dateColumn"
														th:text="${projectDetail.completed_date}"></td>
													<td th:text="${projectDetail.description}"></td>
													<td id="statusCell" style="color: green"
														th:text="${projectDetail.status}"></td>

													<!-- <td th:text="${projectDetail.reason}"></td>			
										       <td th:text="${projectDetail.status}" id="status" th:class="${leaveRequestList.status == 'approved' ? 'green-text' : 'red-text'}"></td> -->
													<!-- Add more columns as needed -->
												</tr>
											</tbody>
										</table>
									</div>
									<!--//table-responsive-->
								</div>
								<!--//app-card-body-->
							</div>
							<!--//app-card-->
						</div>
					</div>
					<div class="d-flex flex-wrap">
						<div th:each="project : ${newProjectDetails}"
							class="col-6 col-lg-2 mb-2" style="width: 190px; height: 130px;">
							<!--   <div class="app-card app-card-stat shadow-sm h-100 shining-card" data-toggle="modal" th:data-target="'#projectModal-' + ${project.id}" >
				                    <div class="app-card-body p-2 p-lg-4" >
				                        <p style="font-size:12px;font-weight:bold;">New Projects</p>
				                        <h6 class="stats-type mb-1" th:text="${project.project_name}" style="font-size:12px;font-weight:bold;color:black"></h6>
				                       
				                    </div>//app-card-body
				                    <a class="app-card-link-mask" href="#"></a>
				                </div>  -->
							<!--//app-card-->

							<!-- Modal -->
							<!--   <div class="modal fade" th:id="'projectModal-' + ${project.id}" tabindex="-1" role="dialog" aria-labelledby="projectModalLabel" aria-hidden="true">
				                    <div class="modal-dialog" role="document">
				                        <div class="modal-content">
				                            <div class="modal-header">
				                                <h5 class="modal-title" id="projectModalLabel" th:text="${project.project_name}"></h5>
				                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				                                    <span aria-hidden="true">&times;</span>
				                                </button>
				                            </div>
				                            <div class="modal-body">
				                                <div class="table-responsive p-2">
				                                    <table class="table table-bordered">
				                                        <tbody>
				                                            <tr>
				                                                <th>Project ID:</th>
				                                                <td th:text="${project.project_id}"></td>
				                                            </tr>
				                                            <tr>
				                                                <th>Department:</th>
				                                                <td th:text="${project.department}"></td>
				                                            </tr>
				                                            <tr>
				                                                <th>Completion Date:</th>
				                                                <td th:text="${project.completion_date}"></td>
				                                            </tr>
				                                            <tr>
				                                                <th>Project Manager:</th>
				                                                <td th:text="${project.project_manager}"></td>
				                                            </tr>
				                                            <tr>
				                                                <th>Description:</th>
				                                                <td th:text="${project.description}"></td>
				                                            </tr>
				                                        </tbody>
				                                    </table>
													<div id="delayReasonId" style="display:none" class="p-2">
													<hr class="mb-4">
													Reason:<textarea id="delayReason" name="reason" rows="3" cols="50"></textarea><br><br>
														<input type="text" name="delayReason" id="delayReason">
														Strat Date:<input type="date" name="startDate" id="startDate">
													</div>
				                                </div>                               
				                            </div>
				                            <div class="modal-footer">
				                                   <button th:if="${project.flag == 1}" type="button" class="btn btn-primary action-btn" th:data-project-id="${project.id}" data-action="accept" style="color:white">Accept</button>
												   <button class="btn btn-primary" th:onclick="'delayFunction(' + ${project.id} + ')'" id="delayBtn">Delay</button>
                            					   <button class="btn btn-primary" style="display:none" id="submitBtn" th:onclick="'submitFunction(' + ${project.id} + ')'">Submit</button>
                            
                                              <button th:if="${project.flag == 3}" type="button" class="btn btn-success assign-btn" th:data-project-id="${project.id}" style="color:white">Assign</button>
				                               <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				                            </div>
				                        </div>
				                    </div>
				                </div>//modal -->
						</div>
						<!--//col-->
					</div>
					<!--//flex-wrap-->


					<!-- Code to display Delay projects -->
					<div class="row g-2 mb-2"
						th:if="${findByDelayProject != null and !findByDelayProject.isEmpty()}">
						<div class="d-flex flex-wrap">
							<div th:each="project : ${findByDelayProject}"
								class="col-6 col-lg-2 mb-2" style="width: 190px; height: 130px;">
								<!-- <div class="app-card app-card-stat shadow-sm h-100 delay-shining-card" data-toggle="modal" th:data-target="'#projectModal-' + ${project.id}" >
				                    <div class="app-card-body p-2 p-lg-4">
				                        <p style="font-size:12px;font-weight:bold;">Delay Projects</p>
				                        <h6 class="stats-type mb-1" th:text="${project.project_name}" style="font-size: 12px;font-weight:bold;color:black"></h6>
				                    </div>//app-card-body
				                    <a class="app-card-link-mask" href="#"></a>
				                </div>  -->
								<!-- //app-card -->

								<!-- Modal -->
								<div class="modal fade" th:id="'projectModal-' + ${project.id}"
									tabindex="-1" role="dialog" aria-labelledby="projectModalLabel"
									aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" id="projectModalLabel"
													th:text="${project.project_name}"></h5>
												<button type="button" class="close"
													th:onclick="'closeModal('+${project.id}+')'"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="table-responsive p-2">
													<table class="table table-bordered">
														<tbody>
															<tr>
																<th>Project ID:</th>
																<td th:text="${project.project_id}"></td>
															</tr>
															<tr>
																<th>Department:</th>
																<td th:text="${project.department}"></td>
															</tr>
															<tr>
																<th>Completion Date:</th>
																<td th:text="${project.completion_date}"></td>
															</tr>
															<tr>
																<th>Project Manager:</th>
																<td th:text="${project.project_manager}"></td>
															</tr>
															<tr>
																<th>Description:</th>
																<td th:text="${project.description}"></td>
															</tr>
														</tbody>
													</table>
													<div th:id="'AdminDeliveryDate-' + ${project.id}"
														style="display: none" class="p-2">
														<hr class="mb-4">
														Select completion date by Admin: <input type="date"
															class="startDate" name="startDate" id="startDate">
													</div>
												</div>
											</div>


											<div class="modal-footer">
												<button th:if="${project.flag == 3}" type="button"
													class="btn btn-primary action-btn"
													th:data-project-id="${project.id}" th:data-action="accept"
													style="display: none"
													th:id="'actionBtn-' + ${project.id}">Accept</button>
												<button class="btn btn-primary"
													th:onclick="'displayDateModel1(' + ${project.id} + ')'"
													th:id="'displayDateModel1-' + ${project.id}">Accccept</button>
												<button type="button" class="btn btn-secondary"
													th:onclick="'closeModal(' + ${project.id} + ')'">Close</button>
											</div>
										</div>
									</div>
								</div>
								<!--//modal-->
							</div>
							<!--//col-->
						</div>
						<!--//flex-wrap-->
					</div>
					<!--//row-->

					<!-- Code to display unassigned cards -->
					<div class="row g-2 mb-2"
						th:if="${unAssignedProjects != null and !unAssignedProjects.isEmpty()}">
						<div class="d-flex flex-wrap">
							<div th:each="project1 : ${unAssignedProjects}"
								class="col-6 col-lg-2 mb-2" style="width: 190px; height: 130px;">

								<!-- <div class="app-card app-card-stat shadow-sm h-100" data-toggle="modal" th:data-target="'#projectModal-' + ${project1.id}">
				                <div class="app-card-body p-2 p-lg-4">
				                    <p style="font-size:12px;font-weight:bold;">Unassigned Projects</p>
				                    <h6 class="stats-type mb-1" th:text="${project1.project_name}" style="font-size: 12px;font-weight:bold;color:black"></h6>
				                </div>
				                <a class="app-card-link-mask" href="#"></a>
				            </div>  -->

								<div class="modal fade" th:id="'projectModal-' + ${project1.id}"
									tabindex="-1" role="dialog" aria-labelledby="projectModalLabel"
									aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" id="projectModalLabel"
													th:text="${project1.project_name}"></h5>
												<button type="button" class="close"
													th:onclick="'closeModal('+${project1.id}+')'"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="table-responsive p-2">
													<table class="table table-bordered">
														<tbody>
															<tr>
																<th>Project ID:</th>
																<td th:text="${project1.project_id}"></td>
															</tr>
															<tr>
																<th>Department:</th>
																<td th:text="${project1.department}"></td>
															</tr>
															<tr>
																<th>Completion Date:</th>
																<td th:text="${project1.completion_date}"></td>
															</tr>
															<!-- <tr>
																<th>Project Manager:</th>
																<td th:text="${project1.project_manager}"></td>
															</tr> -->
															<tr>
																<th>Description:</th>
																<td th:text="${project1.description}"></td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-primary assign-btn"
													th:data-id="${project1.id}"
													th:data-project-id="${project1.project_id}"
													th:data-project-name="${project1.project_name}"
													th:data-department="${project1.department}"
													th:data-completion-date="${project1.completion_date}"
													th:data-project-manager="${project1.project_manager}"
													th:data-description="${project1.description}"
													onclick="addProject(null,this)">Assign</button>
												<button type="button" class="btn btn-secondary"	th:onclick="'closeModal('+${project1.id}+')'">Close</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="card pt-2" id="addProjectContainer" style="display: none;">
				       <div class="card-body">
				        <div class="pagetitle d-flex mb-0 justify-content-between">
				            <h5 class="card-title p-0 mt-1" id="formTitle">Add Project</h5>
				            <button type="button" class="btn btn-primary" id="listImageViewButton" onclick="viewProject()">View Project</button>
				        </div>

						<div class="addCompProjectFormOuterBox">
							<div class="container mt-3" style="font-size:14px;">
								 <form class="addCompProjectForm" th:action="@{/saveNewCompProjectList}" method="post" th:object="${newCompProj_Entity}" onsubmit="return validateForm();">
					                <input type="hidden" id="assignedSubmitDate" th:field="*{assigned_date}">
					
					                <div class="row">
					                    <!-- Select Department -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Select Department(s):</label>
					                        <div class="dropdown-container">
					                            <button type="button" class="dropdown-btn" onclick="toggleDropdown()">Select Department(s)</button>
					                            <div class="dropdown-menu1" id="departmentDropdown">
					                                <th:block th:each="dept : ${departments}">
					                                    <div>
					                                        <input type="checkbox" class="dept-checkbox" name="department" th:value="${dept.deptName}" onchange="updateSelectedDepartments()" />
					                                        <span th:text="${dept.deptName}"></span>
					                                    </div>
					                                </th:block>
					                            </div>
					                        </div>
					                        <div id="selectedContainer" class="selected-container">
					                            <label>Selected Department(s):</label>
					                            <ul id="selectedDepartmentsList" class="selected-list"></ul>
					                        </div>
					                    </div>
					
					                    <!-- Select Project Type -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Select Project Type:</label>
					                        <select class="form-control" name="prj_type" th:field="*{prj_type}" id="platform_to_work" style="font-size:14px;" required>
					                            <option value="" selected>Select Project Type</option>
					                            <option id="int" value="Int">Internal</option>
					                            <option id="ext" value="Ext">External</option>
					                        </select>
					                    </div>
					
					                    <!-- Project Name -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Project Name:</label>
					                        <input type="text" th:field="*{project_name}" class="form-control" id="project_name" placeholder="Enter project name" required>
					                    </div>
					
					                    <!-- Reference Project -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Reference Project:</label>
					                        <input type="text" th:field="*{ref_prj}" class="form-control" id="ref_prj" placeholder="Enter reference project">
					                    </div>
					
					                    <!-- Project Description -->
					                    <div class="col-md-12 mb-3">
					                        <label class="form-label">Project Description:</label>
					                        <textarea class="form-control" th:field="*{description}" placeholder="Enter description" id="projDescription" required></textarea>
					                    </div>
					
					                    <!-- Client Name -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Client Name:</label>
					                        <input type="text" th:field="*{client_name}" class="form-control" id="client_name" placeholder="Enter client name">
					                    </div>
					
					                    <!-- Completion Date -->
					                    <div class="col-md-6 mb-3">
					                        <label class="form-label">Completion Date:</label>
					                        <input type="date" th:field="*{completion_date}" class="form-control" id="delivery_date" required>
					                    </div>
					                        <!-- Buttons -->
											<div class="d-flex justify-content-end mt-3">
											    <button type="reset" class="btn btn-secondary me-2">Clear</button>
											    <button type="submit" class="btn btn-primary">Assign</button>
											</div>
											
					                </div>
					            </form>
							</div>
						</div>
					</div>
				</div>

			</div><!--//app-content-->   
		</section>
	</main>
	<!-- End #main -->

	<!-- ======= Footer ======= -->
	<footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>Melange System pvt ltd</span></strong>. All Rights Reserved
    </div>
  </footer><!-- End Footer -->

	<a href="#"
		class="back-to-top d-flex align-items-center justify-content-center"><i
		class="bi bi-arrow-up-short"></i></a>

	<!-- Vendor JS Files -->
	<script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
	<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="assets/vendor/chart.js/chart.umd.js"></script>
	<script src="assets/vendor/echarts/echarts.min.js"></script>
	<script src="assets/vendor/quill/quill.js"></script>
	<script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
	<script src="assets/vendor/tinymce/tinymce.min.js"></script>
	<script src="assets/vendor/php-email-form/validate.js"></script>
	<!-- Template Main JS File -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
	<script src="assets/js/chart.min.js"></script>
	
	<script src="assets/plugins/popper.min.js"></script>
	 
<script>
function addProject(event,button){ 
	
	// Check if event exists before calling stopPropagation
    if (event) {  
        event.stopPropagation();
        document.getElementById("addRequirement").value = "true";
    } 
	
    var teamContainer = document.getElementById("orders-table-tab-content");
    var ordersTableTab = document.getElementById("orders-table-tab");
    var addProject = document.getElementById("addProject");
    
    var id = button.getAttribute('data-id');//data-project-id
    var prjId = button.getAttribute('data-project-id');
    var projectName = button.getAttribute('data-project-name');
    var department = button.getAttribute('data-department');
    var completionDate = button.getAttribute('data-completion-date');
    var projectManager = button.getAttribute('data-project-manager');
    var description = button.getAttribute('data-description');
    
    console.log("teamContainer="+teamContainer+" ordersTableTab= "+ordersTableTab+" addProject="+addProject+" id"+id+" prjId= "+projectName + " department="+department
    		    +"completionDate="+completionDate+"  projectManager="+projectManager+"description="	
    );
    
    closeModal(id);
    
    console.log("Project ID to assign: " + id);
    
    if (teamContainer) { 
    	
        teamContainer.style.display = "none";	 
        ordersTableTab.style.display = "none";
        addProject.style.display = "block";        
         
        $(modalId).modal('hide');
        
        //var loggedAdminDepartmentId = document.getElementById('dept').value;
        /*   if (loggedAdminDepartmentId) {
            fetchEmployeesByDepartment(loggedAdminDepartmentId);
        } */
    }

    // Close the modal
    var modalId = '#projectModal-' + id;
    $(modalId).find('.btn-secondary[data-dismiss="modal"]').click();
    
    // Fill the form with the project details  project_id
    document.getElementById("id").value = id;
    document.getElementById("project_id").value = prjId;
    document.getElementById("projectName").value = projectName;
    document.getElementById("dept").value = department;
    document.getElementById("complationDate").value = completionDate;
    document.getElementById("prjManager").value = projectManager;
    document.getElementById("description").value = description;

    
    //alert(department);
    //call function to fetch Employee based on dept
    fetchEmployeesByDepartment(department);
    
    // Set focus on the "Department" dropdown and bring it a little up
    var deptElement = document.getElementById("dept");
    deptElement.focus();
    deptElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
}
</script> 

<!--  script to update the status when user click on the pending text -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<script src="assets/js/jquery-3.6.4.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
<script src="assets/js/sweetalert2@11.js"></script>
  
<script>
function updateStatus(projectId) {
    Swal.fire({
        title: 'Are you sure?',
        text: "Do you want to update the status of this project?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, update it!'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: 'updateStatus',
                type: 'POST',
                data: {
                    "projectId": projectId,
                },
                success: function(response) {
                    $('#statusCell').text('Completed'); // Update the status cell with the new status
                    $('#statusCell').css('color', 'blue'); // Optionally, change the color to indicate completion
                    console.log("success");
                    Swal.fire({
                        title: 'Updated!',
                        text: 'The project status has been updated.',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        location.reload(); // Reload the page after the user closes the alert
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error updating status:', error);
                }
            });
        }
    });
}
</script>

<!-- script to select multiple user in select field -->
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const selectElement = document.getElementById('selectTeamMembers');

        selectElement.addEventListener('focus', () => {
            selectElement.classList.add('expanded');
        });

        selectElement.addEventListener('blur', () => {
            selectElement.classList.remove('expanded');
        });
    });
</script>

<script>
    function addEmployeeToTextField(employeeName) {
    	 var selectedEmployeesContainer = document.getElementById("selectedEmployeesContainer");
    	    var employeeDiv = document.createElement("div");
    	    employeeDiv.classList.add("selectedEmployeeItem");

    	    var employeeText = document.createElement("span");
    	    employeeText.textContent = employeeName;

    	    var removeButton = document.createElement("button");
    	    removeButton.textContent = "x";
    	    removeButton.classList.add("removeButton");
    	    removeButton.onclick = function() {
    	        document.querySelector(`#selectTeamMembers input[value="${employeeName}"]`).checked = false;
    	        selectedEmployeesContainer.removeChild(employeeDiv);
    	    };

    	    employeeDiv.appendChild(employeeText);
    	    employeeDiv.appendChild(removeButton);
    	    selectedEmployeesContainer.appendChild(employeeDiv);
    }

    function updateTextField() {
       /*  var select = document.getElementById("selectTeamMembers");
        var selectedOptions = [];
        for (var i = 0; i < select.options.length; i++) {
            if (select.options[i].selected && !select.options[i].disabled) {
                selectedOptions.push(select.options[i].text);
            }
        }

        var selectedEmployeesContainer = document.getElementById("selectedEmployeesContainer");
        selectedEmployeesContainer.innerHTML = "";

        selectedOptions.forEach(function(employeeName) {
            addEmployeeToTextField(employeeName);
        }); */
        
    	var checkboxes = document.querySelectorAll('#selectTeamMembers input[type="checkbox"]:checked');
        var selectedEmployeesContainer = document.getElementById("selectedEmployeesContainer");
        selectedEmployeesContainer.innerHTML = "";

        checkboxes.forEach(checkbox => {
            addEmployeeToTextField(checkbox.value);
        });
    }

    function expandSelectDropdown() {
        var select = document.getElementById("selectTeamMembers");
        select.size = select.options.length > 5 ? 5 : select.options.length;
    }
    
    /* script to remove the red blur boreder after select the employee */
    
document.addEventListener('DOMContentLoaded', function() {
    const selectField = document.getElementById('selectTeamMembers');

    selectField.addEventListener('change', function() {
        if (selectField.selectedOptions.length > 0) {
            selectField.style.boxShadow = '';
        }
    });
});

function addTaskForm(event) { 
   
	event.preventDefault();
    //const selectedEmployees = document.getElementById('selectTeamMembers').selectedOptions;
    const selectedEmployees = document.querySelectorAll('#selectTeamMembers input[type="checkbox"]:checked');

    //console.log("mmmmmmmmmmm"+selectedEmployees);    
    const selectField = document.getElementById('selectTeamMembers');
    
    const projectId = document.getElementById('project_id').value;
    const projectName = document.getElementById('projectName').value;
    const complationDate = document.getElementById('complationDate').value;
    const prjManager = document.getElementById('prjManager').value;
    const selectGuide = document.getElementById('selectManager').value;
    
    if (selectedEmployees.length === 0) {
        selectField.style.boxShadow = '0 0 5px 2px red'; // Apply a blurred red border
        selectField.focus();
        return; // Exit the function if no employees are selected
    }
	
    // Reset border to default if employees are selected
    selectField.style.boxShadow = '';
	
    const taskFormsContainer = document.getElementById('taskFormsContainer');
    taskFormsContainer.innerHTML = '';

    for (let employee of selectedEmployees) {
    	
        //const employeeName = employee.text;
        const employeeValue = employee.value;
        const employeeName = employee.nextElementSibling.textContent; // Get label text

        const taskForm = document.createElement('div');
        taskForm.classList.add('card', 'mb-3');
        
        taskForm.innerHTML = `
            <div class="card-header task-header">
                <h5 class="card-title mb-0">Assign Task to ${employeeName}</h5>
            </div>
            <div class="card-body addtaskContainer" data-employee-value="${employeeValue}">
                <div class="task-fields-container">
                    <div style="display:flex;width:100%;">
                        <div class="form-group" style="width:100%;margin:10px;">
                            <input type="hidden" name="task_employee[]" value="${employeeValue}">
                            <label for="taskName_${employeeValue}_1">Task Name:</label>
                            <input type="text" class="form-control" th:field="*{taskName}" id="taskName_${employeeValue}_1" name="task_name[]" placeholder="Task Name" required>
                        </div>
                        <div class="form-group" style="width:100%;margin:10px;"> 
	                        <label for="taskDescription_${employeeValue}_1">Task Description:</label>
	                        <input type="text" class="form-control" id="taskDescription_${employeeValue}_1" name="task_description[]" placeholder="Task Description" required>
	                    </div>                          
                    </div>
                    <div class="form-group" style="width:100%;margin:10px">
	                	<input type="hidden" class="form-control" th:field="*{employeeName}" id="taskName_${employeeName}_1" name="employeeName[]" placeholder="employeeName" value="${employeeName}" required>
	                </div>
	                <div class="form-group" style="width:100%;margin:10px">
	                	<input type="hidden" class="form-control" th:field="*{prjManager}" id="taskName_${prjManager}_1" name="prjManager[]" placeholder="prjManager" value="${prjManager}" required>
	                	<input type="hidden" class="form-control" th:field="*{selectGuide}" id="taskName_${selectGuide}_1" name="selectGuide[]" placeholder="selectGuide" value="${selectGuide}" required>
	            	</div>
	                
	                <div class="form-group" style="width:100%;margin:10px;display:none">
	                	<input type="text" class="form-control" th:field="*{projectId}" id="taskName_${projectId}_1" name="projectId[]" placeholder="projectId" value="${projectId}" required>
	                </div>
	                <div class="form-group" style="width:100%;margin:10px;display:none">
	                	<input type="text" class="form-control" th:field="*{projectName}" id="taskName_${projectName}_1" name="projectName[]" placeholder="projectName" value="${projectName}" required>
	                </div>
	                <div class="form-group" style="width:100%;margin:10px;display:none">
	                	<input type="text" class="form-control" th:field="*{complationDate}" id="taskName_${complationDate}_1" name="complationDate[]" placeholder="complationDate" value="${complationDate}" required>
	                </div>                        
                
                    <!-- Subtasks Section -->
                    <div class="subtasks-container">
                        <h6>Subtasks:</h6>
                        <div class="subtasks-list" id="subtasksList_${employeeValue}_1"></div>
                        <button type="button" class="btn btn-secondary add-subtask-btn" onclick="addSubtask('${employeeValue}_1', '${employeeName}', document.getElementById('taskName_${employeeValue}_1').value, document.getElementById('taskDescription_${employeeValue}_1').value)">Add Subtask</button>
                    </div> 
                </div>
                <button type="button" class="btn btn-primary add-more-task-btn" onclick="addMoreTaskFields(this)">Add More Task</button>
            </div>
        `;
        taskFormsContainer.appendChild(taskForm);
    }
}

function addMoreTaskFields(button) {
    const taskFormBody = button.closest('.card-body');
    const employeeValue = taskFormBody.getAttribute('data-employee-value');
    const taskFieldsContainer = taskFormBody.querySelector('.task-fields-container');
    
    // Start task count from 2
    const taskCount = taskFieldsContainer.children.length - 5; // Adds 2 to ensure count starts from 2
    
    const projectId = document.getElementById('project_id').value;
    const projectName = document.getElementById('projectName').value;
    const complationDate = document.getElementById('complationDate').value;
    const prjManager = document.getElementById('prjManager').value;
    const selectGuide = document.getElementById('selectManager').value;

    const newTaskFields = document.createElement('div');
    newTaskFields.innerHTML = `
        <hr>
    	<button type="button" class="btn remove-task-btn" onclick="removeTaskFields(this)">
	        <i class="fa fa-minus"></i>
	    </button>
        <div style="display:flex;width:100%;align-items:center;">
            <div class="form-group" style="width:100%;margin:10px;">
                <input type="hidden" name="task_employee[]" value="${employeeValue}">
                <label for="taskName_${employeeValue}_${taskCount}">Task ${taskCount} Name:</label>
                <input type="text" class="form-control" id="taskName_${employeeValue}_${taskCount}" name="task_name[]" placeholder="Task Name" required>
            </div>
            <div class="form-group" style="width:100%;margin:10px;"> 
                <label for="taskDescription_${employeeValue}_${taskCount}">Task  Description:</label>
                <input type="text" class="form-control" id="taskDescription_${employeeValue}_${taskCount}" name="task_description[]" placeholder="Task Description" required>
            </div>
        </div>           
        
        <div class="form-group" style="">
	    	<input type="hidden" class="form-control" th:field="*{employeeValue}" id="taskName_${employeeValue}_1" name="employeeName[]" placeholder="employeeValue" value="${employeeValue}" required>
	    </div>
	    
	    <div class="form-group" style="display:none">
	    	<input type="hidden" class="form-control" th:field="*{projectId}" id="taskName_${projectId}_1" name="projectId[]" placeholder="projectId" value="${projectId}" required>
	    </div>
	    <div class="form-group" style="display:none">
	    	<input type="hidden" class="form-control" th:field="*{projectName}" id="taskName_${projectName}_1" name="projectName[]" placeholder="projectName" value="${projectName}" required>
	    </div>
	    <div class="form-group" style="display:none">
    	   <input type="hidden" class="form-control" th:field="*{prjManager}" id="taskName_${prjManager}_1" name="prjManager[]" placeholder="prjManager" value="${prjManager}" required>
        </div>
        <div class="form-group" style="display:none">
	 	   <input type="hidden" class="form-control" th:field="*{selectGuide}" id="taskName_${selectGuide}_1" name="selectGuide[]" placeholder="selectGuide" value="${selectGuide}" required>
	     </div>
	    <div class="form-group" style="display:none">
	    	<input type="hidden" class="form-control" th:field="*{complationDate}" id="taskName_${complationDate}_1" name="complationDate[]" placeholder="complationDate" value="${complationDate}" required>
	    </div>
	    
	    <!-- Subtasks Section -->
        <div class="subtasks-container">
            <h6>Subtasks:</h6>
            <div class="subtasks-list" id="subtasksList_${employeeValue}_${taskCount}"></div>
            <button type="button" class="btn btn-secondary add-subtask-btn" onclick="addSubtask('${employeeValue}_${taskCount}', '${employeeValue}', document.getElementById('taskName_${employeeValue}_${taskCount}').value, document.getElementById('taskDescription_${employeeValue}_${taskCount}').value)">Add Subtask</button>
        </div>
    `; 
    taskFieldsContainer.appendChild(newTaskFields);
}

function addSubtask(taskIdentifier, employeeName, mainTaskName,mainTaskDescription) {
	
    const subtasksList = document.getElementById(`subtasksList_${taskIdentifier}`);
    const subtaskCount = subtasksList.children.length + 1;
    const projectId = document.getElementById('project_id').value;
    const projectName = document.getElementById('projectName').value;
    const prjManager = document.getElementById('prjManager').value;
    const selectGuide = document.getElementById('selectManager').value;
    
    const subtaskForm = document.createElement('div');
    subtaskForm.classList.add('form-group', 'subtask');
    subtaskForm.id = `subtask_${taskIdentifier}_${subtaskCount}`;
    
    subtaskForm.innerHTML = `
    	<div class="subtask-fields" style="position: relative; margin-bottom: 20px;">
        <i class="fas fa-minus-circle remove-subtask-icon" 
            onclick="removeSubtask('${taskIdentifier}_${subtaskCount}')" 
            style="position: absolute; top: -35px; right: -5px; cursor: pointer; font-size: 18px; color: red; margin-left:20px;"></i>
            
	    	<input type="hidden" class="form-control" th:field="*{projectId}" id="taskName_${projectId}_1" name="subTaskprojectId[]" placeholder="projectId" value="${projectId}" required>
	    	<input type="hidden" class="form-control" th:field="*{projectName}" id="taskName_${projectName}_1" name="subTaskprojectName[]" placeholder="projectName" value="${projectName}" required>
	    	<input type="hidden" class="form-control" th:field="*{mainTaskDescription}" id="taskName_${projectName}_1" name="mainTaskDescription[]" placeholder="mainTaskDescription" value="${mainTaskDescription}" required>
	    	<input type="hidden" class="form-control" th:field="*{prjManager}" id="taskName_${prjManager}_1" name="prjManager[]" placeholder="prjManager" value="${prjManager}" required>
	    	<input type="hidden" class="form-control" th:field="*{selectGuide}" id="taskName_${selectGuide}_1" name="selectGuide[]" placeholder="selectGuide" value="${selectGuide}" required>
	       	
            <label for="maintaskName_${taskIdentifier}_${subtaskCount}" style="display:none">Main Task Name:</label>
            <input type="hidden" class="form-control" id="maintaskName_${taskIdentifier}_${subtaskCount}" name="maintask_name[]" value="${mainTaskName}" placeholder="Main Task Name" readonly>
            
            <label for="empName_${taskIdentifier}_${subtaskCount}" style="display:none">Employee Name:</label>
            <input type="hidden" class="form-control" id="empName_${taskIdentifier}_${subtaskCount}" name="subtask_emp_name[]" value="${employeeName}" placeholder="Employee Name" readonly>
            
            <div class='d-flex justify-content-between'>
	            <div style="width:100%;margin:0 5px 0 0;">
		            <label for="subtaskName_${taskIdentifier}_${subtaskCount}">Subtask Name:</label>
		            <input type="text" class="form-control" id="subtaskName_${taskIdentifier}_${subtaskCount}" name="sub_task[]" placeholder="Subtask Name" required>
		            
		            <label for="subtaskStartDate_${taskIdentifier}_${subtaskCount}">Start Date:</label>
		            <input type="date" class="form-control" id="subtaskStartDate_${taskIdentifier}_${subtaskCount}" name="subtask_start_date[]" required>
		            
		            <label for="subtaskCompletionDate_${taskIdentifier}_${subtaskCount}">Subtask Completion Date:</label>
		            <input type="date" class="form-control" id="subtaskCompletionDate_${taskIdentifier}_${subtaskCount}" name="subtask_completion_date[]" required>
		            
	            </div>
	            <div style="width:100%;margin:0 0 0 5px;">
		            <label for="subtaskDescription_${taskIdentifier}_${subtaskCount}">Subtask Description:</label>
		            <textarea class="form-control" id="subtaskDescription_${taskIdentifier}_${subtaskCount}" name="subtask_description[]" placeholder="Subtask Description" rows="6" required> </textarea>
	            </div>
	         </div>
        </div>
    `;
    subtasksList.appendChild(subtaskForm);
} 
//Function to remove subtasks
function removeSubtask(subtaskId) {
    const subtaskElement = document.getElementById(`subtask_${subtaskId}`);
    subtaskElement.remove();
}

function removeTaskFields(button) {
    const taskFields = button.closest('div');
    taskFields.remove();
}
</script>

<!-- script to call endpoint which returns flag value for notification on each second -->
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>  -->
<script src="assets/js/jquery-3.6.4.min.js"></script>

<!-- <script>
// Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
    	
    	 var leaveRequestCountValue = response.leaveRequestFlagCount;
         var ActivityReportCountValue = response.dailyActivityFlagCount;            
         var flagProjectValue = response.flagProjectValue;
         var projectAcceptByUserFlag = response.projectAcceptByUserFlag;
         var projectAcceptedEmpNames = response.getPrjAcceptedEmpName;
         var totalNotificationCount = response.totalNotificationCount;  
        // Update flag value in the fragment item
        $(".icon-badge").text(totalNotificationCount);

        // Show the leave request div if leaveRequestCount is greater then 0  
        if (leaveRequestCountValue > 0) {
            $(".leave-request").show();
            $("#leaveCount").text(leaveRequestCountValue+" leave request");
        } else {
            $(".leave-request").hide();
        }
        
        // Show the Daily Activity div if flag is greater then 0
        if (ActivityReportCountValue > 0) {
            $(".dailyActivity").show();
            // Update the content of elements with the class 'meta'
            $("#activityCount").text(ActivityReportCountValue+" Activity Report");
        } else {
            $(".dailyActivity").hide();
        }
        
        // Show the project div if flag is greater then 0
        if (flagProjectValue > 0) {
            $(".project").show();
            // Update the content of elements with the class 'meta'
            $("#projectCount").text(flagProjectValue +" New Project");
        } else {
            $(".project").hide();
        }
        
        // Show the project div if flag is greater then 0
        if (projectAcceptByUserFlag > 0) {
            $(".projectAcceptance").show();
            // Update the content of elements with the class 'meta'
            $("#projectAcceptance").text(projectAcceptedEmpNames +" Accepted Project");
        } else {
            $(".projectAcceptance").hide();
        }
    });
}


// Periodically fetch flag value every 5 seconds (adjust as needed)
setInterval(fetchFlag, 1000);
</script> -->
<!-- script for get the employee based on department -->
<!-- <script>
function updateManagers() {
    var dept = document.getElementById('dept').value;
    var prjManagerSelect = document.getElementById('prjManager');
    var seniorManagerSelect = document.getElementById('selectManager');
    var teamMembersSelect = document.getElementById('selectTeamMembers');

    // Clear existing options
    prjManagerSelect.innerHTML = '<option value="">Select a Lead</option>';
    seniorManagerSelect.innerHTML = '<option value="">Select a Guider</option>';
    teamMembersSelect.innerHTML = '<option value="">Select Employees</option>';

    if (dept) {
        fetch('/getManagers?department=' + dept)
            .then(response => response.json())
            .then(data => {            	
                // Populate the "Project Manager" and "Under the Guidance Of" select boxes
                data.tlAndTc.forEach(manager => {
                    var managerOption = document.createElement('option');
                    managerOption.value = manager;
                    managerOption.text = manager;
                    prjManagerSelect.add(managerOption);                  
                });
                
                data.emails.forEach(manager => {
                    var managerOption = document.createElement('option');
                    managerOption.value = manager;
                    managerOption.text = manager;
                    teamMembersSelect.add(managerOption);                  
                });

                // Populate the "Add Employee" select box  emails
                data.employees.forEach(employee => {
                 /* var employeeOption = document.createElement('option');
                    employeeOption.value = employee;
                    employeeOption.text = employee;
                    teamMembersSelect.add(employeeOption); */
                    
                    var seniorManagerOption = document.createElement('option');
                    seniorManagerOption.value = employee;
                    seniorManagerOption.text = employee;
                    seniorManagerSelect.add(seniorManagerOption);
                });
            })
            .catch(error => console.error('Error fetching managers:', error));
    }
}

</script> -->

<!-- script to convert date formate -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    var dateColumns = document.querySelectorAll(".dateColumn");
    dateColumns.forEach(function(column) {
        var originalDate = column.textContent;
        var formattedDate = formatDate(originalDate);
        column.textContent = formattedDate;
    });
});
function formatDate(dateString) {
	
    var date = new Date(dateString);
    var day = date.getDate();
    var month = date.getMonth() + 1; // Months are zero-based
    var year = date.getFullYear();
    
    // Ensure two digits for day and month
    if (day < 10) {
        day = '0' + day;
    }
    if (month < 10) {
        month = '0' + month;
    }
    return day + '-' + month + '-' + year;    
}
</script>	


<!-- Bootstrap JS (jQuery required) -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<script src="assets/js/jquery-3.6.4.min.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script> -->
<script src="/assets/js/popper.min.js"></script>

<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script src="assets/js/app.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
  <script src="assets/js/jquery-3.6.4.min.js"></script>
 <script>
 function handleProjectAction(projectId, action) {
	    var adminStartDate = document.getElementById('startDate').value;

	    $.ajax({
	        type: 'GET',
	        url: 'acceptProject',
	        data: {
	            "projectId": projectId,
	            "action": action,
	            "adminStartDate": adminStartDate
	        },
	        success: function(data) {
	            var message = action === 'accept' ? 'Project has been accepted' : 'Project has been delayed';

	            Swal.fire({
	                title: message,
	                icon: 'success',
	                confirmButtonColor: '#007bff',
	                confirmButtonText: 'OK'
	            });
	            location.reload();
	        },
	        error: function(xhr, status, error) {
	            console.error('Error while updating the project:');
	            console.log('XHR object:', xhr);
	            console.log('Status:', status);
	            console.log('Error:', error);
	            //alert('Error updating the project. Please try again.');
	        }
	    });
	}
</script>

<!--    script to call endpoint to accept the project  -->
<script src="assets/js/app.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
  <script src="assets/js/jquery-3.6.4.min.js"></script>
  <script>
	 $(document).ready(function() {
	     $('.action-btn').on('click', function() {
	         var projectId = $(this).attr('data-project-id');
	         var action = $(this).attr('data-action');
	         var adminStartDate = $('#startDate').val();
	         
	         $.ajax({
	             type: 'GET',
	             url: 'acceptProject',
	             data: {
	                 "projectId": projectId,
	                 "action": action,
	                 "adminStartDate":adminStartDate
	             },
	             success: function(data) {
	                 var message = action === 'accept' ? 'Project has been accepted' : 'Project has been delayed';
	                 
	                 Swal.fire({
	                     title: message,
	                     icon: 'success',
	                     confirmButtonColor: '#007bff',
	                     confirmButtonText: 'OK'
	                 });
	                 location.reload();
	             },
	             error: function(xhr, status, error) {
	                 console.error('Error while updating the project:');
	                 console.log('XHR object:', xhr);
	                 console.log('Status:', status);
	                 console.log('Error:', error);
	                 //alert('Error updating the project. Please try again.');
	             }
	         });
	     });
	 });
    </script>

 <!-- script to display card dynamically -->
<!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
<script src="assets/js/highcharts.js"></script>

<script>
$.ajax({
    type: 'GET', 
    url: 'getAllProjects', 
    success: function(data) {
        updateCompanyProjectsDetailsUsingCardsData(data);
    },
    error: function(xhr, status, error) {use
        console.error('Error fetching data:', error);
        alert('Error fetching data. Please try again.');
    }
});

function updateCompanyProjectsDetailsUsingCardsData(data) {
	// console.log("++++++++++++++++++++++++++++"+JSON.stringify(data));
    var cardContainer = document.getElementById("compProjectCardsRow");
    cardContainer.innerHTML = ''; 

    if (!data || data.length === 0) {
        // No projects available
        cardContainer.innerHTML = `
            <div class="text-center w-100">
                <img src="assets/img/no-projects.png" alt="No Projects" style="width: 220px; height: auto; margin-bottom: 10px;">
                <p class="text-muted" style="font-size: 18px;">
                    No projects available
                </p>
            </div>
        `;
        return;
    }
    
    for (var i = 0; i < data.length; i++) {
        var cardText = '';
        var cardIcon = '';
        var iconColor = '';

        if (data[i].flag === 1) {
            cardText = 'New Project';
            cardIcon = '<i class="fas fa-star"></i>';
            iconColor = 'color: #6495ED;';
        } else if (data[i].flag === 3) {
            cardText = 'Delayed Project';
            cardIcon = '<i class="fas fa-exclamation-triangle"></i>';
            iconColor = 'color: red;';
        } else if (data[i].flag == 2 && data[i].assign_flag == 1) {
            cardText = 'Unassigned';
            cardIcon = '<i class="fas fa-user-slash"></i>';
            iconColor = 'color: gray;';
        } else {
            cardText = 'Ongoing';
            cardIcon = '<i class="fas fa-tasks"></i>';
            iconColor = 'color: green;';
        }

        var dynamicCardColor1, dynamicCardColor2;
        var cardDiv = document.createElement("div");
        cardDiv.className = "compProjectHiddenCards";
        
        
        
        if (!data[i].department.includes(',')) {
            // Logic to modify the project name if no comma in the department
            var actualProjectName = JSON.stringify(data[i].project_name);
            console.log("actualProjectName=" + actualProjectName);

            // Remove everything after the last underscore
            var modifiedProjectName = actualProjectName.replace(/_[^_]*$/, '');

            // Remove surrounding quotes
            modifiedProjectName = modifiedProjectName.replace(/^"|"$/g, '');
            console.log("modifiedProjectName=" + modifiedProjectName);
        } else {
        	 // Logic to modify the project name if multiple departments (i.e., there is a comma in the department)
            var actualProjectName = JSON.stringify(data[i].project_name);
            console.log("multiple department=" + actualProjectName);

            // Split the project names by comma and take the first part
            var projectNamesArray = actualProjectName.split(',')[0];

            // Remove everything after the last underscore from the first project name
            var modifiedProjectName = projectNamesArray.replace(/_[^_]*$/, '');

            // Remove surrounding quotes
            modifiedProjectName = modifiedProjectName.replace(/^"|"$/g, '');
            console.log("modifiedProjectName=" + modifiedProjectName);
        }
     
        
        
        
        if (data[i].flag === 1) {
            cardDiv.classList.add("shining-card");
        } else if (data[i].flag === 3) {
            cardDiv.classList.add("delay-shining-card");
        } else if (data[i].flag == 2 && data[i].assign_flag == 1) {
            cardDiv.classList.add("unassigned-shining-card");
        } else {
            cardDiv.classList.add("unassign-card");
        }
        
        if(data[i].department.includes(',')){
        	cardDiv.classList.add("multipleDept");
        }

        cardDiv.innerHTML = `
        	<div class="compProjectInnerHiddenCards" onclick="getProjectDetailInPopup(${data[i].id}, '${data[i].status}', '${data[i].project_id}', ${data[i].department.includes(',')});">
                <div class="compProjectCard_content" style="display:flex;justify-content:space-between">
                    <div>
                        <p class="compProject_card_data_heading_para">${data[i].id}</p>
                        <p class="card_data_flag_text" style="text-align:left;">
                            <span style="font-size:12px;">${cardText}</span><br>
                            <span style="text-align:left;font-weight:bold;font-size:16px;">
                            ${(modifiedProjectName.split(",").length > 1 ? (modifiedProjectName.split(",")[0] + '...') : modifiedProjectName)}
                            </span><br>
                            <span class="description">
                                ${(data[i].description.split(" ")[0] + (data[i].description.split(" ").length > 1 ? '...' : ''))}
                            </span>
                        </p>
                    </div>
                    <div>
                        <div class="icon-container" style="text-align: right; ${iconColor}">${cardIcon}</div>
                        <!-- Conditionally Add the "Add Task" Button -->
                        ${(data[i].flag == 2 && data[i].assign_flag == 2) ? 
                            `<button 
								    style="background: none; border: none; color:#5c76e0; cursor: pointer; font-size: 14px; margin-top: 20px; padding: 0;" 
								    onclick="addProject(event, this)"
								    data-id="${data[i].id}"
								    data-project-id="${data[i].project_id}"
								    data-project-name="${data[i].project_name}"
								    data-department="${data[i].department}"
								    data-completion-date="${data[i].completion_date}"
								    data-project-manager="${data[i].project_manager}"
								    data-description="${data[i].description}">
								    Add Task <i class="fas fa-plus-circle"></i>
								</button>` 
                            : ''}
                    </div>
                </div>
            </div>`;


        cardContainer.appendChild(cardDiv);

        // Create a hidden modal for each project
        var modalDiv = document.createElement("div");
        modalDiv.className = "modal fade";
        modalDiv.id = "projectModal-" + data[i].id;
        modalDiv.setAttribute("tabindex", "-1");
        modalDiv.setAttribute("role", "dialog");
        modalDiv.setAttribute("aria-labelledby", "projectModalLabel-" + data[i].id);
        modalDiv.setAttribute("aria-hidden", "true");

        // Check if the department contains a comma(if it contains comma it means it is has multiple department)
	     if (data[i].department.includes(',')) {
	    	    
			    const departments = data[i].department.split(','); // Split departments into an array
			    const projectNames = data[i].project_name.split(',');
			    
			    let cardsHtml = '';
			    let graphHtml = '';
			    let totalTasksCount = 0;  // To hold total tasks count of all departments
			    let completedTasksCount = 0;  // To hold completed tasks count of all departments
			    
			    // Loop through departments to create cards and corresponding graph containers
			    departments.forEach((dept, index) => {
			        const departmentId = `teamPrjDetails2-${index}`; // Unique ID for each graph container
			        cardsHtml += `
			            <div class="card d-flex m-0 p-0" style="width:98%;background-color:#CACFD2;padding:0;margin:0; cursor: pointer;" 
			                 onclick="multipleDepartmentGraph(${data[i].id}, '${data[i].project_id}', '${data[i].project_name}', '${dept.trim()}')">
			                <div class="card-body m-0 p-0" style="">
			                    <h5 class="card-title p-0 m-0 text-center">${dept.trim()}</h5> <!-- Department Name -->
			                </div>
			            </div>
			            <div id="${departmentId}"></div> <!-- Graph container for each department -->
			        `;
			        graphHtml += `
			            <div id="${departmentId}"></div> <!-- Unique ID for each graph container -->
			        `;
			    });
			
			    modalDiv.innerHTML = `
			        <div class="modal-dialog modal-lg" role="document">
			            <div class="modal-content">
			                <div class="modal-header">
			                    <h5 class="modal-title" id="projectModalLabel-${data[i].id}">${modifiedProjectName}</h5>
			                    <button type="button" class="close" onclick="closeModal(${data[i].id});" aria-label="Close">
			                        <span aria-hidden="true">&times;</span>
			                    </button>
			                </div>
			                <div class="modal-body">
			                <div style="margin-left:30%">
			                	<div id="overallPercent"></div> <!-- Overall percentage of all departments -->
			                </div>
			                
			                    <div class="row">
			                        ${cardsHtml} <!-- Cards dynamically inserted here -->
			                    </div>
			                </div>
			                <div class="modal-footer">
			                    <button type="button" class="btn btn-secondary" onclick="closeModal(${data[i].id});">Close</button>
			                </div>
			            </div>
			        </div>`;
			
			    // Call the function to render the graphs for all departments
			    departments.forEach((dept, index) => {
			        const departmentId = `teamPrjDetails2-${index}`; // Use unique IDs for each department
			        const projectName = projectNames[index] || '';
			        multipleDepartmentGraph(data[i].id, data[i].project_id, projectName, dept.trim(), departmentId, (deptTotalTasks, deptCompletedTasks) => {
			            totalTasksCount += deptTotalTasks;
			            completedTasksCount += deptCompletedTasks;
			
			            // After all departments' data is processed, calculate the overall percentage
			            const overallPercentage = (completedTasksCount / totalTasksCount) * 100;
			            document.getElementById('overallPercent').innerHTML = `
			                <p><strong>Overall Completion: </strong>${overallPercentage.toFixed(2)}%</p>
			            `;
			        });
			    });
			} else {
			        	  modalDiv.innerHTML = '<div class="modal-dialog" role="document">' +
			              '<div class="modal-content">' +
			                  '<div class="modal-header">' +
			                      '<h5 class="modal-title" id="projectModalLabel-' + data[i].id + '">' + modifiedProjectName + '</h5>' +
			                      '<button type="button" class="close" onclick="closeModal(' + data[i].id + ');" aria-label="Close">' +
			                          '<span aria-hidden="true">&times;</span>' +
			                      '</button>' +
			                  '</div>' +
			                  '<div class="modal-body">' +
			                      '<div class="table-responsive p-2">' +
			                      '<div class="d-flex">'+                                          
			                       
			                           '<div class="chart-container" id="chartContainer-' + data[i].id + '" style="display:none">' +
			                           	'<div id = "projectChart-' + data[i].id + '" class="chart"></div>' +
			                           ' </div>' +                                          	
			                       
			                          '<table class="table table-bordered">' +
			                              '<tbody>' +
			                                  '<tr>' +
			                                      '<th>Project ID:</th>' +
			                                      '<td>' + data[i].project_id + '</td>' +
			                                  '</tr>' +
			                                  '<tr>' +
			                                      '<th>Department:</th>' +
			                                      '<td>' + data[i].department + '</td>' +
			                                  '</tr>' +	
			                                  '<tr>' +
			                                      '<th>Completion Date:</th>' +
			                                      '<td>' + data[i].completion_date + '</td>' +
			                                  '</tr>' +
			                                  /* '<tr>' +
			                                      '<th>Project Manager:</th>' +
			                                      '<td>' + data[i].project_manager + '</td>' +
			                                  '</tr>' + */
			                                  '<tr>' +
			                                      '<th>Description:</th>' +
			                                      '<td>' + data[i].description + '</td>' +
			                                  '</tr>' +
			                              '</tbody>' +
			                          '</table>' +   
			                          
			                          '</div>'+
			                          
			                          '<div class="Team-details" id="teamDetails-' + data[i].id + '" style="display:'+(data[i].flag === 1?'none':'block')+'">'+
			                          '<hr>'+	
			                          '<h6>Team Details</h6>'+
			                              '<div class="table-responsive">' +	
			                                '<div id="teamPrjDetails1-'+data[i].id+'" style=" height: 400px;"></div>'+
			                               '<div >'+
			                               '<div style="max-height: 400px; overflow-y: auto;">'+
			                                  '<table class="table table-bordered" id="teamDetails-' + data[i].id + '">' +
			                                      '<thead style="position:sticky;top:0;z-index:1;">' +
			                                          '<tr>' +
			                                              '<th>Sl no</th>' +
			                                              '<th>Project Id</th>' +
			                                              '<th>Date</th>' +
			                                              '<th>Employee</th>' +
			                                              '<th>Task Name</th>' +
			                                              '<th>Weight</th>' +
			                                              '<th>Status</th>' +
			                                          '</tr>' +
			                                      '</thead>' +
			                                      '<tbody></tbody>' +	
			                                  '</table>' +
			                                  '</div>'+
			                                  '</div>'+
			                              '</div>'+
			                          '</div>'+
			                          '<div id="delayReasonId-' + data[i].id + '" style="display:none" class="p-2">' +
			                              '<hr class="mb-4">' +
			                              'Reason:<textarea class="delayReason" id="delayReason-' + data[i].id + '" name="reason" rows="3" cols="50"></textarea><br><br>' +
			                              'Start Date:<input type="date" class="startDate" name="startDate" id="startDate-' + data[i].id + '">' +
			                          '</div>' + 
			                          
			                          '<div id="AdminDeliveryDate-' + data[i].id + '" style="display:none" class="p-2">' +
			                          '<hr class="mb-4">' +                                            
			                          'select completion date by Admin:<input type="date" class="startDate" name="startDate" id="startDate">' +
			                      '</div>' + 
			                      '</div>' +                                
			                      '</div>' +
			                      ((data[i].flag != 2 && data[i].assign_flag != 2) ? 
			                          '<div class="modal-footer">' +                                            
			                              '<button class="btn btn-primary" onclick="displayDateModel(' + data[i].id + ')" id="displayDateModel-' + data[i].id + '">Accept	</button>' +
			                              '<button type="button" class="btn btn-primary action-btn" id="acceptBtn-' + data[i].id + '" onclick="handleProjectAction(' + data[i].id + ', \'accept\')" style="display:none;">Accept</button>'+
			
			                              '<button class="btn btn-primary" onclick="delayFunction(' + data[i].id + ')" id="delayBtn-' + data[i].id + '">Delay</button>' +
			                              '<button class="btn btn-primary" style="display:none" id="submitBtn-' + data[i].id + '" onclick="submitFunction(' + data[i].id + ')">Submit</button>' +
			                              '<button type="button" class="btn btn-secondary" onclick="closeModal(' + data[i].id + ');">Close</button>' +                                            
			                           '</div>' : ''
			                      ) +
			                  '</div>' +  
			              '</div>' +
			          '</div>';
			        }       
        
      

        document.body.appendChild(modalDiv);
        
        // Add event listener for Ongoing cards to create the chart
        if (data[i].flag == 2 && data[i].assign_flag == 2) {
        	console.log("aaaaaa",data[i]);
            (function(projectId, projectIDValue,projectName) {
            	console.log("bbbbbbbb",data[i]);
                cardDiv.addEventListener('click', function() { 
                    var chartContainer = document.getElementById('chartContainer-' + projectId);
                    chartContainer.style.display = 'block'; // Show the chart container

                    // Ensure modal is fully shown before creating the chart
                    $('#' + 'projectModal-' + projectId).on('shown.bs.modal', function () {
                        createProjectChart(projectId, projectIDValue,projectName);
                    });

                    // Show the modal
                    $('#' + 'projectModal-' + projectId).modal('show');
                });
            })(data[i].id, data[i].project_id,data[i].project_name);
        }
    }
}

function addRequirment(){
	//alert("hi");
}

function createProjectChart(id, projectIDValue, projectName) {
	teamPrjDetailsteamPrjDetails(id, projectIDValue, projectName);
	$.ajax({
        type: 'GET',
        url: 'ProjectByprjId', // Adjust this URL based on your backend endpoint
        data: { projectId: projectIDValue },
        success: function(projectDetails) {
            console.log("Project Details Data:", JSON.stringify(projectDetails));
            displayTeamDetails(projectDetails, id);
            teamPrjDetailsteamPrjDetails(id, projectIDValue, projectName);                   
        },
        error: function(xhr, status, error) {
            alert('Error fetching project details. Please try again.');
        }
    });
	fetch('/getEmployeProjectStatus?projectId=' + projectIDValue + '&projectName=' + encodeURIComponent(projectName))
    .then(response => response.json())
    .then(data => {
        console.log(JSON.stringify(data));

        let employeeData = {}; // To store cumulative data for each employee
        let totalTasksCount = 0; // Total number of tasks across all employees

        // Loop through the data to aggregate tasks for each employee
        data.forEach(item => {
            const employeeName = item[0]; // Employee name
            const totalTaskCount = parseInt(item[3], 10); // Total tasks assigned
            const completedTaskCount = parseInt(item[4], 10); // Completed tasks

            // Initialize the employee's data if not already done
            if (!employeeData[employeeName]) {
                employeeData[employeeName] = {
                    totalAssigned: 0,
                    totalCompleted: 0
                };
            }

            // Accumulate the tasks for this employee
            employeeData[employeeName].totalAssigned += totalTaskCount;
            employeeData[employeeName].totalCompleted += completedTaskCount;

            // Accumulate the overall total tasks
            totalTasksCount += totalTaskCount;
        });

        // Prepare data for the pie chart
        let completedData = [];
        let totalCompletedTasks = 0;

        // Aggregate the completed tasks and total tasks per employee
        Object.keys(employeeData).forEach(employeeName => {
            const employee = employeeData[employeeName];
            const completedPercentage = (employee.totalCompleted / totalTasksCount) * 100;

            completedData.push({
                name: employeeName,
                y: completedPercentage, // Employee's completed percentage
                totalAssigned: employee.totalAssigned // For tooltip
            });

            totalCompletedTasks += employee.totalCompleted;
        });

        // Calculate pending tasks across all employees
        const pendingTasksCount = totalTasksCount - totalCompletedTasks;
        const pendingPercentage = (pendingTasksCount / totalTasksCount) * 100;

        // Add pending tasks as a separate slice in the pie chart
        completedData.push({
            name: 'Pending Tasks',
            y: pendingPercentage,
            color: '#e74c3c' // Red color for pending tasks
        });

        // Initialize the pie chart with cumulative employee completion percentages
        Highcharts.chart('projectChart-' + id, {
            chart: {
                type: 'pie',
                animation: {
                    duration: 1000,
                    easing: 'easeOutBounce'
                }
            },
            title: {
                text: 'Project Progress'
            },
            plotOptions: {
                pie: {
                    innerSize: '50%', // For a donut chart
                    size: '70%',
                    dataLabels: {
                        formatter: function() {
                            return this.point.name + ': ' + Highcharts.numberFormat(this.y, 1) + '%';
                        }
                    },
                    animation: {
                        duration: 500,
                        easing: 'easeInOutQuart'
                    }
                }
            },
            tooltip: {
                formatter: function() {
                    return `<b>${this.point.name}</b><br/>` +
                           `Completed: ${Highcharts.numberFormat(this.y, 1)}%<br/>` +
                           `Assigned: ${this.point.totalAssigned} tasks`;
                }
            },
            series: [{
                name: 'Completion Percentage',
                colorByPoint: true,
                data: completedData, // Data including both completed and pending tasks
                animation: {
                    duration: 2000,
                    easing: 'easeOutElastic'
                }
            }],
            credits: {
                enabled: false
            }
        });
    })
    .catch(error => console.error('Error fetching data:', error));
}


function displayTeamDetails(projectDetails, projectId) {
	
    var teamDetailsTableBody = document.querySelector('#teamDetails-' + projectId + ' tbody');
    teamDetailsTableBody.innerHTML = ''; // Clear any existing content
	var i=0;
    projectDetails.forEach(function(detail) {
    	i++;
        var row = document.createElement('tr');

        var statusColor = detail.task_status.toLowerCase() === 'pending' ? 'red' : 
                          detail.task_status.toLowerCase() === 'completed' ? 'green' : '';

        row.innerHTML = '<td>' + i + '</td>' +
                        '<td>' + detail.projectId + '</td>' +
                        '<td>' + detail.date + '</td>' +
                        '<td>' + detail.email + '</td>' +                        
                        '<td>' + detail.task_name + '</td>' +
                        '<td>' + detail.percent + '</td>' +
                        '<td style="color:' + statusColor + '">' + detail.task_status + '</td>';       
                        
        teamDetailsTableBody.appendChild(row);
    });
}


function getProjectDetailInPopup(projectId, status,prjId,iscontainsMultipleDept) {
	
	console.log("iscontainsMultipleDept---"+iscontainsMultipleDept);
	

		$('#projectModal-' + projectId).modal('show');

	    // Ensure that the specific divs are hidden each time the modal is opened
	    $('#delayReasonId-' + projectId).hide();
	    $('#AdminDeliveryDate-' + projectId).hide();
		
	    //$('#projectModal-' + projectId).modal('show');
	    // Fetch additional project details
	    $.ajax({
	        type: 'GET',
	        url: 'team-progress', // Adjust this URL based on your backend endpoint
	        data: {
	            projectId: prjId
	        },
	        success: function(details) {
	        	console.log(details);
	        	
	            var projectDetailsTable = $('#projectDetailsss-' + prjId);
	            projectDetailsTable.empty(); // Clear any existing rows

	            details.forEach(function(detail) {
	                var row = '<tr>' +
	                            '<td>' + detail.email + '</td>' +
	                            '<td>' + detail.percent + '%</td>' +
	                          '</tr>';
	                projectDetailsTable.append(row);
	            });
	        },
	        error: function(xhr, status, error) {
	            console.error('Error fetching project details:', error);
	            alert('Error fetching project details. Please try again.');
	        }
	    });	
}

function closeModal(id) {
    $('#' + 'projectModal-' + id).modal('hide');
}

function closeModal(projectId) {
    $('#projectModal-' + projectId).modal('hide');
}

function delayFunction(projectId) {
    $('#delayReasonId-' + projectId).show();
    $('#delayBtn-' + projectId).hide();
    $('#submitBtn-' + projectId).show();
    $('#acceptBtn-' + projectId).hide();
    $('#displayDateModel-' + projectId).hide();
}

function displayDateModel(projectId) {	
    $('#AdminDeliveryDate-' + projectId).show();
    $('#displayDateModel-' + projectId).hide();
    $('#acceptBtn-' + projectId).show();
    $('#delayBtn-' + projectId).hide();
    
}
</script>
<!-- script to display Select completion date by Admin: in delay project -->
<script>
function displayDateModel1(projectId) {
	
    var adminDeliveryDateDiv = document.getElementById('AdminDeliveryDate-' + projectId);
    if (adminDeliveryDateDiv) {
        adminDeliveryDateDiv.style.display = 'block';
    }

    var displayButton = document.getElementById('displayDateModel1-' + projectId); 
    
    if (displayButton) {
        displayButton.style.display = 'none';
    }

    var actionButton = document.getElementById('actionBtn-' + projectId);
    if (actionButton) {
        actionButton.style.display = 'block';
    } 
}
   
$(document).ready(function() {
    $('.modal').on('hidden.bs.modal', function() {
        var projectId = $(this).attr('id').split('-')[1];
        $('#delayReasonId-' + projectId).hide();
        $('#AdminDeliveryDate-' + projectId).hide();
        $('#acceptBtn-' + projectId).hide();
        $('#submitBtn-' + projectId).hide();
        $('#displayDateModel-' + projectId).show();
        $('#delayBtn-' + projectId).show();
    });
});

//fuction to delay the new project
function submitFunction(projectId) {
    var delayReason = $('#delayReason-' + projectId).val();
    var startDate = $('#startDate-' + projectId).val();

    if (!delayReason || !startDate) {
        alert('Please provide both reason and start date.');
        return;
    } else {
        $.ajax({
            type: 'GET',
            url: 'acceptdelayProject',
            data: {
                "projectId": projectId,
                "delayReason": delayReason,
                "startDate": startDate
            },
            success: function(data) {
                Swal.fire({
                    title: 'Success',
                    text: 'Project update has been sent successfully.',
                    icon: 'success',
                    confirmButtonColor: '#007bff',
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                        location.reload();
                    }
                });
            },
            error: function(xhr, status, error) {
                console.error('Error submitting delay reason:', error);
                alert('Error submitting delay reason. Please try again.');
            }
        });
    }
}
</script>
  <!-- Vendor JS Files -->
<!--   <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script> -->

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
 <!--  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <script src="assets/js/chart.min.js"></script>

<!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
 <script src="assets/js/highcharts.js"></script>


<script>
function teamPrjDetailsteamPrjDetails(id, projectIDValue, projectName) {
	
	console.log("id--"+id);
	console.log("projectIDValue--"+projectIDValue);
	console.log("projectName--"+projectName);
	
    fetch('/getEmployeProjectStatus?projectId=' + projectIDValue + '&projectName=' + encodeURIComponent(projectName))
        .then(response => response.json())
        .then(data => {
            console.log(JSON.stringify(data));

            // Process data for each task separately
            const categories = [];
            const totalTasks = [];
            const completedTasks = [];
            const pendingTasks = [];

            // Loop through each task entry and assign data to the respective arrays
            data.forEach(item => {
                const employeeName = item[0];
                const taskName = item[2];
                const totalTaskCount = parseInt(item[3], 10);
                const completedTaskCount = parseInt(item[4], 10);

                // Calculate pending tasks based on total tasks and completed tasks
                const pendingTaskCount = totalTaskCount - completedTaskCount;

                // Add a category with a line break between the employee name and task name
                categories.push(`${employeeName}<br>(${taskName})`);

                // Push the task data for the corresponding series
                totalTasks.push(totalTaskCount);
                completedTasks.push(completedTaskCount);
                pendingTasks.push(pendingTaskCount); // Ensure pending tasks are populated
            });

            // Initialize Highcharts with separate columns for each task
            Highcharts.chart('teamPrjDetails1-' + id, {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Employees Task Status'
                },
                xAxis: {
                    categories: categories, // Use the combined employee-task categories with line breaks
                    title: {
                        text: 'Employees and Tasks'
                    },
                    labels: {
                        useHTML: true, // Enable HTML rendering for labels
                        rotation: 0,   // No rotation needed with line breaks
                        style: {
                            fontSize: '12px'
                        }
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Number of Tasks'
                    }
                },
                tooltip: {
                    shared: true,
                    formatter: function() {
                        const taskIndex = this.point.index; // Get index of the task
                        const category = categories[taskIndex]; // Get the corresponding category

                        return `<b>${category}</b><br/>` +
                            `Total Subtasks: ${totalTasks[taskIndex]}<br/>` +
                            `Completed Subtasks: ${completedTasks[taskIndex]}<br/>` +
                            `Pending Tasks: ${pendingTasks[taskIndex]}`; // Display pending tasks correctly
                    }
                },
                series: [{
                    name: 'Total Assigned',
                    data: totalTasks,
                    color: '#3498db'
                }, {
                    name: 'Completed Tasks',
                    data: completedTasks,
                    color: '#2ecc71'
                }, {
                    name: 'Pending Tasks',
                    data: pendingTasks,
                    color: '#e74c3c'
                }],
                plotOptions: {
                    column: {
                        grouping: true, // Grouping the columns for each category
                        shadow: false,
                        borderWidth: 0
                    }
                },
                credits: {
                    enabled: false // 🔥 This removes the Highcharts watermark
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
}

let overallTotalTasks = 0;
let overallCompletedTasks = 0;
function multipleDepartmentGraph(id, projectIDValue, projectName, department, departmentId) {
	
    console.log("id--" + id);
    console.log("projectIDValue--" + projectIDValue);
    console.log("projectName--" + projectName);
    console.log("department--" + department);
    
    const parts = projectIDValue.split('/');
    const modifiedProjectID = `${parts[0]}/${parts[1]}/${parts[2]}/${department}/${parts[3]}`;
    
    fetch('/getEmployeProjectStatus?projectId=' + modifiedProjectID + '&projectName=' + encodeURIComponent(projectName))
        .then(response => response.json())
        .then(data => {
            console.log("//////" + JSON.stringify(data));

            const categories = [];
            const totalTasks = [];
            const completedTasks = [];
            const pendingTasks = [];            

            data.forEach(item => {
                const employeeName = item[0];
                const taskName = item[2];
                const totalTaskCount = parseInt(item[3], 10);
                const completedTaskCount = parseInt(item[4], 10);

                const pendingTaskCount = totalTaskCount - completedTaskCount;

                categories.push(`${employeeName}<br>(${taskName})`);
                totalTasks.push(totalTaskCount);
                completedTasks.push(completedTaskCount);
                pendingTasks.push(pendingTaskCount);

                overallTotalTasks += totalTaskCount;
                overallCompletedTasks += completedTaskCount;
            });
			
            console.log("overallTotalTasks=="+overallTotalTasks);
            console.log("overallCompletedTasks=="+overallCompletedTasks);
            
            // Calculate overall percentage of completed tasks
            const overallPercentage = (overallCompletedTasks / overallTotalTasks) * 100;
            
            // Update the donut chart with overall percentage
            Highcharts.chart('overallPercent', {
                chart: {
                    type: 'pie',
                    width: 300,
                    height: 300
                },
                title: {
                    text: 'Overall Task Completion'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        innerSize: '60%',  // Creates a donut chart
                        dataLabels: {
                            enabled: false
                        }
                    }
                },
                series: [{
                    name: 'Completion',
                    data: [
                        ['Completed', overallCompletedTasks],
                        ['Remaining', overallTotalTasks - overallCompletedTasks]
                    ],
                    colors: ['#2ecc71', '#e74c3c'],  // Green for completed, red for remaining
                }]
            });

            // Initialize Highcharts for the department task status
            Highcharts.chart(departmentId, {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Employees Task Status'
                },
                xAxis: {
                    categories: categories,
                    title: {
                        text: 'Employees and Tasks'
                    },
                    labels: {
                        useHTML: true,
                        rotation: 0,
                        style: {
                            fontSize: '12px'
                        }
                    }
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Number of Tasks'
                    }
                },
                tooltip: {
                    shared: true,
                    formatter: function() {
                        const taskIndex = this.point.index;
                        const category = categories[taskIndex];
                        return `<b>${category}</b><br/>` +
                            `Total Subtasks: ${totalTasks[taskIndex]}<br/>` +
                            `Completed Subtasks: ${completedTasks[taskIndex]}<br/>` +
                            `Pending Tasks: ${pendingTasks[taskIndex]}`;
                    }
                },
                series: [{
                    name: 'Total Assigned',
                    data: totalTasks,
                    color: '#3498db'
                }, {
                    name: 'Completed Tasks',
                    data: completedTasks,
                    color: '#2ecc71'
                }, {
                    name: 'Pending Tasks',
                    data: pendingTasks,
                    color: '#e74c3c'
                }],
                plotOptions: {
                    column: {
                        grouping: true,
                        shadow: false,
                        borderWidth: 0
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
}

</script>




    
    
    <!-- script to fill project manager and employees based on the selected department -->
    <script>
    function fetchEmployeesByDepartment(departmentId) {
        
    	if (!departmentId) return;

        fetch(`employees/byDepartment/${departmentId}`)
            .then(response => response.json())
            .then(employees => {
            	//console.log("dddeeepppttt"+JSON.stringify(employees));
                populateProjectManager(employees);
                populateTeamMembers(employees);
                populateSenior(employees);
            })
            .catch(error => console.error('Error fetching employees:', error));
    }

    function populateProjectManager(employees) {
        const prjManagerSelect = document.getElementById('prjManager');
        prjManagerSelect.innerHTML = '<option value="">Select a Lead</option>';
		
        // console.log("....."+employees);
		// console.log(JSON.stringify(employees)); 	
		
        employees.forEach(employee => {
            const option = document.createElement('option');
            option.value = employee.firstName;
            option.text = employee.firstName;
            prjManagerSelect.appendChild(option);
        }); 
        
    }

    function populateTeamMembers(employees) {
    	/* console.log("employees---"+employees);
        const teamMembersSelect = document.getElementById('selectTeamMembers');
        teamMembersSelect.innerHTML = ''; // Clear previous options

        employees.forEach(employee => {
            const option = document.createElement('option');
            option.value = employee.email;
            option.text = employee.email;
            teamMembersSelect.appendChild(option);
        }); */
        
    	console.log("employees---", employees);
        const teamMembersContainer = document.getElementById('selectTeamMembers');
        teamMembersContainer.innerHTML = ''; // Clear previous options

        employees.forEach(employee => {
            // Create checkbox container
            const checkboxDiv = document.createElement('div');
            checkboxDiv.classList.add('checkbox-item');

            // Create checkbox
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = employee.email;
            checkbox.id = `teamMember_${employee.email}`;
            checkbox.addEventListener('change', updateTextField); // Call updateTextField when checked/unchecked

            // Create label for checkbox
            const label = document.createElement('label');
            label.htmlFor = checkbox.id;
            label.textContent = employee.email; // Full email shown inside dropdown

            // Append checkbox and label
            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(label);
            teamMembersContainer.appendChild(checkboxDiv);
        });
    }
    
    // Toggle dropdown visibility
    document.getElementById("teamMembersWrapper").addEventListener("click", function (event) {
         	
    	const container = document.getElementById("selectTeamMembers");
        container.classList.toggle("active");
		 
        // Prevent event propagation to document click listener
        event.stopPropagation();
         
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", function (event) {
        const container = document.getElementById("selectTeamMembers");
        if (!document.getElementById("teamMembersWrapper").contains(event.target)) {
            container.classList.remove("active");
        }
    });
    
    function populateSenior(employees) {
        const selectManager = document.getElementById('selectManager');
        selectManager.innerHTML = ''; // Clear previous options

        employees.forEach(employee => {
            const option = document.createElement('option');
            option.value = employee.firstName;
            option.text = employee.firstName;
            selectManager.appendChild(option);
        });
    }
    
</script>

<script>
    // Get all nav links
    const navLinks = document.querySelectorAll('.nav-link');

    // Function to remove background color from all tabs
    function resetBackgrounds() {
        navLinks.forEach(link => {
            link.style.backgroundColor = ''; // Reset background color
        });
    }

    // Add event listener for each nav link
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            resetBackgrounds(); // Reset background colors of all tabs
            this.style.backgroundColor = '#D7DBF9'; // Change background color of clicked tab
        });
    });
    // Set the default background color for the "Ongoing" tab
    document.getElementById('orders-all-tab').style.backgroundColor = '#D7DBF9';
</script>

<!-- script to hide and display the adproject and view project -->
<script>
function addNewProject() {
    // Show the form and hide the content
    document.getElementById('addProjectContainer').style.display = 'block';
    document.getElementById('addProjectButton').style.display = 'none';
    document.getElementById('appContent').style.display = 'none';
}

function viewProject() {
    // Hide the form and show the content
    document.getElementById('addProjectContainer').style.display = 'none';
    document.getElementById('addProjectButton').style.display = 'block';
    document.getElementById('appContent').style.display = 'block';
}
</script>

<!-- script to fill the current date into hidden datefield on add new project form -->
<script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('assignedSubmitDate').value = formattedDate;
            document.getElementById('delivery_date').setAttribute('min', formattedDate);
        });
</script>
<!-- script to notification -->
<!-- <script>
// Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
        var leaveRequestCountValue = response;
        
        // If total notification count is greater than 0, show the bell icon and notifications
        if (leaveRequestCountValue.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        } else {
            // If total notification count is 0, hide the bell icon and notification
            $("#notificationBellIcon").hide();
        }
    });
}

// Periodically fetch flag value every second (adjust as needed)
setInterval(fetchFlag, 1000);

</script> -->

<!-- script to notification link redirect -->
<script th:inline="javascript">
    function redirectToLeaveRequest() {
        var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/viewAdminLeaves?empid=' + empid;
    }
</script>
<!-- script to notification -->
<!-- <script>

// Function to fetch flag value from the backend
// Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
        var leaveRequestCountValue = response; 
        // console.log(leaveRequestCountValue);
        // If total notification count is greater than 0, show the bell icon and notifications
        if (leaveRequestCountValue.leaveRequestFlagCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        }  
        
        //display the asset notifu=ication based on asset count value
        if(leaveRequestCountValue.asseteRequestFlagCount>0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
             
             $("#assetRequestMessage").text(leaveRequestCountValue.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#asseteRequestFlagCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        	 	
        }      
        	
        //display the new project notification based on asset count value
        if(leaveRequestCountValue.newPrjectValueCount>0){
        	
        	 $("#notificationBellIcon").show();     // Show bell icon
             $("#newProjectNotification").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.newPrjectValueCount + " project request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount); 
             
        }
        
        //display the appraisal from HR notification
        if(leaveRequestCountValue.appraisalCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#hrAppraisal").show();  // Show specific notification
             
             $("#apprisalHrNotification").text(" Appraisal Form");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#appraisalCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        
        //display the appraisal from employee notification 
        if(leaveRequestCountValue.empAppraisalflag>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalempNotification").text(leaveRequestCountValue.empAppraisalflag + " employees sent appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#empAppraisalflag").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        
        //display the appraisal Due date notification 
        if(leaveRequestCountValue.adminAppraisalDuedate>0){
        	 $("#dueAppraisal").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalDueNotification").text("Tomorrow is the due date for submit appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#adminAppraisalDuedate").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        
        //display the asset notifu=ication based on asset count value
        if(leaveRequestCountValue.announcementNotification>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newAnnouncementNotification").show();  // Show specific notification
             
             $("#newannouncement").text(leaveRequestCountValue.announcementNotification + " announcement(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        }  
        
        //display the leave request status change notification
        if(leaveRequestCountValue.leaveRequestStatusChangeValue > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#leaveRequestSatusChangeNotification").show();  // Show specific notification
             
             $("#leaveRequestSatusChangeMessage").text("Your leave request status has been");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 	
        }
        
        //display the new feature notification
        if(leaveRequestCountValue.newFeatureNotification > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#new-feature").show();  // Show specific notification
             
             $("#new-featuretext").text("Latest Update, There is " + leaveRequestCountValue.newFeatureNotification + " new feature(s) update is now available.");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 
        } 
    });
}
// Periodically fetch flag value every second (adjust as needed)
setInterval(fetchFlag, 1000);

</script>

script to notification link redirect
<script th:inline="javascript">
    function redirectToLeaveRequest() {
        var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/viewAdminLeaves?empid=' + empid;
    }
    function redirectToAsset() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/asset';
    }
    function redirectToProject() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/ongoingProject';
    }    
    function redirectToAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/apprisal?empid=' + empid;
    }    
    function redirectToemployeeAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/employeeApprisal?empid=' + empid;
    }    
    function redirectToAnnouncement() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/events';
    }
    function redirectToAttendence() {
    	var email = /*[[${empDetailsByEmpId.email}]]*/ 'defaultEmpId';
    	window.location.href = '/attendanceLive?email=' +email;
    }
</script>

 -->

<!-- script for profile pic -->
<script>
$.ajax({
    type: "GET",
    url: "fetchEmployeeDocumentDetailsOnlyByEmpId",
    data: {
        "emp_id": $('#emp_idSessionValue').val()
    },
    success: function(data) {
    	console.log("++++data"+JSON.stringify(data));
        $('#dynamicProfilePic').attr('src', `${data.profilePicPath}`);
    },
    error: function(xhr, status, error) {
        console.error("Error invoking data:", error);
    }
});
</script>


<!-- script to check selected emails are in database or not (before assigning project for extend permission) -->
<script>
document.getElementById("myForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent default form submission

    // Collect selected emails from "Team Members" field
    const selectedEmails = Array.from(document.getElementById("selectTeamMembers").selectedOptions)
                                .map(option => option.value);

    // Check for existing emails with AJAX
    fetch('/checkEmails', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(selectedEmails)
    })
    .then(response => response.json())
    .then(existingEmails => {
        if (existingEmails.length > 0) {
            // If emails already exist, display the modal for confirmation
            $('#confirmModal').modal('show');

            // Handle "Yes, Extend" button
            document.getElementById("extendYes").onclick = function() {
                // Set extendAssignment to true
                document.getElementById("extendAssignment").value = "true";
                
                // Proceed with form submission and backend operations
                document.getElementById("myForm").submit();
            };

            // Handle "No, Don’t Extend" button
            document.getElementById("extendNo").onclick = function() {
                // Set extendAssignment to false
                document.getElementById("extendAssignment").value = "false";
                
                // Proceed with form submission
                document.getElementById("myForm").submit();
            };
        } else {
            // If no existing emails, submit the form directly with extendAssignment as false
            document.getElementById("extendAssignment").value = "false";
            document.getElementById("myForm").submit();
        }
    })
    .catch(error => {
        console.error("Error checking emails:", error);
    });
});

document.querySelector('.close').onclick = function() {
    $('#confirmModal').modal('hide');
};

</script>


<!-- script to display selected multiple departments below -->
<!-- <script>
function updateSelectedDepartments() {
    const selectElement = document.getElementById("department");
    const selectedOptions = Array.from(selectElement.selectedOptions).map(option => option.text);
    const displayList = document.getElementById("selectedDepartmentsList");

    // Clear previous entries
    displayList.innerHTML = "";

    // Add the selected departments to the list
    selectedOptions.forEach(department => {
        const listItem = document.createElement("li");
        listItem.textContent = department;

        // Add a click-to-remove functionality
        const removeIcon = document.createElement("span");
        removeIcon.textContent = "×";
        removeIcon.style.color = "#d9534f";
        removeIcon.style.cursor = "pointer";
        removeIcon.style.marginLeft = "10px";

        // Remove the department on click
        removeIcon.addEventListener("click", () => {
            const optionToRemove = Array.from(selectElement.options).find(option => option.text === department);
            optionToRemove.selected = false; // Deselect the option
            updateSelectedDepartments(); // Update the list
        });

        listItem.appendChild(removeIcon);
        displayList.appendChild(listItem);
    });
}

</script> -->

<!-- script to display selected department in separate field -->
<script>
function toggleDropdown() {
    const dropdown = document.getElementById("departmentDropdown");
    dropdown.style.display = (dropdown.style.display === "block") ? "none" : "block";
}

function updateSelectedDepartments() {
    const checkboxes = document.querySelectorAll(".dept-checkbox");
    const displayList = document.getElementById("selectedDepartmentsList");
    const selectedContainer = document.getElementById("selectedContainer");

    // Clear previous selections
    displayList.innerHTML = "";

    let selectedCount = 0;

    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            selectedCount++;

            const listItem = document.createElement("li");
            listItem.textContent = checkbox.value;
            
            // Remove button
            const removeIcon = document.createElement("span");
            removeIcon.textContent = " ×";
            removeIcon.className = "remove-icon";
            
            // Remove on click
            removeIcon.addEventListener("click", () => {
                checkbox.checked = false; // Uncheck checkbox
                updateSelectedDepartments(); // Refresh list
            });

            listItem.appendChild(removeIcon);
            displayList.appendChild(listItem);
        }
    });

    // Show or hide the selected departments container
    selectedContainer.style.display = (selectedCount > 0) ? "block" : "none";
}

// Close dropdown when clicking outside
document.addEventListener("click", function(event) {
    const dropdown = document.getElementById("departmentDropdown");
    const button = document.querySelector(".dropdown-btn");

    if (!dropdown.contains(event.target) && !button.contains(event.target)) {
        dropdown.style.display = "none";
    }
});
</script>	
<!-- script to notification on bottom of the page-->
<!--CHAT BOOT-->

<!-- Include SockJS and Stomp.js libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- script to notification on bottom of the page-->
<script>

		//CODE FOR CHATBOOT NOTIFICATION 
		var stompClient = null;
		var employeeMap = {}; // To store the mapping of employee names to emails
		let employeePhotoMap = {};
		let emailToNameMap = {}; // New map for email -> name lookup
		var email = null;
		var visibilityState = document.visibilityState; // Track tab visibility
		var heartbeatInterval = null; // Track heartbeat interval

		function connectWebSocket() {
			
			var socket = new SockJS('/chat-websocket');
						  stompClient = Stomp.over(socket);

						  var email = document.getElementById('loggedInMail').value;
						  console.log(`Connecting WebSocket as: ${email}`);

						  stompClient.connect({ 'email': email }, function (frame) {
						      console.log('Connected to WebSocket:', frame);

							 // subscribeToTypingEvents();
						      // Mark user as active
						      stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));

						      // Subscribe to active users list
						      stompClient.subscribe('/topic/activeUsers', function (message) {
						          var activeUsers = JSON.parse(message.body);
						          updateActiveUserUI(activeUsers);
						      });
							  // Subscribe to user messages
							        stompClient.subscribe('/user/queue/messages', function (message) {
									//	loadMessages();
									//	alert("po2");
							            console.log('Raw WebSocket Message:11', message);
							            var msg = JSON.parse(message.body);
										//alert(msg);
							            console.log('Parsed Messag111e:', msg);
							            console.log(`Received messagesdsd: ${JSON.stringify(msg)}`);
										//alert("(message.read"+msg.read);
									
							            // Display message if it matches the selected employee
							            if (selectedEmployee === msg.senderEmail || selectedEmployee === msg.recipientEmail) {
											console.log(`New message fromss ${msg.senderEmail}: ${msg.content}`);
											console.log("plk "+selectedEmployee);
											console.log("plk "+msg.senderEmail);
											console.log("plk "+msg.recipientEmail);
											//loadMessages();
							                showMessage(
							                    msg.id,               // Message ID
							                    msg.senderEmail,      // Sender's email
							                    msg.content,          // Message content
							                    msg.recipientEmail,   // Recipient's email
							                    msg.timestamp,        // Message timestamp
							                    email,
												msg.read                    // Logged-in user's email
							                );
							            }
								
										loadEmployees();
										loadMessages();
									 	
							        });

							        // Subscribe to notifications
							        stompClient.subscribe('/user/queue/notifications', function (notification) {
										//alert("00");
							            console.log('New Notification:', notification.body);
							            showToastNotification(notification.body);
										loadEmployees();
										//alert("01");
							        });

									//alert("Subscribing to chat updates...");
									stompClient.subscribe('/user/queue/messages', function (message) {
									    console.log('WebSocket Chat Update Received:', message.body); // Log raw message

									    let parsedMessage = JSON.parse(message.body);
									    console.log('Parsed Message:', parsedMessage); // Log parsed JSON

									    if (Array.isArray(parsedMessage)) {
									        parsedMessage.forEach(msg => {
									            console.log(`Message ID: ${msg.id}, Read: ${msg.read}`);
									            if (msg.read) {
									                updateMessageUI(msg);
									            }
									        });
									    } else {
									        console.log("Unexpected message format:", parsedMessage);
									    }

									    // Refresh messages after a delay
									    setTimeout(() => {
									        console.log("Refreshing messages...");
									        loadMessages();
									    }, 3000);
									});

									stompClient.subscribe('/topic/typing', function (message) {
									    console.log("📩 Typing notification received:", message.body);

									    let typingData;
									    try {
									        typingData = JSON.parse(message.body);
									        console.log("✅ Parsed Typing Data:", typingData);
									    } catch (error) {
									        console.error("❌ Error parsing typing notification message:", error);
									        return;
									    }

									    let loggedInUserEmail = document.getElementById('loggedInMail')?.value;
									    if (!loggedInUserEmail) return;

									    if (loggedInUserEmail === typingData.recipientEmail && typingData.senderEmail === selectedEmployee) {
									        // Fetch actual typing status from the backend
									        fetch(`/getTypingStatus?senderEmail=${typingData.senderEmail}&recipientEmail=${typingData.recipientEmail}`)
									            .then(response => response.json())
									            .then(data => {
									                console.log("🎯 Actual Typing Status from DB:", data.typing);
													console.log("🎯 Actual Typing Status from DB:", data);
													                console.log("ℹ️ Typing Status (0 or 1):", data.typing);
													                
									                let chatMessages = document.querySelector(".chat-history ul");
									                let chatContainer = document.querySelector(".chat-history"); // The scrollable chat area

									                let typingIndicator = document.getElementById("typingIndicator");
									                
									                if (!typingIndicator) {
									                    typingIndicator = document.createElement("li");
									                    typingIndicator.id = "typingIndicator";
									                    typingIndicator.classList.add("typing-indicator");
									                    typingIndicator.innerHTML = `
									                        <img src="${employeePhotoMap[selectedEmployee] || 'default-profile.jpg'}" alt="User Photo" class="typing-photo">
									                        <span>Typing...</span>
									                    `;
									                    chatMessages.appendChild(typingIndicator);
									                }

									                if (data.typing === 1) { // Ensure it checks the latest typing status
									                    typingIndicator.style.display = "flex";

									                    // Move typing indicator to the bottom
									                    chatMessages.appendChild(typingIndicator);

									                    // Auto-scroll to the bottom
									                    setTimeout(() => {
									                        chatContainer.scrollTop = chatContainer.scrollHeight;
									                    }, 100);
									                } else {
									                    typingIndicator.style.display = "none";
									                }
									            })
									            .catch(error => console.error("❌ Error fetching typing status:", error));
									    }
									});


						      // Start heartbeat initially
						      heartbeatInterval = setInterval(() => {
						          if (stompClient && stompClient.connected) {
						              stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						              console.log("Heartbeat sent for user: " + email);
						          }
						      }, 20000); // 30 seconds

						      // Detect tab visibility change
						  /*    document.addEventListener("visibilitychange", function () {
						          if (document.hidden) {
						              console.log("User switched to another tab. Marking as inactive.");
						              stompClient.send("/app/userInactive", {}, JSON.stringify({ email }));
						              clearInterval(heartbeatInterval); // Stop heartbeat
						              heartbeatInterval = null;
						          } else {
						              console.log("User returned to the application tab. Marking as active.");
						              stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));
						              if (!heartbeatInterval) {
						                  heartbeatInterval = setInterval(() => {
						                      if (stompClient && stompClient.connected) {
						                          stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						                          console.log("Heartbeat sent for user: " + email);
						                      }
						                  }, 30000);
						              }
						          }
						      });*/

						      // Detect tab close or WebSocket disconnect
						      socket.onclose = function () {
						          console.log("WebSocket disconnected. Updating user status.");
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      };

						      window.addEventListener('beforeunload', function () {
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      });

						  });
		}

		function updateActiveUserUI(activeUsers) {
		//	alert("1");
		    const employeeItems = document.getElementById('employeeNames').getElementsByTagName('li');

		    Array.from(employeeItems).forEach(item => {
		        const employeeName = item.querySelector('span').textContent;
		        const email = employeeMap[employeeName]; 
		        const statusIndicator = item.querySelector('.status-indicator'); // Get the status dot

		        if (activeUsers.includes(email)) {
		            item.classList.add('active-user');
		            statusIndicator.style.backgroundColor = '#66cc66'; // Green for active users
		        } else {
		            item.classList.remove('active-user');
		            statusIndicator.style.backgroundColor = '#ff6666'; // Red for inactive users
		        }

		        // If this employee is currently selected, update chat header status
				if (selectedEmployee === email) {
				           const chatStatusIndicator = document.getElementById('chatStatusIndicator');
				           if (activeUsers.includes(email)) {
				               chatStatusIndicator.style.backgroundColor = '#66cc66'; // Green (Online)
				           } else {
				               chatStatusIndicator.style.backgroundColor = '#ff6666'; // Red (Offline)
				           }
				       }
		    });
		}


		// Select an employee to chat with
		function selectEmployee(employeeName) {
			selectedEmployee = employeeMap[employeeName]; // Get the email from the map
			console.log(`Employee selected: ${selectedEmployee}`);

			// Highlight the selected employee
			var employeeItems = document.querySelectorAll('#employeeNames li');
			employeeItems.forEach(function (item) {
				item.classList.remove('active');
			});
			var selectedItem = Array.from(employeeItems).find(item => item.innerHTML === employeeName);
			if (selectedItem) {
				selectedItem.classList.add('active');
			}

			// Update chat header with employee name and photo
			document.querySelector('.chat-about h6').innerText = employeeName;
			document.querySelector('#employeePhoto').src = employeePhotoMap[selectedEmployee] || 'default-profile.jpg';

			// Hide the message icon and dots when an employee is selected
			document.getElementById('message-icon-container').style.display = 'none';
			// Hide the paragraph when an employee is selected
			document.getElementById('logo-text').style.display = 'none';

			// Load messages for the selected employee
			loadMessages();
		}

		function loadEmployees() {
			console.log("Loading employee names...");

			// Fetch employee names from the endpoint
			fetch('/employees/names')
				.then(response => {
					console.log("Response received:", response);
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(data => {
					console.log("Employee data fetched:", data); // Log the raw data

					const employeeList = document.getElementById('employeeNames');
					if (!employeeList) {
						console.error("Element with ID 'employeeNames' not found.");
						return;
					}

					employeeList.innerHTML = ''; // Clear the list before adding new items

					// Iterate through employee data
					data.forEach(employee => {
						console.log("Processing employee:", employee);

						// Create a list item for each employee
						const li = document.createElement('li');
						li.classList.add('d-flex', 'align-items-center', 'employee-item');

						// Handle missing or empty profile photo paths
						const profilePic = employeePhotoMap[employee.email] || '/static/default-profile.jpg';
						console.log(`Profile picture for ${employee.name}: ${profilePic}`);

						li.innerHTML = `
			                    <img src="${profilePic}" 
			                         alt="Employee Photo" 
			                         class="employee-photo mr-2" />
			                    <span>${employee.name}</span>
			                `;

						// Map employee name to email
						employeeMap[employee.name] = employee.email;
						console.log("Mapped employee:", employee.name, "->", employee.email);
						// Add new reverse mapping (email -> name)
						emailToNameMap[employee.email] = employee.name;
						// Add click event to list item
						li.onclick = () => {
							console.log(`Selected employee: ${employee.name}`);
							selectEmployee(employee.name);
						};

						// Append the list item to the employee list
						employeeList.appendChild(li);

					});

					console.log("Employee names loaded successfully. Employee map:", employeeMap);
					// Call the unread messages function after loading employee data
					fetchUnreadMessages();

					// Set interval to check for new messages every 10 seconds
						setInterval(fetchUnreadMessages, 10000);
				})
				.catch(error => {
					console.error("Error loading employees:", error);
				});
		}


		function loadMessages() {
			// alert("Loading messages...");
			// Get the logged-in user's email and selected employee's email
			var loggedInEmail = document.getElementById('loggedInMail').value;
			var selectedEmployeeEmail = selectedEmployee; // Email is already stored in selectedEmployee

			console.log(`Loading messages between: ${loggedInEmail} and ${selectedEmployeeEmail}`);

			fetch(`/messages?loggedInEmail=${encodeURIComponent(loggedInEmail)}&selectedEmployeeEmail=${encodeURIComponent(selectedEmployeeEmail)}`)
				.then(response => response.json())
				.then(data => {
					console.log("Chat messages loaded:", data);
					// Clear the chat window before displaying messages
					var chatWindow = document.getElementById('chat-window').querySelector('ul');
					chatWindow.innerHTML = '';

					// Display messages
					data.forEach(function (msg) {
						// showMessage(msg.senderEmail, msg.content, msg.recipientEmail, loggedInEmail);
						showMessage(msg.id, msg.senderEmail, msg.content, msg.recipientEmail, msg.timestamp, loggedInEmail);
					});
				})
				.catch(error => console.error("Error loading chat messages:", error));
		}
		let activeDeleteDropdown = null;
		function showMessage(id, senderEmail, message, recipientEmail, timestamp, loggedInEmail) {
			console.log("Message ID:", id);
			console.log(`LoggedInEmailrrr: ${loggedInEmail}, SenderEmail: ${senderEmail}`);

			const isSender = senderEmail === loggedInEmail;
			const senderName = isSender ? "Me" : Object.keys(employeeMap).find(name => employeeMap[name] === senderEmail) || senderEmail;
			const senderPhoto = employeePhotoMap[senderEmail] || 'default-avatar.png';
			const formattedTime = new Date(timestamp).toLocaleString(); // Format timestamp

			console.log(`Message ID: ${id}, Time: ${formattedTime}, From: ${senderEmail}, To: ${recipientEmail}, Content: "${message}"`);

			var chatWindow = document.getElementById('chat-window').querySelector('ul');
			var li = document.createElement('li');
			li.className = isSender ? 'clearfix right' : 'clearfix left';

			li.innerHTML = `
					    <div class="message-container" data-message-id="${id}" onclick="toggleDeleteOption(this)">
					        <img class="sender-photo" src="${senderPhoto}" alt="Sender Photo" />
					        <div class="message ${isSender ? 'my-message' : 'other-message'}">
					            <strong>${senderName}:</strong> ${message}
					        </div>
					    </div>
					    <div class="timestamp" style="text-align: ${isSender ? 'right' : 'left'};">
					        ${formattedTime}
					    </div>
					    ${isSender ? `
					        <div class="message-action-dropdown" >
					            <a class="dropdown-item" href="#" onclick="deleteMessage(this, ${id})">Delete Message</a>
					        </div>
					    ` : ''}`;

			chatWindow.appendChild(li);
			chatWindow.scrollTop = chatWindow.scrollHeight;
		}
		
		/*function fetchUnreadMessages() {
			console.log("Fetching unread messages...");
			var loggedInEmail = document.getElementById('loggedInMail').value;

			fetch(`/unread?email=${loggedInEmail}`)
				.then(response => response.json())
				.then(messages => {
					messages.forEach(message => {
						let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;

						// Show notification with sender's email as a parameter
						showToastNotification(`New message from ${senderName}: ${message.content}`, message.senderEmail);
					});
				})
				.catch(error => console.error("Error fetching unread messages:", error));
		}*/

		let displayedMessageIds = new Set(); // Track displayed messages
		let closedMessageIds = new Set(); // Track closed messages

		function fetchUnreadMessages() {
		    console.log("Fetching unread messages...");
		    var loggedInEmail = document.getElementById('loggedInMail').value;

		    fetch(`/unread?email=${loggedInEmail}`)
		        .then(response => response.json())
		        .then(messages => {
		            messages.forEach(message => {
		                console.log("Processing message ID:", message.id); // Print message ID to console
		                
		                // Ignore messages that were previously closed
		                if (!displayedMessageIds.has(message.id) && !closedMessageIds.has(message.id)) {
		                	
							//alert(1);
		                    let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;
		                    showToastNotification(`New message from ${senderName}: ${message.content}`, message.id, message.senderEmail);
		                    displayedMessageIds.add(message.id); // Mark message as displayed
		                }
						//alert(2);
		            });
		        })
		        .catch(error => console.error("Error fetching unread messages:", error));
		}
		// Global flag to track if the user manually dismissed notifications
		
		/*function showToastNotification(message, senderEmail) {
			
			var toastContainer = document.createElement('div');
			toastContainer.className = 'toast-notification';

			// Add message and close button
			toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">✖</span>`;

			document.body.appendChild(toastContainer);

			// Animate in
			setTimeout(() => {
				toastContainer.classList.add('show');
			}, 100);

			// Auto-hide after 8 seconds
			let autoHideTimeout = setTimeout(() => closeToast(toastContainer), 10000);

			// Prevent opening chat when clicking the close button
			toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
				event.stopPropagation(); // Prevent click from bubbling to toastContainer
				clearTimeout(autoHideTimeout);
				
				closeToast(toastContainer);
			});

			// Open chat when clicking on the notification
			toastContainer.addEventListener('click', () => {
				openChatWithSender(senderEmail);
				closeToast(toastContainer); // Remove notification when chat opens
			});
		}*/
		function showToastNotification(message, messageId, senderEmail) {
			//alert(1);
		    var toastContainer = document.createElement('div');
		    toastContainer.className = 'toast-notification';
		    toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">✖</span>`;

		    document.body.appendChild(toastContainer);

		    // Animate in
		    setTimeout(() => {
		        toastContainer.classList.add('show');
		    }, 100);

		    // Auto-hide after 8 seconds
		    let autoHideTimeout = setTimeout(() => closeToast(toastContainer, messageId), 8000);

		    // Prevent opening chat when clicking the close button
		    toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
		        event.stopPropagation(); // Prevent click from bubbling to toastContainer
		        clearTimeout(autoHideTimeout);
		        closedMessageIds.add(messageId); // Mark as closed so it won't be shown again
		        closeToast(toastContainer, messageId);
		    });

		    // Open chat when clicking on the notification
		    toastContainer.addEventListener('click', () => {
		        openChatWithSender(senderEmail);
		        closeToast(toastContainer, messageId); // Remove notification when chat opens
		    });
		}

		// Function to handle toast closing
		/*function closeToast(toast) {
			toast.classList.remove('show');
			setTimeout(() => toast.remove(), 300); // Faster fade-out
		}*/
		// Function to handle toast closing and mark as dismissed
		// Function to handle toast closing
		function closeToast(toast, messageId) {
		    toast.classList.remove('show');
		    setTimeout(() => toast.remove(), 300); // Faster fade-out
		}
		/*	function openChatWithSender(senderEmail) {
				console.log("Opening chat with:", senderEmail);
			    
				// Construct the URL for the UserFavorite page with the senderEmail as a query parameter
				const url = `/my-favorites?email=${encodeURIComponent(senderEmail)}`;
			    
				// Redirect to the UserFavorite page
				window.location.href = url;
			}*/

		function openChatWithSender(senderEmail) {
			console.log("Opening chat with:", senderEmail);

			// Store sender email in sessionStorage
			sessionStorage.setItem("chatSenderEmail", senderEmail);

			// Redirect to the UserFavorite page
			window.location.href = `/my-favorites`;
		}

		// Connect to the WebSocket server and load employees when the page is loaded
		document.addEventListener('DOMContentLoaded', function () {
			//fetchUnreadMessages();
			loadEmployees();
			connectWebSocket();
		});

	</script>
</body>
</html>