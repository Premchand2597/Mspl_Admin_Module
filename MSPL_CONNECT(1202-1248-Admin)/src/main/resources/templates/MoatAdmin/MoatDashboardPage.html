<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Interview</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <!-- Template Main JS File -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
   <style>
  
  .moat_navbar{
	  font-size: 14px;
	  background: #fff;
	  padding: 15px;
	  position: sticky;
	  top: 64px;
	  width: 100%;
	  margin-left: auto;
	  margin-right: auto;
	  box-shadow: 0 0 10px #0005;
	  gap: 0.7rem;
	  backdrop-filter: blur(10px);
	  background-color: #fff2;
	  display: flex;
}

.moattt_anchor {
    position: relative;
    display: inline-block;
    padding: 5px 10px;
    color: inherit;
    text-decoration: none;
    text-shadow: 0 0 5px rgba(#000, 0.8);
    letter-spacing: 1px;
    border-right: 1px solid #d5d8dc;
  }

.moattt_anchor.active{
	font-weight: bold;
	color: #4154f1;
}

.moat_parentDropDown{
	position: relative;
    display: inline-block;
}

.moat_subDropDown {
    display: none;
    position: absolute;
    background-color: #f6f9ff;
    min-width: 160px;
    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
    z-index: 1;
}

  .progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 0.08rem;
    background-image: linear-gradient(to right, #8ad4ff, #fa7196);
    border-radius: 0.1rem;
    animation: progressMove linear both;
    animation-timeline: scroll(block root);
  }


/* Fullscreen overlay with dim background */
#loadingPopup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Dim background */
    z-index: 9999;
    font-family: Arial, sans-serif;
    color: white; /* Text color for better contrast */
    display: none;
}

.spinnerAndParaMerger{
	display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    /* background: red; */
    margin: 18% auto;
}

/* Spinner animation */
.spinner {
    width: 50px;
    height: 50px;
    border: 6px solid rgba(255, 255, 255, 0.3); /* Semi-transparent border */
    border-top-color: white; /* Bright top border */
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Loading text */
#loadingPopup p {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    color: white;
}

/* Spinner keyframe animation */
@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.moatBody_content_div{
	width: 100%;
	height: 100%;
}

.add_questions_form_outer_div{
	width: 98%;
	height: auto;
	padding: 10px;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	font-size: 14px;
}

.add_questions_form_div{
	width: 100%;
	height: 100%;
}

.question_heading{
	width: 100%;
	padding: 5px 10px;
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 10px;
}

.question_p{
	color: #566573;
	font-size: 14px;
	font-weight: bold;
	margin-top: 10px;
}

.addQuestions_language_select{
	border: none;
	outline: none;
	background-color: transparent;
	border-bottom: 1px solid #566573;
	color: #566573;
	font-weight: bold;
}

.questionType_radio_box{
	width: auto;
}

.questionTypeLabel{
	color: #566573;
	font-weight: bold;
}

.question_text_area_box,.correct_answer_box2{
	width: 100%;
	height: auto;
}

.question_text_area{
	width: 100%;
	height: 100%;
	font-size: 14px;
}

.options_p,.correct_answer_p{
	color: #566573;
	padding: 5px 10px;
	font-weight: bold;
	margin-top: 10px;
	margin-bottom: 10px;
}

.options_box{
	width: 100%;
	height: auto;
	display: flex;
	justify-content: space-evenly;
	gap: 5px;
}

.question_text_field{
	padding-left: 5px;
	font-size: 14px;
}

.answer_text_area2{
	width: 100%;
	font-size: 14px;
}

.btn_outer_div{
	width: 100%;
	height: auto;
	padding: 5px 10px;
	margin-top: 2%;
}

.btn_div{
	display: flex;
	width: 100%;
	height: auto;
	justify-content: flex-start;
	gap: 10px;
}

.questions_table_div{
	width: 98%;
	height: 90vh;
	overflow: auto;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	font-size: 14px;
}

.cards_container{
	width: 98%;
	margin-bottom: 8px;
	margin-left: auto;
	margin-right: auto;
	padding: 5px 10px;
	display: flex;
	justify-content: space-between;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
}

.card1{
	width: 24%;
	/*background-color: green;*/
	display: flex;
	padding: 5px;
	border-right: 2px solid #ECF0F1;
}

.card4{
	width: 24%;
	/*background-color: green;*/
	display: flex;
	padding: 5px;
}

.card_numbers{
	/*background-color: yellow;*/
	width: auto;
	height: 100%;
}

.card_numbers p{
	font-size: 30px;
	font-weight: bold;
	color: #4154f1;
}

.card_text{
	/*background-color: red;*/
	width: auto;
	height: 100%;
}

.p2{
	margin-top: 5px;
	/*background-color: orange;*/
	padding-left: 10px;
	color: #566573;
	font-size: 15px;
	font-weight: bold;
}

.p3{
	margin-top: -15px;
	/*background-color: darkgreen;*/
	padding-left: 10px;
	color: #AEB6BF;
	font-size: 14px;
}

.student_table_outer_div{
	width: 98%;
	height: 100%;
	box-shadow: 0 0 10px #0005;
	backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	background: transparent !important;
}

.student_table_div{
	width: 100%;
	height: 100%;
	overflow: auto;
}

.student_table_div .table,.student_table_url_archive_div .table{
	width: 100%;
	font-size: 14px;
}

.student_table_div .table thead th,.student_table_url_archive_div .table thead th{
	padding: 12px;
	font-size: 14px;
	background: transparent !important;
	color: #566573;
}

.emailFormOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }

.emailFormInnerBoxCloser{
   	/* background: red; */
   	padding-right: 10px;
   	text-align: right;
   }
   
   .emailFormInnerBoxCloser span{
   	font-size: 25px;
   	font-weight: bold;
   	cursor: pointer;
   }

.emailFormBox{
   	/* background: red; */
   	width: 98%;
   	margin-right: auto;
   	margin-left: auto;
   }

.ctcFormOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }
   
.ctcFormInnerBox{
	width: 60%;
   	height: 400px;
   	background: rgb(255,255,255);
   	margin: 3% auto;
   	border-radius: 10px;
   	padding: 15px 5px;
   	overflow: auto;
}

  .ctcFormInnerBoxCloser{
   	/* background: red; */
   	padding-right: 10px;
   	text-align: right;
   	margin: 0;
   }
   
   .ctcFormInnerBoxCloser span{
   	font-size: 25px;
   	font-weight: bold;
   	cursor: pointer;
   }

.hiddenCtcFeedbackFromCandidate{
   	display: none;
   }

.docUploadFormOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }

.docUploadFormInnerBox{
	width: 30%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 3% auto;
   	border-radius: 10px;
   	padding: 15px 5px;
   	overflow: auto;
}

.docUploadBox{
	width: 32%;
	height: 10px;
	margin: 40px auto 5px auto;
	/* background: red; */
}

.docUploadViewFormOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }
   
   .docUploadViewFormInnerBox{
	width: 70%;
   	height: 440px;
   	background: rgb(255,255,255);
   	margin: 2% auto;
   	border-radius: 10px;
   	padding: 5px;
   	overflow-y: auto;
   	overflow-x: hidden;
}

.candidateCompleteViewFormOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }

.candidateCompleteViewFormInnerBox{
	width: 86%;
   	height: 96%;
   	background: rgb(255,255,255);
   	margin: 1% auto;
   	border-radius: 5px;
   	overflow: auto;
}

.candidateProfileHeadingAndAddEmpIconMerger{
	 /* background: red; */
	 display: flex;
	 justify-content: space-between;
	 align-items: center;
}

.candidateProfileHeadingAndAddEmpIconMerger span{
	background: #eaeded;
	padding: 2px 8px;
	border-radius: 10px;
	box-shadow: 0 0 4px #0005;
}

.candidateProfileHeadingAndAddEmpIconMerger span i{
	font-size: 22px;
	font-weight: bold;
	color: #4154f1;
}

.candidateProfileHeadingAndAddEmpIconMerger span i:hover{
	color: #52be80;
}

.student_result_box{
	width: 98%;
	height: 200px;
	padding: 5px;
	overflow: auto;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	font-size: 14px;
}

.student_result_box_heading{
	color: #566573;
	padding: 5px 10px;
	font-weight: bold;
	margin-top: 10px;
	margin-bottom: 10px;
	position: sticky;
	top: 0;
	left: 0;
}

.student_result_sheet_heading{
	color: #566573;
	padding: 5px 10px;
	font-weight: bold;
	margin-top: 10px;
	margin-bottom: 10px;
}

.student_result_box_table thead th,.student_result_box_table tbody td{
	padding: 10px;
	font-size: 14px;
	background: transparent !important;
	color: #566573;
}

.candidate_resultSheet_box{
	width: 98%;
	height: auto;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	font-size: 14px;
	margin-top: 15px;
	padding: 5px 10px;
	display: none;
}

.questions_filter_box{
	margin-top: 10px;
	margin-bottom: 10px;
}

.marksDetails_outerBox{
	width: 50%;
	height: 100%;
	background-color: rgba(0,0,0,0.5);
	z-index: 5;
	position: fixed;
	top: 0;
    right: 0; /* Initially positioned outside the screen */
    transform: translateX(100%); /* Initial position outside the viewport */
    transition: transform 0.8s ease;
}

.marksDetails_outerBox.active {
    transform: translateX(0); /* When the modal is active, it slides to the right edge of the screen */
}

.marksDetails_outerBox_closeBox{
	/* background-color: red; */
	margin-top: 2vh;
	margin-bottom: 3px;
}

.close_marksDetails_outerBox_span{
	font-size: 20px;
	color: #fff;
	margin-left: 10px;
	cursor: pointer;
}

.marksDetails_outerBox{
	width: 50%;
	height: 100%;
	background-color: rgba(0,0,0,0.5);
	z-index: 5;
	position: fixed;
	top: 0;
    right: 0; /* Initially positioned outside the screen */
    transform: translateX(100%); /* Initial position outside the viewport */
    transition: transform 0.8s ease;
}

.marksDetails_outerBox.active {
    transform: translateX(0); /* When the modal is active, it slides to the right edge of the screen */
}

.marksDetails_outerBox_closeBox{
	/* background-color: red; */
	margin-top: 2vh;
	margin-bottom: 3px;
}

.close_marksDetails_outerBox_span{
	font-size: 20px;
	color: #fff;
	margin-left: 10px;
	cursor: pointer;
}

.markDetails_table_and_chartBox{
	width: 86%;
	height: 82vh;
	/* background-color: green; */
	margin: 1px auto; 
	padding: 4px;
	overflow: auto;
}

.markDetails_tableBox{
	width: 100%;
	height: 46vh;
	background-color: #fff;
	padding: 8px;
	margin-bottom: 5px;
	overflow: auto;
}

.markDetails_table{
	width: 100%;
	height: 100%;
}

.markDetails_grapghBox{
	width: 100%;
	height: auto;
	background-color: #fff;
	padding: 5px;
	margin-bottom: 5px;
}

.student_marksDetail_table{
	width: 100%;
	height: 100%;
	font-size: 14px;
	padding: 5px;
	color: #566573;
}

.marksDetail_table_heading{
	text-align: center;	
	font-size: 15px;
	font-weight: bold;
	padding: 5px;
	color: #566573;
}

.updateQuestionPopupOuterDiv{
	width: 100%;
	height: 100%;
	background-color: rgba(0,0,0,0.2);
	z-index: 9999;
	position: fixed;
	top: 0;
	display: none;
	overflow: auto;
}

.update_questions_form_outer_div{
	width: 90%;
	height: auto;
	padding: 10px;
	background-color: #f6f9ff;
	margin: 2% auto;
	border-radius: 10px;
}

.update_questions_form_div{
	width: 100%;
	height: 100%;
}

.UpdateQuestionPopupCloseBtnDiv{
	margin-top: -20px;
}

.UpdateQuestionPopupCloseBtnDiv span{
	font-size: 25px;
	font-weight: bold;
	cursor: pointer;
}

.update_questions_form_outer_div{
	width: 90%;
	height: auto;
	padding: 10px;
	background-color: #f6f9ff;
	margin: 2% auto;
	border-radius: 10px;
}

.update_questions_form_div{
	width: 100%;
	height: 100%;
}

.questions_table_div{
	width: 98%;
	height: 90vh;
	overflow: auto;
	box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	font-size: 14px;
}
.customTable2{
	width: 100%;
	font-size: 14px;
}

.customTable2 thead{
	position: sticky;
	top: 0;
	background-color: #f6f9ff;
}

.customTable2 thead th{
	padding: 10px;
	font-size: 14px;
	background: transparent !important;
	color: #566573;
}

.customTable2 tbody td{
	font-size: 14px;
}

.viewQuestions_language_select{
	border: none;
	outline: none;
	background-color: transparent;
	border-bottom: 1px solid #566573;
	color: #566573;
	font-weight: bold;
}

.questions{
	color: #EC7063 !important;
}

.answers{
	color: #229954 !important;
}

.moatResultView_icon{
	cursor: pointer;
}

.student_table_url_archive_div{
	width: 98%;
	height: 82vh;
	box-shadow: 0 0 10px #0005;
	backdrop-filter: blur(10px);
	margin-left: auto;
	margin-right: auto;
	background: transparent !important;
	overflow: auto;
}

.emailSentLoadingDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 200;
   	display: none;
   }
   
   .emailFormInnerBox{
   	width: 40%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 10% auto;
   	border-radius: 10px;
   	padding: 15px 5px;
   }

.emailSentLoadingInnerBox{
   	width: 40%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 10% auto;
   	border-radius: 10px;
   	padding: 15px 5px;
   }
   
   .emailFormInnerBoxCloser{
   	/* background: red; */
   	padding-right: 10px;
   	text-align: right;
   }
   
   .emailFormInnerBoxCloser span{
   	font-size: 25px;
   	font-weight: bold;
   	cursor: pointer;
   }
   
   .emailFormBox{
   	/* background: red; */
   	width: 98%;
   	margin-right: auto;
   	margin-left: auto;
   }

.linkGenerateFormBox{
   	width: 35%;
    height: auto;
    padding: 10px;
    margin-left: auto;
	margin-right: auto;
	margin-bottom: 10px;
    box-shadow: 0 0 10px #0005;
    backdrop-filter: blur(10px);
   }

.customTable{
    	width: 100%;
    	height: 100%;
    	font-size: 14px;
   }
        
     .customTable td{
     	padding-bottom: 15px;
     	padding: 10px;
     	text-align: left !important;
     	font-size: 14px;
     }

#emailList{
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
}

.test_link_generator_btn {
  color: #4154f1;
  border: 1px solid #4154f1;
  font-size: 14px;
}

.test_link_generator_btn:focus,
.test_link_generator_btn:hover 
{
  color: #fff;
  background-color: #4154f1;
}

.generatedLink {
    margin-top: 20px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.addDropDownDataFormOuterDiv{
    width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 9920;
   	display: none;
   }

.addDropDownDataFormInnerBox{
	width: 50%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 1% auto;
   	border-radius: 10px;
   	padding: 5px;
   	overflow: auto;
}

.newCandidateModeOfContactFormOuterDiv{
    width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 9900;
   	display: none;
   }

.newCandidateModeOfContactFormInnerBox{
	width: 90%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 1% auto;
   	border-radius: 10px;
   	padding: 5px;
   	overflow: auto;
}

.customLabel span{
	color: red;
	padding-left: 4px;
}

  </style>
  
</head>

<body style="overflow-x: hidden;">
<div class="addDropDownDataFormOuterDiv" id="addDropDownDataFormOuterDiv">
	 <div class="addDropDownDataFormInnerBox">
		
		<div class="d-flex justify-content-between align-items-center">
          	<p style="font-size: 14px; padding-top: 14px; padding-left: 20px; font-weight: bold;">Add Data to Dropdown Lists (Mode of Contact &amp; Status)</p>
       	 	<p class="emailFormInnerBoxCloser" style="margin-bottom: 0; margin-top: -5px;"><span onclick="closeAddDropDownDataFormOuterDiv();">&times;</span></p>
         </div>
         
			<div class="row emailFormBox" style="padding: 10px 20px">
				<div class="col-sm-5 form-group">
					<label style="font-size: 14px;" class="customLabel">Data to Add In<span>*</span></label>
					<select style="font-size: 14px;"
						class="form-select custom-select browser-default custom_selectfield" id="selectedDataDropdownValue">
						<option value=""></option>
						<option value="1">Mode of Contact</option>
						<option value="2">Status</option>
					</select>
				</div>
				<div class="col-sm-5">
					<label style="font-size: 14px;" class="customLabel">Enter Your Data<span>*</span></label>
					<input type="text" class="form-control" style="font-size: 14px;" id="dropDownValueData">
				</div>
				<div class="col-sm-2" style="margin-top: 26px;">
					<button style="font-size: 14px;" class="btn btn-outline-primary" onclick="submitDropDowndata();">Add</button>  
				</div>
			</div>
			
		</div>
	</div>


<div class="newCandidateModeOfContactFormOuterDiv" id="newCandidateModeOfContactFormOuterDiv">
	 <div class="newCandidateModeOfContactFormInnerBox">
		
		<div class="d-flex justify-content-between align-items-center">
          	<p style="font-size: 14px; padding-top: 14px; padding-left: 20px; font-weight: bold;">New Screening Candidate Form</p>
           	  
           	<div class="d-flex justify-content-between align-items-center" style="gap: 10px;">
        		<button style="font-size: 14px;" onclick="openAddDropDownDataFormOuterDiv();" class="btn btn-outline-primary mx-2">Add Dropdown Data</button>           	
       	 		<p class="emailFormInnerBoxCloser" style="margin-bottom: 0; margin-top: -5px;"><span onclick="closeNewCandidateModeOfContactFormOuterDiv();">&times;</span></p>
       		</div>
         </div>
		
			<form action="addMoadeOfContactDetails" method="post" style="font-size: 14px;">
				<input type="hidden" id="contact_by_name" name="contact_by" th:value="${session.empDetailsByEmpId.fullName}">
				<input type="date" style="display: none;" name="contacted_date" id="contacted_date">
					
				<div class="row emailFormBox mb-2" style="padding: 10px 20px">
					<div class="col-sm-3 mb-2">
						<label style="font-size: 14px;" class="customLabel">Department<span>*</span></label>
						<select style="font-size: 14px;" name="dept" class="form-select custom-select browser-default custom_selectfield" required>
					        <option value=""></option>
					        <option th:each="dept : ${departments}" th:value="${dept.deptName}" th:text="${dept.deptName}"></option>
					    </select>
				    </div>
					<div class="col-sm-3 mb-2">
						<label style="font-size: 14px;" class="customLabel">Candidate Name<span>*</span></label>
						<input type="text" class="form-control" style="font-size: 14px;" name="candidate_name" id="candidate_name" required>
					</div>
					<div class="col-sm-3">
						<label style="font-size: 14px;" class="customLabel">Candidate Email<span>*</span></label>
						<input type="email" onblur="validateEmailExists(this.value)" class="form-control" style="font-size: 14px;" name="candidate_email" id="candidate_email" required>
						<span id="errorEmilTextValidate"></span>
					</div>
					<div class="col-sm-3">
						<label style="font-size: 14px;" class="customLabel">Contact Number<span>*</span></label>
						<input type="text" maxlength="10" class="form-control" style="font-size: 14px;" name="candidate_contact_no" id="candidate_contact_no" required>
					</div>
					<div class="col-sm-3 form-group mb-2">
						<label style="font-size: 14px;" class="customLabel">Candidate Type<span>*</span></label>
						<select style="font-size: 14px;" onchange="filterDataBasedOnCandidateType(this.value)"
							class="form-select custom-select browser-default custom_selectfield"
							name="candidate_type" id="candidate_type" required="required">
							<option value="Fresher">Fresher</option>
							<option value="Experience">Experience</option>
						</select>
					</div>
					<div class="col-sm-3 form-group mb-2" id="currently_working" style="display: none;">
						<label style="font-size: 14px;" class="customLabel">Currently Working<span>*</span></label>
						<select style="font-size: 14px;"
							class="form-select custom-select browser-default custom_selectfield"
							name="currently_working">
							<option value=""></option>
							<option value="Yes">Yes</option>
							<option value="No">No</option>
						</select>
					</div>
					<div class="col-sm-3 mb-2" id="yoe" style="display: none;">
						<label style="font-size: 14px;" class="customLabel">Year of Experience<span>*</span></label>
						<input type="number" class="form-control" style="font-size: 14px;" min="0.1" step="0.1" name="yoe">
					</div>
					<div class="col-sm-3 mb-2" id="current_ctc" style="display: none;">
						<label style="font-size: 14px;" class="customLabel">Current CTC<span>*</span></label>
						<input type="number" class="form-control" style="font-size: 14px;" min="0.1" step="0.1" name="current_ctc">
					</div>
					<div class="col-sm-3 mb-2">
						<label style="font-size: 14px;" class="customLabel">Expected CTC<span>*</span></label>
						<input type="number" class="form-control" style="font-size: 14px;" min="0.1" step="0.1" name="expected_ctc" id="expected_ctc" required>
					</div>
					<div class="col-sm-3 mb-2" id="notice_period" style="display: none;">
						<label style="font-size: 14px;" class="customLabel">Notice Period (days)<span>*</span></label>
						<input type="number" class="form-control" style="font-size: 14px;" min="1" step="1" name="notice_period">
					</div>
					<div class="col-sm-3 mb-2">
						<label class="customLabel">Highest Qualification</label>
						<input type="text" class="form-control" style="font-size: 14px;" name="qualification" id="qualification">
					</div>
					<div class="col-sm-3 mb-2">
						<label class="customLabel">Communication Point</label>
						<input type="text" class="form-control" style="font-size: 14px;" name="communication_point" id="communication_point">
					</div>
					<div class="col-sm-3 mb-2">
						<label class="customLabel">Technical Part</label>
						<input type="text" class="form-control" style="font-size: 14px;" name="technical_part" id="technical_part">
					</div>
					<div class="col-sm-3 mb-2">
						<label class="customLabel">Technical Languages</label>
						<input type="text" class="form-control" placeholder="Comma seperated value" style="font-size: 14px;" name="technical_lang" id="technical_lang">
					</div>
					<div class="col-sm-3 form-group mb-2">
						<label style="font-size: 14px;" class="customLabel">Mode of Contact (Via)<span>*</span></label>
						<select style="font-size: 14px;"
							class="form-select custom-select browser-default custom_selectfield"
							name="mode_of_contact" id="mode_of_contact" required="required">
							<!-- <option value=""></option>
							<option value="LinkedIn">LinkedIn</option>
							<option value="Facebook">Facebook</option> -->
						</select>
					</div>
					
					<div class="col-sm-3 form-group mb-2">
						<label style="font-size: 14px;" class="customLabel">Status<span>*</span></label>
						<select style="font-size: 14px;"
							class="form-select custom-select browser-default custom_selectfield"
							name="remarks" id="remarks" required="required">
							<!-- <option value=""></option>
							<option value="Received on First Call">Received on First Call</option>
							<option value="Recall Again">Recall Again</option>
							<option value="Send Mail">Send Mail</option> -->
						</select>
					</div>
				</div>
				<div style="padding: 10px 20px; display: flex; justify-content: flex-start; gap: 6px; float: right;">
					<div>
						<button type="submit" class="btn btn-primary" id="moatContactListSubmitBtn" style="font-size: 14px;">Submit</button>
					</div>
					<div>
						<button type="button" class="btn btn-light" style="font-size: 14px;" onclick="closeNewCandidateModeOfContactFormOuterDiv();">Cancel</button>
					</div>
				</div> 
			</form>
		</div>
	</div>


  <main id="moatMain" class="moatMain">
  
  
  <div id="loadingPopup">
	<div class="spinnerAndParaMerger">
	    <div class="spinner"></div>
	    <p id="loadingPopupPara"></p>
    </div>
</div>
  
			<section class="section dashboard">
				<div class="col-lg-12">
					<div class="row">
						<div class="moatBody_content_div">
							
							<div class="cards_container">
								<div class="card1">
									<div class="card_numbers">
										<p id="student_count_today">0</p>
									</div>
									
									<div class="card_text pt-2">
										<p class="p2">Total</p>
										<p class="p3">Screening &amp; Interview</p>
									</div>
								</div>
								<div class="card1">
									<div class="card_numbers">
										<p id="student_approveCount">0</p>
									</div>
									
									<div class="card_text">
										<p class="p2">Selected</p>
										<p class="p3">Screening : <span id="screeningCount2">0</span></p>
										<p class="p3">Interview : <span id="interviewCount2">0</span></p>
									</div>
								</div>
								
								<div class="card1">
									<div class="card_numbers">
										<p id="student_rejectCount">0</p>
									</div>
									
									<div class="card_text">
										<p class="p2">Rejected</p>
										<p class="p3">Screening : <span id="screeningCount3">0</span></p>
										<p class="p3">Interview : <span id="interviewCount3">0</span></p>
									</div>
								</div>
								
								<div class="card1">
									<div class="card_numbers">
										<p id="student_onHoldCount">0</p>
									</div>
									
									<div class="card_text">
										<p class="p2">On-Hold</p>
										<p class="p3">Screening : <span id="screeningCount4">0</span></p>
										<p class="p3">Interview : <span id="interviewCount4">0</span></p>
									</div>
								</div>
								
								<div class="card4">
									<div class="card_numbers">
										<p id="student_pendingCount">0</p>
									</div>
									
									<div class="card_text">
										<p class="p2">Pending</p>
										<p class="p3">Screening : <span id="screeningCount5">0</span></p>
										<p class="p3">Interview : <span id="interviewCount5">0</span></p>
									</div>
								</div>
							</div>						
						
							<div class="student_table_outer_div">
								<div class="d-flex justify-content-between align-items-center" style="position: sticky; top: 0; bottom: 10px; background: #f6f9ff;">
						               	<h5 class="card-title m-0 p-0 px-2">Candidate Lists<span></span></h5>
									      
									      <div class="d-flex justify-content-between align-items-center m-1" style="gap: 10px;">
										      <div class="search-box">
										        <button class="btn-search" title="Search"><i class="bi bi-search"></i></button>
										        <input type="text" oninput="searchTable();" class="input-search" placeholder="Search...">
										      </div>
						               	
						              	 	<i style="font-size: 25px; font-weight: bold; color: blue; cursor: pointer;" title="Add new screening candidate details" onclick="openNewCandidateModeOfContactFormOuterDiv();" class="bi bi-plus-lg"></i>
					               		</div>
									      
					              	</div>
					              	
					              	
					              	<!-- Main Bordered Tabs Justified -->
								<ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist" style="background: #f6f9ff">
									<li class="nav-item flex-fill" role="presentation">
										<button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab" style="background: transparent; font-size: 14px;"
											data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home" onclick="fetchInitialParentTabSlect('screening')"
											aria-selected="true">Screening</button>
									</li>
									<li class="nav-item flex-fill" role="presentation">
										<button class="nav-link w-100 customInterviewBtnClick" id="profile-tab" data-bs-toggle="tab" style="background: transparent; font-size: 14px;"
											data-bs-target="#bordered-justified-profile" type="button" role="tab" onclick="fetchInitialParentTabSlect('interview')"
											aria-controls="profile" aria-selected="false">Interview</button>
								</ul>
					              	
					            <div class="tab-content pt-3" id="borderedTabJustifiedContent">
						            <div class="tab-pane fade show active" id="bordered-justified-home" role="tabpanel" aria-labelledby="home-tab">
						              	<ul class="nav nav-tabs nav-tabs-bordered d-flex" style="background: #f6f9ff" role="tablist">
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100 active" id="contactCandidateList-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('newCandidateList')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-home"
													type="button" role="tab" aria-controls="home"
													aria-selected="true">Pending</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="contactSelected-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('screening_selected')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button"
													role="tab" aria-controls="home" aria-selected="false">Selected</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="contactRejected-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('screening_rejected')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button"
													role="tab" aria-controls="home" aria-selected="false">Rejected</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="contactOnhold-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('screening_onhold')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button"
													role="tab" aria-controls="home" aria-selected="false">On-hold</button>
											</li>
										</ul>
									</div>
									
									<div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" aria-labelledby="profile-tab">
						              	<ul class="nav nav-tabs nav-tabs-bordered d-flex" style="background: #f6f9ff" role="tablist">
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100 active" id="pending-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('pending')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button" role="tab" aria-controls="profile"
													aria-selected="false">Pending</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="approved-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('approv')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button"
													role="tab" aria-controls="profile" aria-selected="false">Selected</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="rejected-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('reject')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button"
													role="tab" aria-controls="profile" aria-selected="false">Rejected</button>
											</li>
											<li class="nav-item flex-fill" role="presentation">
												<button class="nav-link w-100" id="onhold-tab" style="background: transparent; font-size: 14px;" onclick="fetchOnlineInterviewData('onhold')"
													data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button"
													role="tab" aria-controls="profile" aria-selected="false">On-hold</button>
											</li>
										</ul>
									</div>
								</div>
									
									<div class="student_table_div" id="new_candidate_table_div">
										<table class="table table-hover text-center tableSearch">
											<thead style="background: #f6f9ff;">
												<tr>
													<th>#</th>
													<th>Status</th>
													<th>Mode of Contact (via)</th>
													<th>Contacted Date</th>
													<th>Screening For</th>
													<th>Contacted By</th>
													<th>Candidate Name</th>
													<th>Email</th>
													<th>Contact No</th>
													<th>Highest Qualification</th>
													<th>Candidate Type</th>
													<th>Currently Working</th>
													<th>YOE</th>
													<th>Expected CTC(LPA)</th>
													<th>Current CTC(LPA)</th>
													<th>Notice Period (days)</th>
													<th>Communication Point</th>
													<th>Technical Part</th>
													<th>Technical Languages</th>
												</tr>
											</thead>
											<tbody id="newCandidateTbody">
												
											</tbody>		
										</table>
									</div>
					              	
									<div class="student_table_div" id="student_table_div" style="display: none;">
										<table class="table table-hover text-center tableSearch" id="customTable">
											<thead style="background: #f6f9ff;">
												<tr>
													<!-- <th class="auto_id">Id</th> -->
													<th></th>
													<th>#</th>
													<th class="center_text">Result</th>
													<th>Candidate CTC Status</th>
													<th>Admin Overall Status</th>
													<th>Registered Date</th>
													<th>Candidate Id</th>
													<th>Candidate Name</th>
													<th>Candidate Type</th>
													<th>Expected CTC(LPA)</th>
													<th>Current CTC(LPA)</th>
													<th>Notice Period</th>
													<th>Accepted CTC(LPA)</th>
													<th>Email</th>
													<th>Password</th>
												</tr>
											</thead>
											<tbody id="tbody">
												
											</tbody>		
										</table>
									</div>
							</div>
							
					</div>
				</div>
			</div>
		</section>


	</main><!-- End #main -->

   <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>


<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>


<!-- Script to auto logout the session if user is idle for more than 15 minutes -->
<!-- <script>
        let timeout;

        // Function to reset the timeout
        function resetTimeout() {
            clearTimeout(timeout);
            timeout = setTimeout(logout, 900000); // 15 minutes
        }

        // Function to logout the user
        function logout() {
        	 window.location.href = '/';
        }

        // Attach event listeners for user activity
        document.addEventListener('mousemove', resetTimeout);
        document.addEventListener('keypress', resetTimeout);
        document.addEventListener('click', resetTimeout);
        document.addEventListener('scroll', resetTimeout);

        // Start the initial timeout
        resetTimeout();
</script> -->

<!-- script for spinner -->
<script>
function displayOnLoadingPopup(){
	$('#loadingPopup').show();
	$('#loadingPopupPara').text("Loading, please wait...");
}

function displayAppraisalEmailSendingLoadingPopup(){
	$('#loadingPopup').show();
	$('#loadingPopupPara').text("Please hold on, the appraisal reminder emails are currently being sent...");
}

function hideLoadingPopup(){
	$('#loadingPopup').hide();
}

window.onload = function() {
	hideLoadingPopup();
};

window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const tab = urlParams.get('tab');
   	if (tab === 'interview') {
        document.querySelector('.customInterviewBtnClick')?.click();
    }
};
</script>


 <script>
    
    	function closeAddDropDownDataFormOuterDiv(){
    		fetchAllDropDownDataLists();
    		$('#addDropDownDataFormOuterDiv').hide();
    	}
    	
    	function openAddDropDownDataFormOuterDiv(){
    		$('#selectedDataDropdownValue').val('');
        	$('#dropDownValueData').val('');
    		$('#addDropDownDataFormOuterDiv').show();
    	}
    
    	function submitDropDowndata(){
    		var dropDownStatusNumber = $('#selectedDataDropdownValue').val();
    		var dropDownValue = $('#dropDownValueData').val();
    		
    		if(dropDownStatusNumber === ""){
    			alert("Please Select the Dropdown Box");
    			return;
    		}
    		
    		if(dropDownValue === ""){
    			alert("Please Enter Your Data to Add in Dropdown List");
    			return;
    		}
    		
    		$.ajax({
                url: 'checkDropDownDataExistsInTable', // Endpoint to check if email already exists
                type: 'GET',
                data: { 
                	dropDownStatusNumber: dropDownStatusNumber,
                	dropDownValue: dropDownValue
                	},
                success: function (response) {
                    if (response === true) {
                        alert("Entered data is already present!");
                        return;
                    } else {
                    	$.ajax({
                            type: 'POST',
                            url: 'insertDynamicDropDownDataForMoatContactList',
                            data: {
                                "dropDownStatusNumber": dropDownStatusNumber,
                                "dropDownValue": dropDownValue
                            },
                            success: function (response) {
                                if (response === 'success') {
                                	//$('#selectedDataDropdownValue').val('');
                                	$('#dropDownValueData').val('');
                                }
                            },
                            error: function (xhr, status, error) {
                                console.error('Error inserting record for dropdown data:');
                                console.log('XHR object:', xhr);
                                console.log('Status:', status);
                                console.log('Error:', error);
                            }
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error checking email existence:', error);
                }
            });
    		
    	}
    	
    	function fetchAllDropDownDataLists(){
    			$.ajax({
    	          url: '/fetchAllInsertedDropdownDataForMoatContactList',
    	          type: 'GET',
    	          success: function (response) {
    	        	  //console.log(JSON.stringify(response));
    	        	  updateDataForModeOfContactDropdown(response);
    	        	  updateDataForStatusDropdown(response);
    	        	  updateDataForStatusInTableViewDropDown(response);
    	          },
    	          error: function (xhr, status, error) {
    	              alert('Failed to fetch dropdwon Lists data: ' + error);
    	          }
    	      });
    		}
    	
    	//fetchAllDropDownDataLists();
    	
    	function updateDataForModeOfContactDropdown(datas){
    		let modeOfContactSelect = document.getElementById('mode_of_contact');
    		modeOfContactSelect.innerHTML = '<option value=""></option>';
            datas.forEach(data => {
            	if(data.status_number === "1"){
            		let option = document.createElement('option');
                    option.value = data.data_value;
                    option.text = data.data_value;
                    modeOfContactSelect.add(option);
            	}
            });
    	}
    	
    	function updateDataForStatusDropdown(datas){
    		let statusSelect = document.getElementById('remarks');
    		statusSelect.innerHTML = '<option value=""></option>';
            datas.forEach(data => {
            	if(data.status_number === "2"){
            		let option = document.createElement('option');
                    option.value = data.data_value;
                    option.text = data.data_value;
                    statusSelect.add(option);
            	}
            });
    	}
    	
    	function updateDataForStatusInTableViewDropDown(datas) {
    	    // Select all dropdowns with the class 'statusDropDownInTableView'
    	    let dropdowns = document.querySelectorAll('.statusDropDownInTableView');
    	    
    	    // Iterate over each dropdown
    	    dropdowns.forEach(dropdown => {
    	        // Clear existing options if needed
    	        //dropdown.innerHTML = '<option value=""></option>'; // Uncomment if you want to reset the dropdown

    	        // Add options from the provided data
    	        datas.forEach(data => {
    	            if (data.status_number === "2") {
    	                let option = document.createElement('option');
    	                option.value = data.data_value;
    	                option.text = data.data_value;
    	                dropdown.add(option);
    	            }
    	        });
    	    });
    	}
    	
    	function validateEmailExists(emailId){
    		var email = emailId.trim();
    		
    		$.ajax({
                url: 'checkEmailExistsInTable', // Endpoint to check if email already exists
                type: 'GET',
                data: { email: email },
                success: function (response) {
                    if (response === true) {
                    	$('#errorEmilTextValidate').text('Email already exists!');
                        $('#errorEmilTextValidate').css('font-size', '14px');
                        $('#errorEmilTextValidate').css('color', '#ec7063');
                        $('#moatContactListSubmitBtn').prop('disabled', true);
                        return;
                    } else {
                    	$('#errorEmilTextValidate').text('');
                    	$('#moatContactListSubmitBtn').prop('disabled', false);
                        console.log('Email is valid and does not exist in moat contact list table.');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error checking email existence:', error);
                }
            });
    	}
    </script>


<script>

function fetchInitialParentTabSlect(selectedParentTab) {
    if (selectedParentTab === "screening") {
    	document.getElementById('home-tab').classList.add("active");
    	document.getElementById('contactCandidateList-tab').classList.add("active");
        fetchOnlineInterviewData("newCandidateList");
        //fetchAllDropDownDataLists();
        
        document.getElementById('contactSelected-tab').classList.remove("active");
        document.getElementById('contactRejected-tab').classList.remove("active");
        document.getElementById('contactOnhold-tab').classList.remove("active");
        document.getElementById('pending-tab').classList.remove("active");
        document.getElementById('approved-tab').classList.remove("active");
        document.getElementById('rejected-tab').classList.remove("active");
        document.getElementById('onhold-tab').classList.remove("active");
    } else {
    	document.getElementById('pending-tab').classList.add("active");
        fetchOnlineInterviewData("pending");
        //fetchAllDropDownDataLists();
        
        document.getElementById('contactCandidateList-tab').classList.remove("active");
        document.getElementById('contactSelected-tab').classList.remove("active");
        document.getElementById('contactRejected-tab').classList.remove("active");
        document.getElementById('contactOnhold-tab').classList.remove("active");
        document.getElementById('approved-tab').classList.remove("active");
        document.getElementById('rejected-tab').classList.remove("active");
        document.getElementById('onhold-tab').classList.remove("active");
    }
}

function fetchOnlineInterviewData(selectedTab) {
	
	if(selectedTab === "newCandidateList" || selectedTab === "screening_selected" || selectedTab === "screening_rejected" || selectedTab === "screening_onhold"){
		$('#new_candidate_table_div').show();
		$('#student_table_div').hide();
		fetchAllDropDownDataLists();
		
		var customSelectedTab;
		
		if(selectedTab === "screening_selected"){
			customSelectedTab = "Selected";
		}else if(selectedTab === "screening_rejected"){
			customSelectedTab = "Rejected";
		}else if(selectedTab === "screening_onhold"){
			customSelectedTab = "Onhold";
		}else{
			customSelectedTab = "remaining";
		}
		
		// Fetch new candidate mode of contact data via AJAX
	    displayOnLoadingPopup();
		
	    $.ajax({
	        type: "GET",
	        url: "getAllModeOfContactDetails",
	        data: {
	        	status_value: customSelectedTab
	        },
	        success: function(data) {
	            //console.log(JSON.stringify(data));
	            //Update student data in the table
	            updateNewCandidateModeOfContactData(data);
	            hideLoadingPopup();
	        },
	        error: function(xhr, status, error) {
	            console.error("Error invoking data:", error);
	            hideLoadingPopup();
	        }
	    });
	}else{
		$('#new_candidate_table_div').hide();
		$('#student_table_div').show();
		
		// Set selectedTab to null if it's "pending"
	    if (selectedTab === "pending") {
	        selectedTab = null;
	    }

	    //alert("Actionnnn=== "+ selectedTab);

	    // Fetch student data via AJAX
	    displayOnLoadingPopup();
	    
	    $.ajax({
	        type: "GET",
	        url: "fetchStudentAllDataBasedOnAction",
	        data: { action: selectedTab !== null ? selectedTab : '' }, // Ensure null is handled
	        success: function(data) {
	            // Update student data in the table
	            updateStudentData(data);
	            hideLoadingPopup();
	        },
	        error: function(xhr, status, error) {
	            console.error("Error invoking data:", error);
	            hideLoadingPopup();
	        }
	    });
	}
	
}

fetchInitialParentTabSlect("screening");
//fetchOnlineInterviewData("newCandidateList");


function updateNewCandidateModeOfContactData(data){
	var tbody = $('#newCandidateTbody');
	tbody.empty();
	

	if (data && data.length > 0) {
	    for (var i = 0; i < data.length; i++) {
	        var row = "<tr class='moatTd'>" +
	            "<td>" + (i+1) + "</td>" +
	            "<td style='min-width: 200px;'>" + "<select style='font-size: 14px;' class='form-select custom-select browser-default custom_selectfield statusDropDownInTableView' onchange='updateNewCandidateRemarks(this.value, "+data[i].id+")'>" +
								            			"<option>"+ (data[i].remarks || "-") +"</option>" +
														/* "<option value='Received on First Call'>Received on First Call</option>" +
														"<option value='Recall Again'>Recall Again</option>" +
														"<option value='Send Mail'>Send Mail</option>" + */
													  "</select>" + 
				"</td>" +
	            "<td style='min-width: 160px;'>" + (data[i].mode_of_contact || "-") + "</td>" +
	            "<td class='dateFormatter' style='min-width: 100px;'>" + data[i].contacted_date + "</td>" +
	            "<td style='min-width: 120px;'>" + (data[i].dept || "-") + "</td>" +
	            "<td style='min-width: 120px;'>" + (data[i].contact_by || "-") + "</td>" +
	            "<td style='min-width: 150px;'>" + (data[i].candidate_name || "-") + "</td>" +
	            "<td style='min-width: 100px;'>" + (data[i].candidate_email || "-") + "</td>" +
	            "<td style='min-width: 100px;'>" + (data[i].candidate_contact_no || "-") + "</td>" +
	            "<td style='min-width: 140px;'>" + (data[i].qualification || "-") + "</td>" +
	            "<td>" + (data[i].candidate_type || "-") + "</td>" +
	            "<td>" + (data[i].currently_working || "-") + "</td>" +
	            "<td>" + (data[i].yoe || "-") + "</td>" +
	            "<td>" + (data[i].expected_ctc || "-") + "</td>" +
	            "<td>" + (data[i].current_ctc || "-") + "</td>" +
	            "<td style='min-width: 120px;'>" + (data[i].notice_period || "-") + "</td>" +
	            "<td style='min-width: 160px;'>" + (data[i].communication_point || "-") + "</td>" +
	            "<td style='min-width: 140px;'>" + (data[i].technical_part || "-") + "</td>" +
	            "<td style='min-width: 160px;'>" + (data[i].technical_lang || "-") + "</td>" +
	            "</tr>";

	        tbody.append(row);
	    }
	    formatDates22();
	} else {
	    console.log("No data available");
	    var noDataRow = "<tr class='td_tr'><td class='error_msg' colspan='25'>No data available</td></tr>";
	    tbody.append(noDataRow);
		}
}


function formatDates22() {
    var dateElements = document.querySelectorAll('.dateFormatter');
    dateElements.forEach(function(dateElement) {
        var dateStr = dateElement.innerText; // Get the date string in yyyy-mm-dd format
        var dateParts = dateStr.split('-'); // Split the date string into parts
        
        // Format the date as dd-mm-yyyy
        if(dateParts.length === 3) {
            var formattedDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
            // Update the text of the date element
            dateElement.innerText = formattedDate;
        }
    });
}


//Function to update student data in the table
function updateStudentData(data) {
var tbody = $('#tbody');
tbody.empty();

if (data && data.length > 0) {
    for (var i = 0; i < data.length; i++) {
        var candidateName = (data[i].first_name + " " + data[i].last_name).toUpperCase();
        var status = data[i].action;
        var offeredCtc, statusByCandidate;
        var statusColor, borderStyle, statusColor2;
        var testStatusIcon;

        // Mapping status to corresponding values
        switch (status) {
            case 'approv':
                status = 'Selected';
                statusColor = '#229954';
                borderStyle = 'background-color: #dff2e7';
                break;
            case 'reject':
                status = 'Rejected';
                statusColor = '#EC7063';
                borderStyle = 'background-color: #f5e3e1';
                break;
            case 'onhold':
                status = 'On-Hold';
                statusColor = '#d68910';
                borderStyle = 'background-color: #f5e3e1';
                break;
            default:
                status = 'Pending';
                statusColor = '#4154f1';
                borderStyle = 'background-color: #fff';
        }
        
     // Determine offered CTC
        if (data[i].candidate_response_for_first_ctc_offer === "Accepted" && data[i].first_ctc_offer) {
            offeredCtc = data[i].first_ctc_offer;
        } else if (data[i].candidate_response_for_second_ctc_offer === "Accepted" && data[i].second_ctc_offer) {
            offeredCtc = data[i].second_ctc_offer;
        } else if (data[i].candidate_response_for_third_ctc_offer === "Accepted" && data[i].third_ctc_offer) {
            offeredCtc = data[i].third_ctc_offer;
        } else {
            offeredCtc = "-";
        }
     
     // Determine offered CTC
        if (data[i].candidate_response_for_first_ctc_offer === "Accepted" || data[i].candidate_response_for_second_ctc_offer === "Accepted" || data[i].candidate_response_for_third_ctc_offer === "Accepted") {
        	statusByCandidate = "Accepted";
        	statusColor2 = '#229954';
        } else if (data[i].candidate_response_for_first_ctc_offer === "Rejected" || data[i].candidate_response_for_second_ctc_offer === "Rejected" || data[i].candidate_response_for_third_ctc_offer === "Rejected") {
        	statusByCandidate = "Rejected";
        	statusColor2 = '#EC7063';
        } else {
        	statusByCandidate = "Pending";
        	statusColor2 = '#4154f1';
        }
     
     	if(data[i].test_status_flagg === '1'){
     		testStatusIcon = "<i style='font-size: 19px; color: #D4A017;' class='ri ri-speed-fill' title='Ongoing Test'></i>";
     	}else if(data[i].test_status_flagg === '2'){
     		testStatusIcon = "<i style='font-size: 19px; color: green;' class='ri ri-check-double-line' title='Test Completed'></i>";
     	}else{
     		testStatusIcon = "";
     	}

        var row = "<tr class='moatTd'>" +
            "<td><p>" + testStatusIcon + "</p></td>" +
            "<td>" + (i + 1) + "</td>" +
            "<td><div style='color: #4154f1;' class='view_icon_div' onclick='openStudentResultSheetPage(" + data[i].id + ", " + data[i].test_status_flagg + ");'><i class='bi bi-eye-fill moatResultView_icon'></i></div></td>" +
            "<td style='color: " + statusColor2 + "; font-weight: bold; min-width: 100px;'>" + statusByCandidate + "</td>" +
            "<td style='color: " + statusColor + "; font-weight: bold; min-width: 120px;'>" + status + "</td>" +
            "<td class='dateFormatter' style='min-width: 100px;'>" + data[i].inserted_at + "</td>" +
            "<td>" + data[i].id + "</td>" +
            "<td>" + candidateName + "</td>" +
            "<td>" + data[i].experience + "</td>" +
            "<td>" + data[i].candidate_expected_salary_in_lpa + "</td>" +
            "<td>" + (data[i].exp_current_salary_in_lpa ? data[i].exp_current_salary_in_lpa : "-") + "</td>" +
            "<td>" + (data[i].exp_notice_period_type1 ? data[i].exp_notice_period_type1 : "-") + "</td>" +
            "<td>" + offeredCtc + "</td>" +
            "<td>" + data[i].email + "</td>" +
            "<td>" + data[i].password + "</td>" +
           	/* "<td><div class='delete_icon_div' onclick='deleteById(" + data[i].id + ")'><img alt='delete_icon' src='/images/moat_delete_icon1.png' class='delete_icon'></div></td>" + */            "</tr>";

        tbody.append(row);
    }
    formatDates();
} else {
    console.log("No data available");
    var noDataRow = "<tr class='td_tr'><td class='error_msg' colspan='20'>No data available</td></tr>";
    tbody.append(noDataRow);
	}
}

function formatDates() {
    var dateElements = document.querySelectorAll('.dateFormatter');
    dateElements.forEach(function(dateElement) {
        var dateTimeStr = dateElement.innerText; // Get the date and time string
        var dateTimeParts = dateTimeStr.split(' '); // Split the string into date and time parts
        
        if (dateTimeParts.length === 2) {
            var dateStr = dateTimeParts[0]; // Extract the date part (yyyy-mm-dd)
            var timeStr = dateTimeParts[1]; // Extract the time part (hh:mm:ss)
            var dateParts = dateStr.split('-'); // Split the date string into yyyy, mm, dd
            
            // Format the date as dd-mm-yyyy
            if (dateParts.length === 3) {
                var formattedDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
                // Update the text of the date element, keeping the time part
                dateElement.innerText = formattedDate + ' ' + timeStr;
            }
        }
    });
}
</script>


<script>
	function openStudentResultSheetPage(student_id, testStatusFlag){
		//alert(student_id+" "+testStatusFlag);
        window.location.href='/moatResultSheet?student_id=' + student_id+"&testStatusFlag="+testStatusFlag;
  }
</script>

<script>
    $.ajax({
        url: '/fetchCard1Count',
        type: 'GET',
        success: function(data) {
			//alert(JSON.stringify(data));
            // Update the HTML content with the received count
            $('#student_count_today').text(data[0].student_count);
            
            $({ count: 0 }).animate({ count: data[0].student_count }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#student_count_today').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#student_count_today').text(data[0].student_count);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching student_count:', error);
        }
    });
    
	$.ajax({
        url: '/fetchCard2Count',
        type: 'GET',
        success: function(data) {
			//alert(JSON.stringify(data));
            // Update the HTML content with the received count
            $('#student_approveCount').text(data[0].approve_count);
            
            $({ count: 0 }).animate({ count: data[0].approve_count }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#student_approveCount').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#student_approveCount').text(data[0].approve_count);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching student_approveCount:', error);
        }
    });
    
    
    $.ajax({
        url: '/fetchCard3Count',
        type: 'GET',
        success: function(data) {
			//alert(JSON.stringify(data));
            // Update the HTML content with the received count
            $('#student_rejectCount').text(data[0].reject_count);
            
            $({ count: 0 }).animate({ count: data[0].reject_count }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#student_rejectCount').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#student_rejectCount').text(data[0].reject_count);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching student_rejectCount:', error);
        }
    });
    
    $.ajax({
        url: '/fetchCard4Count',
        type: 'GET',
        success: function(data) {
			//alert(JSON.stringify(data));
            // Update the HTML content with the received count
            $('#student_pendingCount').text(data[0].pending_count);
            
            $({ count: 0 }).animate({ count: data[0].pending_count }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#student_pendingCount').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#student_pendingCount').text(data[0].pending_count);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching student_pendingCount:', error);
        }
    });
    
    $.ajax({
        url: '/fetchCard5Count',
        type: 'GET',
        success: function(data) {
			//alert(JSON.stringify(data));
            // Update the HTML content with the received count
            $('#student_onHoldCount').text(data[0].onhold_count);
            
            $({ count: 0 }).animate({ count: data[0].onhold_count }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#student_onHoldCount').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#student_onHoldCount').text(data[0].onhold_count);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching student_onHoldCount:', error);
        }
    });
    
    
    $.ajax({
        url: '/fetchIndividualStatusCountsForInterview',
        type: 'GET',
        success: function(data) {
            $('#interviewCount2').text(data.interview_select);
            
            $({ count: 0 }).animate({ count: data.interview_select }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#interviewCount2').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#interviewCount2').text(data.interview_select);
		        }
		    });
            
			$('#interviewCount3').text(data.interview_reject);
            
            $({ count: 0 }).animate({ count: data.interview_reject }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#interviewCount3').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#interviewCount3').text(data.interview_reject);
		        }
		    });
            
            
			$('#interviewCount4').text(data.interview_onhold);
            
            $({ count: 0 }).animate({ count: data.interview_onhold }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#interviewCount4').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#interviewCount4').text(data.interview_onhold);
		        }
		    });
            
            
			$('#interviewCount5').text(data.interview_pending);
            
            $({ count: 0 }).animate({ count: data.interview_pending }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#interviewCount5').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#interviewCount5').text(data.interview_pending);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching individual interview counts:', error);
        }
    });
    
    
    $.ajax({
        url: '/fetchIndividualStatusCountsForModeOfContact',
        type: 'GET',
        success: function(data) {
            $('#screeningCount2').text(data.mode_of_contact_select);
            
            $({ count: 0 }).animate({ count: data.mode_of_contact_select }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#screeningCount2').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#screeningCount2').text(data.mode_of_contact_select);
		        }
		    });
            
			$('#screeningCount3').text(data.mode_of_contact_reject);
            
            $({ count: 0 }).animate({ count: data.mode_of_contact_reject }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#screeningCount3').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#screeningCount3').text(data.mode_of_contact_reject);
		        }
		    });
            
            
			$('#screeningCount4').text(data.mode_of_contact_onhold);
            
            $({ count: 0 }).animate({ count: data.mode_of_contact_onhold }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#screeningCount4').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#screeningCount4').text(data.mode_of_contact_onhold);
		        }
		    });
            
            
			$('#screeningCount5').text(data.mode_of_contact_pending);
            
            $({ count: 0 }).animate({ count: data.mode_of_contact_pending }, {
		        duration: 1000,
		        easing: 'linear',
		        step: function () {
		            $('#screeningCount5').text(Math.floor(this.count));
		        },
		        complete: function () {
		            $('#screeningCount5').text(data.mode_of_contact_pending);
		        }
		    });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching individual mode of contact counts:', error);
        }
    });
    
</script>

<!-- Script to search table -->
<script>
document.querySelector('.btn-search').addEventListener('click', function () {
    document.querySelector('.input-search').focus();
});

function searchTable() {
    const input = document.querySelector(".input-search");
    const filter = input.value.toUpperCase();

    // Get all visible tables with the class `tableSearch`
    const visibleTables = Array.from(document.querySelectorAll(".tableSearch")).filter(table => {
        return table.closest('.student_table_div').style.display !== 'none';
    });

    visibleTables.forEach(table => {
        const rows = table.getElementsByTagName("tr");
        for (let i = 1; i < rows.length; i++) { // Start from 1 to skip the header row
            rows[i].style.display = "none"; // Hide all rows initially
            const cells = rows[i].getElementsByTagName("td");
            for (let j = 0; j < cells.length; j++) {
                if (cells[j]) {
                    const textValue = cells[j].textContent || cells[j].innerText;
                    if (textValue.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = ""; // Show the row if it matches
                        break; // Stop checking other cells in the row
                    }
                }
            }
        }
    });
}
</script>
    
    <script>
    	function filterDataBasedOnCandidateType(candidateTye){
    		if(candidateTye === "Fresher"){
    			$('#notice_period').hide();
    			$('#currently_working').hide();
    			$('#yoe').hide();
    			$('#current_ctc').hide();
    			
    			$('#notice_period input').prop("required", false);
    			$('#currently_working select').prop("required", false);
    			$('#yoe input').prop("required", false);
    			$('#current_ctc input').prop("required", false);
    		}else{
    			$('#notice_period').show();
    			$('#currently_working').show();
    			$('#yoe').show();
    			$('#current_ctc').show();
    			
    			$('#notice_period input').prop("required", true);
    			$('#currently_working select').prop("required", true);
    			$('#yoe input').prop("required", true);
    			$('#current_ctc input').prop("required", true);
    		}
    	}
    	
    	function closeNewCandidateModeOfContactFormOuterDiv(){
    		document.body.style.overflow = 'auto';
    		$('#newCandidateModeOfContactFormOuterDiv').hide();
    		//fetchOnlineInterviewData("newCandidateList");
    		location.reload();
    	}
    	
    	function openNewCandidateModeOfContactFormOuterDiv(){
    		document.body.style.overflow = 'hidden';
    		$('#newCandidateModeOfContactFormOuterDiv').show();
    	}
    	
    	// Get today's date in YYYY-MM-DD format
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];

        // Set the value of the date input field
        document.getElementById('contacted_date').value = formattedDate;
        
        
        function updateNewCandidateRemarks(remarksValue, id){
        	//var changesMadeByName = $('#contact_by_name').val();
        	//alert(remarksValue+" "+id)
        	Swal.fire({
	        title: 'Are you sure?',
	        text: "You want to update remarks as '"+remarksValue+"' format?",
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#3085d6',
	        cancelButtonColor: '#d33',
	        confirmButtonText: 'Yes, submit it!',
	        customClass: {
                popup: 'custom-swal-font'
            },
	    }).then((result) => {
	        if (result.isConfirmed) {
	        	$.ajax({
	                type: 'POST',
	                url: 'updateModeOfContactRemarksValue',
	                data: {
	                    "remarksValue": remarksValue,
	                    "id": id
	                },
	                success: function (response) {
	                    if (response === 'success') {
	                        
	                        Swal.fire({
	                            title: 'Changes Updated Successfully',
	                            icon: 'success',
	                            confirmButtonColor: '#007bff',
	                            confirmButtonText: 'OK',
	                            allowOutsideClick: false, // Prevent closing when clicking outside
	                			allowEscapeKey: false, // Prevent closing when pressing escape key
	                			customClass: {
	                                popup: 'custom-swal-font'
	                            },
	                        });
	                    }
	                },
	                error: function (xhr, status, error) {
	                    console.error('Error updating record:');
	                    console.log('XHR object:', xhr);
	                    console.log('Status:', status);
	                    console.log('Error:', error);
	                }
	            });
	        	
	        }
	    });
     }
    </script>
<!-- script to notification on bottom of the page-->
<!--CHAT BOOT-->

<!-- Include SockJS and Stomp.js libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- script to notification on bottom of the page-->
<script>
		//CODE FOR CHATBOOT NOTIFICATION 
		var stompClient = null;
		var employeeMap = {}; // To store the mapping of employee names to emails
		let employeePhotoMap = {};
		let emailToNameMap = {}; // New map for email -> name lookup
		var email = null;
		var visibilityState = document.visibilityState; // Track tab visibility
		var heartbeatInterval = null; // Track heartbeat interval

		function connectWebSocket() {
			var socket = new SockJS('/chat-websocket');
			  stompClient = Stomp.over(socket);

			  var email = document.getElementById('loggedInMail').value;
			  console.log(`Connecting WebSocket as: ${email}`);

			  stompClient.connect({ 'email': email }, function (frame) {
			      console.log('Connected to WebSocket:', frame);

			      // Mark user as active
			      stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));

			      // Subscribe to active users list
			      stompClient.subscribe('/topic/activeUsers', function (message) {
			          var activeUsers = JSON.parse(message.body);
			          updateActiveUserUI(activeUsers);
			      });

			      // Start heartbeat initially
			      heartbeatInterval = setInterval(() => {
			          if (stompClient && stompClient.connected) {
			              stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
			              console.log("Heartbeat sent for user: " + email);
			          }
			      }, 20000); // 30 seconds

			      // Detect tab visibility change
			      document.addEventListener("visibilitychange", function () {
			          if (document.hidden) {
			              console.log("User switched to another tab. Marking as inactive.");
			              stompClient.send("/app/userInactive", {}, JSON.stringify({ email }));
			              clearInterval(heartbeatInterval); // Stop heartbeat
			              heartbeatInterval = null;
			          } else {
			              console.log("User returned to the application tab. Marking as active.");
			              stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));
			              if (!heartbeatInterval) {
			                  heartbeatInterval = setInterval(() => {
			                      if (stompClient && stompClient.connected) {
			                          stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
			                          console.log("Heartbeat sent for user: " + email);
			                      }
			                  }, 30000);
			              }
			          }
			      });

			      // Detect tab close or WebSocket disconnect
			      socket.onclose = function () {
			          console.log("WebSocket disconnected. Updating user status.");
			          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
			      };

			      window.addEventListener('beforeunload', function () {
			          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
			      });

			  });
		}

		function updateActiveUserUI(activeUsers) {
		//	alert("1");
		    const employeeItems = document.getElementById('employeeNames').getElementsByTagName('li');

		    Array.from(employeeItems).forEach(item => {
		        const employeeName = item.querySelector('span').textContent;
		        const email = employeeMap[employeeName]; 
		        const statusIndicator = item.querySelector('.status-indicator'); // Get the status dot

		        if (activeUsers.includes(email)) {
		            item.classList.add('active-user');
		            statusIndicator.style.backgroundColor = '#66cc66'; // Green for active users
		        } else {
		            item.classList.remove('active-user');
		            statusIndicator.style.backgroundColor = '#ff6666'; // Red for inactive users
		        }

		        // If this employee is currently selected, update chat header status
				if (selectedEmployee === email) {
				           const chatStatusIndicator = document.getElementById('chatStatusIndicator');
				           if (activeUsers.includes(email)) {
				               chatStatusIndicator.style.backgroundColor = '#66cc66'; // Green (Online)
				           } else {
				               chatStatusIndicator.style.backgroundColor = '#ff6666'; // Red (Offline)
				           }
				       }
		    });
		}


		// Select an employee to chat with
		function selectEmployee(employeeName) {
			selectedEmployee = employeeMap[employeeName]; // Get the email from the map
			console.log(`Employee selected: ${selectedEmployee}`);

			// Highlight the selected employee
			var employeeItems = document.querySelectorAll('#employeeNames li');
			employeeItems.forEach(function (item) {
				item.classList.remove('active');
			});
			var selectedItem = Array.from(employeeItems).find(item => item.innerHTML === employeeName);
			if (selectedItem) {
				selectedItem.classList.add('active');
			}

			// Update chat header with employee name and photo
			document.querySelector('.chat-about h6').innerText = employeeName;
			document.querySelector('#employeePhoto').src = employeePhotoMap[selectedEmployee] || 'default-profile.jpg';

			// Hide the message icon and dots when an employee is selected
			document.getElementById('message-icon-container').style.display = 'none';
			// Hide the paragraph when an employee is selected
			document.getElementById('logo-text').style.display = 'none';

			// Load messages for the selected employee
			loadMessages();
		}

		function loadEmployees() {
			console.log("Loading employee names...");

			// Fetch employee names from the endpoint
			fetch('/employees/names')
				.then(response => {
					console.log("Response received:", response);
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(data => {
					console.log("Employee data fetched:", data); // Log the raw data

					const employeeList = document.getElementById('employeeNames');
					if (!employeeList) {
						console.error("Element with ID 'employeeNames' not found.");
						return;
					}

					employeeList.innerHTML = ''; // Clear the list before adding new items

					// Iterate through employee data
					data.forEach(employee => {
						console.log("Processing employee:", employee);

						// Create a list item for each employee
						const li = document.createElement('li');
						li.classList.add('d-flex', 'align-items-center', 'employee-item');

						// Handle missing or empty profile photo paths
						const profilePic = employeePhotoMap[employee.email] || '/static/default-profile.jpg';
						console.log(`Profile picture for ${employee.name}: ${profilePic}`);

						li.innerHTML = `
			                    <img src="${profilePic}" 
			                         alt="Employee Photo" 
			                         class="employee-photo mr-2" />
			                    <span>${employee.name}</span>
			                `;

						// Map employee name to email
						employeeMap[employee.name] = employee.email;
						console.log("Mapped employee:", employee.name, "->", employee.email);
						// Add new reverse mapping (email -> name)
						emailToNameMap[employee.email] = employee.name;
						// Add click event to list item
						li.onclick = () => {
							console.log(`Selected employee: ${employee.name}`);
							selectEmployee(employee.name);
						};

						// Append the list item to the employee list
						employeeList.appendChild(li);

					});

					console.log("Employee names loaded successfully. Employee map:", employeeMap);
					// Call the unread messages function after loading employee data
					fetchUnreadMessages();

					// Set interval to check for new messages every 10 seconds
						setInterval(fetchUnreadMessages, 10000);
				})
				.catch(error => {
					console.error("Error loading employees:", error);
				});
		}


		function loadMessages() {
			// alert("Loading messages...");
			// Get the logged-in user's email and selected employee's email
			var loggedInEmail = document.getElementById('loggedInMail').value;
			var selectedEmployeeEmail = selectedEmployee; // Email is already stored in selectedEmployee

			console.log(`Loading messages between: ${loggedInEmail} and ${selectedEmployeeEmail}`);

			fetch(`/messages?loggedInEmail=${encodeURIComponent(loggedInEmail)}&selectedEmployeeEmail=${encodeURIComponent(selectedEmployeeEmail)}`)
				.then(response => response.json())
				.then(data => {
					console.log("Chat messages loaded:", data);
					// Clear the chat window before displaying messages
					var chatWindow = document.getElementById('chat-window').querySelector('ul');
					chatWindow.innerHTML = '';

					// Display messages
					data.forEach(function (msg) {
						// showMessage(msg.senderEmail, msg.content, msg.recipientEmail, loggedInEmail);
						showMessage(msg.id, msg.senderEmail, msg.content, msg.recipientEmail, msg.timestamp, loggedInEmail);
					});
				})
				.catch(error => console.error("Error loading chat messages:", error));
		}
		let activeDeleteDropdown = null;
		function showMessage(id, senderEmail, message, recipientEmail, timestamp, loggedInEmail) {
			console.log("Message ID:", id);
			console.log(`LoggedInEmailrrr: ${loggedInEmail}, SenderEmail: ${senderEmail}`);

			const isSender = senderEmail === loggedInEmail;
			const senderName = isSender ? "Me" : Object.keys(employeeMap).find(name => employeeMap[name] === senderEmail) || senderEmail;
			const senderPhoto = employeePhotoMap[senderEmail] || 'default-avatar.png';
			const formattedTime = new Date(timestamp).toLocaleString(); // Format timestamp

			console.log(`Message ID: ${id}, Time: ${formattedTime}, From: ${senderEmail}, To: ${recipientEmail}, Content: "${message}"`);

			var chatWindow = document.getElementById('chat-window').querySelector('ul');
			var li = document.createElement('li');
			li.className = isSender ? 'clearfix right' : 'clearfix left';

			li.innerHTML = `
					    <div class="message-container" data-message-id="${id}" onclick="toggleDeleteOption(this)">
					        <img class="sender-photo" src="${senderPhoto}" alt="Sender Photo" />
					        <div class="message ${isSender ? 'my-message' : 'other-message'}">
					            <strong>${senderName}:</strong> ${message}
					        </div>
					    </div>
					    <div class="timestamp" style="text-align: ${isSender ? 'right' : 'left'};">
					        ${formattedTime}
					    </div>
					    ${isSender ? `
					        <div class="message-action-dropdown" >
					            <a class="dropdown-item" href="#" onclick="deleteMessage(this, ${id})">Delete Message</a>
					        </div>
					    ` : ''}`;

			chatWindow.appendChild(li);
			chatWindow.scrollTop = chatWindow.scrollHeight;
		}
		
		/*function fetchUnreadMessages() {
			console.log("Fetching unread messages...");
			var loggedInEmail = document.getElementById('loggedInMail').value;

			fetch(`/unread?email=${loggedInEmail}`)
				.then(response => response.json())
				.then(messages => {
					messages.forEach(message => {
						let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;

						// Show notification with sender's email as a parameter
						showToastNotification(`New message from ${senderName}: ${message.content}`, message.senderEmail);
					});
				})
				.catch(error => console.error("Error fetching unread messages:", error));
		}*/

		let displayedMessageIds = new Set(); // Track displayed messages
		let closedMessageIds = new Set(); // Track closed messages

		function fetchUnreadMessages() {
		    console.log("Fetching unread messages...");
		    var loggedInEmail = document.getElementById('loggedInMail').value;

		    fetch(`/unread?email=${loggedInEmail}`)
		        .then(response => response.json())
		        .then(messages => {
		            messages.forEach(message => {
		                console.log("Processing message ID:", message.id); // Print message ID to console
		                
		                // Ignore messages that were previously closed
		                if (!displayedMessageIds.has(message.id) && !closedMessageIds.has(message.id)) {
		                	
							//alert(1);
		                    let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;
		                    showToastNotification(`New message from ${senderName}: ${message.content}`, message.id, message.senderEmail);
		                    displayedMessageIds.add(message.id); // Mark message as displayed
		                }
						//alert(2);
		            });
		        })
		        .catch(error => console.error("Error fetching unread messages:", error));
		}
		// Global flag to track if the user manually dismissed notifications
		
		/*function showToastNotification(message, senderEmail) {
			
			var toastContainer = document.createElement('div');
			toastContainer.className = 'toast-notification';

			// Add message and close button
			toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close"></span>`;

			document.body.appendChild(toastContainer);

			// Animate in
			setTimeout(() => {
				toastContainer.classList.add('show');
			}, 100);

			// Auto-hide after 8 seconds
			let autoHideTimeout = setTimeout(() => closeToast(toastContainer), 10000);

			// Prevent opening chat when clicking the close button
			toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
				event.stopPropagation(); // Prevent click from bubbling to toastContainer
				clearTimeout(autoHideTimeout);
				
				closeToast(toastContainer);
			});

			// Open chat when clicking on the notification
			toastContainer.addEventListener('click', () => {
				openChatWithSender(senderEmail);
				closeToast(toastContainer); // Remove notification when chat opens
			});
		}*/
		function showToastNotification(message, messageId, senderEmail) {
			//alert(1);
		    var toastContainer = document.createElement('div');
		    toastContainer.className = 'toast-notification';
		    toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close"></span>`;

		    document.body.appendChild(toastContainer);

		    // Animate in
		    setTimeout(() => {
		        toastContainer.classList.add('show');
		    }, 100);

		    // Auto-hide after 8 seconds
		    let autoHideTimeout = setTimeout(() => closeToast(toastContainer, messageId), 8000);

		    // Prevent opening chat when clicking the close button
		    toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
		        event.stopPropagation(); // Prevent click from bubbling to toastContainer
		        clearTimeout(autoHideTimeout);
		        closedMessageIds.add(messageId); // Mark as closed so it won't be shown again
		        closeToast(toastContainer, messageId);
		    });

		    // Open chat when clicking on the notification
		    toastContainer.addEventListener('click', () => {
		        openChatWithSender(senderEmail);
		        closeToast(toastContainer, messageId); // Remove notification when chat opens
		    });
		}

		// Function to handle toast closing
		/*function closeToast(toast) {
			toast.classList.remove('show');
			setTimeout(() => toast.remove(), 300); // Faster fade-out
		}*/
		// Function to handle toast closing and mark as dismissed
		// Function to handle toast closing
		function closeToast(toast, messageId) {
		    toast.classList.remove('show');
		    setTimeout(() => toast.remove(), 300); // Faster fade-out
		}
		/*	function openChatWithSender(senderEmail) {
				console.log("Opening chat with:", senderEmail);
			    
				// Construct the URL for the UserFavorite page with the senderEmail as a query parameter
				const url = `/my-favorites?email=${encodeURIComponent(senderEmail)}`;
			    
				// Redirect to the UserFavorite page
				window.location.href = url;
			}*/

		function openChatWithSender(senderEmail) {
			console.log("Opening chat with:", senderEmail);

			// Store sender email in sessionStorage
			sessionStorage.setItem("chatSenderEmail", senderEmail);

			// Redirect to the UserFavorite page
			window.location.href = `/my-favorites`;
		}

		// Connect to the WebSocket server and load employees when the page is loaded
		document.addEventListener('DOMContentLoaded', function () {
			//fetchUnreadMessages();
			loadEmployees();
			connectWebSocket();
		});

	</script>
    
</body>

</html>