<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Leaves</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
<!--   <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon"> -->
  
    <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <!--   <link href="https://fonts.gstatic.com" rel="preconnect">
   <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  -->
  <link rel="stylesheet" href="/assets/font/fonts.css">
  
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <!--  <script src="https://code.highcharts.com/highcharts.js"></script> -->
  <script src="assets/js/highcharts.js"></script>
    
    <!--   <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
    <script src="assets/js/jquery-3.6.4.min.js"></script>
    
   <!--   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
   <script src="assets/js/sweetalert2@11.js"></script>
   <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
   <link rel="stylesheet" href="/assets/css/all.min.css"> 

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="/assets/js/jquery.dataTables.min.js"></script>
  
  <!-- DataTables JS -->
  <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
  <script src="assets/js/jquery-3.6.4.min.js"></script> 
  
  <!-- <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script> -->
  <script src="/assets/js/jquery.dataTables.min.js"></script>

  <!-- <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.3.3/css/fixedHeader.dataTables.min.css"> -->
<!--   <script src="https://cdn.datatables.net/fixedheader/3.3.3/js/dataTables.fixedHeader.min.js"></script> -->

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  
  <style>
  
	   .main{
	    	font-size: 14px;
	   }  
 	   .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
		.half-detail-row td {
		    border-top: none;
		    border-bottom: 1px solid #dee2e6;
		}
		.duration-cell {
		    cursor: pointer;
		    text-decoration: none;
		}
        .info-card {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #attendence-chart{
            width: 100%;
            height: 190px; /* Adjust the height as needed */
        }
		/* Ensure version number appears on a new line */
								.release-note-text {
								  display: flex;
								  flex-direction: column; /* Stacks elements vertically */
								  font-size: 1rem;
								}

								/* Optional: Adjust the version number styling */
								.version-number {
								  font-size: 0.9rem;
								  font-weight: bold;
								  color: #555;
								}
								
        /* Example CSS to style disabled items */
		.activity-item .disabled {
		    pointer-events: none; /* Disable interactions */
		    opacity: 0.5; /* Make the item appear grayed out */
		}
	    #pagination button {
		    border-radius: 5px;
		}
		#pagination button:hover {
		    background-color: #0056b3;
		    color: #fff;
		}
		.holidayTable th, .holidayTable td {
		   white-space: nowrap; /* Prevent text from wrapping to the next line */
		   text-align: center; /* Optional: Align text to the left for better readability */
		   padding: 8px 5px; /* Add padding for better spacing */
		 }
		 
		 	/* Fullscreen overlay with dim background */
		#loadingPopup {
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background: rgba(0, 0, 0, 0.5); /* Dim background */
		    display: flex;
		    flex-direction: column;
		    justify-content: center;
		    align-items: center;
		    z-index: 9999;
		    font-family: Arial, sans-serif;
		    color: white; /* Text color for better contrast */
		}
		.small-hint {
		    cursor: pointer;
		    color: #0d6efd;
		}
		.small-hint:hover {
		    text-decoration: underline;
		}

		/* Spinner animation */
		.spinner {
		    width: 50px;
		    height: 50px;
		    border: 6px solid rgba(255, 255, 255, 0.3); /* Semi-transparent border */
		    border-top-color: white; /* Bright top border */
		    border-radius: 50%;
		    animation: spin 1s linear infinite;
		}
		
		/* Loading text */
		#loadingPopup p {
		    margin-top: 20px;
		    font-size: 18px;
		    font-weight: bold;
		    color: white;
		}
		.highlight {
	    background-color: yellow;
	    font-weight: bold;
	    color: black;
	}
</style>
</head>

<body>
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId > 0}">

		   <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/userDashboard}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				  <!--   <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
			</div>	
   <!-- Include the header fragment -->
   <div th:replace="fragments/header :: header"></div>

  </header><!-- End Header -->
  
   <!-- =======Super Admin Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId == 0}">

    <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/navbar}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				   <!--  <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
	</div><!-- End Logo -->

    <div th:replace="fragments/superAdminHeader :: header"></div>

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  
<aside id="sidebar" class="sidebar">
<input type="hidden" id="employee-id" th:value="${empDetailsByEmpId.deptId}">
<input type="hidden" id="employeeId1" name="empId" th:value="${empDetailsByEmpId.empid}" />
<input type="hidden" id="loggedEmpEmail" th:value="${empDetailsByEmpId.email}">

    <ul class="sidebar-nav" id="sidebar-nav">
		 
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/userDashboard}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link " th:href="@{/navbar}">
		        <i class="bi bi-grid"></i>
		        <span>Dashboard</span>
		    </a>
	    </li>
	    <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>
		
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>  
		<li class="nav-item" th:if="${session.permissions.dispatch && empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/dispatchIframe}">
                <i class="bi bi-truck"></i>
                <span>Dispatched Details</span>
            </a>
        </li>
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminProfile(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-person"></i>
                 <span>My Profile</span>
            </a>
        </li>  
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a> 
        </li>      
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-telephone"></i>
                <span>Communications</span>
            </a>
        </li>
       <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link " th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
        </li> -->
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/adminHoliday}">
                <i class="bi bi-calendar4-week"></i>
                <span>Holiday List</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>	
		        <span>Employee</span>
		    </a>
	   </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link active" th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-card-text"></i>
                <span>Team Leaves</span>
            </a>
        </li>
       <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/events}">
                <i class="bi bi-megaphone"></i>
                <span>Announcement</span>
            </a>
        </li>                
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/ongoingProject}">
                <i class="bi bi-card-heading"></i>
                <span>Projects</span>
            </a>
        </li>  
		 
         <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminPayslip(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-file-text"></i>
                <span>Payslip</span>
            </a>
        </li>  -->    
         <!-- Loop through the permissions map -->
       <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.apprisalAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" id="apprisalLink" th:href="@{/apprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Appraisal</span>
		    </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" id="apprisalLink" th:href="@{/employeeApprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Employee Appraisal</span>
		    </a>
		</li>
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
				<li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(V.0.1.2)</span>
					        </span>
					    </a>
		</li>
        
	    <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a>
       </li> -->
       <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/adminHoliday}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Holiday List</span>
		    </a>
	 </li>	
	 
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/addInterComm}">
                <i class="bi bi-telephone"></i>
                <span>Communication</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-envelope-open"></i>
                <span>Group Mail Id</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/hikeRatingForm}">
			<i class="bi bi-arrow-up-circle"></i><span>Appraisal Ratings</span>
		</a>
	</li>
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/apprisalEmployee}">
			<i class="bi bi-check-square"></i><span>Submitted Appraisals</span>
		</a>
	</li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
          <a class="nav-link" href="hrActivity">
	        <i class="bi bi-file-lock"></i><span>Permissions</span>
	    </a>
      </li>
	  <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
      </li> -->
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:classappend="${empDetailsByEmpId.deptId==0} ? ' active'" th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Employee Leaves</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/events}">
		        <i class="bi bi-megaphone"></i>
		        <span>Announcement</span>
		    </a>
	 </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/addDepartment}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Department</span>
		    </a>
	   </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/addRole}">
		        <i class="bi bi-receipt"></i>
		        <span>Role</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>
		        <span>Employees</span>
		    </a>
	 </li> 
	
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/ongoingProject}">
                <i class="bi bi-calendar3"></i>
                <span>Projects</span>
            </a>
      </li>  
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
      </li>   
      <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
              <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#interview-summary-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Interview Summary</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="interview-summary-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
		            <a href="totalCandidatesList">
		              <i class="bi bi-circle"></i><span>Total Candidates</span>
			            </a>
			          </li>
			        <li>
		            <a href="selectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Selected Candidates</span>
		            </a>
		          </li>
		          <li>
		            <a href="rejectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Rejected Candidates</span>
		            </a>
		          </li>
			    </ul>
			</li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link" href="feedbackReports">
			        <i class="bi bi-chat-square-text"></i>
			        <span>Feedback Reports</span>
			    </a>
		 </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
		<li class="nav-item new-feature"  th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(Policy Update)</span>
					        </span>
					    </a>
		</li>
    </ul>
</aside>

  <main id="main" class="main">
  
  <input type="hidden" id="loggedAdminEmpId2" th:value="${session.loggedAdminEmpId}">
  <input type="hidden" id="loggedAdminEmailId2" th:value="${session.email}">
  <!-- <input type="hidden" id="employeeEmail1" th:value="${loogedAdminDetailsByEmpId.email}" th:text="${loogedAdminDetailsByEmpId.email}" > -->
  
  <div class="chat-app" style="display: none;">
                <div id="plist" class="people-list">
                        <div class="input-group mb-3">
                                <input type="text" id="searchInputModal" class="form-control" placeholder="Search..."
                                        aria-label="Search">
                                <span class="input-group-text">
                                        <i class="bi bi-search"></i>
                                </span>

                        </div>
                        <ul id="employeeNames" class="list-unstyled chat-list mt-2 mb-0">
                                <!-- Employee names will be dynamically populated here -->
                        </ul>
                </div>

                <div class="chat">
                        <div class="chat-header clearfix">
                                <div class="row w-100">

                                        <!-- Employee Photo and Name Section -->
                                        <div class="col-lg-6 d-flex align-items-center">
                                                <div class="chat-about d-flex align-items-center">
                                                        <img id="employeePhoto" class="employee-photo" src="default-avatar.png"
                                                                alt="Employee Photo" />
                                                        <h6 class="m-b-0 ml-2" id="employeeName">Select an Employee</h6>
                                                </div>
                                        </div>
                                        <!-- Right aligned three dots (Vertical) -->
                                        <div class="col-lg-6 text-right">
                                                <div class="dropdown custom-dropdown">
                                                        <button class="btn btn-outline-secondary" type="button" id="dropdownMenuButton"
                                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                                <i class="fa fa-ellipsis-v"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                                                <li><a class="dropdown-item" href="#">Delete Chat</a></li>
                                                                <li><a class="dropdown-item" href="#">Mute</a></li>
                                                                <li><a class="dropdown-item" href="#">Contact Info</a></li>
                                                        </ul>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        <div id="chat-window" class="chat-history">
                                <ul class="m-b-0">
                                        <!-- Chat messages will be populated here dynamically -->

                                </ul>
                                <div id="message-icon-container" class="message-icon" style="display: none;">

                                        <!-- Plain square message icon SVG (behind) -->
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                        <path
                                                                d="M10 9H17M10 13H17M7 9H7.01M7 13H7.01M21 20L17.6757 18.3378C17.4237 18.2118 17.2977 18.1488 17.1656 18.1044C17.0484 18.065 16.9277 18.0365 16.8052 18.0193C16.6672 18 16.5263 18 16.2446 18H6.2C5.07989 18 4.51984 18 4.09202 17.782C3.71569 17.5903 3.40973 17.2843 3.21799 16.908C3 16.4802 3 15.9201 3 14.8V7.2C3 6.07989 3 5.51984 3.21799 5.09202C3.40973 4.71569 3.71569 4.40973 4.09202 4.21799C4.51984 4 5.0799 4 6.2 4H17.8C18.9201 4 19.4802 4 19.908 4.21799C20.2843 4.40973 20.5903 4.71569 20.782 5.09202C21 5.51984 21 6.0799 21 7.2V20Z"
                                                                stroke="#94b7db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </g>
                                        </svg>

                                        <!-- SVG with animation -->
                                        <svg class="animated-icon" viewBox="0 0 374 374" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0)">
                                                        <path
                                                                d="M318.084 132.622C311.339 101.37 287.642 82 256.652 82C238.423 82 217.459 89.3248 197.954 102.509C191.574 106.904 182.642 106.904 176.079 102.672C155.298 88.9992 135.246 82 116.652 82C85.6626 82 61.9647 101.533 55.2199 133.111C44.2824 183.896 80.923 252.26 187.017 291C292.746 251.446 329.204 183.082 318.084 132.622Z" />
                                                        <path
                                                                d="M187.466 0C187.366 0 187.166 0 186.866 0C85.666 0 3.36603 82.3 3.36603 183.5C3.36603 224.8 17.466 264.9 43.266 297.2L16.566 359.3C14.366 364.4 16.766 370.3 21.766 372.4C23.566 373.2 25.566 373.4 27.466 373.1L125.366 355.9C144.966 363 165.566 366.6 186.366 366.5C287.566 366.5 369.866 284.2 369.866 183C370.066 82.1 288.366 0.1 187.466 0ZM192.966 269.8C188.966 271.3 184.666 271.3 180.666 269.8C149.066 257.1 124.466 238.3 109.466 215.4C95.966 194.7 90.766 171.4 94.866 149.9C100.466 121.4 121.866 102.3 148.266 102.3C160.966 102.3 173.866 106.5 186.766 114.7C199.366 106.5 212.466 102.3 225.066 102.3C251.866 102.3 272.866 120.9 278.466 149.6C286.066 188.8 262.666 241.3 192.966 269.8Z" />
                                                </g>
                                                <defs>
                                                        <clipPath id="clip0">
                                                                <rect width="373.232" height="373.232" fill="white" />
                                                        </clipPath>
                                                </defs>
                                        </svg>



                                        <!-- Dots Animation -->
                                        <div class="dots">
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                        </div>




                                </div>


                        </div>
                        <!-- Move the paragraph outside the chat window -->
                        <p id="logo-text"
                                style="text-align: center; font-size: 14px; color: #6c757d; margin-top: 10px; display: none;">
                                "Reach out to your colleagues and stay on top of your projects with quick, seamless communication."
                        </p>
                        <div class="chat-message clearfix">
                                <div class="custom-input-group mb-0">
                                        <input type="text" id="message" class="custom-form-control" placeholder="Enter your message..." />
                                        <div class="custom-input-group-append">
                                                <button class="custom-send-btn" onclick="sendMessage()">
                                                        <i class="ri ri-send-plane-2-fill"></i>
                                                </button>
                                        </div>
                                </div>

                        </div>
                </div>
        </div>
        <input type="hidden" th:value="${empDetailsByEmpId.email}" id="loggedInMail">
<input type="hidden" id="emp_idSessionValue" th:value="${empDetailsByEmpId.empid}">
    
   <div class="pagetitle d-flex"  th:if="${empDetailsByEmpId.deptId==0}">
      <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px"></i>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a th:href="@{/navbar}">Home</a></li>
          <li class="breadcrumb-item active">Leave Request</li>
        </ol>
      </nav>
    </div><!-- End Page Title --><!-- End Page Title -->
    
    <div class="pagetitle mb-0 d-flex"  th:if="${empDetailsByEmpId.deptId>0}">
     <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px"></i>
      <nav>
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a th:href="@{/userDashboard}">Home</a></li>
          <li class="breadcrumb-item active">Leave Request</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->
    
    <input type="hidden" id="roleValue" th:value="${session.role_name}">
    <!-- Modal -->
	<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        Are you sure you want to <span id="actionType"></span> this leave request?
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
	        <button type="button" class="btn btn-primary" id="confirmButton">Confirm</button>
	      </div>
	    </div>
	  </div>
	</div>
	<!-- Success Modal -->
	<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="successModalLabel">Success</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        The leave request was successfully <span id="successAction"></span>.
	      </div>
	      <div class="modal-footer">
	        <button type="button" id="successOkButton" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Error Modal -->
	<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="errorModalLabel">Error</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        There was an error <span id="errorAction"></span> the leave request. Please try again.
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" style="color:white">OK</button>
	      </div>
	    </div>
	  </div>
	</div>
	<!-- Error Modal -->
	<div class="modal fade" id="validationErrorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title text-danger" id="errorModalLabel">Validation Error</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body" id="errorModalMessage">
	                <!-- Error message will be inserted here -->
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
	            </div>
	        </div>
	    </div>
	</div>
		
	<!-- Rejection Reason Modal -->
	<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="rejectModalLabel">Reject Leave Request</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <div class="mb-3">
	          <label for="rejectionReason" class="form-label">Please provide a reason for rejection:</label>
	          <textarea class="form-control" id="rejectionReason" rows="3"></textarea>
	        </div>
	      </div>
	      <input type="hidden" id="leaveReason">
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
	        <button type="button" class="btn btn-primary" id="confirmRejectButton">Reject</button>
	      </div>
	    </div>
	  </div>
	</div>
					<!-- Feedback Modal -->
					<input type="hidden" id="loggedInDeptName" th:value="${empDetailsByEmpId.deptName}">
			<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
			    <div class="modal-dialog">
			        <div class="modal-content rounded-4 shadow-lg">
			            <div class="modal-header border-0">
			                <h5 class="modal-title" id="feedbackModalLabel">Feedback Form</h5>
			                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			            </div>
			            <div class="modal-body">
			                <form id="feedbackForm" method="post" enctype="multipart/form-data">
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackName" class="form-label fw-bold">Your Name</label>
			                        <input type="text" class="form-control" id="feedbackName" name="name" th:value="${empDetailsByEmpId.fullName}" readonly>
			                    </div>
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackEmail" class="form-label fw-bold">Your Email</label>
			                        <input type="email" class="form-control" id="feedbackEmail" name="email" th:value="${empDetailsByEmpId.email}" readonly>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackEmailyy" class="form-label fw-bold">To</label>
			                        <div class="to-field-container">
			                            <span class="to-field rounded-pill px-3 py-2 shadow-sm">bugs_msplconnect@melangesystems.com</span>
			                        </div>
			                    </div>
								<div class="mb-3">
								    <label for="bugType" class="form-label fw-bold">Bug Type</label>
								    <select class="form-control" id="bugType" name="bugType" required>
								        <option value="About Application">About Application</option>
								        <option value="New Feature">New Feature</option>
								    </select>
								</div>

			                    <div class="mb-3">
			                        <label for="feedbackMessage" class="form-label fw-bold">Message</label>
			                        <textarea class="form-control" id="feedbackMessage" name="message" rows="4" placeholder="Enter your feedback here..." required></textarea>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackAttachment" class="form-label fw-bold">Attachment (optional)</label>
			                        <input type="file" class="form-control" id="feedbackAttachment" name="attachment" accept=".png, .jpg, .jpeg" multiple>
			                        <small class="text-muted">Max size: 5MB. You can upload multiple images.</small>
			                    </div>
			                    <button type="submit" class="btn btn-primary w-100 mt-3 py-2 shadow-sm" id="submitFeedbackBtn">Submit Feedback</button>
			                </form>
			            </div>
			        </div>
			    </div>
			</div>
	<!-- model to edit leave request -->

	<div id="editModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Leave Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editForm" class="row g-3">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="mb-3">
                        	<input type="hidden" id="reqEmpId">
                        	<input type="hidden" id="reqId">
                        	<input type="hidden" id="candidateEmail">
                            <label for="employeeName" class="form-label">Employee Name</label>
                            <input type="text" id="employeeNameInEditLeaveForm" class="form-control" readonly>
                        </div>
                       
                         <div class="mb-3">
                            <label for="fromDate" class="form-label">From Date</label>
                            <input type="date" id="fromDate" name="from_date" class="form-control">
                        </div>
                         <div id="fromDateError" class="text-danger mt-1" style="display: none;">
							 <strong>Invalid Selection:</strong> Holidays cannot be selected.
						 </div>
						 <div id="dateErrorfromto" class="text-danger mt-1" style="display: none;">
											    <strong>Invalid Selection:</strong> Holidays cannot be selected.
											</div>
											<div id="dateErrorholiday" class="text-danger mt-1" style="display: none;">
											    <strong>Invalid Selection:</strong> Selected date cannot be a holiday.
											</div>

											<!-- Error Message for Invalid Date Range -->
											<!-- <div id="dateError" class="text-danger mb-2" style="display: none;">
												<strong>Invalid Date Range:</strong> The "To Date" must be later than or
												equal to the "From Date".
											</div> -->

											<!-- Error Message for Invalid Date Range -->
											<div id="dateError" class="text-danger mb-2" style="display: none;">
												<strong>Invalid Date Range:</strong> The "To Date" must be later than or
												equal to the "From Date".
											</div>
											<div id="dateOverlap" class="text-danger mb-2" style="display: none;">
												<strong>Invalid Date Range:</strong> You have already requested leave
												for the selected dates.
											</div>

											<!-- Error Message for Invalid Maternity Leave -->
											<div id="maternityLeaveError" class="text-danger mb-2"
												style="display: none;">
												<strong>Invalid Maternity Leave:</strong> Maternity leave cannot be less
												than or greater than 6 months.
											</div>
											<div id="error-message" style="color: red; display: none;"></div>
					                         <div class="mb-3">
											    <label class="form-label">Day Duration</label>
											    <div>
											        <input type="radio" id="fullDay" name="leaveDuration" value="Full Day">
											        <label for="fullDay">Full Day</label>
											        <input type="radio" id="halfDay" name="leaveDuration" value="Half Day">
											        <label for="halfDay">Half Day</label>
											    </div>
											</div>
					                    </div>

                    <!-- Right Column -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="leaveType" class="form-label">Leave Type</label>
                            <select id="leaveType" class="form-select" required onchange="hideLeaveTypeError()">
                                <option value="CL">Casual Leave</option>
                                <option value="SL">Sick Leave</option>
                                <option value="LOP">LOP</option>
                                <option value="EL">Earned Leave</option> 
                            </select>
                        </div>
                        <div id="leaveTypeError" class="text-danger mt-1" style="display: none;">
						    <strong>Please select a leave type.</strong>
						</div>
                        
                        <div class="mb-3">
                            <label for="toDate" class="form-label">To Date</label>
                            <input type="date" id="toDate" name="to_date" class="form-control">
                        </div> 
                        <div id="toDateError" class="text-danger mt-1" style="display: none;">
							  <strong>Invalid Selection:</strong> Sundays cannot be selected.
						 </div>                   
                    </div>

                    <!-- Full-Width Row -->
                    <div class="col-12">
                        <div class="mb-3">
                            <label for="reason" class="form-label">Reason</label>
                            <textarea id="reason" class="form-control"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="submitBtn" onclick="saveChanges()">Save Changes</button>
            </div>
        </div>
    </div>
</div>
<!-- model to display leave Request -->
<div class="modal fade" id="leaveDetailsModal" tabindex="-1" role="dialog"
							aria-labelledby="leaveDetailsModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="leaveDetailsModalLabel">Leave Details</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal"
											aria-label="Close"></button>
									</div>
									<div class="modal-body">
										<table class="table">
											<thead>
												<tr>
													<th>Leave Type</th>
													<th>Added</th>
													<th>Used</th>
													<th>Remaining</th>
												</tr>
											</thead>
											<tbody id="leaveRecordsTable">
												<!-- Dynamic content will be inserted here -->
											</tbody>
										</table>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary"
											data-bs-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>


				<!-- modal for display success or failure of leave request modification -->
				<div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
				  <div class="modal-dialog modal-dialog-centered">
				    <div class="modal-content">
				      <div class="modal-header">
				        <h5 class="modal-title" id="statusModalLabel">Status</h5>
				        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				      </div>
				      <div class="modal-body" id="statusModalBody">
				        <!-- Message will be set dynamically -->
				      </div>
				      <div class="modal-footer">
				        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				      </div>
				    </div>
				  </div>
				</div>
			<!-- loding spinner -->
			<div id="loadingPopup" style="display:none">
			    <div class="spinner"></div>
			    <p>Loading please wait...</p>
			</div> 
			<!-- end edit model -->
			    
			    <section class="section dashboard">
			      <div class="row">

            <!-- <div class="col-lg-4" id="groupMailIdForm">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">Group Mail Id Form</h5>

						<form class="addCompProjectForm addEmployeeFormWithValidation" action="saveGroupMailIdList" method="post">
							<input type="date" style="display: none;" name="announced_date" id="assignedSubmitDate">
							<div class="row jumbotron box8">
							
								   <div class="col-sm-12 form-group mb-4">
										<input type="email"
											class="form-control eventCustom_textfield"
											name="main_mail_id" id="main_mail_id" placeholder="Main mail id"
											required>
									</div>
									<div class="col-sm-12 form-group mb-4">
										<input type="email" name="sub_mail_id"
													class="form-control eventCustom_textfield" id="sub_mail_id"
													placeholder="Sub mail id">
									</div>
									<div class="col-sm-12 form-group mb-4">
										<textarea
												class="form-control compProjectCustom_textArea2 groupMailIdCustom_textArea"
												placeholder="Group mail id with comma seperated" id="group_mail_id"
												name="group_mail_id" required></textarea>
									</div>

									<div class="col-sm-12 form-group mb-4 customize_btn_div">
										<button type="submit" class="btn btn-outline-primary">Add</button>
										<button type="reset" class="btn btn-outline-secondary">Clear</button>
									</div>
							</div>
						</form>

						</div>
					</div>
				</div> -->
				
				<div class="col-lg-12" id="groupMailIdTable">
					<div class="row">
						<div class="col-lg-12">	
							<div class="card">
								<div class="card-body table-responsive p-0">
								  <div class="d-flex justify-content-between">
								 	 <h5 class="card-title mt-0 pt-0">Leave Requests</h5>
								 	 <div>
									    <div id="searchUnapproved" class="search-box m-1">
										    <button class="btn-search searchUnprovedTable" title="Search"><i class="bi bi-search"></i></button>
										    <input type="text" oninput="searchUnprovedTable();" class="input-search searchUnprovedTable_inputSearch" placeholder="Search...">
										</div>
										<div id="searchApproved" class="search-box m-1" style="display: none;">
										    <button class="btn-search searchApprovedTable" title="Search"><i class="bi bi-search"></i></button>
										    <input type="text" oninput="searchApprovedTable();" class="input-search searchApprovedTable_inputSearch" placeholder="Search...">
										</div>
										<div id="searchRejected" class="search-box m-1" style="display: none;">
										    <button class="btn-search searchRejectedTable" title="Search"><i class="bi bi-search"></i></button>
										    <input type="text" oninput="searchRejectedTable();" class="input-search searchRejectedTable_inputSearch" placeholder="Search...">
										</div>
									</div>
								  </div>
										 <!-- Bordered Tabs Justified -->
							              <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist">
										    <li class="nav-item flex-fill" role="presentation">
										        <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home" aria-selected="true">Unapproved</button>
										    </li>
										    <li class="nav-item flex-fill" role="presentation">
										        <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Approved</button>
										    </li>
										    <li class="nav-item flex-fill" role="presentation">
										        <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-rejected" type="button" role="tab" aria-controls="profile" aria-selected="false">Rejected</button>
										    </li>
										</ul>
									

									<div class="tab-content pt-2" id="borderedTabJustifiedContent">

										<!-- Home Tab Content, new leave request tab-->
										<div class="tab-pane fade show active"
											id="bordered-justified-home" role="tabpanel"
											aria-labelledby="home-tab"	>
											<div style="max-height: 400px;min-height:390px; overflow-y: auto;">
		   											 <table id="holidayTable2" class="table table-striped table-hover mb-0 holidayTable">
														<thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 10;">
															<tr>
															
																<th>Sl No</th>
																<th>Req Id</th>
																<th>Action</th>
		
																<th>Employee Id</th>
																<th>Employee Name</th>
																<th>Leave Type</th>
		
																<th style="min-width: 100px;">From</th>
																<th style="min-width: 100px;">To</th>
																<th style="min-width: 100px;">Requested On</th>
																<th style="min-width: 100px;">Requested By</th>
																
		
																<th>Duration</th>
																<th style="min-width: 150px; max-width: 250px;">Reason</th>
		
																<th>Status</th>
																 
																<!-- <th>Rejected Reason</th>	 -->
															</tr>
														</thead>
														<tbody>
														  
															<tr th:if="${usersList.empty}">
																<td colspan="11" class="text-center">No data found</td>
															</tr>
															
															<tr th:each="userlist, stat : ${usersList}" th:attr="data-way=${userlist.way}">
																<td th:text="${stat.index + 1}"
																	th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${userlist.id}"
																	th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:classappend="${userlist.way==1?'highlight-row':''}"
																	style="white-space: nowrap;">
																	<div style="display: flex; gap: 10px; align-items: center;">
																		
																		<th:block th:if="${userlist.sender_id != 'The Melange Team'}">
																			<i class="bx bx-check text-success" title="Approve"
																				th:data-id="${userlist.id}"
																				   data-status="Approved"
																				   th:data-reason="${userlist.reason}"
																				   onclick="handleApproveClick(this)" 
																				
																				style="font-size: 22px;cursor: pointer;" th:if="${userlist.sender_name != 'The Melange Team'}"></i> 
																	   	</th:block>	
																	   	<th:block th:if="${userlist.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																		</th:block>
																	   	<th:block th:if="${userlist.sender_id != 'The Melange Team'}">
																		   <i class="bx bx-x text-danger" title="Reject" 
  																			       th:data-id="${userlist.id}"
																				   data-status="Reject"
																				   th:data-reason="${userlist.reason}"
																				   onclick="handleApproveClick(this)"
																				style="font-size: 22px;cursor: pointer;" th:if="${userlist.sender_name != 'The Melange Team'}"></i> 
																	 	</th:block>
																	 	<th:block th:if="${userlist.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																		</th:block>
																	 		
																	   <i class="bx bx-calendar-check text-success"
																			title="Leave Balance"
																			th:onclick="displayLeaveBalanceold('[[${userlist.employeeEmail}]]')"
																			style="font-size: 22px; cursor: pointer;"></i> 
																		<th:block th:if="${userlist.sender_id != 'The Melange Team'}">	
																		   <i class="bx bx-edit text-primary" title="Edit"
																				th:data-id="${userlist.id}"
																				th:data-emp-id="${userlist.empid}"
																				th:data-employee-name="${userlist.employee_name}"
																				th:data-leave-type="${userlist.leaveType}"
																				th:data-from-date="${userlist.from_date}"
																				th:data-to-date="${userlist.to_date}"
																				th:data-reason="${userlist.reason}"
																				th:data-duration="${userlist.leaveDuration}"
																				th:data-email="${userlist.employeeEmail}"
																				th:if="${userlist.edit_flag == 0}"
																				onclick="openEditModal(this)" style="font-size: 22px;cursor: pointer;">
																			</i>
																		</th:block>
																		<th:block th:if="${userlist.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																		</th:block>
																	</div>
																</td>
																<td th:text="${userlist.empid}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${userlist.employee_name}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${userlist.leaveType}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${userlist.from_date}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																
																<td th:text="${userlist.to_date}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${userlist.requested_date}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<td th:text="${(userlist.sender_name != null and not #strings.isEmpty(userlist.sender_name)) ? userlist.sender_name : '-'}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																<!--<td th:text="${userlist.leaveDuration}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>-->
																<td th:classappend="${userlist.way==1?'highlight-row':''}"
																    th:data-halves-json="${userlist.dailyHalves}"
																    class="duration-cell"
																    onclick="toggleHalfDetails(this)">
																    <span th:text="${userlist.leaveDuration}"></span>
																    <i class="bi bi-info-circle ms-1 text-primary small"
																       title="View details"></i>
																</td>




																
																<td th:text="${userlist.reason}" th:classappend="${userlist.way==1?'highlight-row':''}" style="word-wrap: break-word; white-space: normal; max-width: 200px;"></td>
																<td th:text="${userlist.approvedstatus}" th:classappend="${userlist.way==1?'highlight-row':''}"></td>
																
																<!-- <td th:text="${userlist.approved_by}"
																	th:classappend="${userlist.way==1?'highlight-row':''}"></td> -->
																<!-- <td th:text="${userlist.rejection_reason}"
																	th:classappend="${userlist.way==1?'highlight-row':''}"></td> -->
															</tr>
														</tbody>	
													</table>
											</div>
										</div>
										
										<script>
											document.addEventListener('DOMContentLoaded', () => {
											  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
											  tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
											});
											function toggleHalfDetails(cell) {
											    const tr      = cell.closest('tr');
											    const nextRow = tr.nextElementSibling;
											    const jsonStr = cell.dataset.halvesJson;

											    if (nextRow && nextRow.classList.contains('half-detail-row')) {
											        nextRow.remove();
											        return;
											    }

											    const formatDate = (dateStr) => {
											        const [y, m, d] = dateStr.split('-');
											        return `${d}-${m}-${y}`;
											    };

											    let html = '<td colspan="12" class="bg-light small text-muted p-2">';
											    if (!jsonStr) {
											        html += 'No half-day information available.';
											    } else {
											        try {
											            const data  = JSON.parse(jsonStr);
											            const lines = Object.entries(data).map(([date, halves]) => {
											                let readable;
											                if (halves.length === 2 && halves.includes('am') && halves.includes('pm')) {
											                    readable = 'Full Day';
											                } else {
											                    readable = halves
											                        .map(h => h === 'am' ? 'First Half' : 'Second Half')
											                        .join(' & ');
											                }
											                return `<div><strong>${formatDate(date)}</strong>: ${readable}</div>`;
											            });
											            html += lines.join('');
											        } catch (e) {
											            html += 'Invalid half-day data.';
											        }
											    }
											    html += '</td>';

											    const detailRow = document.createElement('tr');
											    detailRow.className = 'half-detail-row';
											    detailRow.innerHTML = html;
											    tr.insertAdjacentElement('afterend', detailRow);
											}

											const formatDate = (dateStr) => {
											    const [y, m, d] = dateStr.split('-');
											    return `${d}-${m}-${y}`;
											};
										</script>


										<!-- Profile Tab Content -->
										<div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" th:if="${empDetailsByEmpId.deptId!=74}"
											aria-labelledby="profile-tab">
											
											<div style="max-height: 400px;min-height:390px; overflow-y: auto;">
											    <table id="holidayTable3" class="table table-striped table-hover mb-0 holidayTable">
											        <thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 10;">
											            <tr>
											                <th>Sl No</th>  
											                <th>Req Id</th>
											                <th>Actionn</th>
											                <th>Employee Id</th>
											                <th>Employee Name</th>
											                <th>Leave Type</th>                                               
											                <th style="min-width: 100px;">From</th>
											                <th style="min-width: 100px;">To</th>
											                <th style="min-width: 100px;">Requested On</th>
											                <th style="min-width: 100px;">Requested By</th>
											                <th>Duration</th>
											                <th style="min-width: 150px; max-width: 250px;">Reason</th>
											                <th>Status</th>
											                <th>Approved By</th>
											                <th>Approved Time</th>
											                
											                <!-- <th>Rejected Reason</th> -->
											            </tr>
											        </thead>
											        <tbody>
											        
											            <!-- Rows with data -->
											            <tr th:each="adminDeptProccessedLeaveRequest, stat1 : ${adminDeptProccessedLeaveRequests}">
											                <td th:text="${stat1.index + 1}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.id}"></td>
											                <td>
											                    <div style="display: flex; gap: 10px; align-items: center;">
											                        <!-- <i class="bx bx-check text-success" title="Approve"
											                           th:onclick="approveLeave('[[${adminDeptProccessedLeaveRequest.id}]]','Approved')"
											                           style="font-size: 22px;cursor: pointer;"></i> -->
											                           <th:block th:if="${empDetailsByEmpId.deptId>0 && adminDeptProccessedLeaveRequest.sender_id != 'The Melange Team'}">
													                        <i class="bx bx-x text-danger" title="Reject"
													                           th:data-id="${adminDeptProccessedLeaveRequest.id}"
																				   data-status="Reject"
																				   th:data-reason="${adminDeptProccessedLeaveRequest.reason}"
																				   onclick="handleApproveClick(this)" 
													                           style="font-size: 22px;"></i>
											                           </th:block>
											                           
											                           <th:block th:if="${empDetailsByEmpId.deptId==0}">
													                        <i class="bx bx-x text-danger" title="Reject"
													                           th:data-id="${adminDeptProccessedLeaveRequest.id}"
																				   data-status="Reject"
																				   th:data-reason="${adminDeptProccessedLeaveRequest.reason}"
																				   onclick="handleApproveClick(this)" 
													                           style="font-size: 22px;"></i>
											                           </th:block>
											                           <!-- <th:block th:if="${adminDeptProccessedLeaveRequest.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  Keeps alignment
																	   </th:block> -->
											                        <i class="bx bx-calendar-check text-success" title="Leave Balance"  th:data-id="${adminDeptProccessedLeaveRequest.id}"
											                          th:onclick="displayLeaveBalance('[[${adminDeptProccessedLeaveRequest.id}]]', '[[${adminDeptProccessedLeaveRequest.employeeEmail}]]')"
											                           style="font-size: 22px; cursor: pointer;cursor: pointer;"></i>
											                           
											                           
											                        <th:block th:if="${adminDeptProccessedLeaveRequest.sender_id != 'The Melange Team'}">	
												                        <i class="bx bx-edit text-primary" title="Edit"
												                           th:data-id="${adminDeptProccessedLeaveRequest.id}"
												                           th:data-emp-id="${adminDeptProccessedLeaveRequest.empid}"
												                           th:data-employee-name="${adminDeptProccessedLeaveRequest.employee_name}"
												                           th:data-leave-type="${adminDeptProccessedLeaveRequest.leaveType}"
												                           th:data-from-date="${adminDeptProccessedLeaveRequest.from_date}"
												                           th:data-to-date="${adminDeptProccessedLeaveRequest.to_date}"
												                           th:data-reason="${adminDeptProccessedLeaveRequest.reason}"
												                           th:data-duration="${adminDeptProccessedLeaveRequest.leaveDuration}"
												                           th:data-email="${adminDeptProccessedLeaveRequest.employeeEmail}"
												                           th:if="${adminDeptProccessedLeaveRequest.edit_flag == 0}"
												                           onclick="openEditModal(this)" style="font-size: 22px;cursor: pointer;"></i>
											                   		</th:block>
											                   		
											                   		<th:block th:if="${adminDeptProccessedLeaveRequest.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																	</th:block>
											                    </div>
											                </td>
											                <td th:text="${adminDeptProccessedLeaveRequest.empid}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.employee_name}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.leaveType}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.from_date}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.to_date}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.requested_date}"></td>
											                <td th:text="${(adminDeptProccessedLeaveRequest.sender_name != null and not #strings.isEmpty(adminDeptProccessedLeaveRequest.sender_name)) ? adminDeptProccessedLeaveRequest.sender_name : adminDeptProccessedLeaveRequest.sender_id}"></td>
											             <!--   <td th:text="${adminDeptProccessedLeaveRequest.leaveDuration}"></td>-->
														 <td th:data-halves-json="${adminDeptProccessedLeaveRequest.dailyHalves}"
														     class="duration-cell"
														     onclick="toggleHalfDetails(this)">
														     
														     <span th:text="${adminDeptProccessedLeaveRequest.leaveDuration}"></span>
														     <i class="bi bi-info-circle ms-1 text-primary small"
														        title="View details"></i>
														 </td>


											                <td th:text="${adminDeptProccessedLeaveRequest.reason}" style="word-wrap: break-word; white-space: normal; max-width: 200px;"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.approvedstatus}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.approved_by}"></td>
											                <td th:text="${adminDeptProccessedLeaveRequest.approved_date_time}"></td>
											                
											                <!-- <td th:text="${adminDeptProccessedLeaveRequest.sender_name}" th:classappend="${userlist.way==1?'highlight-row':''}"></td> -->
											                <!-- <td th:text="${adminDeptProccessedLeaveRequest.rejection_reason}"></td> -->
											            </tr>
											            
											             <tr th:if="${#lists.isEmpty(adminDeptProccessedLeaveRequests)}">
												                <td colspan="12" class="text-center">No data found</td>
												         </tr>
											        </tbody>
											    </table>
											</div>

										</div>
										<div class="tab-pane fade" id="bordered-justified-rejected"
											role="tabpanel" th:if="${empDetailsByEmpId.deptId!=74}"
											aria-labelledby="profile-tab">

											<div style="max-height: 400px;min-height:390px; overflow-y: auto;">
												<table id="rejectedLeaves" class="table table-striped table-hover mb-0 holidayTable">
													<thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 10;">
														<tr>
															<th>Sl  No</th>
															<th>Req Id</th>
															<th style="margin: 0 30px;">Action</th>
															<th>Employee Id</th>
															<th>Employee Name</th>
															<th>Leave Type</th>
															<th style="min-width: 100px;">From</th>
															<th style="min-width: 100px;">To</th>
															<th style="min-width: 100px;">Requested On</th>
															<th style="min-width: 100px;">Requested By</th>
															<th>Duration</th>
															<th style="min-width: 150px; max-width: 250px;">Reason</th>
															<th>Status</th>
															<th>Rejected By</th>
															<th>Rejected Time</th>
															<th>Rejected Reason</th>
															 
														</tr>
													</thead>
													<tbody>														 
														<tr th:each="adminDeptRejectedLeaveRequest, stat : ${adminDeptRejectedLeaveRequests}"
															th:if="${adminDeptRejectedLeaveRequest.approvedstatus == 'Rejected'}">
															<td th:text="${stat.index + 1}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.id}"></td>
															<td>
																<div
																	style="display: flex; gap: 10px; align-items: center;">
																	<th:block th:if="${adminDeptRejectedLeaveRequest.sender_id != 'The Melange Team'}">
																		<i class="bx bx-check text-success" title="Approve"
																			 th:data-id="${adminDeptRejectedLeaveRequest.id}"
																				   data-status="Approved"
																				   th:data-reason="${adminDeptRejectedLeaveRequest.reason}"
																				   onclick="handleApproveClick(this)"
																			style="font-size: 22px;cursor: pointer;"></i> 
																	</th:block>
																	<th:block th:if="${adminDeptRejectedLeaveRequest.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																	</th:block>
																	<!-- <i class="bx bx-x text-danger" title="Reject"
																		th:onclick="approveLeave('[[${adminDeptRejectedLeaveRequest.id}]]','Reject')"
																		style="font-size: 22px;cursor: pointer;"></i> -->
																	<i class="bx bx-calendar-check text-success"
																		title="Leave Balance" th:data-id="${adminDeptRejectedLeaveRequest.id}"

																		th:onclick="displayLeaveBalance('[[${adminDeptRejectedLeaveRequest.id}]]', '[[${adminDeptRejectedLeaveRequest.employeeEmail}]]')"

																		style="font-size: 22px; cursor: pointer;"></i>
																	 
																	 <th:block th:if="${adminDeptRejectedLeaveRequest.sender_id != 'The Melange Team'}">	
																	 <i class="bx bx-edit text-primary" title="Edit"
																		th:data-id="${adminDeptRejectedLeaveRequest.id}"
																		th:data-emp-id="${adminDeptRejectedLeaveRequest.empid}"
																		th:data-employee-name="${adminDeptRejectedLeaveRequest.employee_name}"
																		th:data-leave-type="${adminDeptRejectedLeaveRequest.leaveType}"
																		th:data-from-date="${adminDeptRejectedLeaveRequest.from_date}"
																		th:data-to-date="${adminDeptRejectedLeaveRequest.to_date}"
																		th:data-reason="${adminDeptRejectedLeaveRequest.reason}"
																		th:data-duration="${adminDeptRejectedLeaveRequest.leaveDuration}"
																		th:data-email="${adminDeptRejectedLeaveRequest.employeeEmail}"
																		th:if="${adminDeptRejectedLeaveRequest.edit_flag == 0}"
																		onclick="openEditModal(this)" style="font-size: 22px;cursor: pointer;"></i>
																	</th:block>
																	<th:block th:if="${adminDeptRejectedLeaveRequest.sender_id == 'The Melange Team'}">
																		    <span style="display: inline-block; width: 22px;"></span>  <!-- Keeps alignment -->
																	</th:block>
																</div>
															</td>
															<td th:text="${adminDeptRejectedLeaveRequest.empid}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.employee_name}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.leaveType}"></td>

															<td th:text="${adminDeptRejectedLeaveRequest.from_date}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.to_date}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.requested_date}"></td>
															<td th:text="${(adminDeptRejectedLeaveRequest.sender_name != null and not #strings.isEmpty(adminDeptRejectedLeaveRequest.sender_name)) ? adminDeptRejectedLeaveRequest.sender_name : '-'}"></td>
															<!--<td th:text="${adminDeptRejectedLeaveRequest.leaveDuration}"></td>-->
															<td th:data-halves-json="${adminDeptRejectedLeaveRequest.dailyHalves}"
															    class="duration-cell"
															    onclick="toggleHalfDetails(this)">

															    <span th:text="${adminDeptRejectedLeaveRequest.leaveDuration}"></span>
															    <i class="bi bi-info-circle ms-1 text-primary small"
															       title="View details"></i>
															</td>

															
															<td th:text="${adminDeptRejectedLeaveRequest.reason}" style="word-wrap: break-word; white-space: normal; max-width: 200px;"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.approvedstatus}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.approved_by}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.approved_date_time}"></td>
															<td th:text="${adminDeptRejectedLeaveRequest.rejection_reason}"></td>
															
														</tr>
														 <!-- Display 'No data found' if the list is empty -->
											            <tr th:unless="${!#lists.isEmpty(adminDeptRejectedLeaveRequests)}">
											                <td colspan="13" style="text-align: center;">No data found</td>
											            </tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<!-- Pagination container -->
									<!-- <div id="pagination" style="text-align: center; margin-top: 10px;"></div> -->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div><!-- End Left side columns -->
    </section>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
       Copyright &copy; <span id="currentYear"></span> <strong><span>Melange Systems Private Limited</span></strong>. All Rights Reserved
    </div>
  </footer>
  
  <script>
      var currentYear = new Date().getFullYear();
      document.getElementById("currentYear").innerHTML = currentYear;
	  
	  
  </script>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
  <script src="assets/js/chart.min.js"></script>


<script>

var formattedDate;

$.ajax({
    type: 'GET', 
    url: 'fetchGroupMailIdData', 
    success: function(data) {
		console.log(JSON.stringify(data));
		updateGroupMailIdDetails(data);
		},
    error: function(xhr, status, error) {
        console.error('Error fetching data:', error);
        console.log('Error fetching data. Please try again.');
    }
});
  
function updateGroupMailIdDetails(data) {
    const tbody = $('#viewEmpDetailsTBody');
    tbody.empty();

    let currentMainMailId = null;
    let mainMailIdRowSpan = 0;
    let mainMailIdIndex = 0;

    data.forEach((item, index) => {
        if (item.main_mail_id !== currentMainMailId) {
            if (mainMailIdRowSpan > 1) {
                tbody.find(`tr:eq(${mainMailIdIndex}) td:eq(1)`).attr('rowspan', mainMailIdRowSpan);
            }

            currentMainMailId = item.main_mail_id;
            mainMailIdRowSpan = 1;
            mainMailIdIndex = tbody.children().length;

            tbody.append(`
                <tr>
                    <td class="cell border">${index + 1}</td>
                    <td class="cell border">${item.main_mail_id}</td>
                    <td class="cell border">${item.sub_mail_id || '-'}</td>
                    <td class="cell border">${formatGroupMailIds(item.group_mail_id)}</td>
                </tr>
            `);
        } else {
            mainMailIdRowSpan++;
            tbody.append(`
                <tr>
                    <td class="cell border">${index + 1}</td>
                    <td class="cell border" style="display: none;"></td>
                    <td class="cell border">${item.sub_mail_id || '-'}</td>
                    <td class="cell border">${formatGroupMailIds(item.group_mail_id)}</td>
                </tr>
            `);
        }
    });

    if (mainMailIdRowSpan > 1) {
        tbody.find(`tr:eq(${mainMailIdIndex}) td:eq(1)`).attr('rowspan', mainMailIdRowSpan);
    }
}

function formatGroupMailIds(groupMailIds) {
    if (!groupMailIds) return '';
    const ids = groupMailIds.split(',');
    let formatted = '<ul>';
    ids.forEach(id => {
        formatted += `<li>${id}</li>`;
    });
    formatted += '</ul>';
    return formatted;
}
  
</script>

<script>
	var loggedInRole = document.getElementById('roleValue').value;
	
	if(loggedInRole === "HR"){
		document.getElementById('employeeLink').style.display="block";
		document.getElementById('groupMailIdForm').style.display="block";
		//document.getElementById('compProjectLink').style.display="none";
		//document.getElementById('addEmployeeLink').style.display="block";
	}else if(loggedInRole === "Super Admin"){
		document.getElementById('employeeLink').style.display="none";
		document.getElementById('groupMailIdForm').style.display="none";
		document.getElementById('groupMailIdTable').style.width="100%";
		//document.getElementById('addEmployeeLink').style.display="none";
	}
</script>  

<!-- script to notification -->
<!-- <script>
// Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
        var leaveRequestCountValue = response;
        
       // If total notification count is greater than 0, show the bell icon
        if (leaveRequestCountValue.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
        } else {
            $("#notificationBellIcon").hide();  // Hide bell icon if no notifications
        }

        if (leaveRequestCountValue.leaveRequestFlagCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        }
        //display the asset notifu=ication based on asset count value
        if(leaveRequestCountValue.asseteRequestFlagCount>0){
        	
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
             
             $("#assetRequestMessage").text(leaveRequestCountValue.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#asseteRequestFlagCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        		
        }
        
        //display the new project notification based on asset count value
        if(leaveRequestCountValue.newPrjectValueCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newProjectNotification").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.newPrjectValueCount + " project request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }

    	
    	//display the appraisal from HR notification ]
            if(leaveRequestCountValue.appraisalCount>0){
            	 $("#notificationBellIcon").show();  // Show bell icon
                 $("#hrAppraisal").show();  // Show specific notification
                 
                 $("#newProjectMessage").text(leaveRequestCountValue.appraisalCount + " Appraisal Form");
                 $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
                 $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
            }
            
          //display the appraisal from employee notification 
            if(leaveRequestCountValue.empAppraisalflag>0){
            	 $("#notificationBellIcon").show();  // Show bell icon
                 $("#empAppraisal").show();  // Show specific notification
                 
                 $("#apprisalempNotification").text(leaveRequestCountValue.empAppraisalflag + " employees sent appraisal");
                 $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
                 $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
            }
            
            //display the appraisal Due date notification 
            if(leaveRequestCountValue.adminAppraisalDuedate>0){
            	 $("#dueAppraisal").show();  // Show bell icon
                 $("#empAppraisal").show();  // Show specific notification
                 
                 $("#apprisalDueNotification").text("Tomorrow is the due date for submit appraisal");
                 $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
                 $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
            }
            
          //display the announcement notification based on asset count value
            if(leaveRequestCountValue.announcementNotification>0){
            	 $("#notificationBellIcon").show();  // Show bell icon
                 $("#newAnnouncementNotification").show();  // Show specific notification
                 
                 $("#newannouncement").text(leaveRequestCountValue.announcementNotification + " announcement(s)");
                 $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
                 
            	 	
            } 
       
    });
}

//Function to fetch flag value from the backend
function fetchsuperAdminFlag() {
    $.get("/flag", function(response) {
    	
        var requestCount = response;
         
        // If total notification count is greater than 0, show the bell icon and notifications
        if (requestCount.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(requestCount.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(requestCount.totalNotificationCount);
            $("#leaveRequestFlagCount").text(requestCount.leaveRequestFlagCount);
        } else {
            // If total notification count is 0, hide the bell icon and notification
            $("#notificationBellIcon").hide();
        }
        //display the asset notifu=ication based on asset count value
        if(requestCount.asseteRequestFlagCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
             
             $("#assetRequestMessage").text(requestCount.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(requestCount.totalNotificationCount);
             $("#asseteRequestFlagCount").text(requestCount.asseteRequestFlagCount);
        		
        }
        else {
            // If total notification count is 0, hide the bell icon and notification
            $("#assetRequestNotification").hide();
        }
    });
}

// Periodically fetch flag value every second (adjust as needed)
const employeeId = document.getElementById('employee-id').value; // This is a string

if(employeeId === "0") {
	//alert("hii");
	setInterval(fetchsuperAdminFlag, 1000);
}
else{
	setInterval(fetchFlag, 1000);
}

</script> -->
 
 
<!-- script to approve leave -->
<script>
let currentEmpId = null;
let currentStatus = null;

/* function approveLeave(requestId, status) {
	alert(empid);
    currentEmpId = requestId;
    currentStatus = status;
    
    

    if (status === 'Approved') {
        // Call approve function directly if the status is 'Approve'
        confirmApproval();
    } else if (status === 'Reject') {
        // Show the rejection reason modal
        var rejectModal = new bootstrap.Modal(document.getElementById('rejectModal'));
        rejectModal.show();
    }
} */

function approveLeave(requestId, status, reason) {
	
	//alert(requestId+" "+status+" "+reason);
	 
	reason = reason.replace(/^"(.*)"$/, '$1'); // Removes quotes if present
	currentEmpId = requestId;
    currentStatus = status;

    // Call leaveValidation API
    fetch('/admin/leaveValidation', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ requestId: requestId, status: status })
    })
    .then(response => response.json())
    .then(data => {
	    if (data.valid) {
	        if (status === 'Approved') {
	            confirmApproval(reason);
	        } else if (status === 'Reject') {
	        	
	        	document.getElementById('leaveReason').value = reason;
	            var rejectModal = new bootstrap.Modal(document.getElementById('rejectModal'));	            
	            //reason
	            rejectModal.show();
	        }
	    } else {
	        const errorMessage = data.message || "Leave request is not valid for approval.";
	        document.getElementById('errorModalMessage').innerText = errorMessage;
	        var errorModal = new bootstrap.Modal(document.getElementById('validationErrorModal'));
	        errorModal.show();
	    }
	})
    .catch(error => {
        console.error('Error during leave validation:', error);
    });
}

// Function to confirm approval
function confirmApproval(reason) {
	const loadingPopup = document.getElementById('loadingPopup');
    loadingPopup.style.display = 'flex'; // Show the overlay
	
    fetch('/admin/leaveApproveByAdmin', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ empid: currentEmpId, status: currentStatus, leaveReason: reason })
    })
	
    .then(response => {
		
        if (response.ok) {
        	 // Hide the loading popup
            loadingPopup.style.display = 'none';
            document.getElementById('successAction').innerText = currentStatus.toLowerCase();
            var successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
        } else {
			loadingPopup.style.display = 'none';
            document.getElementById('errorAction').innerText = currentStatus.toLowerCase();
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            errorModal.show();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        // Hide the loading popup
        loadingPopup.style.display = 'none';
        document.getElementById('errorAction').innerText = currentStatus.toLowerCase();
        var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.show();
    });
}

function displayLeaveBalance(requestId, email) {
    // Remove surrounding double quotes if they exist
    requestId = requestId.replace(/^"|"$/g, '');
    email = email.replace(/^"|"$/g, ''); 

    fetch(`/admin/leaveBalanceSnapshot/${requestId}?email=${email}`, { method: 'GET' })
        .then(response => {
            console.log("Fetch request sent for leave balance snapshot");

            if (!response.ok) {
                throw new Error('Network response was not ok for leave balance snapshot');
            }
            return response.json();
        })
        .then(data => {
            console.log("Leave balance snapshot data received:", data);

            const tbody = document.querySelector('#leaveRecordsTable');
            tbody.innerHTML = ''; // Clear existing rows

            if (!data || data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align:center; color:#888;">
                        No Data Available
                    </td>
                `;
                tbody.appendChild(row);
            } else {
                data.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.leaveType}</td>
                        <td>${record.added || '0'}</td>
                        <td>${record.used || '0'}</td>
                        <td>${record.remaining || '0'}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('leaveDetailsModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching data:', error);

            const tbody = document.querySelector('#leaveRecordsTable');
            tbody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align:center; color:red;">
                        Error fetching data
                    </td>
                </tr>
            `;
        });
}


//function to display leave balance modal
function displayLeaveBalanceold(email){
	
    // Remove surrounding double quotes if they exist
    email = email.replace(/^"|"$/g, ''); 
	
	
	fetch(`/leaveRecords/${email}`, { method: 'GET' })
		                .then(response => {
		                    console.log("Fetch request sent for leave records");

		                    if (!response.ok) {
		                        throw new Error('Network response was not ok for leave records');
		                    }
		                    return response.json();
		                })
		                .then(data => {
		                    console.log("Leave records data received from backend:", data);

		                    const tbody = document.querySelector('#leaveRecordsTable');
		                    tbody.innerHTML = ''; // Clear existing rows

		                    if (!data || data.length === 0) {
		                        const sickLeaveRow = document.createElement('tr');
		                        sickLeaveRow.innerHTML = `
		                            <td>Sick Leave</td>
		                            <td>0</td>
		                            <td>0</td>
		                            <td>0</td>
		                        `;
		                        tbody.appendChild(sickLeaveRow);

		                        const casualLeaveRow = document.createElement('tr');
		                        casualLeaveRow.innerHTML = `
		                            <td>Casual Leave</td>
		                            <td>0</td>
		                            <td>0</td>
		                            <td>0</td>
		                        `;
		                        tbody.appendChild(casualLeaveRow);
		                    } else {
		                        data.forEach(record => {
		                            const row = document.createElement('tr');
		                            row.innerHTML = `
		                                <td>${record.leaveType}</td>
		                                <td>${record.totalAdded || '0'}</td>
		                                <td>${record.totalUsed || '0'}</td>
		                                <td>${record.remaining || '0'}</td>
		                            `;
		                            tbody.appendChild(row);
		                        });
		                    }
		                    return fetch('/fetchMaternityLeave/${email}', { method: 'GET' });
		                })
		                
		                 .then(() => fetch(`/calculate-earned-leave?year=${new Date().getFullYear()}&email=${email}`, { method: 'GET' }))
		                .then(response => {
		                	
		                    console.log("Fetch request sent for calculated earned leave");
		                    console.log("Fetch request sent for calculated earned leave");
		                    console.log("Calculated Earned Leave Response Status:", response.status);

		                    if (!response.ok) {
		                        throw new Error('Network response was not ok for calculated earned leave');
		                    }
		                    return response.json();
		                })
		                .then(earnedLeave => {
		                    console.log("Calculated leave data received from backend:", earnedLeave);

		                    const row = document.createElement('tr');
		                    row.innerHTML = `
		                        <td>Earned Leave</td>
		                        <td>${earnedLeave.earnedLeave || '0'}</td>
		                        <td>${earnedLeave.elUsed || '0'}</td>
		                        <td>${earnedLeave.elRemaining || '0'}</td>
		                    `;
		                    const tbody = document.querySelector('#leaveRecordsTable');
		                    tbody.appendChild(row);

		                    // Hide the spinner and show the modal
		                    loadingSpinner.style.display = "none";

		                    const modal = new bootstrap.Modal(document.getElementById('leaveDetailsModal'));
		                    modal.show();
		                })
		                .catch(error => {
		                    console.error('Error fetching data:', error);

		                    // Hide the spinner on error
		                    loadingSpinner.style.display = "none";
		                });
	
	const modal = new bootstrap.Modal(document.getElementById('leaveDetailsModal'));
    modal.show();
    
}

// Event listener for the Reject modal's confirm button
document.getElementById('confirmRejectButton').addEventListener('click', function() {
	
	var rejectionReason = document.getElementById('rejectionReason').value.trim();
	
	if(!rejectionReason){
		alert("Please enter a reason for rejection!");
		return;
	}
	
	if(rejectionReason.length < 6){
		alert("Please enter a valid reason!");
		return;
	}
	
	const loadingPopup = document.getElementById('loadingPopup');
    loadingPopup.style.display = 'flex'; // Show the overlay
    
    var leaveReason = document.getElementById('leaveReason').value;
    //alert(currentStatus);

    // Close the rejection modal
    var rejectModal = bootstrap.Modal.getInstance(document.getElementById('rejectModal'));
    rejectModal.hide();

    // Send the rejection data to the backend
    fetch('/admin/leaveApproveByAdmin', { 
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ empid: currentEmpId, status: 'Rejected', reason: rejectionReason, leaveReason: leaveReason })
    })
    .then(response => {
        if (response.ok) {
       	    
        	// Hide the loading popup
            loadingPopup.style.display = 'none';
            document.getElementById('successAction').innerText = "rejected";
            var successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
            
        } else {
            document.getElementById('errorAction').innerText = "rejecting";
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            errorModal.show();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('errorAction').innerText = "rejecting";
        var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.show();
    });
});

// Event listener for the OK button on the success modal
document.getElementById('successOkButton').addEventListener('click', function() {
    location.reload();  // Reload the page
});
</script>

<!-- script to apply the background color for pending leave requests -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Select all rows with the 'highlight-row' class
        var rows = document.querySelectorAll('.highlight-row');

        // Apply additional styles if needed
        rows.forEach(function(row) {
            row.style.backgroundColor = '#EBF5FB'; // Ensure background color
            row.style.color = 'black'; // Ensure text color
        });
    });
</script>
<!-- script to notification link redirect -->
<!-- <script th:inline="javascript">
    function redirectToLeaveRequest() {
        var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/viewAdminLeaves?empid=' + empid;
    }
    
    function redirectToAsset() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/asset';
    }
    function redirectToProject() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/ongoingProject';
    }
    function redirectToAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/apprisal?empid=' + empid;
    }
    function redirectToemployeeAppraisal() {
		var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
		window.location.href = '/employeeApprisal?empid=' + empid;
	}
    function redirectToAnnouncement() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/events';
    }
</script> -->



<!-- script for profile pic -->
<script>
$.ajax({
    type: "GET",
    url: "fetchEmployeeDocumentDetailsOnlyByEmpId",
    data: {
        "emp_id": $('#emp_idSessionValue').val()
    },
    success: function(data) {
    	// console.log("++++data"+JSON.stringify(data));
        $('#dynamicProfilePic').attr('src', `${data.profilePicPath}`);
    },
    error: function(xhr, status, error) {
        console.error("Error invoking data:", error);
    }
});
</script>

<!-- script to edit leave request -->
	<script th:inline="javascript">
	    /*<![CDATA[*/
	    var holidays = /*[[${holidays}]]*/ [];
	    console.log("lllkk"+holidays);  // To see the array in the console
	    /*]]>*/
	</script>

								
	<script>
	    // Convert holiday dates to a simple list of strings (e.g., 'YYYY-MM-DD')
		// Convert holiday dates to a simple list of strings (e.g., 'YYYY-MM-DD')
		   const holidayDates = holidays.map(holiday => {
		       // Assuming each holiday has a 'date' field in 'YYYY-MM-DD' format
		       return holiday.date ? new Date(holiday.date).toISOString().split('T')[0] : null;
		   }).filter(date => date !== null); // Filter out any invalid dates

	    // Shared error message div
	    const dateError = document.getElementById("dateErrorfromto");

	    // Function to check if a date is a Sunday
	    function isSunday(dateString) {
	        const date = new Date(dateString);
	        return date.getDay() === 0; // Sunday is day 0 in JavaScript
	    }

	    // Function to check if a date is a holiday
	    function isHoliday(dateString) {
	        return holidayDates.includes(dateString);
	    }

	    // Handle "From Date" and "To Date" fields
	    const fromDateField = document.getElementById("fromDate");
	    const toDateField = document.getElementById("toDate");

	    // Validate the selected date field for both Sundays and holidays
	    function validateDateField(field) {
	        if (isSunday(field.value) || isHoliday(field.value)) {
	            dateError.style.display = "block"; // Show error
	            field.value = ""; // Clear the invalid date
	        } else {
	            dateError.style.display = "none"; // Hide error
	        }
	    }

	    // Add event listeners to both date fields
	    fromDateField.addEventListener("input", function () {
	        validateDateField(this);
	    });

	    toDateField.addEventListener("input", function () {
	        validateDateField(this);
	    });

	    // Clear error message when modal is closed
	    const modal = document.getElementById("requestLeaveModal");
	    modal.addEventListener("hidden.bs.modal", function () {
	        // Reset error message and field values
	        dateError.style.display = "none";
	        fromDateField.value = "";
	        toDateField.value = "";
	    });
	</script>
<script>

function convertToISODate(dateString) {
    // Split the DD-MM-YYYY string into components
    const [day, month, year] = dateString.split('-');
    // Return the ISO format (YYYY-MM-DD)
    return `${year}-${month}-${day}`;
}
	function openEditModal(element) {
		// Retrieve data-* attributes from the clicked element
		
		//const id = element.getAttribute('data-id');
		const id = element.getAttribute('data-id');
	    const empId = element.getAttribute('data-emp-id');
	    const employeeName = element.getAttribute('data-employee-name');
	    const leaveType = element.getAttribute('data-leave-type');
	    const fromDate = element.getAttribute('data-from-date');
	    const toDate = element.getAttribute('data-to-date');
	    const reason = element.getAttribute('data-reason');
	    const duration = element.getAttribute('data-duration'); // New attribute
	    const email = element.getAttribute('data-email'); 
	    
	    console.log("Original to date= " + toDate);
		
	    // Convert dates to ISO format
	    const isoFromDate = convertToISODate(fromDate);
	    const isoToDate = convertToISODate(toDate);
		
	    // Assign default values to the form fields
	    document.getElementById('reqId').value = id;
	    document.getElementById('reqEmpId').value = empId;
	    document.getElementById('employeeNameInEditLeaveForm').value = employeeName;
	    //document.getElementById('leaveType').value = leaveType;
	    document.getElementById('fromDate').value = isoFromDate;
	    document.getElementById('toDate').value = isoToDate;
	    document.getElementById('reason').value = reason;
	    document.getElementById('candidateEmail').value = email;
	    
	    //const select = document.getElementById('leaveType');
	     
		 // Loop through the options and set selected
		//select.value = leaveType.trim();
	 
	    // Set the default duration
	    if (duration === 'Full Day') {
	        document.getElementById('fullDay').checked = true;
	    } else if (duration === 'Half Day') {
	        document.getElementById('halfDay').checked = true;
	    }
	
	    // Show the modal
	    const editModal = new bootstrap.Modal(document.getElementById('editModal'));
	    editModal.show();
	    leaveTypeUpdate(leaveType);
	    loadEmployeeDetails(email);
	  
	}


function leaveTypeUpdate(selectedLeaveType) {
	 
    let leaveBalances = { el: 0, sl: 0, cl: 0 };
    
    const leaveTypeSelect = document.getElementById('leaveType');
     
    //const gender = document.getElementById('employeeGender').value;
    var email=document.getElementById('candidateEmail').value;
	 
    // Fetch Earned Leave balance
    fetch(`/calculate-earned-leave?year=${new Date().getFullYear()}&email=${email}`)
        .then(response => response.json())
        .then(data => {
            if (data && data.elRemaining !== undefined) {
                leaveBalances.el = data.elRemaining;
            }
            console.log("Earned Leave fetched:", leaveBalances.el);
        });

    // Fetch Sick Leave and Casual Leave balance from array response
    fetch(`/leaveRecords/${email}`, { method: 'GET' })
        .then(response => response.json())
        .then(data => {
            if (Array.isArray(data)) {
                data.forEach(record => {
                    if (record.leaveType === 'Sick Leave') {
                        leaveBalances.sl = record.remaining || 0;
                    } else if (record.leaveType === 'Casual Leave') {
                        leaveBalances.cl = record.remaining || 0;
                    }
                });
            }
           // Call the common logic directly after data is fetched
            updateLeaveTypeOptions(leaveBalances,selectedLeaveType);
            console.log("SL & CL fetched:", leaveBalances.sl, leaveBalances.cl);
        });
}

document.addEventListener("DOMContentLoaded", function () {
    document.getElementById('toDate').addEventListener('change', function () {
        // Reuse the same leaveTypeUpdate logic
        leaveTypeUpdate();
    });//fromDate
    document.getElementById('fromDate').addEventListener('change', function () {
        // Reuse the same leaveTypeUpdate logic
        leaveTypeUpdate();
    });
});

function updateLeaveTypeOptions(leaveBalances, selectedLeaveType) {
    const fromDate = new Date(document.getElementById('fromDate').value);
    const toDate = new Date(document.getElementById('toDate').value);
    const leaveTypeSelect = document.getElementById('leaveType');

    if (fromDate && toDate && fromDate <= toDate) {
        const diffTime = toDate - fromDate;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;

        leaveTypeSelect.innerHTML = `<option value="">Select Leave Type</option>`;
        const addedOptions = new Set();
        let slAdded = false, clAdded = false;

        if (diffDays <= 2) {
            if (leaveBalances.sl >= diffDays && !addedOptions.has("SL")) {
                leaveTypeSelect.innerHTML += `<option value="SL">Sick Leave (SL)</option>`;
                addedOptions.add("SL");
                slAdded = true;
            }

            if (leaveBalances.cl >= diffDays && !addedOptions.has("CL")) {
                leaveTypeSelect.innerHTML += `<option value="CL">Casual Leave (CL)</option>`;
                addedOptions.add("CL");
                clAdded = true;
            }

            if (leaveBalances.cl === 0 && leaveBalances.sl === 1 && leaveBalances.el > 0 && diffDays === 2) {
                if (!addedOptions.has("EL")) {
                    leaveTypeSelect.innerHTML += `<option value="EL">Earned Leave (EL)</option>`;
                    addedOptions.add("EL");
                }
            }

            if (leaveBalances.sl === 0 && leaveBalances.cl === 1 && leaveBalances.el > 0 && diffDays === 2) {
                if (!addedOptions.has("EL")) {
                    leaveTypeSelect.innerHTML += `<option value="EL">Earned Leave (EL)</option>`;
                    addedOptions.add("EL");
                }
            }

            if (leaveBalances.sl === 1 && leaveBalances.cl === 1 && leaveBalances.el > 0 && diffDays === 2) {
                if (!addedOptions.has("EL")) {
                    leaveTypeSelect.innerHTML += `<option value="EL">Earned Leave (EL)</option>`;
                    addedOptions.add("EL");
                }
            }

            if (!slAdded && !clAdded) {
                if (leaveBalances.el >= diffDays && !addedOptions.has("EL")) {
                    leaveTypeSelect.innerHTML += `<option value="EL">Earned Leave (EL)</option>`;
                    addedOptions.add("EL");
                } else {
                    leaveTypeSelect.innerHTML += `<option value="LOP">Loss of Pay (LOP)</option>`;
                }
            }

            if (typeof gender !== "undefined" && gender === 'Female' && !addedOptions.has("ML")) {
                leaveTypeSelect.innerHTML += `<option value="ML">Maternity Leave (ML)</option>`;
                addedOptions.add("ML");
            }

        } else if (diffDays > 2 && diffDays <= 30) {
            const selectedValue = leaveBalances.el >= diffDays ? 'EL' : 'LOP';
            leaveTypeSelect.innerHTML = `
                <option value="EL" ${selectedValue === 'EL' ? 'selected' : ''}>Earned Leave (EL)</option>
                <option value="LOP" ${selectedValue === 'LOP' ? 'selected' : ''}>Loss of Pay (LOP)</option>
            `;
            validateLeave();
        }

        // ✅ Set selected leave type (e.g., "CL") after options are updated
        if (selectedLeaveType) {
            for (let i = 0; i < leaveTypeSelect.options.length; i++) {
                if (leaveTypeSelect.options[i].value === selectedLeaveType) {
                    leaveTypeSelect.selectedIndex = i;
                    break;
                }
            }
        }
    }
}


// function to disable the leaveTypeError after user select the leave type
function hideLeaveTypeError() {
    const leaveType = document.getElementById('leaveType').value;
    if (leaveType) {
        document.getElementById('leaveTypeError').style.display = 'none';
    }
}

function saveChanges() {
    const leaveType = document.getElementById('leaveType').value;
    
    // Validate leaveType
    if (!leaveType) {
        document.getElementById('leaveTypeError').style.display = 'block';
        return; // Stop submission
    } else {
        document.getElementById('leaveTypeError').style.display = 'none';
    }
    
    const updatedData = {
        id: document.getElementById('reqId').value,
        empid: document.getElementById('reqEmpId').value,
        employee_name: document.getElementById('employeeNameInEditLeaveForm').value,
        leaveType: document.getElementById('leaveType').value,
        from_date: document.getElementById('fromDate').value,
        to_date: document.getElementById('toDate').value,
        leaveDuration: document.querySelector('input[name="leaveDuration"]:checked')?.value,
        reason: document.getElementById('reason').value,
    };

    console.log('Updated Data:', updatedData); // Debug the payload

    fetch('/admin/updateLeaveRequest', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedData), // Send as JSON
    })
        .then(response => {
            if (response.ok) {
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal')); // Get the instance of the editModal
                editModal.hide(); // Close the editModal

                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show(); // Show the successModal
            } else {
                console.error('Failed to update leave request:', response.statusText);
            }
        })
        .catch(error => {
            console.error('Error during fetch:', error);
        });
}


</script>


<!-- script to search button on leave request table -->
<script>
document.getElementById("searchInput").addEventListener("keyup", function () {
    const input = this.value.toLowerCase();
    const rows = document.querySelectorAll("#holidayTable2 tbody tr");

    rows.forEach((row) => {
        const cells = Array.from(row.querySelectorAll("td"));

        if (!input) {
            // Clear highlights and show all rows if input is empty
            row.style.display = "";
            cells.forEach((cell) => {
                cell.innerHTML = cell.textContent; // Reset cell content
            });
        } else {
            let isMatch = false;
            cells.forEach((cell) => {
                const text = cell.textContent.toLowerCase();

                if (text.includes(input)) {
                    isMatch = true;

                    // Highlight the matched text
                    const regex = new RegExp(`(${input})`, "gi");
                    cell.innerHTML = cell.textContent.replace(regex, `<span class="highlight">$1</span>`);
                } else {
                    // Remove highlights if no match in this cell
                    cell.innerHTML = cell.textContent;
                }
            });

            // Show or hide the row based on matches
            row.style.display = isMatch ? "" : "none";
        }
    });
});

</script>
<!-- script to search proccesed table -->
<script>
document.getElementById("searchInput").addEventListener("keyup", function () {
    const input = this.value.toLowerCase();
    const rows = document.querySelectorAll("#holidayTable3 tbody tr");

    rows.forEach((row) => {
        const cells = Array.from(row.querySelectorAll("td"));

        if (!input) {
            // Clear highlights and show all rows if input is empty
            row.style.display = "";
            cells.forEach((cell) => {
                cell.innerHTML = cell.textContent; // Reset cell content
            });
        } else {
            let isMatch = false;
            cells.forEach((cell) => {
                const text = cell.textContent.toLowerCase();

                if (text.includes(input)) {
                    isMatch = true;
                    // Highlight the matched text
                    const regex = new RegExp(`(${input})`, "gi");
                    cell.innerHTML = cell.textContent.replace(regex, `<span class="highlight">$1</span>`);
                } else {
                    // Remove highlights if no match in this cell
                    cell.innerHTML = cell.textContent;
                }
                
            });

            // Show or hide the row based on matches
            row.style.display = isMatch ? "" : "none";
        }
    });
});

</script>


<!-- script to notification on bottom of the page-->
<!--CHAT BOOT-->

		<!-- Include SockJS and Stomp.js libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- script to notification on bottom of the page-->
<script>
		//CODE FOR CHATBOOT NOTIFICATION 
		var stompClient = null;
		var employeeMap = {}; // To store the mapping of employee names to emails
		let employeePhotoMap = {};
		let emailToNameMap = {}; // New map for email -> name lookup
		var email = null;
		var visibilityState = document.visibilityState; // Track tab visibility
		var heartbeatInterval = null; // Track heartbeat interval

		function connectWebSocket() {
			
			var socket = new SockJS('/chat-websocket');
						  stompClient = Stomp.over(socket);

						  var email = document.getElementById('loggedInMail').value;
						  console.log(`Connecting WebSocket as: ${email}`);

						  stompClient.connect({ 'email': email }, function (frame) {
						      console.log('Connected to WebSocket:', frame);

							 // subscribeToTypingEvents();
						      // Mark user as active
						      stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));

						      // Subscribe to active users list
						      stompClient.subscribe('/topic/activeUsers', function (message) {
						          var activeUsers = JSON.parse(message.body);
						          updateActiveUserUI(activeUsers);
						      });
							  // Subscribe to user messages
							        stompClient.subscribe('/user/queue/messages', function (message) {
									//	loadMessages();
									//	alert("po2");
							            console.log('Raw WebSocket Message:11', message);
							            var msg = JSON.parse(message.body);
										//alert(msg);
							            console.log('Parsed Messag111e:', msg);
							            console.log(`Received messagesdsd: ${JSON.stringify(msg)}`);
										//alert("(message.read"+msg.read);
									
							            // Display message if it matches the selected employee
							            if (selectedEmployee === msg.senderEmail || selectedEmployee === msg.recipientEmail) {
											console.log(`New message fromss ${msg.senderEmail}: ${msg.content}`);
											console.log("plk "+selectedEmployee);
											console.log("plk "+msg.senderEmail);
											console.log("plk "+msg.recipientEmail);
											//loadMessages();
							                showMessage(
							                    msg.id,               // Message ID
							                    msg.senderEmail,      // Sender's email
							                    msg.content,          // Message content
							                    msg.recipientEmail,   // Recipient's email
							                    msg.timestamp,        // Message timestamp
							                    email,
												msg.read                    // Logged-in user's email
							                );
							            }
								
										loadEmployees();
										loadMessages();
									 	
							        });

							        // Subscribe to notifications
							        stompClient.subscribe('/user/queue/notifications', function (notification) {
										//alert("00");
							            console.log('New Notification:', notification.body);
							            showToastNotification(notification.body);
										loadEmployees();
										//alert("01");
							        });

									//alert("Subscribing to chat updates...");
									stompClient.subscribe('/user/queue/messages', function (message) {
									    console.log('WebSocket Chat Update Received:', message.body); // Log raw message

									    let parsedMessage = JSON.parse(message.body);
									    console.log('Parsed Message:', parsedMessage); // Log parsed JSON

									    if (Array.isArray(parsedMessage)) {
									        parsedMessage.forEach(msg => {
									            console.log(`Message ID: ${msg.id}, Read: ${msg.read}`);
									            if (msg.read) {
									                updateMessageUI(msg);
									            }
									        });
									    } else {
									        console.log("Unexpected message format:", parsedMessage);
									    }

									    // Refresh messages after a delay
									    setTimeout(() => {
									        console.log("Refreshing messages...");
									        loadMessages();
									    }, 3000);
									});

									stompClient.subscribe('/topic/typing', function (message) {
									    console.log("📩 Typing notification received:", message.body);

									    let typingData;
									    try {
									        typingData = JSON.parse(message.body);
									        console.log("✅ Parsed Typing Data:", typingData);
									    } catch (error) {
									        console.error("❌ Error parsing typing notification message:", error);
									        return;
									    }

									    let loggedInUserEmail = document.getElementById('loggedInMail')?.value;
									    if (!loggedInUserEmail) return;

									    if (loggedInUserEmail === typingData.recipientEmail && typingData.senderEmail === selectedEmployee) {
									        // Fetch actual typing status from the backend
									        fetch(`/getTypingStatus?senderEmail=${typingData.senderEmail}&recipientEmail=${typingData.recipientEmail}`)
									            .then(response => response.json())
									            .then(data => {
									                console.log("🎯 Actual Typing Status from DB:", data.typing);
													console.log("🎯 Actual Typing Status from DB:", data);
													                console.log("ℹ️ Typing Status (0 or 1):", data.typing);
													                
									                let chatMessages = document.querySelector(".chat-history ul");
									                let chatContainer = document.querySelector(".chat-history"); // The scrollable chat area

									                let typingIndicator = document.getElementById("typingIndicator");
									                
									                if (!typingIndicator) {
									                    typingIndicator = document.createElement("li");
									                    typingIndicator.id = "typingIndicator";
									                    typingIndicator.classList.add("typing-indicator");
									                    typingIndicator.innerHTML = `
									                        <img src="${employeePhotoMap[selectedEmployee] || 'default-profile.jpg'}" alt="User Photo" class="typing-photo">
									                        <span>Typing...</span>
									                    `;
									                    chatMessages.appendChild(typingIndicator);
									                }

									                if (data.typing === 1) { // Ensure it checks the latest typing status
									                    typingIndicator.style.display = "flex";

									                    // Move typing indicator to the bottom
									                    chatMessages.appendChild(typingIndicator);

									                    // Auto-scroll to the bottom
									                    setTimeout(() => {
									                        chatContainer.scrollTop = chatContainer.scrollHeight;
									                    }, 100);
									                } else {
									                    typingIndicator.style.display = "none";
									                }
									            })
									            .catch(error => console.error("❌ Error fetching typing status:", error));
									    }
									});


						      // Start heartbeat initially
						      heartbeatInterval = setInterval(() => {
						          if (stompClient && stompClient.connected) {
						              stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						              console.log("Heartbeat sent for user: " + email);
						          }
						      }, 20000); // 30 seconds

						      // Detect tab visibility change
						  /*    document.addEventListener("visibilitychange", function () {
						          if (document.hidden) {
						              console.log("User switched to another tab. Marking as inactive.");
						              stompClient.send("/app/userInactive", {}, JSON.stringify({ email }));
						              clearInterval(heartbeatInterval); // Stop heartbeat
						              heartbeatInterval = null;
						          } else {
						              console.log("User returned to the application tab. Marking as active.");
						              stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));
						              if (!heartbeatInterval) {
						                  heartbeatInterval = setInterval(() => {
						                      if (stompClient && stompClient.connected) {
						                          stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						                          console.log("Heartbeat sent for user: " + email);
						                      }
						                  }, 30000);
						              }
						          }
						      });*/

						      // Detect tab close or WebSocket disconnect
						      socket.onclose = function () {
						          console.log("WebSocket disconnected. Updating user status.");
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      };

						      window.addEventListener('beforeunload', function () {
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      });

						  });
		}

		function updateActiveUserUI(activeUsers) {
		//	alert("1");
		    const employeeItems = document.getElementById('employeeNames').getElementsByTagName('li');

		    Array.from(employeeItems).forEach(item => {
		        const employeeName = item.querySelector('span').textContent;
		        const email = employeeMap[employeeName]; 
		        const statusIndicator = item.querySelector('.status-indicator'); // Get the status dot

		        if (activeUsers.includes(email)) {
		            item.classList.add('active-user');
		            statusIndicator.style.backgroundColor = '#66cc66'; // Green for active users
		        } else {
		            item.classList.remove('active-user');
		            statusIndicator.style.backgroundColor = '#ff6666'; // Red for inactive users
		        }

		        // If this employee is currently selected, update chat header status
				if (selectedEmployee === email) {
				           const chatStatusIndicator = document.getElementById('chatStatusIndicator');
				           if (activeUsers.includes(email)) {
				               chatStatusIndicator.style.backgroundColor = '#66cc66'; // Green (Online)
				           } else {
				               chatStatusIndicator.style.backgroundColor = '#ff6666'; // Red (Offline)
				           }
				       }
		    });
		}


		// Select an employee to chat with
		function selectEmployee(employeeName) {
			selectedEmployee = employeeMap[employeeName]; // Get the email from the map
			console.log(`Employee selected: ${selectedEmployee}`);

			// Highlight the selected employee
			var employeeItems = document.querySelectorAll('#employeeNames li');
			employeeItems.forEach(function (item) {
				item.classList.remove('active');
			});
			var selectedItem = Array.from(employeeItems).find(item => item.innerHTML === employeeName);
			if (selectedItem) {
				selectedItem.classList.add('active');
			}

			// Update chat header with employee name and photo
			document.querySelector('.chat-about h6').innerText = employeeName;
			document.querySelector('#employeePhoto').src = employeePhotoMap[selectedEmployee] || 'default-profile.jpg';

			// Hide the message icon and dots when an employee is selected
			document.getElementById('message-icon-container').style.display = 'none';
			// Hide the paragraph when an employee is selected
			document.getElementById('logo-text').style.display = 'none';

			// Load messages for the selected employee
			loadMessages();
		}

		function loadEmployees() {
			console.log("Loading employee names...");

			// Fetch employee names from the endpoint
			fetch('/employees/names')
				.then(response => {
					console.log("Response received:", response);
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(data => {
					console.log("Employee data fetched:", data); // Log the raw data

					const employeeList = document.getElementById('employeeNames');
					if (!employeeList) {
						console.error("Element with ID 'employeeNames' not found.");
						return;
					}

					employeeList.innerHTML = ''; // Clear the list before adding new items

					// Iterate through employee data
					data.forEach(employee => {
						console.log("Processing employee:", employee);

						// Create a list item for each employee
						const li = document.createElement('li');
						li.classList.add('d-flex', 'align-items-center', 'employee-item');

						// Handle missing or empty profile photo paths
						const profilePic = employeePhotoMap[employee.email] || '/static/default-profile.jpg';
						console.log(`Profile picture for ${employee.name}: ${profilePic}`);

						li.innerHTML = `
			                    <img src="${profilePic}" 
			                         alt="Employee Photo" 
			                         class="employee-photo mr-2" />
			                    <span>${employee.name}</span>
			                `;

						// Map employee name to email
						employeeMap[employee.name] = employee.email;
						console.log("Mapped employee:", employee.name, "->", employee.email);
						// Add new reverse mapping (email -> name)
						emailToNameMap[employee.email] = employee.name;
						// Add click event to list item
						li.onclick = () => {
							console.log(`Selected employee: ${employee.name}`);
							selectEmployee(employee.name);
						};

						// Append the list item to the employee list
						employeeList.appendChild(li);

					});

					console.log("Employee names loaded successfully. Employee map:", employeeMap);
					// Call the unread messages function after loading employee data
					fetchUnreadMessages();

					// Set interval to check for new messages every 10 seconds
						setInterval(fetchUnreadMessages, 10000);
				})
				.catch(error => {
					console.error("Error loading employees:", error);
				});
		}


		function loadMessages() {
			// alert("Loading messages...");
			// Get the logged-in user's email and selected employee's email
			var loggedInEmail = document.getElementById('loggedInMail').value;
			var selectedEmployeeEmail = selectedEmployee; // Email is already stored in selectedEmployee

			console.log(`Loading messages between: ${loggedInEmail} and ${selectedEmployeeEmail}`);

			fetch(`/messages?loggedInEmail=${encodeURIComponent(loggedInEmail)}&selectedEmployeeEmail=${encodeURIComponent(selectedEmployeeEmail)}`)
				.then(response => response.json())
				.then(data => {
					console.log("Chat messages loaded:", data);
					// Clear the chat window before displaying messages
					var chatWindow = document.getElementById('chat-window').querySelector('ul');
					chatWindow.innerHTML = '';

					// Display messages
					data.forEach(function (msg) {
						// showMessage(msg.senderEmail, msg.content, msg.recipientEmail, loggedInEmail);
						showMessage(msg.id, msg.senderEmail, msg.content, msg.recipientEmail, msg.timestamp, loggedInEmail);
					});
				})
				.catch(error => console.error("Error loading chat messages:", error));
		}
		let activeDeleteDropdown = null;
		function showMessage(id, senderEmail, message, recipientEmail, timestamp, loggedInEmail) {
			console.log("Message ID:", id);
			console.log(`LoggedInEmailrrr: ${loggedInEmail}, SenderEmail: ${senderEmail}`);

			const isSender = senderEmail === loggedInEmail;
			const senderName = isSender ? "Me" : Object.keys(employeeMap).find(name => employeeMap[name] === senderEmail) || senderEmail;
			const senderPhoto = employeePhotoMap[senderEmail] || 'default-avatar.png';
			const formattedTime = new Date(timestamp).toLocaleString(); // Format timestamp

			console.log(`Message ID: ${id}, Time: ${formattedTime}, From: ${senderEmail}, To: ${recipientEmail}, Content: "${message}"`);

			var chatWindow = document.getElementById('chat-window').querySelector('ul');
			var li = document.createElement('li');
			li.className = isSender ? 'clearfix right' : 'clearfix left';

			li.innerHTML = `
					    <div class="message-container" data-message-id="${id}" onclick="toggleDeleteOption(this)">
					        <img class="sender-photo" src="${senderPhoto}" alt="Sender Photo" />
					        <div class="message ${isSender ? 'my-message' : 'other-message'}">
					            <strong>${senderName}:</strong> ${message}
					        </div>
					    </div>
					    <div class="timestamp" style="text-align: ${isSender ? 'right' : 'left'};">
					        ${formattedTime}
					    </div>
					    ${isSender ? `
					        <div class="message-action-dropdown" >
					            <a class="dropdown-item" href="#" onclick="deleteMessage(this, ${id})">Delete Message</a>
					        </div>
					    ` : ''}`;

			chatWindow.appendChild(li);
			chatWindow.scrollTop = chatWindow.scrollHeight;
		}
		
		/*function fetchUnreadMessages() {
			console.log("Fetching unread messages...");
			var loggedInEmail = document.getElementById('loggedInMail').value;

			fetch(`/unread?email=${loggedInEmail}`)
				.then(response => response.json())
				.then(messages => {
					messages.forEach(message => {
						let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;

						// Show notification with sender's email as a parameter
						showToastNotification(`New message from ${senderName}: ${message.content}`, message.senderEmail);
					});
				})
				.catch(error => console.error("Error fetching unread messages:", error));
		}*/

		let displayedMessageIds = new Set(); // Track displayed messages
		let closedMessageIds = new Set(); // Track closed messages

		function fetchUnreadMessages() {
		    console.log("Fetching unread messages...");
		    var loggedInEmail = document.getElementById('loggedInMail').value;

		    fetch(`/unread?email=${loggedInEmail}`)
		        .then(response => response.json())
		        .then(messages => {
		            messages.forEach(message => {
		                console.log("Processing message ID:", message.id); // Print message ID to console
		                
		                // Ignore messages that were previously closed
		                if (!displayedMessageIds.has(message.id) && !closedMessageIds.has(message.id)) {
							//alert(1);
		                    let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;
		                    showToastNotification(`New message from ${senderName}: ${message.content}`, message.id, message.senderEmail);
		                    displayedMessageIds.add(message.id); // Mark message as displayed
		                }
						//alert(2);
		            });
		        })
		        .catch(error => console.error("Error fetching unread messages:", error));
		}
		// Global flag to track if the user manually dismissed notifications
		
		/*function showToastNotification(message, senderEmail) {
			
			var toastContainer = document.createElement('div');
			toastContainer.className = 'toast-notification';

			// Add message and close button
			toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">✖</span>`;

			document.body.appendChild(toastContainer);

			// Animate in
			setTimeout(() => {
				toastContainer.classList.add('show');
			}, 100);

			// Auto-hide after 8 seconds
			let autoHideTimeout = setTimeout(() => closeToast(toastContainer), 10000);

			// Prevent opening chat when clicking the close button
			toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
				event.stopPropagation(); // Prevent click from bubbling to toastContainer
				clearTimeout(autoHideTimeout);
				
				closeToast(toastContainer);
			});

			// Open chat when clicking on the notification
			toastContainer.addEventListener('click', () => {
				openChatWithSender(senderEmail);
				closeToast(toastContainer); // Remove notification when chat opens
			});
		}*/
		function showToastNotification(message, messageId, senderEmail) {
			//alert(1);
		    var toastContainer = document.createElement('div');
		    toastContainer.className = 'toast-notification';
		    toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">✖</span>`;

		    document.body.appendChild(toastContainer);

		    // Animate in
		    setTimeout(() => {
		        toastContainer.classList.add('show');
		    }, 100);

		    // Auto-hide after 8 seconds
		    let autoHideTimeout = setTimeout(() => closeToast(toastContainer, messageId), 8000);

		    // Prevent opening chat when clicking the close button
		    toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
		        event.stopPropagation(); // Prevent click from bubbling to toastContainer
		        clearTimeout(autoHideTimeout);
		        closedMessageIds.add(messageId); // Mark as closed so it won't be shown again
		        closeToast(toastContainer, messageId);
		    });

		    // Open chat when clicking on the notification
		    toastContainer.addEventListener('click', () => {
		        openChatWithSender(senderEmail);
		        closeToast(toastContainer, messageId); // Remove notification when chat opens
		    });
		}

		// Function to handle toast closing
		/*function closeToast(toast) {
			toast.classList.remove('show');
			setTimeout(() => toast.remove(), 300); // Faster fade-out
		}*/
		// Function to handle toast closing and mark as dismissed
		// Function to handle toast closing
		function closeToast(toast, messageId) {
		    toast.classList.remove('show');
		    setTimeout(() => toast.remove(), 300); // Faster fade-out
		}
		/*	function openChatWithSender(senderEmail) {
				console.log("Opening chat with:", senderEmail);
			    
				// Construct the URL for the UserFavorite page with the senderEmail as a query parameter
				const url = `/my-favorites?email=${encodeURIComponent(senderEmail)}`;
			    
				// Redirect to the UserFavorite page
				window.location.href = url;
			}*/

		function openChatWithSender(senderEmail) {
			console.log("Opening chat with:", senderEmail);

			// Store sender email in sessionStorage
			sessionStorage.setItem("chatSenderEmail", senderEmail);

			// Redirect to the UserFavorite page
			window.location.href = `/my-favorites`;
		}

		// Connect to the WebSocket server and load employees when the page is loaded
		document.addEventListener('DOMContentLoaded', function () {
			//fetchUnreadMessages();
			loadEmployees();
			connectWebSocket();
		});

	</script>
<!-- script to pagination -->
<!-- <script>
let rowsPerPage = 5; // Default rows per page
let currentPage = 1;

document.addEventListener("DOMContentLoaded", function () {
    const table = document.getElementById("holidayTable2");
    const tbody = table.querySelector("tbody");
    const rows = Array.from(tbody.querySelectorAll("tr")).filter(row => {
        return row.getAttribute("data-way") === "1"; // Filter rows based on the condition
    });
    
    function showPage(page) {
        const totalRows = rows.length;
        
        // If "All" is selected, display all rows
        if(rowsPerPage === "All") {
            rows.forEach(row => row.style.display = "");
            return;
        }
        
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach((row, index) => {
            row.style.display = index >= start && index < end ? "" : "none";
        });

        renderPagination(page, totalRows);
    }

    function renderPagination(currentPage, totalRows) {
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";  // Clear previous pagination

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement("button");
            button.textContent = i;
            button.style.margin = "0 5px";
            button.style.padding = "5px 10px";
            button.style.border = "1px solid #ccc";
            button.style.cursor = "pointer";
            button.style.backgroundColor = i === currentPage ? "#007bff" : "#fff";
            button.style.color = i === currentPage ? "#fff" : "#000";

            button.addEventListener("click", () => {
                currentPage = i;
                showPage(i);
            });
            pagination.appendChild(button);
        }
    }

    // Function to update rows per page
    function updateRowsPerPage() {
        const selectedValue = document.getElementById("rowsPerPage").value;
        rowsPerPage = selectedValue === "All" ? "All" : parseInt(selectedValue, 10);
        showPage(1);  // Show the first page after updating rows per page
    }

    // Initialize the table with the first page
    showPage(currentPage);
    
    // Bind the rows per page dropdown change event
    document.getElementById("rowsPerPage").addEventListener("change", updateRowsPerPage);
});
</script>


script to pagination for proccesed table
<script>
let rowsPerPage1 = 5; // Default rows per page
let currentPage1 = 1;

document.addEventListener("DOMContentLoaded", function () {
    const table = document.getElementById("holidayTable3");
    const tbody = table.querySelector("tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));
    
    function showPage(page) {
        const totalRows = rows.length;
        
        // If "All" is selected, display all rows
        if (rowsPerPage1 === "All") {
            rows.forEach(row => row.style.display = "");
            return;
        }
        
        const start = (page - 1) * rowsPerPage1;
        const end = start + rowsPerPage1;

        rows.forEach((row, index) => {
            row.style.display = index >= start && index < end ? "" : "none";
        });

        renderPagination(page, totalRows);
    }

    function renderPagination(currentPage1, totalRows) {
        const totalPages = Math.ceil(totalRows / rowsPerPage1);
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";  // Clear previous pagination

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement("button");
            button.textContent = i;
            button.style.margin = "0 5px";
            button.style.padding = "5px 10px";
            button.style.border = "1px solid #ccc";
            button.style.cursor = "pointer";
            button.style.backgroundColor = i === currentPage1 ? "#007bff" : "#fff";
            button.style.color = i === currentPage1 ? "#fff" : "#000";

            button.addEventListener("click", () => {
                currentPage1 = i;
                showPage(i);
            });
            pagination.appendChild(button);
        }
    }

    // Function to update rows per page
    function updateRowsPerPage() {
        const selectedValue = document.getElementById("rowsPerPage1").value;
        rowsPerPage1 = selectedValue === "All" ? "All" : parseInt(selectedValue, 10);
        showPage(1);  // Show the first page after updating rows per page
    }

    // Initialize the table with the first page
    showPage(currentPage1);
    
    // Bind the rows per page dropdown change event
    document.getElementById("rowsPerPage1").addEventListener("change", updateRowsPerPage);
});
</script> -->

<!-- script to sort proccessed table -->
<!-- <script>
$(document).ready(function () {
    $('#holidayTable2').DataTable({
    	scrollX: true,
        paging: true, // Disable pagination
        order: [], // Default no sorting
        columnDefs: [
            { orderable: true, targets: [0, 2, 3,4,5,6,7,8] }, // Enable sorting for Sl No and Employee Id
            { orderable: false, targets: '_all' } // Disable sorting for other columns
        ]
    });
});
</script>

script to sort Unproccessed table
<script>
$(document).ready(function () {
    $('#holidayTable3').DataTable({
    	scrollX: true,
        paging: true, // Disable pagination
        order: [], // Default no sorting
        columnDefs: [
            { orderable: true, targets: [0, 2, 3,4,5,6,7,8] }, // Enable sorting for Sl No and Employee Id
            { orderable: false, targets: '_all' } // Disable sorting for other columns
        ]
    });
});
</script>
<script>
$(document).ready(function () {
    $('#rejectedLeaves').DataTable({
        paging: true, // Enable pagination
        pageLength: 10, // Number of rows per page (default is 10)
        lengthChange: true, // Allow changing the number of rows per page
        scrollX: true, // Enable horizontal scrolling
        order: [], // Default no sorting
        columnDefs: [
            { orderable: true, targets: [0, 2, 3, 4, 5, 6, 7, 8] }, // Enable sorting for specific columns
            { orderable: false, targets: '_all' } // Disable sorting for other columns
        ]
    });
});
</script> -->

<!-- script to enable or disable the search button based on active tab -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Add event listeners for the tab buttons
    document.querySelectorAll('.nav-tabs button').forEach((button) => {
        button.addEventListener('click', function () {
            // Hide all search boxes
            document.getElementById("searchUnapproved").style.display = "none";
            document.getElementById("searchApproved").style.display = "none";
            document.getElementById("searchRejected").style.display = "none";

            // Show the search box corresponding to the active tab
            if (this.id === "home-tab") {
                document.getElementById("searchUnapproved").style.display = "block";
            } else if (this.id === "profile-tab" && this.getAttribute("data-bs-target") === "#bordered-justified-profile") {
                document.getElementById("searchApproved").style.display = "block";
            } else if (this.id === "profile-tab" && this.getAttribute("data-bs-target") === "#bordered-justified-rejected") {
                document.getElementById("searchRejected").style.display = "block";
            }
        });
    });
});
</script>

<!-- script to search box for unapproved text box -->
<script>

document.querySelector('.searchUnprovedTable').addEventListener('click', function () {
    document.querySelector('.searchUnprovedTable_inputSearch').focus();
});

function searchUnprovedTable() {
    var input, filter, table, tr, td, i, j, txtValue, regex;
    
    input = document.querySelector(".searchUnprovedTable_inputSearch");
    filter = input.value.trim(); // Get search text
    if (!filter) {
        resetUnprovedTableHighlight(); // Reset highlights if input is empty
        return;
    }

    regex = new RegExp(`(${filter})`, "gi"); // Case-insensitive regex for search

    table = document.querySelector("#holidayTable2");
    if (!table) return;
    
    tr = table.getElementsByTagName("tr");
    for (i = 1; i < tr.length; i++) { // Skip header row
        tr[i].style.display = "none"; // Hide row initially
        td = tr[i].getElementsByTagName("td");
        let rowMatched = false;

        for (j = 0; j < td.length; j++) {
            if (j === 1) continue; // Skip "Action" columns

            if (td[j]) {
                let originalContent = td[j].getAttribute("data-original"); // Get stored original text
                if (!originalContent) {
                    originalContent = td[j].innerHTML; // Store original content
                    td[j].setAttribute("data-original", originalContent);
                }

                txtValue = td[j].textContent || td[j].innerText;

                if (txtValue.toUpperCase().includes(filter.toUpperCase())) {
                    tr[i].style.display = ""; // Show row if a match is found
                    rowMatched = true;

                    // Highlight only text, preserving existing icons and HTML
                    let highlightedText = txtValue.replace(regex, `<span class="highlight">$1</span>`);
                    td[j].innerHTML = originalContent.replace(txtValue, highlightedText);
                } else {
                    td[j].innerHTML = originalContent; // Restore original content if no match
                }
            }
        }

        if (!rowMatched) {
            tr[i].style.display = "none"; // Hide row if no matches
        }
    }
}

// Function to reset table highlights and restore original content
function resetUnprovedTableHighlight() {
    var table = document.querySelector("#holidayTable2");
    if (!table) return;

    var tdElements = table.getElementsByTagName("td");
    for (var i = 0; i < tdElements.length; i++) {
        let originalContent = tdElements[i].getAttribute("data-original");
        if (originalContent) {
            tdElements[i].innerHTML = originalContent;
        }
    }
}

</script>

<!-- script to search box for approved text box -->
<script>

/* document.querySelector('.searchApprovedTable').addEventListener('click', function () {
    document.querySelector('.searchApprovedTable_inputSearch').focus();
  });

    function searchApprovedTable() {
    	var input, filter, table, tr, td, i, j, txtValue;
        
        input = document.querySelector(".searchApprovedTable_inputSearch");
        filter = input.value.toUpperCase();
        
        //table = document.getElementById("customTable");
        table = document.querySelector("#holidayTable3");
        if (!table) return;
        
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            
            for (j = 0; j < td.length; j++) {
            	if (j === 11) continue; // Skip the "Approved By" column (zero-based index)
            	
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        break;
                    }
                }
            }
            
        }
    }  */  
    document.querySelector('.searchApprovedTable').addEventListener('click', function () {
        document.querySelector('.searchApprovedTable_inputSearch').focus();
      });
    
    function searchApprovedTable() {
        var input, filter, table, tr, td, i, j, txtValue, regex;
        
        input = document.querySelector(".searchApprovedTable_inputSearch");
        filter = input.value.trim(); // Get search text
        if (!filter) {
            resetTableHighlight(); // Reset highlights if input is empty
            return;
        }

        regex = new RegExp(`(${filter})`, "gi"); // Case-insensitive regex for search

        table = document.querySelector("#holidayTable3");
        if (!table) return;
        
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) { // Start from index 1 to skip header row
            tr[i].style.display = "none"; // Hide row initially
            td = tr[i].getElementsByTagName("td");
            let rowMatched = false;

            for (j = 0; j < td.length; j++) {
                if (j === 1 || j === 11) continue; // Skip "Action" & "Approved By" columns

                if (td[j]) {
                    let originalContent = td[j].getAttribute("data-original"); // Get stored original text
                    if (!originalContent) {
                        originalContent = td[j].innerHTML; // Store original content
                        td[j].setAttribute("data-original", originalContent);
                    }

                    txtValue = td[j].textContent || td[j].innerText;

                    if (txtValue.toUpperCase().includes(filter.toUpperCase())) {
                        tr[i].style.display = ""; // Show the row if a match is found
                        rowMatched = true;

                        // Highlight only the text inside the cell, preserving HTML structure
                        let highlightedText = txtValue.replace(regex, `<span class="highlight">$1</span>`);
                        td[j].innerHTML = originalContent.replace(txtValue, highlightedText);
                    } else {
                        td[j].innerHTML = originalContent; // Restore original content if no match
                    }
                }
            }

            if (!rowMatched) {
                tr[i].style.display = "none"; // Hide row if no matches
            }
        }
    }

    // Function to reset table highlights and restore original content
    function resetTableHighlight() {
        var table = document.querySelector("#holidayTable3");
        if (!table) return;

        var tdElements = table.getElementsByTagName("td");
        for (var i = 0; i < tdElements.length; i++) {
            let originalContent = tdElements[i].getAttribute("data-original");
            if (originalContent) {
                tdElements[i].innerHTML = originalContent;
            }
        }
    }

</script>

<!-- script to search box for rejected text box -->
<script>
	document.querySelector('.searchRejectedTable').addEventListener('click', function () {
	    document.querySelector('.searchRejectedTable_inputSearch').focus();
	});

/*     function searchRejectedTable() {
        
    	var input, filter, table, tr, td, i, j, txtValue;
        
        input = document.querySelector(".searchRejectedTable_inputSearch");
        filter = input.value.toUpperCase();
        
        //table = document.getElementById("customTable");
        table = document.querySelector("#rejectedLeaves");
        if (!table) return;
        
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            for (j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }  */
    
    function searchRejectedTable() {
        var input, filter, table, tr, td, i, j, txtValue, regex;
        
        input = document.querySelector(".searchRejectedTable_inputSearch");
        filter = input.value.trim(); // Get search text
        if (!filter) {
            resetRejectedTableHighlight(); // Reset highlights if input is empty
            return;
        }

        regex = new RegExp(`(${filter})`, "gi"); // Case-insensitive regex for search

        table = document.querySelector("#rejectedLeaves");
        if (!table) return;
        
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) { // Skip header row
            tr[i].style.display = "none"; // Hide row initially
            td = tr[i].getElementsByTagName("td");
            let rowMatched = false;

            for (j = 0; j < td.length; j++) {
                if (j === 1) continue; // Skip "Action" 

                if (td[j]) {
                    let originalContent = td[j].getAttribute("data-original"); // Get stored original text
                    if (!originalContent) {
                        originalContent = td[j].innerHTML; // Store original content
                        td[j].setAttribute("data-original", originalContent);
                    }

                    txtValue = td[j].textContent || td[j].innerText;

                    if (txtValue.toUpperCase().includes(filter.toUpperCase())) {
                        tr[i].style.display = ""; // Show row if a match is found
                        rowMatched = true;

                        // Highlight only text, preserving existing icons and HTML
                        let highlightedText = txtValue.replace(regex, `<span class="highlight">$1</span>`);
                        td[j].innerHTML = originalContent.replace(txtValue, highlightedText);
                    } else {
                        td[j].innerHTML = originalContent; // Restore original content if no match
                    }
                }
            }

            if (!rowMatched) {
                tr[i].style.display = "none"; // Hide row if no matches
            }
        }
    }

    // Function to reset table highlights and restore original content
    function resetRejectedTableHighlight() {
        var table = document.querySelector("#rejectedLeaves");
        if (!table) return;

        var tdElements = table.getElementsByTagName("td");
        for (var i = 0; i < tdElements.length; i++) {
            let originalContent = tdElements[i].getAttribute("data-original");
            if (originalContent) {
                tdElements[i].innerHTML = originalContent;
            }
        }
    }

</script>

<!-- script to validate leave balance before while editing leave request -->
<script>
function loadEmployeeDetails(email,selectedLeaveType) {
	console.log("DOMContentLoaded event fired!");

	// Initialize leave balances
	let leaveBalances = {
		sl: 0,
		cl: 0,
		el: 0
	}; 
	
	// Fetch leave balances when the modal opens
	const requestLeaveBtn = document.getElementById("requestLeaveBtn");
	 
		console.log("Request Leave button clicked. Fetching leave balances...");

		//var email = document.getElementById('employeeEmail1').value;
		fetch(`/leaveRecords/${email}`) 
			.then(response => response.json())
			.then(data => {
				data.forEach(record => {
					if (record.leaveType === "Sick Leave") {
						leaveBalances.sl = record.remaining;
					} else if (record.leaveType === "Casual Leave") {
						leaveBalances.cl = record.remaining;
					}
				});
				console.log("Leave balances fetched:", leaveBalances);
			})
			.then(() => {
				return fetch(`/calculate-earned-leave?year=${new Date().getFullYear()}&email=${email}`);
			})
			.then(response => response.json())
			.then(data => {
				if (data && data.elRemaining !== undefined) {
					leaveBalances.el = data.elRemaining;
				}
				console.log("Earned Leave fetched:", leaveBalances.el);
			})
			.then(() => {
				    								    var email = document.getElementById('employeeEmail1').value;
				    								   
                                                        // Fetch future leave applications
                                                        return fetch(`/getFutureLeaveApplications/${email}`);
                                                    })
                                                    .then(response => response.json())
                                                    .then(futureLeaves => {
                                                        console.log("Fetched future leave applications:", futureLeaves);

                                                        // Adjust leave balances based on future leaves
                                                        futureLeaves.forEach(leave => {
                                                            if (leave.approvedstatus !== "Rejected") { // Ignore rejected leave requests
	                                                            
                                                            	const leaveFromDate = new Date(leave.from_date);
	                                                            const leaveToDate = new Date(leave.to_date);
	                                                            
	                                                            const leaveDaysRequested = calculateLeaveDuration(leaveFromDate, leaveToDate);
															    
	                                                            console.log("leaveDaysRequested="+leaveDaysRequested);
	                                                            console.log("leaveBalances[leave.leaveType.toLowerCase()]="+leaveBalances[leave.leaveType.toLowerCase()]);
															    
	                                                            leaveBalances[leave.leaveType.toLowerCase()] -= leaveDaysRequested;
                                                            }
                                                        });
                                                        console.log("Adjusted leave balances after considering future leaves:", leaveBalances);
                                                    })
			.catch(error => {
				console.error('Error fetching data:', error);
			});
	
		
     
	
    // Real-time validation elements
	const fromDateInput = document.getElementById("fromDate");
	const toDateInput = document.getElementById("toDate");
	const leaveTypeInput = document.getElementById("leaveType");
	const errorMessageDiv = document.getElementById("error-message");
	const submitButton = document.getElementById("submitBtn"); 
	
	// ✅ Set the selected leave type AFTER initializing the element
	leaveTypeInput.value = selectedLeaveType;
	
	 // Function to calculate the duration of leave
    function calculateLeaveDuration(fromDate, toDate) {
        return Math.round((toDate - fromDate) / (1000 * 60 * 60 * 24)) + 1; // Include end date
    }
	 
	// Function to check if two dates are in the same financial year
	function isSameFinancialYear(fromDate, toDate) {
		// Financial year starts on 26 March and ends on 25 March the next year
		const fromYear = fromDate.getFullYear();
		const toYear = toDate.getFullYear();

		const financialYearStart = new Date(fromYear, 2, 26); // 26 March
		const financialYearEnd = new Date(fromYear + 1, 2, 25); // 25 March next year

		// If the "From Date" is before 26 March of the financial year and "To Date" is after, it's invalid
		if (fromDate < financialYearStart && toDate > financialYearStart) {
			return false; // Crosses the financial year boundary
		}

		// Adjust the next financial year if needed
		const nextFinancialYearStart = new Date(toYear, 2, 26);
		const nextFinancialYearEnd = new Date(toYear + 1, 2, 25);

		if (fromDate < nextFinancialYearStart && toDate > nextFinancialYearStart) {
			return false; // Crosses to the next financial year
		}

		return true;
	}

	// Function to validate leave including financial year check
	function validateLeave() {
		 
		const fromDate = new Date(fromDateInput.value);
		const toDate = new Date(toDateInput.value);
		const selectedLeaveType = leaveTypeInput.value;

		// Only validate if all fields are selected/filled
		if (!fromDateInput.value || !toDateInput.value || !selectedLeaveType) {
			errorMessageDiv.style.display = "none"; // Hide error message until all fields are filled
			submitButton.disabled = true;
			return;
		}
		
		//alert(selectedLeaveType);
		// If the selected leave type is LOP, bypass validation
		if (selectedLeaveType === "LOP") {
			 
			errorMessageDiv.style.display = "none";
			submitButton.disabled = false;
			return;
			
		}

		const leaveDaysRequested = Math.round((toDate - fromDate) / (1000 * 60 * 60 * 24)) + 1; // Include the end date
		let availableLeaveDays = 0;

		// Calculate available leave days based on the selected leave type
		if (selectedLeaveType === "SL") {
			availableLeaveDays = leaveBalances.sl;
		} else if (selectedLeaveType === "CL") {
			availableLeaveDays = leaveBalances.cl;
		} else if (selectedLeaveType === "EL") {
			availableLeaveDays = leaveBalances.el;
		}

		// Validate financial year boundaries
		if ((selectedLeaveType !== "ML" && selectedLeaveType !== "EL") && !isSameFinancialYear(fromDate, toDate)) {
			 
			errorMessageDiv.textContent = "You cannot request leave that crosses into the next financial year. Please select dates within the same financial year.";
			errorMessageDiv.style.display = "block";
			submitButton.disabled = true;
			return;
		}

		// Validation logic for leave days and available balance
		if (fromDate > toDate) {
			// Display error if "From Date" is later than "To Date"
			errorMessageDiv.textContent = "Invalid Date Range: 'From Date' should not be later than 'To Date'.";
			errorMessageDiv.style.display = "block";
			submitButton.disabled = true;
		} else if (selectedLeaveType !== "ML" && leaveDaysRequested > availableLeaveDays) {
			// Display error if requested leave days exceed available leave days
			errorMessageDiv.textContent = `You do not have enough leave balance for ${selectedLeaveType}. Available: ${availableLeaveDays}, Requested: ${leaveDaysRequested}`;
			errorMessageDiv.style.display = "block";
			submitButton.disabled = true;
		} else {
			// Hide error message and enable submit button if validation passes
			errorMessageDiv.style.display = "none";
			submitButton.disabled = false;
		}
	}
	
	// Add event listeners for real-time validation on date and leave type changes
	fromDateInput.addEventListener("change", validateLeave);
	toDateInput.addEventListener("change", validateLeave);
	leaveTypeInput.addEventListener("change", validateLeave);

	// Reset form validation on modal close/reset
	const leaveForm = document.getElementById("leaveForm");
	leaveForm.addEventListener("reset", function () {
		errorMessageDiv.style.display = "none"; // Hide error message
		submitButton.disabled = false; // Enable submit button
	});
}
</script>
	
	<script>
		/*VALIDATING THE FROMDATE AND TO DATE  i.e this function is check that to date should not be less than  from date */
		// Function to validate the date fields
		function validateDate() {
			
			const fromDate = document.getElementById('fromDate').value;
			const toDate = document.getElementById('toDate').value;
			const dateError = document.getElementById('dateError');
			const submitBtn = document.getElementById('submitBtn');

			if (fromDate && toDate) {
				
				// Compare the dates
				if (new Date(toDate) < new Date(fromDate)) {
					// Show error if To Date is earlier than From Date
					dateError.style.display = 'block';
					submitBtn.disabled = true;
				} else {
					// Hide error and enable submit button if dates are valid
					dateError.style.display = 'none';
					submitBtn.disabled = false;
				}
			}
		}

		// Add event listeners to the date fields
		document.getElementById('fromDate').addEventListener('input', validateDate);
		document.getElementById('toDate').addEventListener('input', validateDate);
		

		// Optional: Prevent form submission if dates are invalid
		document.getElementById('leaveForm').addEventListener('submit', function (event) {
			if (document.getElementById('submitBtn').disabled) {
				event.preventDefault();
			}
		});

		/*TO REMOVE THE ERROR MESSAGE OF DATE ERROR WHEN CLOSING THE MODAL*/
		// Event listener for when the modal is hidden (closed)
		const leaveModal = document.getElementById('requestLeaveModal');
		leaveModal.addEventListener('hidden.bs.modal', function (event) {
			
			// Hide the error message when the modal is closed
			const dateError = document.getElementById('dateError');
			dateError.style.display = 'none'; // Hide the error message
			document.getElementById('maternityLeaveError').style.display = 'none'; // Hide maternity leave error

			// Optionally, reset the form if you want to clear all input fields
			document.getElementById('leaveForm').reset();

		});

		/*TO CLEAR THE ERROR MESSAGE OF DATEOVERLAP*/
		// Clear the error message when the modal is closed
		document.getElementById('requestLeaveModal').addEventListener('hidden.bs.modal', () => {
			document.getElementById('dateOverlap').style.display = 'none';
		});

		// Hide the error message when the date fields change
		document.getElementById('fromDate').addEventListener('change', hideErrorMessage);
		document.getElementById('toDate').addEventListener('change', hideErrorMessage);

		function hideErrorMessage() {
			document.getElementById('dateOverlap').style.display = 'none'; // Hide error message
			document.getElementById('maternityLeaveError').style.display = 'none';
		}

		// Function to disable past dates for date inputs
		/*document.addEventListener('DOMContentLoaded', function () {
			const today = new Date().toISOString().split('T')[0];
			document.getElementById('fromDate').setAttribute('min', today);
			document.getElementById('toDate').setAttribute('min', today);

			// Optional: Ensure "To" date cannot be earlier than "From" date
			//  document.getElementById('fromDate').addEventListener('change', function() {
			//	  const fromDateValue = this.value;
			//	  document.getElementById('toDate').setAttribute('min', fromDateValue);
			//  });
		});*/

	</script>
	 
	<script>
	function handleApproveClick(elem) {
	    const requestId = elem.dataset.id;
	    const status = elem.dataset.status;
	    const reason = elem.dataset.reason;
	    
	    approveLeave(requestId, status, reason);
	}
	</script>
</body>
</html>