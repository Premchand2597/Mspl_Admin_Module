<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Product List</title>
<!-- <link rel="stylesheet"	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script	src="https://cdn.jsdelivr.net/npm/datatables.net/js/jquery.dataTables.min.js"></script>
<script	src="https://cdn.jsdelivr.net/npm/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
<link rel="stylesheet"  href="https://cdn.jsdelivr.net/npm/datatables.net-bs5/css/dataTables.bootstrap5.min.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> --> 

<!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <!-- <link href="https://fonts.gstatic.com" rel="preconnect"> -->
  <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet"> -->
  
  <link rel="stylesheet" href="/assets/font/fonts.css"> 
  
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  
  <!--   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->
  <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
  <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  
  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> --> 
  <script src="assets/js/jquery-3.6.4.min.js"></script> 
  
</head>

<style>

/* Style pagination */
.dataTables_wrapper .dataTables_paginate .paginate_button {
	padding: 5px 10px;
	margin: 2px;
	border-radius: 5px;
	border: 1px solid #007bff;
	color: #007bff;
	background: white;
	transition: 0.3s;
	cursor: default;
}

.dataTables_wrapper .dataTables_paginate .paginate_button.current {
	background: #007bff !important;
	color: white !important;
}

.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
	background: #0056b3 !important;
	color: white !important;
	cursor: default;
}

.dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
	color: #999 !important;
	border-color: #ddd;
}

/* Custom ellipsis style */
.paginate_button.ellipsis {
	cursor: default;
	border: none;
	background: none;
	color: #999;
	padding: 5px 10px;
}

/* Ensure pagination stays at the bottom */
.dataTables_wrapper .dataTables_info {
	float: left;
}

.dataTables_wrapper .dataTables_paginate {
	float: right;
}


#employeeTable th {
	        vertical-align: middle; /* Ensures consistent vertical alignment */
	        text-align:center;
	        background-color:#E9EAEC;
	       
	    }
 
	    
</style>

<body>
	<div id="searchUnapproved" class="search-box m-1 mt-3" style="float:right">
				<button class="btn-search searchUnprovedTable" title="Search" ><i class="bi bi-search"></i></button>
				<input type="text" oninput="searchUnprovedTable();" class="input-search searchUnprovedTable_inputSearch" placeholder="Search...">
	</div>
	<div class="container-fluid mt-2" style="overflow-x: auto; max-height: 90vh;">
		<!-- <h4 class="text-center mb-0">Product List</h4> -->

		<table id="productTable"
			class="table text-center table-hover table-responsive" style="font-size:12px;">
			<thead class="table-primary text-center" style="position:sticky;top:0;z-index:2;">
				<tr>
					<th class="text-center table-responsive">SL No</th>
					<th class="text-center table-responsive">Edit</th>
					<th class="text-center table-responsive">Delete</th>
					<th class="text-center table-responsive">Date Time</th>
					<th class="text-center table-responsive">Product ID</th>
					<th style="display: none;" class="text-center table-responsive">Product Name</th>
					<th class="text-center table-responsive">HSN Code</th>
					<th class="text-center table-responsive">Part Number</th>
					<th class="text-center table-responsive">Description</th>
					<th class="text-center table-responsive">Remarks</th>
				</tr>
			</thead>
			<tbody >
				<tr th:each="product, serialNo : ${products}">
					<td class="text-center table-responsive" th:text="${serialNo.count}"></td>
					<td class="text-center table-responsive">
						<img src="/assets/img/edit.png" alt="Update" width="15" height="15" title="edit" style="cursor: pointer;" onclick="editProduct(this)">
					</td>
					<td class="text-center table-responsive">
						<img src="assets/img/delete.png" alt="Delete" width="15" height="15" title="Delete" style="cursor: pointer;" th:attr="onclick='deleteProduct(\'' + ${product.pid} + '\')'">
					</td>
					<td style="min-width: 120px;" class="text-center table-responsive " th:text="${product.dateTime}"></td>
					<td style="min-width: 140px;" class="text-center table-responsive" th:text="${product.pid}"></td>
					<td style="display: none;" th:text="${product.pname}"></td>
					<td class="text-center table-responsive" th:text="${product.hsn_code}"></td>
					<td style="min-width: 140px;" class="text-center table-responsive" th:text="${product.part_number}"></td>
					<td class="text-center table-responsive" th:text="${product.pdescription}"></td>
					
					<td class="text-center table-responsive" th:text="${product.remarks}"></td>
				</tr>
			</tbody>
		</table>
	</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Edit Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <!-- Modal Body -->
      <div class="modal-body">
        <form id="productForm">
          <input type="hidden" id="editRowIndex"> <!-- Stores row index for update -->

       <div class="row mb-3 justify-content-between">
						<div class="col-md-3">			
							<input type="text" class="form-control" id="product_id" placeholder="Product ID" disabled autocomplete="off" />
						</div>
						<div class="col-md-4 text-end">			
							<input type="text" class="form-control" id="pdateTime" autocomplete="off"/>
						</div>
					</div>
					<div class="row mb-3">
						<div class="col-md-4" style="display: none;">
							<label for="productName" class="form-label">Product Name</label>
							<input type="text" class="form-control" id="product_name" placeholder="Enter Product Name" autocomplete="off"/>
						</div>
						<div class="col-md-6">
							<label for="productName" class="form-label">HSN Code</label>
							<input type="text" class="form-control" id="hsn_code" placeholder="Enter HSN Code" autocomplete="off"/>
						</div>
						<div class="col-md-6">
							<label for="productName" class="form-label">Part Number</label>
							<input type="text" class="form-control" id="part_number" placeholder="Enter Part Number" autocomplete="off"/>
						</div>								
					</div>		
					
					<div class="row mb-3">
					<div class="col-md-6">
							<label for="productDescription" class="form-label">Product Description</label>
							<textarea type="text" class="form-control" id="product_description" autocomplete="off"
								placeholder="Enter Product Description" ></textarea>
						</div>	
						
							<div class="col-md-6">
							<label for="remarks" class="form-label">Remarks</label>
							<textarea type="text" class="form-control" id="remarks" autocomplete="off"
								placeholder="Enter Remarks" ></textarea>
						</div>	
					</div>	
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveProduct()">Save Changes</button>
      </div>
    </div>
  </div>
</div>


	<script>
		$(document)
				.ready(
						function() {
							var table = $('#productTable')
									.DataTable(
											{
												"paging" : true,
												"searching" : true,
												"scrollX" : true, // Enable horizontal scrolling
												"lengthMenu" : [ 8, 15, 25, 50,
														75, 100, 200, 500, 800,
														1000 ],
														"ordering": true,
														
												"pageLength" : 8,
												"pagingType" : "full_numbers",
												// "info": true,
												"dom" : '<"d-flex justify-content-between mb-2"l f>t<"d-flex justify-content-between mt-2"i p>',
												
												
												
												
												
												
											});

							// Ensure pagination stays at the bottom even when scrolling
							//  $('.dataTables_paginate').parent().css('overflow', 'visible');
						});
		
		window.onunload = function(){ window.scrollTo(0,0); }
	</script>

	
	<script>
function editProduct(button) {
    // Get the row where the button was clicked
    var row = button.closest('tr');
    var rowIndex = row.rowIndex - 1; // Adjusting for header row

    // Extract data from row cells
    var datetime = row.cells[3].innerText;
    var productID = row.cells[4].innerText;
    var productName = row.cells[5].innerText;
    var hsnCode = row.cells[6].innerText;
    var partNumber = row.cells[7].innerText;
    var description = row.cells[8].innerText;
    var remarks = row.cells[9].innerText;
    
   // alert(productID);

    // Populate modal fields
    document.getElementById("editRowIndex").value = rowIndex;
    document.getElementById("pdateTime").value = datetime;
    document.getElementById("product_id").value = productID;
    document.getElementById("product_name").value = productName;
    document.getElementById("hsn_code").value = hsnCode;
    document.getElementById("part_number").value = partNumber;
    document.getElementById("product_description").value = description;
    document.getElementById("remarks").value = remarks;

    // Show the modal
    var productModal = new bootstrap.Modal(document.getElementById('productModal'));
    productModal.show();
}

</script>

<script>
function saveProduct() {
    // Get the product ID (Primary Key)
    var productID = document.getElementById("product_id").value;
	var dateTime = document.getElementById("pdateTime").value;
    // Get updated values from modal
    var productName = document.getElementById("product_name").value;
    var hsnCode = document.getElementById("hsn_code").value;
    var partNumber = document.getElementById("part_number").value;
    var description = document.getElementById("product_description").value;
    var remarks = document.getElementById("remarks").value;

    // Create an object to send to the server
    var productData = {
        pid: productID,
        dateTime : dateTime,
        pname: productName,
        hsn_code: hsnCode,
        part_number: partNumber,
        pdescription: description,
        remarks: remarks
    };
    
   // alert(JSON.stringify(productData));

    // Send AJAX request to update the product in the database
    fetch("/updateProduct", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(productData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Find the row in the table and update it
            var table = document.getElementById("productTable");
            var rowIndex = document.getElementById("editRowIndex").value;
            var row = table.rows[rowIndex];

            row.cells[2].innerText = productName;
            row.cells[3].innerText = hsnCode;
            row.cells[4].innerText = partNumber;
            row.cells[5].innerText = description;
            row.cells[6].innerText = remarks;

            // Close the modal
            var productModal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
            productModal.hide();
            alert("Updated the product Successfully !");
            location.reload();
        } else {
            alert("Failed to update product!");
        }
    })
    .catch(error => console.error("Error:", error));
}
</script>

	<script>
	function deleteProduct(productId) {
	    if (confirm("Are you sure you want to delete this product?")) {
	        $.ajax({
	            url: '/deleteProduct',  // Send request to `/deleteProduct`
	            type: 'POST',           // Change method to POST
	            data: { id: productId }, // Send `id` as form data
	            success: function(response) {
	                alert(response.message);  // Show success message
	                location.reload();
	            },
	            error: function(xhr) {
	                alert("Error: " + xhr.responseText);
	            }
	        });
	    }
	}


	</script>
<!-- script to search box for unapproved text box -->
<script>

document.querySelector('.searchUnprovedTable').addEventListener('click', function () {
    document.querySelector('.searchUnprovedTable_inputSearch').focus();
  });

    function searchUnprovedTable() {
        
    	var input, filter, table, tr, td, i, j, txtValue;
        
        input = document.querySelector(".searchUnprovedTable_inputSearch");
        filter = input.value.toUpperCase();
        
        //table = document.getElementById("customTable");
        table = document.querySelector("#productTable");
        if (!table) return;
        
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            for (j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }    
</script>

 
</body>
</html>
