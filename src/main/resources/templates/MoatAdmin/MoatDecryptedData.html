<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>

  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Interview</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
<!--   <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
 -->
   <link rel="stylesheet" href="/assets/font/fonts.css"> 
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">
  <!-- Template Main JS File -->
<!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
  <script src="assets/js/jquery-3.6.4.min.js"></script> 

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <style>
        body {
            margin: 0;
            padding: 0;
        }

        .decryptLoginPage {
            width: 98%;
            height: 80vh;
            padding: 10px;
        }
        
        .decryptedData{
        	background: #f2f3f4;
        	padding: 10px;
        }
    </style> 
</head>
<body>

<input type="hidden" id="encyDataValue" th:value="${encryptData}">
<input type="hidden" id="candidate_emailValue" th:value="${candidate_email}">
<input type="hidden" id="test_durationValue" th:value="${test_duration}">
<input type="hidden" id="supervisor_nameValue" th:value="${supervisor_name}">

  <main id="moatMain" class="moatMain">
  
			<section class="section dashboard">
				<div class="col-lg-12">
					<div class="decryptLoginPage">
					    <div class="decryptedData"></div>
					</div>
				</div>
			</section>

	</main><!-- End #main -->

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>


<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>


<script>
    
function decryptAndDisplayData() {
    var encryptedData = document.getElementById("encyDataValue").value.trim();
    
    // Debug the raw data
  //  alert("Raw Encrypted Data: '" + encryptedData + "'");

    if (encryptedData && encryptedData !== 'Data not found') {
        try {
            // Parse the decrypted data using URLSearchParams
            //var params = new URLSearchParams(encryptedData);

            // Get the parameters
            //var names = params.get('name');
           // var email = params.get('email');
           // var testDuration = params.get('testDuration');
           
           	var names = document.getElementById('supervisor_nameValue').value;
            var email = document.getElementById('candidate_emailValue').value;
            var testDuration = document.getElementById('test_durationValue').value;

            // Remove extra quotes from phone number if present
            if (testDuration) {
            	testDuration = testDuration.replace(/["']*$/, ''); 
            }

            // Manually handle if name is null or if URLSearchParams fails
            /* if (!names) {
               // alert("Name is null. Trying to extract it manually.");

                // Manually extract the name field if URLSearchParams failed
                var regex = /name=([^&]*)/;
                var match = encryptedData.match(regex);
                if (match && match[1]) {
                    names = decodeURIComponent(match[1]); // decode in case of encoding
                }
            } */
            
           // alert("Parsed Values: Name = " + names + ", Email = " + email + ", Phone = " + phone);

            // Display the decrypted data
            var decryptedDiv = document.querySelector(".decryptedData");
            decryptedDiv.innerHTML = `
            	<h2>Test Detail</h2>
                <p>Supervisor Name: ${names || '-'}</p>
                <p>Candidate Email: ${email || '-'}</p>
                <p>Test Duration: ${testDuration ? testDuration + ' min' : '-'}</p>
            `;
        } catch (e) {
            alert("Error parsing data: " + e.message);
            document.querySelector(".decryptedData").innerHTML = "<p>Error parsing data.</p>";
        }
    } else {
        document.querySelector(".decryptedData").innerHTML = "<p>No valid data found.</p>";
    }
}

document.addEventListener("DOMContentLoaded", decryptAndDisplayData);

</script>

</body>

</html>