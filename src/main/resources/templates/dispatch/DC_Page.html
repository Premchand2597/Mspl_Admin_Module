<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Master</title>
    
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>
<style>
/* Navbar container */
	.navbar {
		    position: fixed;
		    top: 0;
		    right: 0;
		    background-color: #EBECF0; /* Darker shade for a professional look */
		    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		    z-index: 1000;
		    width: 100%; /* Full width navbar */
		    padding: 12px 4px;
		    display: flex;
		    align-items: center;
		    justify-content: flex-start; /* Align entire content to the right */
		    box-sizing: border-box;
		}

/* Navbar list style */
.navbar ul {
    display: flex;
    justify-content: flex-end; /* Align items to the right */
    padding: 0;
    margin: 0;
    list-style: none;
    gap: 5px;
}

/* Navbar item */
.navbar li {
    padding: 10px 18px;
    border-radius: 5px;
    cursor: pointer;
    color: black; /* Light color text */
    font-size: 14px;
    font-weight: 600;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.navbar li a{
			text-decoration:none;
			color:black;
		}
		/* Hover effect */
		.navbar li:hover {
		    background-color: #F8F8FF; /* Bright blue for hover effect */
		    color: white;
		    transform: translateY(-2px); /* Slightly lift on hover */
		}

/* Active link style */
.navbar li.active {
    background-color: #F8F8FF; /* Bright blue for hover effect */
	font-weight: bold;
}

/* Navbar icons */
.navbar li i {
    margin-right: 8px;
}

/* Optional: Add a little space between the navbar and the top of the page */
body {
    margin-top: 70px; /* Adjust based on navbar height */
}

/* Mobile responsiveness (optional) */
@media (max-width: 768px) {
    .navbar {
        width: 100%;
        border-radius: 0;
    }

    .navbar ul {
        justify-content: center; /* Center content on smaller screens */
    }

    .navbar li {
        margin: 0 10px;
    }
}

	  .tables-container {
	    width: 96%;
	    margin: 2px auto; 
	    padding: 20px;
	    overflow-x: auto;
	}
	
	.table-box {
	    background: white;
	    padding: 10px;
	    box-sizing: border-box;
	    border: 1px solid #ccc;
	}
	
	table th,td{
		font-size: 14px;
	}
	
	.form-section h4{
		font-size: 18px;
	}
	
	.form-section label,input,textarea,a{
		font-size: 14px;
	}
	
	.modal-header h5{
		font-size: 18px;
	}
	
	.modal-header button{
		font-size: 14px;
	}
	
   .emailPasswordOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 101;
   	display: none;
   	pointer-events: auto;
   }
   
.emailPasswordInnerBox{
	width: 30%;
   	height: auto;
   	background: rgb(255,255,255);
   	margin: 6% auto 0 auto;
   	border-radius: 5px;
   	overflow: auto;
   	pointer-events: auto;
   	padding: 10px;
}

  .sendEmailForCustomerOuterDiv{
   	width: 100%;
   	height: 100%;
   	position: fixed;
   	background: rgba(0,0,0,0.5);
   	top: 0;
   	left: 0;
   	z-index: 100;
   	display: none;
   	pointer-events: auto;
   }
   
  .sendEmailForCustomerInnerBox{
	width: 40%;
   	height: 80%;
   	background: rgb(255,255,255);
   	margin: 6% auto 0 auto;
   	border-radius: 5px;
   	overflow: auto;
   	pointer-events: auto;
   	padding: 10px;
}
   
   .sendEmailForCustomerBodyBox{
   	width: 100%;
   	height: 90%;
   	background: #fff;
   	overflow: auto;
   }
   
   #loadingPopup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Dim background */
    z-index: 9999;
    font-family: Arial, sans-serif;
    color: white; /* Text color for better contrast */
    display: none;
}

#loadingPopup p {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    color: white;
}

.spinnerAndParaMerger{
	display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    /* background: red; */
    margin: 18% auto;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 6px solid rgba(255, 255, 255, 0.3); /* Semi-transparent border */
    border-top-color: white; /* Bright top border */
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.user-dropdown {
    position: absolute;
    top: 50px; /* adjust as needed */
    left: 10px;
    background-color: white;
    border: 1px solid #ccc;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    border-radius: 8px;
    z-index: 1000;
    width: auto;
}

.user-dropdown ul {
    list-style: none;
    margin: 0;
    padding: 0;
     display: flex;
    flex-direction: column;
    align-items: center;
}

.user-dropdown ul li {
    padding: 15px;
    border-bottom: 1px solid #eee;
}

.user-dropdown ul li:hover {
    background-color: #F8F8FF; /* Bright blue for hover effect */
    color: #000;
}

.user-dropdown ul li:last-child {
    border-bottom: none;
}

.user-dropdown ul li a {
    text-decoration: none;
    color: #333;
}

.user-dropdown ul li a i {
    margin-right: 10px;
}

.dispatch_subDropDown {
    display: none;
    position: absolute;
    background-color: #EBECF0;
    width: auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    z-index: 1000;
    top: 50px; /* adjust as needed */
}

.dispatch_subDropDown ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.dispatch_subDropDown ul li {
    padding: 5px;
    border-bottom: 1px solid #eee;
}

.dispatch_subDropDown ul li:hover {
    background-color: #F8F8FF; /* Bright blue for hover effect */
    color: #000;
}

.dispatch_subDropDown ul li:last-child {
    border-bottom: none;
}

.dispatch_subDropDown ul li a {
    text-decoration: none;
    color: #333;
}
   
</style>
</head>
<body>

<div id="loadingPopup">
	<div class="spinnerAndParaMerger">
	    <div class="spinner"></div>
	    <p id="loadingPopupPara"></p>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="generateNewDcDispatchModal" tabindex="-1" aria-labelledby="dispatchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content" style="overflow-y: auto;">
        <div class="modal-header">
          <h5 class="modal-title" id="dispatchModalLabel">Generate New Delivery Challan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
		<!-- <input type="hidden" id="auto_id_dispatch_hidden_text"> -->
          <!-- User Details -->
          <div class="form-section">
            <h4>User Details</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">User Name:</label>
                <div class="d-flex">
                  <!-- <input type="text" class="form-control" id="dcUserName"> -->
                  <select class="form-select" name="userName" id="dcUserNamePopup">
				        <option value="">Select User Name</option>
				        <option th:each="un : ${distinctUserNames}" th:value="${un.emp_full_name}" th:text="${un.emp_full_name}"></option>
				    </select>
                  <!-- <a href="#" class="ms-2 mt-1 action-link" data-bs-toggle="modal" data-bs-target="#userModal">Add User</a> -->
                </div>
              </div>

              <!-- <div class="col-md-6">
                <label class="form-label">Transport Mode:</label>
                <select class="form-select" th:field="*{transportMode}" required>
                  <option value="">Select Transport Mode</option>
                  <option th:each="mode : ${transportModes}" th:value="${mode}" th:text="${mode}"></option>
                </select>
              </div> -->
              
              <div class="col-md-6">
				    <label class="form-label">Transport Mode:</label>
				    <div class="d-flex" style="gap: 10px;">
				    <!-- <input type="text" class="form-control" id="dcTransportMode"> -->
				    <select class="form-select" id="dcTransportModePopup"></select>
				    	<!-- <div style="display: flex; justify-content: space-around;">
						    <a href="#" style="text-decoration: none;" class="action-link">
						    	<i data-bs-toggle="modal" data-bs-target="#userModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
						    </a>
						    <a id="transportDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
						    	<i title="Delete" onclick="deleteTransportModeData($('#transportModeDropDown').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
						    </a>
					    </div> -->
				    </div>
				</div>

              <div class="col-md-6">
                <label class="form-label">Invoice No:</label>
                <input type="text" class="form-control" id="dcInvoiceNoPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Date:</label>
                <input type="date" class="form-control" id="dcDeliveryDatePopup">
              </div>
              
              <div class="col-md-6">
                <label class="form-label">Dc No:</label>
                <input type="text" class="form-control" id="dcNoPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">eWay Bill No:</label>
                <input type="text" class="form-control" id="dcEWayBillNoPopup">
              </div>

            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Billing Details</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Buyer (Biller To):</label>
                <textarea class="form-control" rows="2" id="dcBillerToAddressPopup"></textarea>
              </div>

               <div class="col-md-6">
                <label class="form-label">Delivery Address:</label>
                <textarea class="form-control" rows="2" id="dcDeliveryAddressPopup"></textarea>
              </div>

            </div>
          </div>
          
          <!-- Customer Details -->
          <div class="form-section mt-4">
            <h4>Customer Details</h4>
            <div class="row g-3">
              
              <!-- <div class="col-md-6">
                <label class="form-label">Customer Name:</label>
                <div class="d-flex">
                  <select class="form-select me-2" id="customerNameDropdown" name="customerNameDropdown" onchange="fetchCustomerDetails()">
                    <option value="">Select Customer</option>
                    <option th:each="customer : ${customers}" th:value="${customer.customerName}" th:text="${customer.customerName}"></option>
                  </select>
                  <a href="#" class="action-link" data-bs-toggle="modal" data-bs-target="#customerModal">Add Customer</a>
                </div>
                <input type="hidden" id="customerName" th:field="*{customerName}">
              </div> -->
              
              <div class="col-md-6">
                <label class="form-label">Customer Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select me-2" id="dcCustomerNamePopup" onchange="fetchCustomerDetailsForDcGenerate()">
			            <option value="">Select Contact Name</option>
			            <option th:each="customer : ${customers}" th:value="${customer.customerName}" th:text="${customer.customerName}"></option>
			        </select>
			        <!-- <input type="text" class="form-control" id="dcCustomerName"> -->
			    	<!-- <div style="display: flex; justify-content: space-around;">
					    <a href="#" style="text-decoration: none;" class="action-link">
					    	<i data-bs-toggle="modal" data-bs-target="#customerModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
					    </a>
					    <a id="contactNameDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
					    	<i title="Delete" onclick="deleteContactNameData($('#customerNameDropdown').val(), $('#emailId').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
					    </a>
				    </div> -->
				</div>
			</div>

              <div class="col-md-6">
                <label class="form-label">Company Name:</label>
                <input type="text" class="form-control" id="dcCompanyNamePopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Contact No:</label>
                <input type="number" class="form-control" id="dcContactNoPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Email ID:</label>
                <input type="email" class="form-control" id="dcEmailIdPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Company Address:</label>
                <textarea class="form-control" rows="2" id="dcCompanyAddressPopup"></textarea>
              </div>
            </div>
          </div>

          <!-- Product Details -->
          <div class="form-section mt-4">
          
          <div class="d-flex align-items-center justify-content-between">
          	<h4>Product Details</h4>
          </div>
            
            <div class="row border bg-light" id="productBox1" style="padding-bottom: 10px; border-radius: 10px;">
            	<div class="d-flex align-items-center justify-content-between">
		          	<p></p>
		          	<i style="font-size: 18px; cursor: pointer;" id="addRow1" onclick="toggleAddProductBox(1)" title="Add more row" class="fa-solid fa-plus text-success"></i>
		        </div>
              <div class="col-md-3">
		    	<label class="form-label">Product Name with Model No:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName1" onchange="fetchProductDetails(1)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
				</select>
					<!-- <input type="text" class="form-control" id="dcProductName"> -->
			    	<!-- <div style="display: flex; justify-content: space-around;">
					    <a href="#" style="text-decoration: none;" class="action-link">
					    	<i data-bs-toggle="modal" data-bs-target="#productModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
					    </a>
					    <a id="productNameDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
					    	<i title="Delete" onclick="deleteProductDetailsData($('#productNameDropdown').val(), $('#moduleNo').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
					    </a>
				    </div> -->
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal1">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion1">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(1);" min="0" class="form-control" id="dcPrice1">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(1);" min="0" class="form-control" id="dcQuantity1">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice1" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription1"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath1">
			  </div>
            </div>
            
            
         <div class="row border bg-light mt-4" id="productBox2" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	 <div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(2)" id="addRow2" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(2)" id="deleteRow2" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName2" onchange="fetchProductDetails(2)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal2">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion2">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(2);" min="0" class="form-control" id="dcPrice2">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(2);" min="0" class="form-control" id="dcQuantity2">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice2" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription2"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath2">
			  </div>
            </div>
            
	          
          <div class="row border bg-light mt-4" id="productBox3" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(3)" id="addRow3" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(3)" id="deleteRow3" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName3" onchange="fetchProductDetails(3)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal3">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion3">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(3);" min="0" class="form-control" id="dcPrice3">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(3);" min="0" class="form-control" id="dcQuantity3">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice3" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription3"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath3">
			  </div>
            </div>
            
            
         <div class="row border bg-light mt-4" id="productBox4" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(4)" id="addRow4" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(4)" id="deleteRow4" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName4" onchange="fetchProductDetails(4)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal4">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion4">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(4);" min="0" class="form-control" id="dcPrice4">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(4);" min="0" class="form-control" id="dcQuantity4">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice4" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription4"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath4">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox5" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(5)" id="addRow5" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(5)" id="deleteRow5" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName5" onchange="fetchProductDetails(5)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal5">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion5">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(5);" min="0" class="form-control" id="dcPrice5">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(5);" min="0" class="form-control" id="dcQuantity5">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice5" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription5"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath5">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox6" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(6)" id="addRow6" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(6)" id="deleteRow6" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName6" onchange="fetchProductDetails(6)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal6">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion6">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(6);" min="0" class="form-control" id="dcPrice6">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(6);" min="0" class="form-control" id="dcQuantity6">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice6" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription6"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath6">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox7" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(7)" id="addRow7" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(7)" id="deleteRow7" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName7" onchange="fetchProductDetails(7)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal7">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion7">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(7);" min="0" class="form-control" id="dcPrice7">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(7);" min="0" class="form-control" id="dcQuantity7">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice7" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription7"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath7">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox8" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(8)" id="addRow8" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(8)" id="deleteRow8" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName8" onchange="fetchProductDetails(8)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal8">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion8">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(8);" min="0" class="form-control" id="dcPrice8">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(8);" min="0" class="form-control" id="dcQuantity8">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice8" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription8"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath8">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox9" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(9)" id="addRow9" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(9)" id="deleteRow9" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName9" onchange="fetchProductDetails(9)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal9">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion9">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(9);" min="0" class="form-control" id="dcPrice9">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(9);" min="0" class="form-control" id="dcQuantity9">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice9" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription9"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath9">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox10" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(10)" id="addRow10" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(10)" id="deleteRow10" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName10" onchange="fetchProductDetails(10)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal10">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion10">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(10);" min="0" class="form-control" id="dcPrice10">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(10);" min="0" class="form-control" id="dcQuantity10">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice10" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription10"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath10">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox11" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(11)" id="addRow11" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(11)" id="deleteRow11" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName11" onchange="fetchProductDetails(11)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal11">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion11">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(11);" min="0" class="form-control" id="dcPrice11">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(11);" min="0" class="form-control" id="dcQuantity11">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice11" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription11"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath11">
			  </div>
            </div>
            
        <div class="row border bg-light mt-4" id="productBox12" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(12)" id="addRow12" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(12)" id="deleteRow12" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName12" onchange="fetchProductDetails(12)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal12">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion12">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(12);" min="0" class="form-control" id="dcPrice12">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(12);" min="0" class="form-control" id="dcQuantity12">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice12" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription12"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath12">
			  </div>
            </div>
            
        <div class="row border bg-light mt-4" id="productBox13" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(13)" id="addRow13" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(13)" id="deleteRow13" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName13" onchange="fetchProductDetails(13)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal13">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion13">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(13);" min="0" class="form-control" id="dcPrice13">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(13);" min="0" class="form-control" id="dcQuantity13">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice13" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription13"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath13">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox14" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(14)" id="addRow14" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(14)" id="deleteRow14" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName14" onchange="fetchProductDetails(14)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal14">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion14">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(14);" min="0" class="form-control" id="dcPrice14">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(14);" min="0" class="form-control" id="dcQuantity14">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice14" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription14"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath14">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox15" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(15)" id="addRow15" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(15)" id="deleteRow15" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName15" onchange="fetchProductDetails(15)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal15">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion15">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(15);" min="0" class="form-control" id="dcPrice15">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(15);" min="0" class="form-control" id="dcQuantity15">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice15" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription15"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath15">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox16" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(16)" id="addRow16" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(16)" id="deleteRow16" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName16" onchange="fetchProductDetails(16)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal16">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion16">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(16);" min="0" class="form-control" id="dcPrice16">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(16);" min="0" class="form-control" id="dcQuantity16">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice16" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription16"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath16">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox17" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(17)" id="addRow17" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(17)" id="deleteRow17" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName17" onchange="fetchProductDetails(17)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal17">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion17">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(17);" min="0" class="form-control" id="dcPrice17">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(17);" min="0" class="form-control" id="dcQuantity17">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice17" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription17"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath17">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox18" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(18)" id="addRow18" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(18)" id="deleteRow18" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName18" onchange="fetchProductDetails(18)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal18">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion18">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(18);" min="0" class="form-control" id="dcPrice18">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(18);" min="0" class="form-control" id="dcQuantity18">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice18" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription18"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath18">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox19" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(19)" id="addRow19" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(19)" id="deleteRow19" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName19" onchange="fetchProductDetails(19)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal19">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion19">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(19);" min="0" class="form-control" id="dcPrice19">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(19);" min="0" class="form-control" id="dcQuantity19">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice19" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription19"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath19">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox20" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(20)" id="addRow20" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(20)" id="deleteRow20" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName20" onchange="fetchProductDetails(20)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal20">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion20">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(20);" min="0" class="form-control" id="dcPrice20">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(20);" min="0" class="form-control" id="dcQuantity20">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice20" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription20"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath20">
			  </div>
            </div>
            
        <div class="row border bg-light mt-4" id="productBox21" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(21)" id="addRow21" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(21)" id="deleteRow21" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName21" onchange="fetchProductDetails(21)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal21">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion21">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(21);" min="0" class="form-control" id="dcPrice21">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(21);" min="0" class="form-control" id="dcQuantity21">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice21" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription21"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath21">
			  </div>
            </div>
            
          <div class="row border bg-light mt-4" id="productBox22" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(22)" id="addRow22" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(22)" id="deleteRow22" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName22" onchange="fetchProductDetails(22)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal22">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion22">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(22);" min="0" class="form-control" id="dcPrice22">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(22);" min="0" class="form-control" id="dcQuantity22">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice22" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription22"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath22">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox23" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(23)" id="addRow23" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(23)" id="deleteRow23" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName23" onchange="fetchProductDetails(23)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal23">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion23">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(23);" min="0" class="form-control" id="dcPrice23">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(23);" min="0" class="form-control" id="dcQuantity23">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice23" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription23"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath23">
			  </div>
            </div>
            
        <div class="row border bg-light mt-4" id="productBox24" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(24)" id="addRow24" title="Add more row" class="fa-solid fa-plus text-success"></i>
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(24)" id="deleteRow24" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName24" onchange="fetchProductDetails(24)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal24">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion24">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(24);" min="0" class="form-control" id="dcPrice24">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(24);" min="0" class="form-control" id="dcQuantity24">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice24" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription24"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath24">
			  </div>
            </div>
            
         <div class="row border bg-light mt-4" id="productBox25" style="padding-bottom: 10px; border-radius: 10px; display: none;">
            <div class="d-flex align-items-center justify-content-between">
	          	<p></p>
	          	<div class="d-flex align-items-center" style="gap: 10px;">
		          	<!-- <i style="font-size: 18px; cursor: pointer;" onclick="toggleAddProductBox(25)" id="addRow25" title="Add more row" class="fa-solid fa-plus text-success"></i> -->
		          	<i style="font-size: 18px; cursor: pointer;" onclick="toggleDeleteProductBox(25)" id="deleteRow25" title="Delete this row" class="fa-solid fa-minus text-danger"></i>
	          	</div>
	        </div>
            
              <div class="col-md-3">
		    	<label class="form-label">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="dcProductName25" onchange="fetchProductDetails(25)">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
				</div>
			</div>
			
			  <div class="col-md-3">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal25">
              </div>
              
               <div class="col-md-3">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion25">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice(25);" min="0" class="form-control" id="dcPrice25">
              </div>
              
              <div class="col-md-3">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice(25);" min="0" class="form-control" id="dcQuantity25">
              </div>

              <div class="col-md-3">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice25" readonly>
              </div>

              <div class="col-md-3">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="1" id="dcDescription25"></textarea>
              </div>

              <div class="col-md-3 col-sm-12">
			      <input type="hidden" class="form-control" id="dcUploadedFilePath25">
			  </div>
            </div>
            
          </div>

          <!-- Configuration Details -->
          <div class="form-section mt-5">
            <h4>Configuration Details</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">AppSKey:</label>
                <input type="text" class="form-control" id="dcAppSKeyPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">NwkSKey:</label>
                <input type="text" class="form-control" id="dcNwkSKeyPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">App EUI:</label>
                <input type="text" class="form-control"  id="dcAppEUIPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Device Address:</label>
                <textarea class="form-control" rows="1" id="dcDeviceAddressPopup"></textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label">Remarks:</label>
                <textarea class="form-control" rows="2" id="dcRemarksPopup"></textarea>
              </div>
            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Tax Type</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Select Tax Type:</label>
                <select class="form-select" id="dcTaxTypePopup">
                	<option value=""></option>
                	<option value="Interstate">Interstate (CGST 9% + SGST 9%)</option>
                	<option value="Outerstate">Outerstate (IGST 18%)</option>
                </select>
              </div>

            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Terms and Condition</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Payment Terms:</label>
                <textarea class="form-control" rows="2" id="dcPaymentTermsPopup"></textarea>
              </div>

               <div class="col-md-6">
                <label class="form-label">Terms and Conditions:</label>
                <textarea class="form-control" rows="2" id="dcTermsAndConditionPopup"></textarea>
              </div>

            </div>
          </div>
          
          <!-- Price Details -->
<!--           <div class="form-section mt-5">
            <h4>Price Details</h4>
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice();" min="0" class="form-control" id="dcPrice">
              </div>
              
              <div class="col-md-4">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice();" min="0" class="form-control" id="dcQuantity">
              </div>

              <div class="col-md-4">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice" readonly>
              </div>

              <div class="col-md-12">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="2" id="dcDescription"></textarea>
              </div>
            
            </div>
          </div> -->

        </div>

        <div class="modal-footer">
          <button type="submit" style="font-size: 14px;" onclick="viewNewDC();" class="btn btn-success">View DC</button>
          <button type="submit" style="font-size: 14px;" onclick="generateNewDC();" class="btn btn-primary">Generate DC</button>
          <button type="button" style="font-size: 14px;" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="generateDcDispatchModal" tabindex="-1" aria-labelledby="dispatchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content" style="overflow-y: auto;">
        <div class="modal-header">
          <h5 class="modal-title" id="dispatchModalLabel">Generated Delivery Challan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
		<input type="hidden" id="auto_id_ForHiddendispatch_text">
          <!-- User Details -->
          <div class="form-section">
            <h4>User Details</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">User Name:</label>
                <div class="d-flex">
                  <input type="text" class="form-control" id="dcUserName" readonly>
                  <!-- <select class="form-select" name="userName" required>
				        <option value="">Select User Name</option>
				        <option th:each="un : ${distinctUserNames}" th:value="${un}" th:text="${un}"></option>
				    </select> -->
                  <!-- <a href="#" class="ms-2 mt-1 action-link" data-bs-toggle="modal" data-bs-target="#userModal">Add User</a> -->
                </div>
              </div>

              <!-- <div class="col-md-6">
                <label class="form-label">Transport Mode:</label>
                <select class="form-select" th:field="*{transportMode}" required>
                  <option value="">Select Transport Mode</option>
                  <option th:each="mode : ${transportModes}" th:value="${mode}" th:text="${mode}"></option>
                </select>
              </div> -->
              
              <div class="col-md-6">
				    <label class="form-label">Transport Mode:</label>
				    <div class="d-flex" style="gap: 10px;">
				    <input type="text" class="form-control" id="dcTransportMode" readonly>
				    <!-- <select class="form-select" th:field="*{transportMode}" id="transportModeDropDown" onchange="toggleTransportModeDeleteIcon();" required></select> -->
				    	<!-- <div style="display: flex; justify-content: space-around;">
						    <a href="#" style="text-decoration: none;" class="action-link">
						    	<i data-bs-toggle="modal" data-bs-target="#userModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
						    </a>
						    <a id="transportDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
						    	<i title="Delete" onclick="deleteTransportModeData($('#transportModeDropDown').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
						    </a>
					    </div> -->
				    </div>
				</div>

              <div class="col-md-6">
                <label class="form-label">Invoice No:</label>
                <input type="text" class="form-control" id="dcInvoiceNo" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Date:</label>
                <input type="date" class="form-control" id="dcDeliveryDate" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Dc No:</label>
                <input type="text" class="form-control" id="dcDCNo" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">eWay Bill No:</label>
                <input type="text" class="form-control" id="dcEWayBillNo" readonly>
              </div>

            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Billing Details</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Buyer (Biller To):</label>
                <textarea class="form-control" rows="2" id="dcBillerToAddress" readonly></textarea>
              </div>

               <div class="col-md-6">
                <label class="form-label">Delivery Address:</label>
                <textarea class="form-control" rows="2" id="dcDeliveryAddress" readonly></textarea>
              </div>

            </div>
          </div>

          <!-- Customer Details -->
          <div class="form-section mt-4">
            <h4>Customer Details</h4>
            <div class="row g-3">
              
              <!-- <div class="col-md-6">
                <label class="form-label">Customer Name:</label>
                <div class="d-flex">
                  <select class="form-select me-2" id="customerNameDropdown" name="customerNameDropdown" onchange="fetchCustomerDetails()">
                    <option value="">Select Customer</option>
                    <option th:each="customer : ${customers}" th:value="${customer.customerName}" th:text="${customer.customerName}"></option>
                  </select>
                  <a href="#" class="action-link" data-bs-toggle="modal" data-bs-target="#customerModal">Add Customer</a>
                </div>
                <input type="hidden" id="customerName" th:field="*{customerName}">
              </div> -->
              
              <div class="col-md-6">
                <label class="form-label">Customer Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <!-- <select class="form-select me-2" id="customerNameDropdown" onchange="fetchCustomerDetails()">
			            <option value="">Select Contact Name</option>
			            <option th:each="customer : ${customers}" th:value="${customer.customerName}" th:text="${customer.customerName}"></option>
			        </select> -->
			        <input type="text" class="form-control" id="dcCustomerName" readonly>
			    	<!-- <div style="display: flex; justify-content: space-around;">
					    <a href="#" style="text-decoration: none;" class="action-link">
					    	<i data-bs-toggle="modal" data-bs-target="#customerModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
					    </a>
					    <a id="contactNameDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
					    	<i title="Delete" onclick="deleteContactNameData($('#customerNameDropdown').val(), $('#emailId').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
					    </a>
				    </div> -->
				</div>
			</div>

              <div class="col-md-6">
                <label class="form-label">Company Name:</label>
                <input type="text" class="form-control" id="dcCompanyName" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Contact No:</label>
                <input type="number" class="form-control" id="dcContactNo" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Email ID:</label>
                <input type="email" class="form-control" id="dcEmailId" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Company Address:</label>
                <textarea class="form-control" rows="2" id="dcCompanyAddress" readonly></textarea>
              </div>
            </div>
          </div>

          <!-- Product Details -->
          <div class="form-section mt-4">
            <h4>Product Details</h4>
            <!-- <div class="row g-3"> -->
            
            <div class="table-responsive">
            	<table class="table table-hover mb-0 holidayTable text-center border">
		        	<thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 10;">
		        	 	<tr>
		        	 		<th>Sl. No</th>
		        	 		<th>Product Name</th>
		        	 		<th>Module No</th>
		        	 		<th>Antenna Type</th>
	                        <th>Root Firmware(Ext)</th>
	                        <th>Root Firmware(Int)</th>
	                        <th>Router Firmware(Ext)</th>
	                        <th>Router Firmware(Int)</th>
	                        <th>Firmware H/w Version</th> 
	                        <th>Price</th>
	                        <th>Quantity</th>
	                        <th>Total Price</th>
	                        <th>Description</th>
	                    </tr>
		        	</thead>
		        		<tbody id="viewProductDetailsPopupTBody"></tbody>
        		</table>
            </div>
              
              <!-- <div class="col-md-6">
                <label class="form-label">Product Name:</label>
                <div class="d-flex">
                  <select class="form-select me-2" id="productNameDropdown" name="productNameDropdown" onchange="fetchProductDetails()">
                    <option value="">Select Product name with model no</option>
                    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
                  </select>
                  <a href="#" class="action-link" data-bs-toggle="modal" data-bs-target="#productModal">Add New</a>
                </div>
                <input type="hidden" id="productName" th:field="*{productName}">
              </div> -->
              
<!--               <div class="col-md-6">
		    	<label class="form-label" for="productName">Product Name:</label>
	              <div class="d-flex" style="gap: 10px;">
				    <select class="form-select" id="productNameDropdown" onchange="fetchProductDetails()">
					    <option value="">Select Product name with model no</option>
					    <option th:each="product : ${products}" th:if="${product.moduleNo != null and !#strings.isEmpty(product.moduleNo)}" th:value="${product.productName}" th:text="${product.productName+' ['+product.moduleNo+']'}"></option>
					</select>
					<input type="text" class="form-control" id="dcProductName" readonly>
			    	<div style="display: flex; justify-content: space-around;">
					    <a href="#" style="text-decoration: none;" class="action-link">
					    	<i data-bs-toggle="modal" data-bs-target="#productModal" title="Add new" style="font-size: 18px;" class="fas fa-plus"></i>
					    </a>
					    <a id="productNameDeleteDropDownDataIcon" href="#" style="text-decoration: none; display: none;" class="action-link">
					    	<i title="Delete" onclick="deleteProductDetailsData($('#productNameDropdown').val(), $('#moduleNo').val())" style="font-size: 14px; color: red;" class="fas fa-trash"></i>
					    </a>
				    </div>
				</div>
			</div>
			
			  <div class="col-md-6">
                <label class="form-label">Model No:</label>
                <input type="text" class="form-control" id="dcModuleNo" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Root Firmware (External):</label>
                <input type="text" class="form-control" id="dcRootFirmwareExternal" readonly>
              </div>
              
               <div class="col-md-6">
                <label class="form-label">Root Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRootFirmwareInternal" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Router Firmware (External):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareExternal" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Router Firmware (Internal):</label>
                <input type="text" class="form-control" id="dcRouterFirmwareInternal" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Antenna Type:</label>
                <input type="text" class="form-control" id="dcAntennaType" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Firmware Hardware Version:</label>
                <input type="text" class="form-control" id="dcFirmwareHardwareVersion" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Upload File:</label>
                <input type="file" class="form-control" name="file" accept="image/*">
              </div>
              
              <div class="col-md-6 col-sm-12">
			        <label class="form-label" for="uploadFile">Upload File:</label>
			        
			        <input type="hidden" class="form-control" id="dcUploadedFilePath">
			        
			        <input type="file" class="form-control" id="uploadFile" name="file" accept=".png,.jpg,.jpeg">
			    </div> -->
              
            <!-- </div> -->
          </div>

          <!-- Configuration Details -->
          <div class="form-section mt-5">
            <h4>Configuration Details</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">AppSKey:</label>
                <input type="text" class="form-control" id="dcAppSKey" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">NwkSKey:</label>
                <input type="text" class="form-control" id="dcNwkSKey" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">App EUI:</label>
                <input type="text" class="form-control"  id="dcAppEUI" readonly>
              </div>

              <div class="col-md-6">
                <label class="form-label">Device Address:</label>
                <textarea class="form-control" rows="1" id="dcDeviceAddress" readonly></textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label">Remarks:</label>
                <textarea class="form-control" rows="2" id="dcRemarks" readonly></textarea>
              </div>
            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Tax Type</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Select Tax Type:</label>
                <!-- <select class="form-select" id="dcTaxType" disabled="disabled">
                	<option value=""></option>
                	<option value="Interstate">Interstate (CGST 9% + SGST 9%)</option>
                	<option value="Outerstate">Outerstate (IGST 18%)</option>
                </select> -->
                <input type="text" class="form-control"  id="dcTaxType" readonly>
              </div>

            </div>
          </div>
          
          <div class="form-section mt-4">
            <h4>Terms and Condition</h4>
            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">Payment Terms:</label>
                <textarea class="form-control" rows="2" id="dcPaymentTerms" readonly></textarea>
              </div>

               <div class="col-md-6">
                <label class="form-label">Terms and Conditions:</label>
                <textarea class="form-control" rows="2" id="dcTermsAndCondition" readonly></textarea>
              </div>

            </div>
          </div>
          
          <!-- Price Details -->
          <!-- <div class="form-section mt-5">
            <h4>Price Details</h4>
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Price:</label>
                <input type="number" oninput="calculateDcTotalPrice();" min="0" class="form-control" id="dcPrice" readonly>
              </div>
              
              <div class="col-md-4">
                <label class="form-label">Quantity:</label>
                <input type="number" oninput="calculateDcTotalPrice();" min="0" class="form-control" id="dcQuantity" readonly>
              </div>

              <div class="col-md-4">
                <label class="form-label">Total:</label>
                <input type="number" class="form-control" id="dcTotalPrice" readonly>
              </div>

              <div class="col-md-12">
                <label class="form-label">Description:</label>
                <textarea class="form-control" rows="2" id="dcDescription" readonly></textarea>
              </div>
            
            </div>
          </div> -->

        </div>

        <div class="modal-footer">
          <button type="submit" style="font-size: 14px;" onclick="viewDC();" class="btn btn-success">View DC</button>
          <button type="submit" style="font-size: 14px;" onclick="generateDC();" class="btn btn-primary">Download DC</button>
          <button type="button" style="font-size: 14px;" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="dispatchReturnModal" tabindex="-1" aria-labelledby="dispatchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-scrollable">
    <div class="modal-content" style="overflow-y: auto;">
        <div class="modal-header">
          <h5 class="modal-title" id="dispatchReturnModalLabel">Customer Return Form</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <div class="form-section">
            <div class="row g-3">

			  <input type="hidden" id="auto_id_value_return_popup">
              <div class="col-md-6">
                <label class="form-label">Customer Name:</label>
                <input type="text" class="form-control" readonly id="customerNameReturnPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Company Name:</label>
                <input type="text" class="form-control" readonly id="companyNameReturnPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Product Name:</label>
                <input type="text" class="form-control" readonly id="productNameReturnPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Module No:</label>
                <input type="text" class="form-control" readonly id="moduleNoReturnPopup">
              </div>

              <div class="col-md-6">
                <label class="form-label">Dispatched Date:</label>
                <input type="date" class="form-control" readonly id="dispatchedDateReturnPopup">
              </div>
              
              <div class="col-md-6">
                <label class="form-label">Dispatched Quantity:</label>
                <input type="number" class="form-control" readonly id="dispatchedQtyReturnPopup">
              </div>
              
              <div class="col-md-6">
                <label class="form-label">Returned Date:</label>
                <input type="date" class="form-control" id="returnedDateReturnPopup">
              </div>
              
              <div class="col-md-6">
                <label class="form-label">Returned Quantity:</label>
                <input type="number" min="0" class="form-control" id="returnedQtyReturnPopup">
              </div>
              
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="submit" style="font-size: 14px;" onclick="insertCustomerDispatchReturn();" class="btn btn-success">Submit</button>
          <button type="button" style="font-size: 14px;" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
</div>


    <div class="content">
     <div class="navbar">
     <!-- <i class="fa-solid fa-circle-user text-primary" style="font-size: 24px; padding-right: 15px; cursor: pointer;"></i> -->
     <div class="user-dropdown" id="userDropdown" style="display: none;">
			<ul>
			        <li><a><i class="fas fa-user"></i><span th:text="${session.full_name}"></span></a></li>
			        <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Sign Out</a></li>
			    </ul>
			</div>
		   <ul>
		    <li>
		        <a th:href="@{/dashboard}">
		            <i class="fas fa-home"></i> Home
		        </a>
		    </li>
		    <li>
		        <a href="#" id="dispatchMenu">
		            <i class="fas fa-file-import"></i> Dispatch <i style="padding-left: 5px;" class="fa-solid fa-caret-down"></i>
		        </a>
		        <div class="dropdown-menu dispatch_subDropDown">
			      <ul>
			        <li><a class="dropdown-item" th:href="@{/form}">Add</a></li>
			        <li><a class="dropdown-item" th:href="@{/view-dispatch}">View</a></li>
			      </ul>
			    </div>
		    </li>
		    <li>
		         <a th:href="@{/import}">
		            <i class="fas fa-arrow-down"></i> Import
		        </a>
		    </li>
		    <!-- <li>
		         <a th:href="@{/view-dispatch}">
		            <i class="fas fa-eye"></i> View Dispatch
		        </a>
		    </li> -->
		    <li>
		        <a th:href="@{/calendar}">
		            <i class="fas fa-calendar"></i> Calendar
		        </a>
		    </li>
		    
		    <li>
		        <a href="#" id="masterMenu">
		            <i class="fas fa-building"></i> Master <i style="padding-left: 5px;" class="fa-solid fa-caret-down"></i>
		        </a>
		        <div class="dropdown-menu dispatch_subDropDown master_subDropDown">
			      <ul>
			        <!-- <li><a class="dropdown-item" th:href="@{/adduser}">User Master</a></li> -->
			        <li><a class="dropdown-item" th:href="@{/product}">Product Master</a></li>
			        <li><a class="dropdown-item" th:href="@{/customer}">Customer Master</a></li>
			      </ul>
			    </div>
		    </li>
		    
		    <!-- <li>
		        <a th:href="@{/adduser}">
		            <i class="fas fa-users"></i> Add Users
		        </a>
		    </li>
		    <li>
		        <a th:href="@{/product}">
		            <i class="fas fa-box"></i> Product Master
		        </a>
		    </li>
		    <li>
		        <a th:href="@{/customer}">
		            <i class="fas fa-building"></i> Customer Master
		        </a>
		    </li> -->
		    <li>
		        <a th:href="@{/dcDispatchData}">
		            <i class="fa-solid fa-file"></i> Generated DC
		        </a>
		    </li>
		    
		    <li>
		        <a th:href="@{/audit-log}">
		            <i class="fas fa-cogs"></i> Track Info
		        </a>
		    </li>
		</ul>

</div>

<input type="hidden" th:value="${email}" id="emailFromAddress">
<input type="hidden" id="clickedDispatchDataAutoId">

<div class="emailPasswordOuterDiv" id="emailPasswordOuterDiv">
	 <div class="emailPasswordInnerBox">
		<div class="d-flex justify-content-between align-items-center m-0" style="position: sticky; top: 0; background: #fff;">
			<p class="candidatePrfoilesHeading m-0" style="font-size: 14px; padding-left: 10px; font-weight: bold;">Please Enter Email Password</p>
			<p class="emailFormInnerBoxCloser m-0"><span onclick="closeEmailPasswordOuterDiv();" style="font-size: 20px; cursor: pointer; font-weight: bold;">&times;</span></p>		               	  
		</div>
		<div class="card-body mt-1" style="padding-bottom: 10px;">
			<div class="table-responsive" style="width: 96%; margin-left: auto; margin-right: auto;">
				<div class="col-sm-12 form-group mb-2" style="padding-left: 3px; padding-right: 3px;">
					<input type="text" class="form-control mt-2" id="ionos_password">
				</div>
			</div>
			<div class="table-responsive" style="width: 96%; margin-left: auto; margin-right: auto;">
				<div class="col-sm-12 form-group p-2">
					<button type="button" class="btn btn-primary" id="emailSendBtn" onclick="sendDataToEmailToTheParticularCustomer();" style="font-size: 14px; float: right;">Validate</button>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="sendEmailForCustomerOuterDiv" id="sendEmailForCustomerOuterDiv">
	 <div class="sendEmailForCustomerInnerBox">
			<div class="d-flex justify-content-between align-items-center m-0" style="position: sticky; top: 0; background: #fff;">
				<p class="candidatePrfoilesHeading m-0" style="font-size: 14px; padding-left: 10px; font-weight: bold;">Compose Mail</p>
				<p class="emailFormInnerBoxCloser m-0"><span onclick="closeSendEmailForCustomerOuterDiv();" style="font-size: 20px; cursor: pointer; font-weight: bold;">&times;</span></p>		               	  
			</div>
			<div class="card-body sendEmailForCustomerBodyBox mt-1">
			
				<div class="table-responsive" style="width: 96%; margin-left: auto; margin-right: auto;">
					<table style="width: 100%; font-size: 14px;">
						<tr>
							<th style="text-align: left; margin-bottom: 10px; margin-top: 10px;">From</th>
							<td><input type="text" th:value="${session.email}" readonly style="font-size: 14px; margin-bottom: 10px; margin-top: 10px;" class="form-control" id="emailFromAddress"></td>
						</tr>
						<tr>
							<th style="text-align: left; margin-bottom: 10px;">To</th>
							<td><input type="text" style="font-size: 14px; margin-bottom: 10px;" placeholder="Comma seperated emails" class="form-control" id="emailToAddress"></td>
						</tr>
						<tr>
							<th style="text-align: left; margin-bottom: 10px;">CC</th>
							<td><input type="text" style="font-size: 14px; margin-bottom: 10px;" placeholder="Comma seperated emails" class="form-control" id="emailCCAddress"></td>
						</tr>
						<tr>
							<th style="text-align: left; margin-bottom: 10px;">Subject</th>
							<td><input type="text" style="font-size: 14px; margin-bottom: 20px;" class="form-control" id="emailSubject"></td>
						</tr>
						<tr>
							<td style="padding-left: 3px; padding-right: 3px;" colspan="2">
								<textarea class="form-control" placeholder="Body" style="font-size: 14px; margin-bottom: 10px;" id="emailBody" rows="4"></textarea>
							</td>
						</tr>
					</table>
				</div>
				
			<div style="width: 96%; margin-left: auto; margin-right: auto;">
				<div class="col-sm-12 form-group mt-4 modal-footer table-responsive p-2">
					<button type="button" id="email_send_button" class="btn btn-primary" onclick="openEmailPasswordOuterDiv()" style="font-size: 14px; float: right;">Send</button>
				</div>
			</div>
			
		</div>
	</div>
</div>


 <div class="tables-container">
    <div class="table-box">
        <div class="table-responsive" style="height: 460px; overflow: auto;">
      <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
         <!-- <div style="display: flex; justify-content: space-around; align-items: center; gap: 10px;">
         	<i title="Generate Excel" onclick="export_To_Excel();" class="fas fa-file-excel" style="color: green; font-size: 25px; cursor: pointer;"></i>
         	<i title="Generate PDF" onclick="generateFilteredPDF();" class="fa-solid fa-file-pdf" style="color: red; font-size: 25px; cursor: pointer;"></i>
         </div> -->
         <i style="font-size: 18px; cursor: pointer;" onclick='openGenerateDcBox();' title="Generate New DC" class="fa-solid fa-plus text-success"></i>
         <input type="text" class="form-control" id="searchInput" placeholder="Search..." style="padding: 5px; width: 20%;" />
     </div>
        	<table id="holidayTable2" class="table table-hover mb-0 holidayTable text-center">
	        	<thead style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 10;">
	        	 <tr>
	        	 		<th colspan="1">Action</th> <!-- New column for Edit button -->
	        	 		<th>Sl. No</th>
	        	 		<!-- <th>Return Status</th>
	        	 		<th>Product Retention</th> -->
	        	 		<th>Dispatched Date</th>
	        	 		<!-- <th>Returned Date</th> -->
                        <!-- <th>Returned Qty</th> -->
                        <th>Customer Name</th>
                        <th>Company Name</th>
                        <th>Product Name</th> 
                        <th>Module No</th> 
                        <th>Employee Name</th>
                        <th>Transport Mode</th>
                        <!-- <th>dcNo</th>
                        <th>eWayBillNo</th>
                        <th>invoiceNo</th> -->
                        <!-- <th>quantity</th> -->
                        <th>Company Address</th>
                        <th>Contact No</th>
                        <th>EmailId</th>
                        <!-- <th>rootFirmwareExternal</th>
                        <th>antennaType</th>
                        <th>rootFirmwareInternal</th>
                        <th>routerFirmwareExternal</th>
                        <th>routerFirmwareInternal</th>
                        <th>appSKey</th>
                        <th>nwkSKey</th>
                        <th>deviceAddress</th>
                        <th>appEUI</th>
                        <th>remarks</th>
                        <th>firmwareHardwareVersion</th>
                        <th>Product Image</th> -->
                    </tr>
	        	</thead>
	        	<tbody id="viewDispatchDetailsTBody">
		        	<!-- Display this row if the events list is empty -->
			        <!-- <tr th:if="${#lists.isEmpty(dispatches)}">
			            <td colspan="30" class="text-center">No data available</td>
			        </tr>
                    <tr th:each="dispatch, stat : ${dispatches}">
                    	<td>
                            <i title="Edit" th:attr="onclick=|editDispatch('${dispatch.id}')|" style="font-size: 14px; cursor: pointer;" class="fas fa-pen text-primary"></i>
                        </td>
                        <td><i title="Send Mail" th:attr="onclick=|openEmailBoxDispatch('${dispatch.id}')|" style="font-size: 16px; cursor: pointer;" class="fas fa-envelope text-info"></i></td>
                        <td><i title="Customer Return" th:attr="onclick=|openReturnBoxDispatch('${dispatch.id}')|" style="font-size: 16px; cursor: pointer;" class="fas fa-rotate-left text-success"></i></td>
                        <td style="min-width: 80px;" th:text="${#numbers.parseInteger(dispatch.quantity) == 0 ? '-' :
						             (dispatch.returnedDate == null ?
						             @dateUtils.daysBetween(dispatch.dispatchDate, T(java.time.LocalDate).now()) + ' days' :
						             (dispatch.quantity == dispatch.returnedQty ?
						             @dateUtils.daysBetween(dispatch.dispatchDate, dispatch.returnedDate) + ' days' :
						             @dateUtils.daysBetween(dispatch.dispatchDate, T(java.time.LocalDate).now()) + ' days'))}">
						</td>
                        <td style="min-width: 60px;" th:text="${stat.index + 1}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.userName}"></td>
                        <td style="min-width: 40px;" th:text="${dispatch.transportMode}"></td>
                        <td id="dispatchDate" style="min-width: 90px;" th:text="${dispatch.date.substring(8,10) + '-' + dispatch.date.substring(5,7) + '-' + dispatch.date.substring(0,4)}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.dcNo}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.eWayBillNo}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.invoiceNo}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.quantity}"></td>
                        <td style="min-width: 120px;" th:text="${dispatch.customerName}"></td>
                        <td style="min-width: 120px;" th:text="${dispatch.companyName}"></td>
                        <td style="min-width: 180px;" th:text="${dispatch.companyAddress}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.contactNo}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.emailId}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.productName}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.moduleNo}"></td>
                        <td style="min-width: 180px;" th:text="${dispatch.rootFirmwareExternal}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.antennaType}"></td>
                        <td style="min-width: 180px;" th:text="${dispatch.rootFirmwareInternal}"></td>
                        <td style="min-width: 180px;" th:text="${dispatch.routerFirmwareExternal}"></td>
                        <td style="min-width: 180px;" th:text="${dispatch.routerFirmwareInternal}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.appSKey}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.nwkSKey}"></td>
                        <td style="min-width: 140px;" th:text="${dispatch.deviceAddress}"></td>
                        <td style="min-width: 80px;" th:text="${dispatch.appEUI}"></td>
                        <td style="min-width: 200px;" th:text="${dispatch.remarks}"></td>
                        <td style="min-width: 100px;" th:text="${dispatch.firmwareHardwareVersion}"></td>
				        <td style="min-width: 200px;">
					  	  <img th:if="${dispatch.uploadFile != null}" 
					         th:src="@{'dispatchDocs/' + ${dispatch.uploadFile.replace('\\', '/')}}" 
					         alt="Image" 
					         width="100%" height="100%">
					    </td>
                    </tr> -->
                </tbody>
        	</table> 
        </div>
    </div>
</div>

</div>
  	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  	
  <!-- 	script to edit  -->
  <script>
  
  $.ajax({
      url: '/getAllDcDispatchedDetails', // Your backend URL for saving the CTC offer
      type: 'GET',
      success: function (response) {
    	  updateDispatchDetailsData(response);
      },
      error: function (xhr, status, error) {
          alert('Failed to fetch dispatch Lists: ' + error);
      }
  });
  
  function updateDispatchDetailsData(data) {
	  var viewEmpDetailsTBody = document.getElementById('viewDispatchDetailsTBody');
	  
	  viewEmpDetailsTBody.innerHTML = ''; 
	  
	  if (data && data.length > 0) {
	      for (var i = 0; i < data.length; i++) {
	    	  
	    	  var quantity = parseInt(data[i].quantity1) || 0;
	    	  var returnedQty = parseInt(data[i].returnedQty) || 0;
	    	  var returnedDate = data[i].returnedDate;
	    	  var dispatchDate = data[i].date;
	    	  var remarkColumnText = '-', productReturnStatus = '-';
	    	  var diffInMs, diffInDays, qtyDisplay = '0', productImage = '-';

	    	  if (quantity > 0 && dispatchDate) {
	    	      var startDate = new Date(dispatchDate);
	    	      var endDate = returnedDate ? new Date(returnedDate) : new Date();
	    	      var endDate2 = new Date();
	    	      
	    	      if(returnedQty === quantity){
	    	    	  diffInMs = endDate - startDate;
		    	      diffInDays = Math.ceil(diffInMs / (1000 * 60 * 60 * 24));
		    	      remarkColumnText = diffInDays + " day(s)";
	    	      }else if(returnedQty !== quantity){
	    	    	  diffInMs = endDate2 - startDate;
		    	      diffInDays = Math.ceil(diffInMs / (1000 * 60 * 60 * 24));
		    	      remarkColumnText = diffInDays + " day(s)";
	    	      }
	    	  }
	    	  
	    	  if(quantity > 0){
	    		  if(quantity === returnedQty){
	    			  productReturnStatus = "<p style='margin: 0; padding: 2px 5px; background: green; color: #fff; border-radius: 12px;'>Full Return</p>";
	    		  }else if(returnedQty > 0 && quantity !== returnedQty){
	    			  productReturnStatus = "<p style='margin: 0; padding: 2px 5px; background: #f39c12; color: #fff; border-radius: 12px;'>Partial Return</p>";
	    		  }else if(returnedQty == 0){
	    			  productReturnStatus = "<p style='margin: 0; padding: 2px 5px; background: red; color: #fff; border-radius: 12px;'>No Return</p>";
	    		  }
	    	  }
	    	  
	    	  if(data[i].quantity){
	    		  var returnQtyValue = '0';
	    		  if(data[i].returnedQty){
	    			  returnQtyValue = data[i].returnedQty;
	    		  }
	    		  qtyDisplay = returnQtyValue+'/'+data[i].quantity;
	    	  }
	    	  
	    	  if (data[i].uploadFile) {
	    		    productImage = "<img src='dispatchDocs/" + data[i].uploadFile + "' alt='Image' width='100%' height='100%'>";
	    		}
	    	  
	          var row = "<tr class='custom_tr'>" +
	          			/* "<td><i title='Edit' onclick='editDispatch(\"" + data[i].id + "\")' style='font-size: 14px; cursor: pointer;' class='fas fa-pen text-primary'></i></td>" +
	          			"<td><i title='Send Mail' onclick='openEmailBoxDispatch(\"" + data[i].id + "\")' style='font-size: 16px; cursor: pointer;' class='fas fa-envelope text-info'></i></td>" +
	          			"<td><i title='Customer Return' onclick='openReturnBoxDispatch(\"" + data[i].id + "\")' style='font-size: 16px; cursor: pointer;' class='fas fa-rotate-left text-success'></i></td>" + */
	          			"<td><i title='View Generated DC' onclick='openGenerateDcBoxDispatch(\"" + data[i].id + "\")' style='font-size: 14px; cursor: pointer;' class='fa fa-eye text-primary'></i></td>" +
	          			"<td style='min-width: 60px;'>" + (i+1) + "</td>" +
	          			/* "<td style='min-width: 120px;'>" + productReturnStatus + "</td>" +
	          			"<td style='min-width: 140px;'>" + remarkColumnText + "</td>" + */
	          			"<td class='dateFormatter dispatchDate' style='min-width: 130px;'>" + (data[i].date || '-') + "</td>" +
	          			/* "<td class='dateFormatter returnDate' style='min-width: 120px;'>" + (data[i].returnedDate || '-') + "</td>" + */
                        //"<td style='min-width: 120px;'>" + qtyDisplay + "</td>" +
                        "<td style='min-width: 130px;'>" + (data[i].customerName || '-') + "</td>" +
                        "<td style='min-width: 130px;'>" + (data[i].companyName || '-') + "</td>" +
                        "<td style='min-width: 120px;'>" + (data[i].productName1 || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].moduleNo1 || '-') + "</td>" +
                        "<td style='min-width: 130px;'>" + (data[i].userName || '-') + "</td>" +
                        "<td style='min-width: 130px;'>" + (data[i].transportMode || '-') + "</td>" +
                        /* "<td style='min-width: 80px;'>" + (data[i].dcNo || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].eWayBillNo || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].invoiceNo || '-') + "</td>" + */
                        /* "<td style='min-width: 80px;'>" + data[i].quantity + "</td>" + */
                        "<td style='min-width: 180px;'>" + (data[i].companyAddress || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].contactNo || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].emailId || '-') + "</td>" +
                        /* "<td style='min-width: 180px;'>" + (data[i].rootFirmwareExternal || '-') + "</td>" +
                        "<td style='min-width: 80px;'>" + (data[i].antennaType || '-') + "</td>" +
                        "<td style='min-width: 180px;'>" + (data[i].rootFirmwareInternal || '-') + "</td>" +
                        "<td style='min-width: 180px;'>" + (data[i].routerFirmwareExternal || '-') + "</td>" +
                        "<td style='min-width: 180px;'>" + (data[i].routerFirmwareInternal || '-') + "</td>" +
                        "<td style='min-width: 80px;'>" + (data[i].appSKey || '-') + "</td>" +
                        "<td style='min-width: 80px;'>" + (data[i].nwkSKey || '-') + "</td>" +
                        "<td style='min-width: 140px;'>" + (data[i].deviceAddress || '-') + "</td>" +
                        "<td style='min-width: 80px;'>" + (data[i].appEUI || '-') + "</td>" +
                        "<td style='min-width: 200px;'>" + (data[i].remarks || '-') + "</td>" +
                        "<td style='min-width: 100px;'>" + (data[i].firmwareHardwareVersion || '-') + "</td>" +
                        "<td style='min-width: 120px;'>" + (productImage || '-') + "</td>" + */
		              	"</tr>";

	          viewEmpDetailsTBody.innerHTML += row; //Append row HTML
	      }
	      
	      formatDates2();
	      
	  } else {
	      var noDataRow = "<tr><td colspan='30'>No data available</td></tr>";
	      viewEmpDetailsTBody.innerHTML = noDataRow; // Display 'No data available'
	  }
	}
  
  function formatDates2() {
	    var dateElements = document.querySelectorAll('.dateFormatter');
	    dateElements.forEach(function(dateElement) {
	        var dateStr = dateElement.innerText; // Get the date string in yyyy-mm-dd format
	        var dateParts = dateStr.split('-'); // Split the date string into parts
	        
	        // Format the date as dd-mm-yyyy
	        if(dateParts.length === 3) {
	            var formattedDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0];
	            // Update the text of the date element
	            dateElement.innerText = formattedDate;
	        }
	    });
	}
  
  function editDispatch(id) {
	  //alert(id);
	    fetch(`/get-dispatch/${id}`)
	        .then(response => {
	            if (!response.ok) {
	                throw new Error('Network response was not OK');
	            }
	            return response.json();
	        })
	        .then(data => {
	            //console.log("Fetched Dispatch:", data);

	            // User Details
	            document.querySelector('[name="id"]').value = data.id || '';
	            document.querySelector('[name="userName"]').value = data.userName || '';
	            document.querySelector('[name="transportMode"]').value = data.transportMode || '';
	            document.querySelector('[name="invoiceNo"]').value = data.invoiceNo || '';
	            document.querySelector('[name="date"]').value = data.date || '';
	            document.querySelector('[name="dcNo"]').value = data.dcNo || '';
	            document.querySelector('[name="eWayBillNo"]').value = data.eWayBillNo || '';
	            document.querySelector('[name="quantity"]').value = data.quantity || '';

	            // Customer Details
	            document.getElementById('customerNameDropdown').value = data.customerName || '';
	            document.getElementById('customerName').value = data.customerName || '';
	            document.querySelector('[name="companyName"]').value = data.companyName || '';
	            document.querySelector('[name="contactNo"]').value = data.contactNo || '';
	            document.querySelector('[name="emailId"]').value = data.emailId || '';
	            document.querySelector('[name="companyAddress"]').value = data.companyAddress || '';

	            // Product Details
	            document.getElementById('productNameDropdown').value = data.productName || '';
	            document.getElementById('productName').value = data.productName || '';
	            document.querySelector('[name="rootFirmwareExternal"]').value = data.rootFirmwareExternal || '';
	            document.querySelector('[name="routerFirmwareExternal"]').value = data.routerFirmwareExternal || '';
	            document.querySelector('[name="moduleNo"]').value = data.moduleNo || '';
	            document.querySelector('[name="rootFirmwareInternal"]').value = data.rootFirmwareInternal || '';
	            document.querySelector('[name="routerFirmwareInternal"]').value = data.routerFirmwareInternal || '';
	            document.querySelector('[name="antennaType"]').value = data.antennaType || '';
	            document.querySelector('[name="firmwareHardwareVersion"]').value = data.firmwareHardwareVersion || '';

	            // Configuration Details
	            document.querySelector('[name="appSKey"]').value = data.appSKey || '';
	            document.querySelector('[name="nwkSKey"]').value = data.nwkSKey || '';
	            document.querySelector('[name="appEUI"]').value = data.appEUI || '';
	            document.querySelector('[name="deviceAddress"]').value = data.deviceAddress || '';
	            document.querySelector('[name="remarks"]').value = data.remarks || '';
	            
	            fetchProductDetails();

	            // Show the modal
	            const dispatchModal = new bootstrap.Modal(document.getElementById('dispatchModal'));
	            dispatchModal.show();
	        })
	        .catch(error => {
	            console.error('There was a problem with the fetch operation:', error);
	        });
	}

</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.navbar ul li a');

    navLinks.forEach(link => {
        const linkHref = link.getAttribute('href');

        if (linkHref === currentPath) {
            // Highlight the current link
            link.parentElement.classList.add('active');

            // Check if it's a submenu item and activate the main menu as well
            let parentMenu = link.closest('.dropdown-menu');
            if (parentMenu) {
                // Find the parent <li> of the main menu that contains this dropdown
                let mainMenuLi = parentMenu.parentElement;
                if (mainMenuLi && mainMenuLi.tagName === 'LI') {
                    mainMenuLi.classList.add('active');
                }
            }
        }
    });
});
</script>

<script>
function fetchProductDetails() {
    var selectedProduct = document.getElementById("productNameDropdown").value;
    document.getElementById("productName").value = selectedProduct;
    
    /* if(selectedProduct){
    	$('#productNameDeleteDropDownDataIcon').show();
    }else{
    	$('#productNameDeleteDropDownDataIcon').hide();
    } */

    if (selectedProduct) {
        fetch(`/getProductDetails?productName=${encodeURIComponent(selectedProduct)}`)
            .then(response => response.json())
            .then(data => {
            	//alert(JSON.stringify(data));
                document.getElementById("rootFirmwareExternal").value = data.rootFirmwareExternal || "";
                document.getElementById("routerFirmwareExternal").value = data.routerFirmwareExternal || "";
                document.getElementById("moduleNo").value = data.moduleNo || "";
                document.getElementById("rootFirmwareInternal").value = data.rootFirmwareInternal || "";
                document.getElementById("routerFirmwareInternal").value = data.routerFirmwareInternal || "";
                document.getElementById("antennaType").value = data.antennaType || "";
                document.getElementById("firmwareHardwareVersion").value = data.firmwareHardwareVersion || "";
                if(data.uploadFile){
                	$('#uploadedFilePath').val(data.uploadFile);
                	//alert(`dispatchDocs/${data.uploadFile}`);
                	$('#productImageTag').prop("src", `dispatchDocs/${data.uploadFile}`);
                	$('#productImageBox').show();
                }else{
                	$('#uploadedFilePath').val("");
                	$('#productImageBox').hide();
                }
            });
    	}else {
    		document.getElementById("rootFirmwareExternal").value = "";
            document.getElementById("routerFirmwareExternal").value = "";
            document.getElementById("moduleNo").value = "";
            document.getElementById("rootFirmwareInternal").value = "";
            document.getElementById("routerFirmwareInternal").value = "";
            document.getElementById("antennaType").value = "";
            document.getElementById("firmwareHardwareVersion").value = "";
            $('#productImageTag').prop("src", "");
            $('#productImageBox').hide();
        }
	}
	
function fetchCustomerDetails() {
    var selectedCustomer = document.getElementById("customerNameDropdown").value;
    document.getElementById("customerName").value = selectedCustomer;
    
    /* if(selectedCustomer){
    	$('#contactNameDeleteDropDownDataIcon').show();
    }else{
    	$('#contactNameDeleteDropDownDataIcon').hide();
    } */

    if (selectedCustomer) {
        fetch('/getCustomerDetails?customerName=' + encodeURIComponent(selectedCustomer))
            .then(response => response.json())
            .then(data => {
                document.getElementById("companyName").value = data.companyName || '';
                document.getElementById("contactNo").value = data.contactNo || '';
                document.getElementById("emailId").value = data.emailId || '';
                document.getElementById("companyAddress").value = data.companyAddress || '';
            })
            .catch(error => console.error('Error fetching customer details:', error));
    } else {
        document.getElementById("companyName").value = '';
        document.getElementById("contactNo").value = '';
        document.getElementById("emailId").value = '';
        document.getElementById("companyAddress").value = '';
    }
}
</script>

<script>
/* $.ajax({
    type: 'GET', 
    url: '/fetchAllDistinctTransportModes', 
    success: function(data) {
		//alert(JSON.stringify(data));
		updateTransportModeDetailsDataToDropdown(data);
			},
    error: function(xhr, status, error) {
        console.error('Error fetching data for transport mode:', error);
        console.log('Error fetching data for  transport mode. Please try again.');
    }
}); */

function updateTransportModeDetailsDataToDropdown(datas) {
	let transportModeDropdown = document.getElementById("transportModeDropDown");
	transportModeDropdown.innerHTML = "";
	
	let defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Transport Mode";
	transportModeDropdown.appendChild(defaultOption);
	
	datas.forEach(data => {
		let option = document.createElement("option");
		option.value = data.name;
		option.text = data.name;
		transportModeDropdown.appendChild(option);
	});
}

function updateTransportModeDetailsDataToDropdownAfterAdd(datas){
	let transportModeDropdown = document.getElementById("transportModeDropDown");
	transportModeDropdown.innerHTML = "";
	
	let defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Transport Mode";
	defaultOption.disabled = true;
	transportModeDropdown.appendChild(defaultOption);
	
	datas.forEach(data => {
		let option = document.createElement("option");
		option.value = data.name;
		option.text = data.name;
		transportModeDropdown.appendChild(option);
	});
}

function validateTransportModeAdd(e){
	e.preventDefault();
	
	const form = document.getElementById("transportModeForm");
    const formData = new FormData(form);

    fetch("/submitTransportMode", {
        method: "POST",
        body: formData
    })
    .then(response => {
    	if (!response.ok) {
            throw new Error("Failed to add transport mode");
        }
        return response.text(); // Extract response body text
    })
    .then(data => {
    	if (data === "data exists") {
            alert("Entered data already exists!");
        } else if (data === "successfull") {
        	
        	$.ajax({
        	    type: 'GET', 
        	    url: '/fetchAllDistinctTransportModes', 
        	    success: function(data) {
        			updateTransportModeDetailsDataToDropdownAfterAdd(data);
        				},
        	    error: function(xhr, status, error) {
        	        console.error('Error fetching data for transport mode:', error);
        	        console.log('Error fetching data for  transport mode. Please try again.');
        	    }
        	});
        	
            console.log("Transport mode added successfully!");
            form.reset();
            $('#userModal').modal('hide');
        } else {
            alert("Unexpected response: " + data);
        }
    })
    .catch(error => {
        alert("Error: " + error.message);
    });
}

function validateNewCustomerAdd(e){
	e.preventDefault();
	
	const form = document.getElementById("addCustomerPopup");
    const formData = new FormData(form);

    fetch("/submitCustomerPopupData", {
        method: "POST",
        body: formData
    })
    .then(response => {
    	if (!response.ok) {
            throw new Error("Failed to add customer details");
        }
        return response.text(); // Extract response body text
    })
    .then(data => {
    	
		$.ajax({
    	    type: 'GET', 
    	    url: '/fetchAllCustomerDetails', 
    	    success: function(data) {
    	    	updateCustomerNamesToDropdownAfterPopupAdd(data);
    				},
    	    error: function(xhr, status, error) {
    	        console.error('Error fetching data for customer details:', error);
    	        console.log('Error fetching data for customer details. Please try again.');
    	    }
    	});
    	
        console.log("New customer details added successfully!");
        form.reset();
        $('#customerModal').modal('hide');
    })
    .catch(error => {
        alert("Error: " + error.message);
    });
}

function updateCustomerNamesToDropdownAfterPopupAdd(datas){
	var customerNameDropdown = document.getElementById('customerNameDropdown');
	customerNameDropdown.innerHTML = "";
	
	var defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Contact Name";
	defaultOption.disabled = true;
	customerNameDropdown.appendChild(defaultOption);
	
	datas.forEach(data =>{
		var option = document.createElement("option");
		option.text = data.customerName;
		option.value = data.customerName;
		customerNameDropdown.appendChild(option);
	});
	
	populateTheRecentlyInsertedCustomerDetails();
}

function updateCustomerNamesToDropdown(datas){
	var customerNameDropdown = document.getElementById('customerNameDropdown');
	customerNameDropdown.innerHTML = "";
	
	var defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Contact Name";
	customerNameDropdown.appendChild(defaultOption);
	
	datas.forEach(data =>{
		var option = document.createElement("option");
		option.text = data.customerName;
		option.value = data.customerName;
		customerNameDropdown.appendChild(option);
	});
}

function populateTheRecentlyInsertedCustomerDetails(){
	$.ajax({
	    type: 'GET', 
	    url: '/fetchRecentCustomerDetails', 
	    success: function(data) {
	    	
	    	const dropdown = $('#customerNameDropdown');
            const valueToSelect = data.customerName;

            // Check if the option exists
            if (dropdown.find(`option[value="${valueToSelect}"]`).length > 0) {
                dropdown.val(valueToSelect); // Set the value if present
            } else {
                console.warn('Customer name not found in dropdown options.');
            }
            
			$('#emailId').val(data.emailId);
			$('#contactNo').val(data.contactNo);
			$('#companyName').val(data.companyName);
			$('#companyAddress').val(data.companyAddress);
				},
	    error: function(xhr, status, error) {
	        console.error('Error fetching data for customer details:', error);
	        console.log('Error fetching data for customer details. Please try again.');
	    }
	});
}

function validateNewProductsAdd(e){
	e.preventDefault();
	
	const form = document.getElementById("addProductsPopup");
    const formData = new FormData(form);

    fetch("/submitProduct", {
        method: "POST",
        body: formData
    })
    .then(response => {
    	if (!response.ok) {
            throw new Error("Failed to add product details");
        }
        return response.text(); // Extract response body text
    })
    .then(data => {
    	
		$.ajax({
    	    type: 'GET', 
    	    url: '/getAllProductDetails', 
    	    success: function(data) {
    	    	updateProductNamesToDropdownAfterPopupAdd(data);
    				},
    	    error: function(xhr, status, error) {
    	        console.error('Error fetching data for product details:', error);
    	        console.log('Error fetching data for product details. Please try again.');
    	    }
    	});
    	
        console.log("New product details added successfully!");
        form.reset();
        $('#productModal').modal('hide');
    })
    .catch(error => {
        alert("Error: " + error.message);
    });
}

function updateProductNamesToDropdownAfterPopupAdd(datas){
	var productNameDropdown = document.getElementById('productNameDropdown');
	productNameDropdown.innerHTML = "";
	
	var defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Product";
	defaultOption.disabled = true;
	productNameDropdown.appendChild(defaultOption);
	
	datas.forEach(data =>{
		var option = document.createElement("option");
		option.text = data.productName;
		option.value = data.productName;
		productNameDropdown.appendChild(option);
	});
	
	populateTheRecentlyInsertedProductDetails();
}

function updateProductNamesToDropdown(datas){
	var productNameDropdown = document.getElementById('productNameDropdown');
	productNameDropdown.innerHTML = "";
	
	var defaultOption = document.createElement("option");
	defaultOption.value = "";
	defaultOption.text = "Select Product";
	productNameDropdown.appendChild(defaultOption);
	
	datas.forEach(data =>{
		var option = document.createElement("option");
		option.text = data.productName;
		option.value = data.productName;
		productNameDropdown.appendChild(option);
	});
}

function populateTheRecentlyInsertedProductDetails(){
	$.ajax({
	    type: 'GET', 
	    url: '/fetchRecentProductDetails', 
	    success: function(data) {
	    	
	    	const dropdown = $('#productNameDropdown');
            const valueToSelect = data.productName;

            // Check if the option exists
            if (dropdown.find(`option[value="${valueToSelect}"]`).length > 0) {
                dropdown.val(valueToSelect); // Set the value if present
                fetchProductDetails();
            } else {
                console.warn('Product name not found in dropdown options.');
            }
            
			/* $('#moduleNo').val(data.moduleNo);
			$('#rootFirmwareExternal').val(data.rootFirmwareExternal);
			$('#rootFirmwareInternal').val(data.rootFirmwareInternal);
			$('#routerFirmwareExternal').val(data.routerFirmwareExternal);
			$('#routerFirmwareInternal').val(data.routerFirmwareInternal);
			$('#antennaType').val(data.antennaType);
			$('#firmwareHardwareVersion').val(data.firmwareHardwareVersion); */
				},
	    error: function(xhr, status, error) {
	        console.error('Error fetching data for customer details:', error);
	        console.log('Error fetching data for customer details. Please try again.');
	    }
	});
}

function deleteTransportModeData(data){
	Swal.fire({
		title: "Are you sure?",
		text: "You want to delete!",
		icon: "warning",
		showCancelButton: true,
		confirmButtonColor: "#007bff",
		cancelButtonColor: "#EC7063",
		confirmButtonText: "Yes, delete it!",
		customClass: {
            popup: 'custom-swal-font'
        },
	}).then((result) => {
		if (result.isConfirmed) {
			$.ajax({
			    type: 'POST', 
			    url: '/deleteTransportModeBasedOnName', 
			    data: {
			    	name: data
			    },
			    success: function(data) {
				    	$.ajax({
				    	    type: 'GET', 
				    	    url: '/fetchAllDistinctTransportModes', 
				    	    success: function(data) {
				    			updateTransportModeDetailsDataToDropdown(data);
				    				},
				    	    error: function(xhr, status, error) {
				    	        console.error('Error fetching data for transport mode:', error);
				    	        console.log('Error fetching data for  transport mode. Please try again.');
				    	    }
				    	});
				    	$('#transportDeleteDropDownDataIcon').hide();
					},
			    error: function(xhr, status, error) {
			        console.error('Error deleting transport mode data:', error);
			        console.log('Error deleting transport mode data. Please try again.');
			    }
			});
		}
	});
}

function deleteContactNameData(name, email){
	Swal.fire({
		title: "Are you sure?",
		text: "You want to delete!",
		icon: "warning",
		showCancelButton: true,
		confirmButtonColor: "#007bff",
		cancelButtonColor: "#EC7063",
		confirmButtonText: "Yes, delete it!",
		customClass: {
            popup: 'custom-swal-font'
        },
	}).then((result) => {
		if (result.isConfirmed) {
			$.ajax({
			    type: 'POST', 
			    url: '/deleteCustomerDetailsBasedOnNameAndEmail', 
			    data: {
			    	name: name,
			    	email: email
			    },
			    success: function(data) {
				    	$.ajax({
				    	    type: 'GET', 
				    	    url: '/fetchAllCustomerDetails', 
				    	    success: function(data) {
				    	    	updateCustomerNamesToDropdown(data);
				    				},
				    	    error: function(xhr, status, error) {
				    	        console.error('Error fetching data for customer details:', error);
				    	        console.log('Error fetching data for customer details. Please try again.');
				    	    }
				    	});
				    	document.getElementById("companyName").value = '';
				        document.getElementById("contactNo").value = '';
				        document.getElementById("emailId").value = '';
				        document.getElementById("companyAddress").value = '';
				    	$('#contactNameDeleteDropDownDataIcon').hide();
					},
			    error: function(xhr, status, error) {
			        console.error('Error deleting customer details data:', error);
			        console.log('Error deleting customer details data. Please try again.');
			    }
			});
		}
	});
}

function deleteProductDetailsData(productName, modelNo){
	Swal.fire({
		title: "Are you sure?",
		text: "You want to delete!",
		icon: "warning",
		showCancelButton: true,
		confirmButtonColor: "#007bff",
		cancelButtonColor: "#EC7063",
		confirmButtonText: "Yes, delete it!",
		customClass: {
            popup: 'custom-swal-font'
        },
	}).then((result) => {
		if (result.isConfirmed) {
			$.ajax({
			    type: 'POST', 
			    url: '/deleteProductDetailsBasedOnProdNameAndModelNo', 
			    data: {
			    	prodName: productName,
			    	modelNo: modelNo
			    },
			    success: function(data) {
				    	$.ajax({
				    	    type: 'GET', 
				    	    url: '/getAllProductDetails', 
				    	    success: function(data) {
				    	    	updateProductNamesToDropdown(data);
				    				},
				    	    error: function(xhr, status, error) {
				    	        console.error('Error fetching data for product details:', error);
				    	        console.log('Error fetching data for product details. Please try again.');
				    	    }
				    	});
				    	document.getElementById("rootFirmwareExternal").value = "";
			            document.getElementById("routerFirmwareExternal").value = "";
			            document.getElementById("moduleNo").value = "";
			            document.getElementById("rootFirmwareInternal").value = "";
			            document.getElementById("routerFirmwareInternal").value = "";
			            document.getElementById("antennaType").value = "";
			            document.getElementById("firmwareHardwareVersion").value = "";
			            $('#productImageTag').prop("src", "");
			            $('#productImageBox').hide();
				    	$('#productNameDeleteDropDownDataIcon').hide();
					},
			    error: function(xhr, status, error) {
			        console.error('Error deleting product details data:', error);
			        console.log('Error deleting product details data. Please try again.');
			    }
			});
		}
	});
}

function closeSendEmailForCustomerOuterDiv(){
	document.body.style.overflow = "auto";
	$('#sendEmailForCustomerOuterDiv').hide();
}

function openEmailBoxDispatch(id){
	$('#clickedDispatchDataAutoId').val(id);
	$('#emailToAddress').val("");
	$('#emailCCAddress').val("");
	$('#emailSubject').val("");
	$('#emailBody').val("");
	document.body.style.overflow = "none";
	$('#sendEmailForCustomerOuterDiv').show();
}

function closeEmailPasswordOuterDiv(){
	$('#emailPasswordOuterDiv').hide();
}

function openEmailPasswordOuterDiv(){
	if($('#emailToAddress').val() === ""){
		alert("Please enter atleast one to-address to proceed!")
		return;
	}
	
	if($('#emailSubject').val() === ""){
		alert("Please enter a subject!")
		return;
	}
	
	if($('#emailBody').val() === ""){
		alert("Please fill the email body!")
		return;
	}
	
	$('#ionos_password').val("");
	$('#emailPasswordOuterDiv').show();
}

function sendDataToEmailToTheParticularCustomer(){
	let fromAddress = $('#emailFromAddress').val().trim();
	// let fromAddress = "premchand.s@melangesystems.com";
	let toAddress = $('#emailToAddress').val().trim();
	//let toAddress = "premsgowda25@gmail.com";
	let ccAddress = $('#emailCCAddress').val().trim();
	let subjectName = $('#emailSubject').val().trim();
	let bodyContent = $('#emailBody').val().trim();
	let enteredPaswword = $('#ionos_password').val().trim();
	
	const submitButton = document.getElementById('emailSendBtn');
	
	if (!enteredPaswword) {
        Swal.fire({ icon: 'warning', title: "Password is required" });
        return;
    }
	
	if(!fromAddress){
		Swal.fire({ icon: 'warning', title: "Login session has been expired! Please login again", allowOutsideClick: false, allowEscapeKey: false, });
        return;
	}
	
	// Store original button text before changing it
     const originalButtonText = submitButton.innerHTML;
     
     // Disable button and show loading state
     submitButton.disabled = true;
     submitButton.innerHTML = `Validating...`;
	
  	// Validate sender email & password
     fetch('/api/validateSenderCredentials', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ email: fromAddress, password: enteredPaswword })
     })
     .then(response => {
         if (!response.ok) {
             return response.text().then(text => { throw new Error(text); });
         }
         return response.text();
     })
     .then(() => {
    		// Close password popup
         closeEmailPasswordOuterDiv();
    	
    	 let id = $('#clickedDispatchDataAutoId').val();
    	 $.ajax({
    		 url: '/get-dispatch/' + id,
             type: 'GET',
             contentType: 'application/json', // Specify content type
             success: function(data) {
            	 //alert(JSON.stringify(data));
            	 // Proceed with sending email sending...
                 sendEmailToTheCustomerAfterValidation(fromAddress, toAddress, ccAddress, subjectName, bodyContent, enteredPaswword, data);
             },
             error: function(xhr, status, error) {
                 console.error('Failed to get dispatch details for particular data:', error);
                 console.error('Response text:', xhr.responseText);
             }
         });
     })
     .catch(error => {
         Swal.fire({ icon: 'error', title: "Invalid Credentials", text: error.message, allowOutsideClick: false, allowEscapeKey: false, });
         //alert("Invalid Credentials");
         submitButton.disabled = false;
         submitButton.innerHTML = originalButtonText;
     })
     .finally(() => {
     	// Re-enable button and restore original text
         submitButton.disabled = false;
         submitButton.innerHTML = originalButtonText;
     });
}

function sendEmailToTheCustomerAfterValidation(fromAddress, toAddress, ccAddress, subjectName, bodyContent, enteredPaswword, data) {
    displayOnLoadingPopup();

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text("Dispatched Details", 105, 15, { align: "center" });

    const dispatchedDate = formatDates(data.date);
    const returnDate = formatDates(data.returnedDate);
    
      var quantity = parseInt(data.quantity) || 0;
	  var returnedQty = parseInt(data.returnedQty) || 0;
	  var returnedDate = data.returnedDate;
	  var dispatchDate = data.date;
	  var remarkColumnText = '-', productReturnStatus = '-';
	  var diffInMs, diffInDays, qtyDisplay = '0', productImage = '-';

	  if (quantity > 0 && dispatchDate) {
	      var startDate = new Date(dispatchDate);
	      var endDate = returnedDate ? new Date(returnedDate) : new Date();
	      var endDate2 = new Date();
	      
	      if(returnedQty === quantity){
	    	  diffInMs = endDate - startDate;
  	      diffInDays = Math.ceil(diffInMs / (1000 * 60 * 60 * 24));
  	      remarkColumnText = diffInDays + " day(s)";
	      }else if(returnedQty !== quantity){
	    	  diffInMs = endDate2 - startDate;
  	      diffInDays = Math.ceil(diffInMs / (1000 * 60 * 60 * 24));
  	      remarkColumnText = diffInDays + " day(s)";
	      }
	  }
	  
	  if(quantity > 0){
		  if(quantity === returnedQty){
			  productReturnStatus = "Full Return";
		  }else if(returnedQty > 0 && quantity !== returnedQty){
			  productReturnStatus = "Partial Return";
		  }else if(returnedQty == 0){
			  productReturnStatus = "No Return";
		  }
	  }
	  
	  if(data.quantity){
		  var returnQtyValue = '0';
		  if(data.returnedQty){
			  returnQtyValue = data.returnedQty;
		  }
		  qtyDisplay = returnQtyValue+'/'+data.quantity;
	  }

    const tableBody = [
    	
    	["Return Status", productReturnStatus],
        ["Product Retention", remarkColumnText],
        ["Dispatched Date", dispatchedDate],
        ["Returned Date", returnDate],
        ["Quantity", qtyDisplay],
        ["Contact Name", data.customerName],
        ["Company Name", data.companyName],
        ["Product Name", data.productName],
        ["Module No", data.moduleNo],
        ["Emp Name", data.userName],
        ["Transport Mode", data.transportMode],
        ["DcNo", data.dcNo],
        ["EWayBill", data.eWayBillNo],
        ["InvoiceNo", data.invoiceNo],
        ["Company Address", data.companyAddress],
        ["Mobile No", data.contactNo],
        ["Customer Email", data.emailId],
        ["Root Firm ver External", data.rootFirmwareExternal],
        ["Antenna Type", data.antennaType],
        ["Root Firm ver Internal", data.rootFirmwareInternal],
        ["Router Firm ver External", data.routerFirmwareExternal],
        ["Router Firm ver Internal", data.routerFirmwareInternal],
        ["appSKey", data.appSKey],
        ["nwkSKey", data.nwkSKey],
        ["Delivery Addr", data.deviceAddress],
        ["appEUI", data.appEUI],
        ["Remarks", data.remarks],
    ];

    doc.autoTable({
        startY: 25,
        body: tableBody,
        styles: { cellPadding: 2, fontSize: 10 },
        headStyles: { fillColor: [41, 128, 185], textColor: 255 },
        alternateRowStyles: { fillColor: [245, 245, 245] }
    });

    let finalY = doc.lastAutoTable.finalY + 5;

    function finalizeAndSendPDF() {
        const pdfBlob = new Blob([doc.output("arraybuffer")], { type: "application/pdf" });

        const formData = new FormData();
        formData.append("from", fromAddress);
        formData.append("to", toAddress);
        formData.append("cc", ccAddress);
        formData.append("subject", subjectName);
        formData.append("message", bodyContent);
        formData.append("password", enteredPaswword);
        formData.append("file", pdfBlob, "dispatched_details.pdf");

        $.ajax({
            type: "POST",
            url: "/sendEmailToTheSuperiorWithAttachment",
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                hideLoadingPopup();
                closeSendEmailForCustomerOuterDiv();
                Swal.fire({
                    icon: 'success',
                    title: "Delivered",
                    text: response,
                    allowOutsideClick: false,
                    allowEscapeKey: false
                });
            },
            error: function(xhr) {
                alert("Error: " + xhr.responseText);
                hideLoadingPopup();
            }
        });
    }

    // Check if image exists
    if (data.uploadFile) {
        const imageUrl = `/dispatchDocs/${data.uploadFile}`;
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.onload = function () {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            const base64Image = canvas.toDataURL("image/png");
            doc.addImage(base64Image, "PNG", 10, finalY, 40, 40);
            finalizeAndSendPDF(); // Proceed after image is added
        };
        img.onerror = function () {
            console.error("Failed to load image.");
            finalizeAndSendPDF(); // Proceed without image
        };
        img.src = imageUrl;
    } else {
        finalizeAndSendPDF(); // No image case
    }
}

function formatDates(date) {
    const dateParts = date.split('-');
    if (dateParts.length === 3) {
        return `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
    }
    return date;
}
</script>

<script>
function displayOnLoadingPopup(){
	$('#loadingPopup').show();
	$('#loadingPopupPara').text("Loading, please wait...");
}

function hideLoadingPopup(){
	$('#loadingPopup').hide();
}
</script>

  	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  	<script>
    const searchInput = document.getElementById('searchInput');
    const table = document.getElementById('holidayTable2');
    const rows = table.getElementsByTagName('tr');

    searchInput.addEventListener('keyup', function () {
        const filter = searchInput.value.toLowerCase();

        for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            let match = false;

            for (let j = 0; j < cells.length; j++) {
                const cellText = cells[j].textContent.toLowerCase();
                if (cellText.includes(filter)) {
                    match = true;
                    break;
                }
            }

            rows[i].style.display = match ? '' : 'none';
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userIcon = document.querySelector(".fa-circle-user");
        const dropdown = document.getElementById("userDropdown");

        userIcon.addEventListener("click", function () {
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });

        // Optional: Close dropdown when clicking outside
        document.addEventListener("click", function (e) {
            if (!userIcon.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = "none";
            }
        });
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        const userIcon = document.querySelector("#dispatchMenu");
        const dropdown = document.querySelector(".dispatch_subDropDown");

        userIcon.addEventListener("click", function () {
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });

        // Optional: Close dropdown when clicking outside
        document.addEventListener("click", function (e) {
            if (!userIcon.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = "none";
            }
        });
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        const userIcon = document.querySelector("#masterMenu");
        const dropdown = document.querySelector(".master_subDropDown");

        userIcon.addEventListener("click", function () {
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });

        // Optional: Close dropdown when clicking outside
        document.addEventListener("click", function (e) {
            if (!userIcon.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = "none";
            }
        });
    });
</script>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<!-- sript for download excel -->
<script>
/* This code is to generate table data into an Excel sheet */
function export_To_Excel() {
    const table = document.getElementById('holidayTable2');
    const visibleData = [];

    const rows = table.rows;

    for (let i = 0; i < rows.length; i++) {
        if (rows[i].style.display !== 'none') {
            const cells = rows[i].cells;
            const rowData = [];

            if (i === 0) {
                // Header row: skip first 2 and last column
                for (let j = 2; j < cells.length - 1; j++) {
                    rowData.push(cells[j].innerText.trim());
                }
            } else {
                // Data rows: skip first 3 and last column
            	for (let j = 5; j < cells.length - 1; j++) {
            	    let cellText = cells[j].innerText.trim();

            	    /* if (cells[j].classList.contains("dispatchDate")) {
            	        const dateObj = new Date(cellText);
            	        if (!isNaN(dateObj)) {
            	            const yyyy = dateObj.getFullYear();
            	            const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
            	            const dd = String(dateObj.getDate()).padStart(2, '0');
            	            cellText = `${yyyy}-${mm}-${dd}`;
            	        }
            	    }

            	    if (cells[j].classList.contains("returnDate") && cellText !== '-' && cellText !== '') {
            	        const dateObj = new Date(cellText);
            	        if (!isNaN(dateObj)) {
            	            const yyyy = dateObj.getFullYear();
            	            const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
            	            const dd = String(dateObj.getDate()).padStart(2, '0');
            	            cellText = `${yyyy}-${mm}-${dd}`;
            	        }
            	    } */

            	    rowData.push(cellText);
            	}
            }

            visibleData.push(rowData);
        }
    }

    // Convert to worksheet
    const worksheet = XLSX.utils.aoa_to_sheet(visibleData);

    // Create workbook
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');

    // Save to file
    XLSX.writeFile(workbook, `dispatched_details_${getFormattedDateTime()}.xlsx`);
}


function generateFilteredPDF() {
    var filteredTable = document.getElementById("holidayTable2");
    var tableData = [];
    var headerRow = [];
    var columnWidths = [];

    var totalColumns = filteredTable.rows[1].cells.length; // Use second row (first data row) for correct count

    var startCol = 5; // Start from actual column index (e.g., skip 3 columns)
    var endCol = totalColumns - 1; // Exclude last column

    // Build header manually  use textContent and skip logical positions, not just indices
    var currentColIndex = 0;
    var headerCells = filteredTable.rows[0].cells;

    for (var h = 0; h < headerCells.length; h++) {
        var colspan = parseInt(headerCells[h].getAttribute("colspan")) || 1;
        for (var c = 0; c < colspan; c++) {
            if (currentColIndex >= startCol && currentColIndex < endCol) {
                headerRow.push({
                    text: headerCells[h].textContent,
                    style: 'tableHeader',
                });
                columnWidths.push(12); // adjust as needed
            }
            currentColIndex++;
        }
    }

    tableData.push(headerRow);

    for (var i = 1; i < filteredTable.rows.length; i++) {
        if (filteredTable.rows[i].style.display !== "none") {
            var row = filteredTable.rows[i];
            var rowData = [];

            for (var j = startCol; j < endCol; j++) {
                rowData.push({
                    text: row.cells[j].textContent,
                    style: 'tableCell',
                });
            }

            tableData.push(rowData);
        }
    }

    if (tableData.length > 1) {
        var docDefinition = {
            content: [
                {
                    table: {
                        headerRows: 1,
                        widths: columnWidths,
                        body: tableData,
                    },
                },
            ],
            styles: {
                header: {
                    fontSize: 8,
                    bold: true,
                    margin: [0, 0, 0, 10],
                },
                tableHeader: {
                    bold: true,
                    fontSize: 4,
                },
                tableCell: {
                    fontSize: 4,
                    margin: [0, 2, 2, 2],
                },
            },
            pageMargins: [0, 0, 0, 0],
        };

        pdfMake.createPdf(docDefinition).download(`dispatched_details_${getFormattedDateTime()}.pdf`);
    }
}

function getFormattedDateTime() {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    return `${yyyy}-${mm}-${dd}_${hh}-${min}-${ss}`;
}
</script>

<script>
function openReturnBoxDispatch(id) {
	  //alert(id);
	    fetch(`/get-dispatch/${id}`)
	        .then(response => {
	            if (!response.ok) {
	                throw new Error('Network response was not OK');
	            }
	            return response.json();
	        })
	        .then(data => {
	        	document.getElementById('auto_id_value_return_popup').value = id;
	            document.querySelector('#dispatchedDateReturnPopup').value = data.date || '';
	            document.querySelector('#dispatchedQtyReturnPopup').value = data.quantity || '';
	            document.getElementById('customerNameReturnPopup').value = data.customerName || '';
	            document.querySelector('#companyNameReturnPopup').value = data.companyName || '';
	            document.getElementById('productNameReturnPopup').value = data.productName || '';
	            document.querySelector('#moduleNoReturnPopup').value = data.moduleNo || '';
	            document.querySelector('#returnedDateReturnPopup').value = data.returnedDate || '';
	            document.querySelector('#returnedQtyReturnPopup').value = data.returnedQty || '';
	            // Show the modal
	            const dispatchModal = new bootstrap.Modal(document.getElementById('dispatchReturnModal'));
	            dispatchModal.show();
	        })
	        .catch(error => {
	            console.error('There was a problem with the fetch operation:', error);
	        });
	}
	
function openGenerateDcBoxDispatch(id) {
	$('#auto_id_ForHiddendispatch_text').val(id);
    fetch(`/get-dc-dispatch/${id}`)
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not OK');
        }
        return response.json();
    })
    .then(data => {
        //console.log("Fetched Dispatch:", data);

        // User Details
        document.querySelector('#dcUserName').value = data.userName || '';
        document.querySelector('#dcTransportMode').value = data.transportMode || '';
        document.querySelector('#dcInvoiceNo').value = data.invoiceNo || '';
        document.querySelector('#dcDeliveryDate').value = data.date || '';
        document.querySelector('#dcDCNo').value = data.dcNo || '';
        document.querySelector('#dcEWayBillNo').value = data.eWayBillNo || '';

        // Customer Details
        document.getElementById('dcCustomerName').value = data.customerName || '';
        document.querySelector('#dcCompanyName').value = data.companyName || '';
        document.querySelector('#dcContactNo').value = data.contactNo || '';
        document.querySelector('#dcEmailId').value = data.emailId || '';
        document.querySelector('#dcCompanyAddress').value = data.companyAddress || '';

        // Product Details
        /* document.getElementById('dcProductName').value = data.productName || '';
        document.querySelector('#dcRootFirmwareExternal').value = data.rootFirmwareExternal || '';
        document.querySelector('#dcRouterFirmwareExternal').value = data.routerFirmwareExternal || '';
        document.querySelector('#dcModuleNo').value = data.moduleNo || '';
        document.querySelector('#dcRootFirmwareInternal').value = data.rootFirmwareInternal || '';
        document.querySelector('#dcRouterFirmwareInternal').value = data.routerFirmwareInternal || '';
        document.querySelector('#dcAntennaType').value = data.antennaType || '';
        document.querySelector('#dcFirmwareHardwareVersion').value = data.firmwareHardwareVersion || ''; 
        document.querySelector('#dcQuantity').value = data.quantity || '';
        document.querySelector('#dcUploadedFilePath').value = data.uploadFile || '';
        document.querySelector('#dcPrice').value = data.price || '';
        document.querySelector('#dcTotalPrice').value = data.total_price || '';
        document.querySelector('#dcDescription').value = data.description || '';*/

        // Configuration Details
        document.querySelector('#dcAppSKey').value = data.appSKey || '';
        document.querySelector('#dcNwkSKey').value = data.nwkSKey || '';
        document.querySelector('#dcAppEUI').value = data.appEUI || '';
        document.querySelector('#dcDeviceAddress').value = data.deviceAddress || '';
        document.querySelector('#dcRemarks').value = data.remarks || '';
        
        document.querySelector('#dcBillerToAddress').value = data.buyer_address || '';
        document.querySelector('#dcDeliveryAddress').value = data.delivery_address || '';
        document.querySelector('#dcPaymentTerms').value = data.payment_terms || '';
        document.querySelector('#dcTermsAndCondition').value = data.terms_condition || '';
        document.querySelector('#dcTaxType').value = data.tax_type || '';
        
        populateProductDetailsInTable(data);
        
        // Show the modal
        const dispatchModal = new bootstrap.Modal(document.getElementById('generateDcDispatchModal'));
        dispatchModal.show();
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });
}

function populateProductDetailsInTable(data) {
    const tbody = document.getElementById('viewProductDetailsPopupTBody');
    tbody.innerHTML = ''; // Clear any existing rows

    let slNo = 1;

    for (let i = 1; i <= 25; i++) {
        const productName = data[`productName${i}`];

        if (productName) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="min-width: 60px;">${slNo++}</td>
                <td style="min-width: 120px;">${productName || '-'}</td>
                <td style="min-width: 120px;">${data[`moduleNo${i}`] || '-'}</td>
                <td style="min-width: 120px;">${data[`antennaType${i}`] || '-'}</td>
                <td style="min-width: 140px;">${data[`rootFirmwareExternal${i}`] || '-'}</td>
                <td style="min-width: 140px;">${data[`rootFirmwareInternal${i}`] || '-'}</td>
                <td style="min-width: 140px;">${data[`routerFirmwareExternal${i}`] || '-'}</td>
                <td style="min-width: 140px;">${data[`routerFirmwareInternal${i}`] || '-'}</td>
                <td style="min-width: 180px;">${data[`firmwareHardwareVersion${i}`] || '-'}</td>
                <td style="min-width: 80px;">${data[`price${i}`] || '-'}</td>
                <td style="min-width: 80px;">${data[`quantity${i}`] || '-'}</td>
                <td style="min-width: 80px;">${data[`total_price${i}`] || '-'}</td>
                <td style="min-width: 140px;">${data[`description${i}`] || '-'}</td>
            `;
            tbody.appendChild(row);
        }
    }
}
	
function insertCustomerDispatchReturn() {
    var returnedDate = document.querySelector('#returnedDateReturnPopup').value;
    var returnedQtyStr = document.querySelector('#returnedQtyReturnPopup').value;
    var dispatchedQtyStr = document.querySelector('#dispatchedQtyReturnPopup').value;
 	// Convert string values to numbers
    var returnedQty = parseInt(returnedQtyStr);
    var dispatchedQty = parseInt(dispatchedQtyStr);
    
    if(dispatchedQty == 0){
    	alert("You can't update the return details because dispatched quantity is 0!");
        return;
    }

    if (!returnedDate) {
        alert("Please select returned date to proceed!");
        return;
    }

    if (!returnedQtyStr) {
        alert("Please enter returned quantity to proceed!");
        return;
    }

    // Check if returned quantity is a valid number
    if (isNaN(returnedQty)) {
        alert("Returned quantity is not a valid number!");
        return;
    }

    // Check if returned quantity is negative
    if (returnedQty < 0) {
        alert("Returned quantity cannot be negative!");
        return;
    }

    // Check if returned quantity exceeds dispatched quantity
    if (returnedQty > dispatchedQty) {
        alert("Returned quantity cannot exceed dispatched quantity!");
        return;
    }

    $.ajax({
		url: 'updateReturnedCustomerData',
        type: 'POST',
        data: {
        	returnedDate: returnedDate,
        	returnedQty: returnedQty,
        	auto_id: $('#auto_id_value_return_popup').val()
        },
        success: function(data) {
            if(data === "successfull"){
            	Swal.fire({
		   	 		title: "Details Updated successfully",
		   	 		icon: "success",
		   	 		showCancelButton: false,
		   	 		confirmButtonColor: "#007bff",
		   	 		cancelButtonColor: "#EC7063",
		   	 		confirmButtonText: "OK",
			   	 	allowOutsideClick: false,
					allowEscapeKey: false,
		   	 	}).then((result) => {
		   			if (result.isConfirmed) {
		   				location.reload();
		   			}
		   		});
            }else{
            	alert("Failed to update customer return details");
            }
        },
        error: function(xhr, status, error) {
            console.error('Failed to update cutomer returned details:', error);
            console.error('Response text:', xhr.responseText);
        }
    });
}
</script>

<script>
	function generateDC(){
		
		var dispatchData = {};
		
		var id = $('#auto_id_ForHiddendispatch_text').val();
		fetch(`/get-dc-dispatch/${id}`)
	    .then(response => {
	        if (!response.ok) {
	            throw new Error('Network response was not OK');
	        }
	        return response.json();
	    })
	    .then(data => {
	    	dispatchData = data;
	    })
	    .catch(error => {
	        console.error('There was a problem with the fetch operation:', error);
	    });
		
/* 		dispatchData = {
				userName: $('#dcUserNamePopup').val(),
				transportMode: $('#dcTransportModePopup').val(),
				invoiceNo: $('#dcInvoiceNoPopup').val(),
				date: $('#dcDeliveryDatePopup').val(),
				dcNo: $('#dcNoPopup').val(),
				eWayBillNo: $('#dcEWayBillNoPopup').val(),
				//customer details
				customerName: $('#dcCustomerNamePopup').val(),
				companyName: $('#dcCompanyNamePopup').val(),
				contactNo: $('#dcContactNoPopup').val(),
				emailId: $('#dcEmailIdPopup').val(),
				companyAddress: $('#dcCompanyAddressPopup').val(),
				// Product Details
			    productName1: $('#dcProductName1').val() || '',
				rootFirmwareExternal1: $('#dcRootFirmwareExternal1').val() || '',
				routerFirmwareExternal1: $('#dcRouterFirmwareExternal1').val() || '',
				moduleNo1: $('#dcModuleNo1').val() || '',
				rootFirmwareInternal1: $('#dcRootFirmwareInternal1').val() || '',
				routerFirmwareInternal1: $('#dcRouterFirmwareInternal1').val() || '',
				antennaType1: $('#dcAntennaType1').val() || '',
				firmwareHardwareVersion1: $('#dcFirmwareHardwareVersion1').val() || '',
				uploadFile1: $('#dcUploadedFilePath1').val() || '',
				price1: $('#dcPrice1').val() || '',
				total_price1: $('#dcTotalPrice1').val() || '',
				description1: $('#dcDescription1').val() || '',
				quantity1: $('#dcQuantity1').val() || '',
			    // Configuration Details
			    appSKey: $('#dcAppSKeyPopup').val(),
			    nwkSKey: $('#dcNwkSKeyPopup').val(),
			    appEUI: $('#dcAppEUIPopup').val(),
			    deviceAddress: $('#dcDeviceAddressPopup').val(),
			    remarks: $('#dcRemarksPopup').val(),
			    returnedQty: '',
			    returnedDate: '',
		}
		
		for (let i = 2; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
			    dispatchData[`productName${i}`] = $(`#dcProductName${i}`).val() || '';
			    dispatchData[`rootFirmwareExternal${i}`] = $(`#dcRootFirmwareExternal${i}`).val() || '';
			    dispatchData[`routerFirmwareExternal${i}`] = $(`#dcRouterFirmwareExternal${i}`).val() || '';
			    dispatchData[`moduleNo${i}`] = $(`#dcModuleNo${i}`).val() || '';
			    dispatchData[`rootFirmwareInternal${i}`] = $(`#dcRootFirmwareInternal${i}`).val() || '';
			    dispatchData[`routerFirmwareInternal${i}`] = $(`#dcRouterFirmwareInternal${i}`).val() || '';
			    dispatchData[`antennaType${i}`] = $(`#dcAntennaType${i}`).val() || '';
			    dispatchData[`firmwareHardwareVersion${i}`] = $(`#dcFirmwareHardwareVersion${i}`).val() || '';
			    dispatchData[`uploadFile${i}`] = $(`#dcUploadedFilePath${i}`).val() || '';
			    dispatchData[`price${i}`] = $(`#dcPrice${i}`).val() || '';
			    dispatchData[`total_price${i}`] = $(`#dcTotalPrice${i}`).val() || '';
			    dispatchData[`description${i}`] = $(`#dcDescription${i}`).val() || '';
			    dispatchData[`quantity${i}`] = $(`#dcQuantity${i}`).val() || '';
			  }
			} */
		
		setTimeout(function() {
			generatePdfDetailsWithFile(dispatchData);
		}, 500);
	}
	
	function viewDC(){
		var dispatchData = {};
		
		var id = $('#auto_id_ForHiddendispatch_text').val();
		fetch(`/get-dc-dispatch/${id}`)
	    .then(response => {
	        if (!response.ok) {
	            throw new Error('Network response was not OK');
	        }
	        return response.json();
	    })
	    .then(data => {
	    	dispatchData = data;
	    })
	    .catch(error => {
	        console.error('There was a problem with the fetch operation:', error);
	    });
		
/* 		dispatchData = {
				userName: $('#dcUserNamePopup').val(),
				transportMode: $('#dcTransportModePopup').val(),
				invoiceNo: $('#dcInvoiceNoPopup').val(),
				date: $('#dcDeliveryDatePopup').val(),
				dcNo: $('#dcNoPopup').val(),
				eWayBillNo: $('#dcEWayBillNoPopup').val(),
				//customer details
				customerName: $('#dcCustomerNamePopup').val(),
				companyName: $('#dcCompanyNamePopup').val(),
				contactNo: $('#dcContactNoPopup').val(),
				emailId: $('#dcEmailIdPopup').val(),
				companyAddress: $('#dcCompanyAddressPopup').val(),
				// Product Details
			    productName1: $('#dcProductName1').val() || '',
				rootFirmwareExternal1: $('#dcRootFirmwareExternal1').val() || '',
				routerFirmwareExternal1: $('#dcRouterFirmwareExternal1').val() || '',
				moduleNo1: $('#dcModuleNo1').val() || '',
				rootFirmwareInternal1: $('#dcRootFirmwareInternal1').val() || '',
				routerFirmwareInternal1: $('#dcRouterFirmwareInternal1').val() || '',
				antennaType1: $('#dcAntennaType1').val() || '',
				firmwareHardwareVersion1: $('#dcFirmwareHardwareVersion1').val() || '',
				uploadFile1: $('#dcUploadedFilePath1').val() || '',
				price1: $('#dcPrice1').val() || '',
				total_price1: $('#dcTotalPrice1').val() || '',
				description1: $('#dcDescription1').val() || '',
				quantity1: $('#dcQuantity1').val() || '',
			    // Configuration Details
			    appSKey: $('#dcAppSKeyPopup').val(),
			    nwkSKey: $('#dcNwkSKeyPopup').val(),
			    appEUI: $('#dcAppEUIPopup').val(),
			    deviceAddress: $('#dcDeviceAddressPopup').val(),
			    remarks: $('#dcRemarksPopup').val(),
			    returnedQty: '',
			    returnedDate: '',
		}
		
		for (let i = 2; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
			    dispatchData[`productName${i}`] = $(`#dcProductName${i}`).val() || '';
			    dispatchData[`rootFirmwareExternal${i}`] = $(`#dcRootFirmwareExternal${i}`).val() || '';
			    dispatchData[`routerFirmwareExternal${i}`] = $(`#dcRouterFirmwareExternal${i}`).val() || '';
			    dispatchData[`moduleNo${i}`] = $(`#dcModuleNo${i}`).val() || '';
			    dispatchData[`rootFirmwareInternal${i}`] = $(`#dcRootFirmwareInternal${i}`).val() || '';
			    dispatchData[`routerFirmwareInternal${i}`] = $(`#dcRouterFirmwareInternal${i}`).val() || '';
			    dispatchData[`antennaType${i}`] = $(`#dcAntennaType${i}`).val() || '';
			    dispatchData[`firmwareHardwareVersion${i}`] = $(`#dcFirmwareHardwareVersion${i}`).val() || '';
			    dispatchData[`uploadFile${i}`] = $(`#dcUploadedFilePath${i}`).val() || '';
			    dispatchData[`price${i}`] = $(`#dcPrice${i}`).val() || '';
			    dispatchData[`total_price${i}`] = $(`#dcTotalPrice${i}`).val() || '';
			    dispatchData[`description${i}`] = $(`#dcDescription${i}`).val() || '';
			    dispatchData[`quantity${i}`] = $(`#dcQuantity${i}`).val() || '';
			  }
			} */
		
		setTimeout(function() {
		    viewPdfDetailsWithFile(dispatchData);
		}, 500);

	}
	
	function generatePdfDetailsWithFile(data) {
		const items = [];
        /* const items = [
            {
                prodName: data.productName,
                antennaType: data.antennaType,
                qty: data.quantity,
                rate: data.price,
                totalPrice: data.total_price
            }
        ]; */
        for (let i = 1; i <= 25; i++) {
        	  const prodName = data[`productName${i}`];

        	  if (prodName) {
        	    items.push({
        	      prodName: prodName,
        	      desc: data[`description${i}`] || '-',
        	      qty: data[`quantity${i}`] || '-',
        	      rate: data[`price${i}`] || '-',
        	      totalPrice: data[`total_price${i}`] || '-'
        	    });
        	  }
        	}
	    const { jsPDF } = window.jspdf;
	    const doc = new jsPDF();

	    // Page border
	    doc.setDrawColor(0);
	    doc.rect(3, 3, 203.5, 291); // Full A4 page

	    let xMargin = 7;
	    let currentY = 10;

	    // Company Info
	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(12);
	    doc.text("Melange Systems Private Limited.", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "normal");
	    doc.setFontSize(10);
	    doc.text("No. 4/1, 7th Cross, Kumara Park West, Bangalore 560020", xMargin, currentY);
	    currentY += 5;
	    doc.text("Tel: 080-2356 1023, Telefax: 080-2346 2175", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(9);
	    doc.text("GSTIN: 29AACCM4737H1ZA, CIN: U72200KA2000PTC027922", xMargin, currentY);
	    currentY += 5;
	    doc.text("Udyam Registration Number: UDYAM-KR-03-0101576", xMargin, currentY);
	    currentY += 2;

	    // Logo (top right)
		const logo = new Image();
	    logo.src = "/assets/img/logo.png"; // Use actual base64 if needed

	    logo.onload = function () {
	        doc.addImage(logo, "PNG", 162, 10, 40, 15); // top right logo

	        // DELIVERY CHALLAN BOX
	        const challanBoxTopY = currentY;
	        const challanBoxHeight = 8;
	        doc.setFontSize(11);
	        doc.setFont("helvetica", "bold");
	        doc.rect(3, challanBoxTopY, 203.5, challanBoxHeight);
	        doc.text("DELIVERY CHALLAN", 85, challanBoxTopY + 5.5);
	        currentY += challanBoxHeight;

	     // Shared Y for both sections starting from bottom border of CHALLAN BOX
	        const boxTopY = currentY;
	        let leftY = boxTopY + 7;
	        let rightY = boxTopY + 7;
	        const leftX = 3;
	        const rightX = 104.5;
	        const boxWidth = 101.5;
	        const labelSpacing = 30;

	        // ---- CUSTOMER DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Buyer (Bill to):", leftX + 4, leftY);
	        leftY += 4;
	        
	        let maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress1 = doc.splitTextToSize(data.buyer_address || '-', 65);
	        doc.text(wrappedAddress1, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress1.length - (2 * 19.5);
	        
	        leftY += maxLeftY;
	        
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Address:", leftX + 4, leftY);
	        leftY += 4;
	        
	        maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress2 = doc.splitTextToSize(data.delivery_address || '-', 65);
	        doc.text(wrappedAddress2, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress2.length * 4;
	        
	        /* const customerFields = [
	            { label: "Customer Name:", value: data.customerName || '-' },
	            { label: "Company Name:", value: data.companyName || '-' },
	            { label: "Contact No:", value: data.contactNo || '-' },
	            { label: "Email Id:", value: data.emailId || '-' },
	        ];

	        let maxLeftY = leftY;
	        customerFields.forEach(item => {
	            doc.text(item.label, leftX + 4, maxLeftY);
	            doc.text(item.value, leftX + labelSpacing + 4, maxLeftY);
	            maxLeftY += 5;
	        });

	        // Handle address
	        doc.text("Company Address:", leftX + 4, maxLeftY);
	        const wrappedAddress = doc.splitTextToSize(data.companyAddress || '-', 65);
	        doc.text(wrappedAddress, leftX + labelSpacing + 4, maxLeftY);
	        maxLeftY += wrappedAddress.length * 5; */

	        const customerBottomY = maxLeftY - 2;

	        // ---- EMPLOYEE DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Details", rightX + 4, rightY);
	        rightY += 5;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);

	        const employeeFields = [
	            { label: "DC No", value: ": "+data.dcNo || '-' },
	            { label: "Invoice No", value: ": "+data.invoiceNo || '-' },
	            { label: "Dispatched Date", value: ": "+data.date || '-' },
	            { label: "Transport Mode", value: ": "+data.transportMode || '-' },
	            //{ label: "Remarks:", value: data.remarks || '-' },
	        ];
	        
	        let maxRightY = rightY;

	        employeeFields.forEach(item => {
	            doc.text(item.label, rightX + 4, maxRightY);
	            doc.text(item.value, rightX + labelSpacing + 4, maxRightY);
	            maxRightY += 5;
	        });
	        
	        doc.text("Remarks", rightX + 4, maxRightY);
	        const wrappedRemarks = doc.splitTextToSize(": "+data.remarks || '-', 65);
	        doc.text(wrappedRemarks, rightX + labelSpacing + 4, maxRightY);
	        maxRightY += wrappedRemarks.length * 3.1;

	        const employeeBottomY = maxRightY + 2;

	        // Draw aligned boxes (top edge merged with delivery challan bottom)
	        const sectionHeight = Math.max(customerBottomY, employeeBottomY) - boxTopY;
	        doc.rect(leftX, boxTopY, boxWidth, sectionHeight);
	        doc.rect(rightX, boxTopY, boxWidth+0.5, sectionHeight);
	        
	        //  Table structure setup
	        let startY = boxTopY + sectionHeight;
	        let rowHeight = 6;
	        let tableX = 3;

	        // Column widths
	        const colWidths = {
	            slNo: 14,
	            desc: 48,
	            hsn: 94.5,
	            qty: 10,
	            rate: 15,
	            value: 22
	        };

	        // Draw table headers
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);

	        doc.rect(tableX, startY, colWidths.slNo, rowHeight); // Sl No
	        doc.text("Sl No.", tableX + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo, startY, colWidths.desc, rowHeight); // Description
	        doc.text("Product Name", tableX + colWidths.slNo + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc, startY, colWidths.hsn, rowHeight); // HSN
	        doc.text("Description", tableX + colWidths.slNo + colWidths.desc + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, startY, colWidths.qty, rowHeight); // Quantity
	        doc.text("Qty", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, startY, colWidths.rate, rowHeight); // Rate
	        doc.text("Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, startY, colWidths.value, rowHeight); // Value
	        doc.text("Total Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, startY + 4);

	        // Reset font for content
	        doc.setFont("helvetica", "normal");

	        let currentYY = startY + rowHeight;
	        let slNo = 1;
	        let totalTaxable = 0;

	        items.forEach(item => {
	            const descLines = doc.splitTextToSize(item.prodName, 48);
	            const antennaLines = doc.splitTextToSize(item.desc, 94);

	            // Calculate max number of lines between the two (if others might wrap too, include those)
	            const numLines = Math.max(descLines.length, antennaLines.length);
	            const height = numLines * 4.2; // 6 is line height

	            // Draw Sl No
	            doc.rect(tableX, currentYY, colWidths.slNo, height);
	            doc.text(String(slNo++), tableX + 2, currentYY + 3.5);

	            // Draw Product Name (desc)
	            doc.rect(tableX + colWidths.slNo, currentYY, colWidths.desc, height);
	            doc.text(descLines, tableX + colWidths.slNo + 2, currentYY + 3.5);

	            // Draw Antenna Type (hsn)
	            doc.rect(tableX + colWidths.slNo + colWidths.desc, currentYY, colWidths.hsn, height);
	            doc.text(antennaLines, tableX + colWidths.slNo + colWidths.desc + 2, currentYY + 3.5);

	            // Draw Quantity
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, currentYY, colWidths.qty, height);
	            doc.text(String(item.qty), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, currentYY + 3.5);

	            // Draw Rate
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, currentYY, colWidths.rate, height);
	            doc.text(String(item.rate), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, currentYY + 3.5);

	            // Draw Total Price
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, currentYY, colWidths.value, height);
	            doc.text(String(item.totalPrice), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, currentYY + 3.5);

	            currentYY += height;
	            totalTaxable += parseFloat(item.totalPrice);
	        });

	     	//  Tax values
	        const cgst = +(totalTaxable * 0.09).toFixed(2);
	        const sgst = +(totalTaxable * 0.09).toFixed(2);
	        const igst = +(totalTaxable * 0.18).toFixed(2);
	        const interStateTotalTax = +(cgst + sgst).toFixed(2);
	        const outerStateTotalTax = +(igst).toFixed(2);
	        
	        let taxFields = [], totalAfterTax, netAmount;
	        
	        if(data.tax_type === "Interstate"){
	        	totalAfterTax = +(totalTaxable + interStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "CGST (9%):", value: cgst.toFixed(2) },
		            { label: "SGST (9%):", value: sgst.toFixed(2) },
		            { label: "Total Tax Amount:", value: interStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	        }else if(data.tax_type === "Outerstate"){
	        	totalAfterTax = +(totalTaxable + outerStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "IGST (18%):", value: igst.toFixed(2) },
		            { label: "Total Tax Amount:", value: outerStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	       	}

	        // Dimensions
	        const leftBoxX = tableX;
	        const leftBoxWidth = colWidths.slNo + colWidths.desc + colWidths.hsn - 5; // similar to Customer box
	        const rightBoxX = leftBoxX + leftBoxWidth;
	        const rightBoxWidth = colWidths.rate + colWidths.value + colWidths.qty;
	        const rowHeightt = 6;
	        const taxBoxHeight = taxFields.length * rowHeightt;
	        let taxStartY = currentYY; // merge with product table bottom

	        // Draw Left Box (empty)
	        //doc.rect(leftBoxX + 10, taxStartY, leftBoxWidth - 10, taxBoxHeight);

	        // Draw Right Box (tax table)
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8);

	        let rowY = taxStartY;

	        taxFields.forEach(field => {
	            // Label column
	            doc.rect(rightBoxX - 10, rowY, rightBoxWidth + 15, rowHeightt);
	            doc.text(field.label, rightBoxX - 8, rowY + 4);

	            // Value column
	            //doc.rect(rightBoxX + rightBoxWidth + 5 / 1, rowY, rightBoxWidth / 1, rowHeightt);
	            doc.text(String(field.value), rightBoxX + rightBoxWidth - 14.5, rowY + 4);

	            rowY += rowHeightt;
	        });

	     	// Set font, size, and color
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8.5);

	        // Prepare text
	        const amountWordsText = `TOTAL IN WORDS: ${numberToWords(netAmount)} Rupees Only`;

	        // Get page dimensions
	        const pageWidth = doc.internal.pageSize.getWidth()-10;
	        const amountWordsHeight = 8;
	        const amountWordsY = taxStartY + taxBoxHeight; // Merge with bottom of tax box

	        // Draw full-width rectangle
	        doc.setDrawColor(0); // Black border
	        doc.rect(3, amountWordsY, 203.5, amountWordsHeight - 2);

	        // Center text inside the rectangle
	        const textWidth = doc.getTextWidth(amountWordsText);
	        const textX = (pageWidth - textWidth) / 2;
	        const textY = amountWordsY + 4; // Vertically center text in 10px height box

	        doc.text(amountWordsText, textX, textY);
	        
	     	// === Two Half Boxes Below ===
	        const marginX = 3;
	        const boxWidthh = 101.5;
	        const startYy = amountWordsY + amountWordsHeight - 2;

	        // -- LEFT BOX: Payment Terms --
	        const leftXx = marginX;
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Payment Terms", leftXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedPaymentTerms = doc.splitTextToSize(data.payment_terms || '-', 97); // adjust width
	        doc.text(wrappedPaymentTerms, leftXx + 4, startYy + 10);
	        const leftHeight = wrappedPaymentTerms.length * 4; // approx line height

	        // -- RIGHT BOX: Declaration or other field --
	        const rightXx = marginX + boxWidthh;
	        doc.setFont("helvetica", "bold");
	        doc.text("Terms and Conditions", rightXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        const wrappedDeclaration = doc.splitTextToSize(data.terms_condition || '-', 97);
	        doc.text(wrappedDeclaration, rightXx + 4, startYy + 10);
	        const rightHeight = wrappedDeclaration.length * 4;

	     	// -- FINAL HEIGHT --
	        let finalBoxHeight = Math.max(leftHeight, rightHeight) * 3;
	        
	        if(Math.max(leftHeight, rightHeight) > 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 5;
	        }else if(Math.max(leftHeight, rightHeight) > 10 && Math.max(leftHeight, rightHeight) <= 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 6;
	        }

	        // Draw the two rectangles
	        doc.rect(leftXx, startYy, boxWidthh, finalBoxHeight);
	        doc.rect(rightXx, startYy, boxWidthh+0.5, finalBoxHeight);
	        
	     	// Signature section
	        let sigY = amountWordsY + 10;
	        doc.setFont("helvetica", "bold");
	        doc.text("* This is a computer-generated Delivery Challan, no seal and signature required", 40, 293);
	        //doc.line(145, sigY + 12, 200, sigY + 12); // Signature line

	        const now = new Date();
	        const formattedDateTime = now.toLocaleString('en-GB', {
	          year: 'numeric',
	          month: '2-digit',
	          day: '2-digit',
	          hour: '2-digit',
	          minute: '2-digit',
	          second: '2-digit'
	        }).replace(/[/:]/g, '-').replace(', ', '_');

	        doc.save(`Delivery_Challan_${data.companyName || '001'}_${formattedDateTime}.pdf`);
	    };
	}
	
	function viewPdfDetailsWithFile(data) {
		const items = [];
        
        for (let i = 1; i <= 25; i++) {
        	  const prodName = data[`productName${i}`];

        	  if (prodName) {
        	    items.push({
        	      prodName: prodName,
        	      desc: data[`description${i}`] || '-',
        	      qty: data[`quantity${i}`] || '-',
        	      rate: data[`price${i}`] || '-',
        	      totalPrice: data[`total_price${i}`] || '-'
        	    });
        	  }
        	}
		//console.log(JSON.stringify(data));
	    const { jsPDF } = window.jspdf;
	    const doc = new jsPDF({
		    orientation: 'portrait',
		    unit: 'mm',
		    format: 'a4'
		});

	    // Page border
	    doc.setDrawColor(0);
	    doc.rect(3, 3, 203.5, 291); // Full A4 page

	    let xMargin = 7;
	    let currentY = 10;

	    // Company Info
	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(12);
	    doc.text("Melange Systems Private Limited.", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "normal");
	    doc.setFontSize(10);
	    doc.text("No. 4/1, 7th Cross, Kumara Park West, Bangalore 560020", xMargin, currentY);
	    currentY += 5;
	    doc.text("Tel: 080-2356 1023, Telefax: 080-2346 2175", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(9);
	    doc.text("GSTIN: 29AACCM4737H1ZA, CIN: U72200KA2000PTC027922", xMargin, currentY);
	    currentY += 5;
	    doc.text("Udyam Registration Number: UDYAM-KR-03-0101576", xMargin, currentY);
	    currentY += 2;

	    // Logo (top right)
	    const logo = new Image();
	    logo.src = "/assets/img/logo.png"; // Use actual base64 if needed

	    logo.onload = function () {
	        doc.addImage(logo, "PNG", 162, 10, 40, 15); // top right logo

	        // DELIVERY CHALLAN BOX
	        const challanBoxTopY = currentY;
	        const challanBoxHeight = 8;
	        doc.setFontSize(11);
	        doc.setFont("helvetica", "bold");
	        doc.rect(3, challanBoxTopY, 203.5, challanBoxHeight);
	        doc.text("DELIVERY CHALLAN", 85, challanBoxTopY + 5.5);
	        currentY += challanBoxHeight;

	     // Shared Y for both sections starting from bottom border of CHALLAN BOX
	        const boxTopY = currentY;
	        let leftY = boxTopY + 7;
	        let rightY = boxTopY + 7;
	        const leftX = 3;
	        const rightX = 104.5;
	        const boxWidth = 101.5;
	        const labelSpacing = 30;

	        // ---- CUSTOMER DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Buyer (Bill to):", leftX + 4, leftY);
	        leftY += 4;
	        
	        let maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress1 = doc.splitTextToSize(data.buyer_address || '-', 65);
	        doc.text(wrappedAddress1, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress1.length - (2 * 19.5);
	        
	        leftY += maxLeftY;
	        
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Address:", leftX + 4, leftY);
	        leftY += 4;
	        
	        maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress2 = doc.splitTextToSize(data.delivery_address || '-', 65);
	        doc.text(wrappedAddress2, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress2.length * 4;
	        
	        /* const customerFields = [
	            { label: "Customer Name:", value: data.customerName || '-' },
	            { label: "Company Name:", value: data.companyName || '-' },
	            { label: "Contact No:", value: data.contactNo || '-' },
	            { label: "Email Id:", value: data.emailId || '-' },
	        ];

	        let maxLeftY = leftY;
	        customerFields.forEach(item => {
	            doc.text(item.label, leftX + 4, maxLeftY);
	            doc.text(item.value, leftX + labelSpacing + 4, maxLeftY);
	            maxLeftY += 5;
	        });

	        // Handle address
	        doc.text("Company Address:", leftX + 4, maxLeftY);
	        const wrappedAddress = doc.splitTextToSize(data.companyAddress || '-', 65);
	        doc.text(wrappedAddress, leftX + labelSpacing + 4, maxLeftY);
	        maxLeftY += wrappedAddress.length * 5; */

	        const customerBottomY = maxLeftY - 2;

	        // ---- EMPLOYEE DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Details", rightX + 4, rightY);
	        rightY += 5;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);

	        const employeeFields = [
	            { label: "DC No", value: ": "+data.dcNo || '-' },
	            { label: "Invoice No", value: ": "+data.invoiceNo || '-' },
	            { label: "Dispatched Date", value: ": "+data.date || '-' },
	            { label: "Transport Mode", value: ": "+data.transportMode || '-' },
	            //{ label: "Remarks:", value: data.remarks || '-' },
	        ];
	        
	        let maxRightY = rightY;

	        employeeFields.forEach(item => {
	            doc.text(item.label, rightX + 4, maxRightY);
	            doc.text(item.value, rightX + labelSpacing + 4, maxRightY);
	            maxRightY += 5;
	        });
	        
	        doc.text("Remarks", rightX + 4, maxRightY);
	        const wrappedRemarks = doc.splitTextToSize(": "+data.remarks || '-', 65);
	        doc.text(wrappedRemarks, rightX + labelSpacing + 4, maxRightY);
	        maxRightY += wrappedRemarks.length * 3.1;

	        const employeeBottomY = maxRightY + 2;

	        // Draw aligned boxes (top edge merged with delivery challan bottom)
	        const sectionHeight = Math.max(customerBottomY, employeeBottomY) - boxTopY;
	        doc.rect(leftX, boxTopY, boxWidth, sectionHeight);
	        doc.rect(rightX, boxTopY, boxWidth+0.5, sectionHeight);
	        
	        //  Table structure setup
	        let startY = boxTopY + sectionHeight;
	        let rowHeight = 6;
	        let tableX = 3;

	        // Column widths
	        const colWidths = {
	            slNo: 14,
	            desc: 48,
	            hsn: 94.5,
	            qty: 10,
	            rate: 15,
	            value: 22
	        };

	        // Draw table headers
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);

	        doc.rect(tableX, startY, colWidths.slNo, rowHeight); // Sl No
	        doc.text("Sl No.", tableX + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo, startY, colWidths.desc, rowHeight); // Description
	        doc.text("Product Name", tableX + colWidths.slNo + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc, startY, colWidths.hsn, rowHeight); // HSN
	        doc.text("Description", tableX + colWidths.slNo + colWidths.desc + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, startY, colWidths.qty, rowHeight); // Quantity
	        doc.text("Qty", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, startY, colWidths.rate, rowHeight); // Rate
	        doc.text("Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, startY, colWidths.value, rowHeight); // Value
	        doc.text("Total Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, startY + 4);

	        // Reset font for content
	        doc.setFont("helvetica", "normal");

	        let currentYY = startY + rowHeight;
	        let slNo = 1;
	        let totalTaxable = 0;

	        items.forEach(item => {
	            const descLines = doc.splitTextToSize(item.prodName, 48);
	            const antennaLines = doc.splitTextToSize(item.desc, 94);

	            // Calculate max number of lines between the two (if others might wrap too, include those)
	            const numLines = Math.max(descLines.length, antennaLines.length);
	            const height = numLines * 4.2; // 6 is line height

	            // Draw Sl No
	            doc.rect(tableX, currentYY, colWidths.slNo, height);
	            doc.text(String(slNo++), tableX + 2, currentYY + 3.5);

	            // Draw Product Name (desc)
	            doc.rect(tableX + colWidths.slNo, currentYY, colWidths.desc, height);
	            doc.text(descLines, tableX + colWidths.slNo + 2, currentYY + 3.5);

	            // Draw Antenna Type (hsn)
	            doc.rect(tableX + colWidths.slNo + colWidths.desc, currentYY, colWidths.hsn, height);
	            doc.text(antennaLines, tableX + colWidths.slNo + colWidths.desc + 2, currentYY + 3.5);

	            // Draw Quantity
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, currentYY, colWidths.qty, height);
	            doc.text(String(item.qty), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, currentYY + 3.5);

	            // Draw Rate
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, currentYY, colWidths.rate, height);
	            doc.text(String(item.rate), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, currentYY + 3.5);

	            // Draw Total Price
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, currentYY, colWidths.value, height);
	            doc.text(String(item.totalPrice), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, currentYY + 3.5);

	            currentYY += height;
	            totalTaxable += parseFloat(item.totalPrice);
	        });

	     	//  Tax values
	        const cgst = +(totalTaxable * 0.09).toFixed(2);
	        const sgst = +(totalTaxable * 0.09).toFixed(2);
	        const igst = +(totalTaxable * 0.18).toFixed(2);
	        const interStateTotalTax = +(cgst + sgst).toFixed(2);
	        const outerStateTotalTax = +(igst).toFixed(2);
	        
	        let taxFields = [], totalAfterTax, netAmount;
	        
	        if(data.tax_type === "Interstate"){
	        	totalAfterTax = +(totalTaxable + interStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "CGST (9%):", value: cgst.toFixed(2) },
		            { label: "SGST (9%):", value: sgst.toFixed(2) },
		            { label: "Total Tax Amount:", value: interStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	        }else if(data.tax_type === "Outerstate"){
	        	totalAfterTax = +(totalTaxable + outerStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "IGST (18%):", value: igst.toFixed(2) },
		            { label: "Total Tax Amount:", value: outerStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	       	}

	        // Dimensions
	        const leftBoxX = tableX;
	        const leftBoxWidth = colWidths.slNo + colWidths.desc + colWidths.hsn - 5; // similar to Customer box
	        const rightBoxX = leftBoxX + leftBoxWidth;
	        const rightBoxWidth = colWidths.rate + colWidths.value + colWidths.qty;
	        const rowHeightt = 6;
	        const taxBoxHeight = taxFields.length * rowHeightt;
	        let taxStartY = currentYY; // merge with product table bottom

	        // Draw Left Box (empty)
	        //doc.rect(leftBoxX + 10, taxStartY, leftBoxWidth - 10, taxBoxHeight);

	        // Draw Right Box (tax table)
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8);

	        let rowY = taxStartY;

	        taxFields.forEach(field => {
	            // Label column
	            doc.rect(rightBoxX - 10, rowY, rightBoxWidth + 15, rowHeightt);
	            doc.text(field.label, rightBoxX - 8, rowY + 4);

	            // Value column
	            //doc.rect(rightBoxX + rightBoxWidth + 5 / 1, rowY, rightBoxWidth / 1, rowHeightt);
	            doc.text(String(field.value), rightBoxX + rightBoxWidth - 14.5, rowY + 4);

	            rowY += rowHeightt;
	        });

	     	// Set font, size, and color
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8.5);

	        // Prepare text
	        const amountWordsText = `TOTAL IN WORDS: ${numberToWords(netAmount)} Rupees Only`;

	        // Get page dimensions
	        const pageWidth = doc.internal.pageSize.getWidth()-10;
	        const amountWordsHeight = 8;
	        const amountWordsY = taxStartY + taxBoxHeight; // Merge with bottom of tax box

	        // Draw full-width rectangle
	        doc.setDrawColor(0); // Black border
	        doc.rect(3, amountWordsY, 203.5, amountWordsHeight - 2);

	        // Center text inside the rectangle
	        const textWidth = doc.getTextWidth(amountWordsText);
	        const textX = (pageWidth - textWidth) / 2;
	        const textY = amountWordsY + 4; // Vertically center text in 10px height box

	        doc.text(amountWordsText, textX, textY);
	        
	     	// === Two Half Boxes Below ===
	        const marginX = 3;
	        const boxWidthh = 101.5;
	        const startYy = amountWordsY + amountWordsHeight - 2;

	        // -- LEFT BOX: Payment Terms --
	        const leftXx = marginX;
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Payment Terms", leftXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedPaymentTerms = doc.splitTextToSize(data.payment_terms || '-', 97); // adjust width
	        doc.text(wrappedPaymentTerms, leftXx + 4, startYy + 10);
	        const leftHeight = wrappedPaymentTerms.length * 4; // approx line height

	        // -- RIGHT BOX: Declaration or other field --
	        const rightXx = marginX + boxWidthh;
	        doc.setFont("helvetica", "bold");
	        doc.text("Terms and Conditions", rightXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        const wrappedDeclaration = doc.splitTextToSize(data.terms_condition || '-', 97);
	        doc.text(wrappedDeclaration, rightXx + 4, startYy + 10);
	        const rightHeight = wrappedDeclaration.length * 4;

	        // -- FINAL HEIGHT --
	        let finalBoxHeight = Math.max(leftHeight, rightHeight) * 3;
	        
	        if(Math.max(leftHeight, rightHeight) > 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 5;
	        }else if(Math.max(leftHeight, rightHeight) > 10 && Math.max(leftHeight, rightHeight) <= 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 6;
	        }
	        //console.log(Math.max(leftHeight, rightHeight));

	        // Draw the two rectangles
	        doc.rect(leftXx, startYy, boxWidthh, finalBoxHeight);
	        doc.rect(rightXx, startYy, boxWidthh+0.5, finalBoxHeight);
	        
	     	// Signature section
	        let sigY = amountWordsY + 10;
	        doc.setFont("helvetica", "bold");
	        doc.text("* This is a computer-generated Delivery Challan, no seal and signature required", 40, 293);
	        //doc.line(145, sigY + 12, 200, sigY + 12); // Signature line

	        // Open the PDF in a new tab
			window.open(doc.output('bloburl'));  // This will open the generated PDF in a new tab
	    };
	}
	
	function numberToWords(num) {
	    const ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
	    const teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen",
	                   "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
	    const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];

	    function twoDigits(n) {
	        if (n < 10) return ones[n];
	        if (n < 20) return teens[n - 10];
	        return tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");
	    }

	    function threeDigits(n) {
	        if (n < 100) return twoDigits(n);
	        return ones[Math.floor(n / 100)] + " Hundred" + (n % 100 ? " " + twoDigits(n % 100) : "");
	    }

	    if (num === 0) return "Zero";

	    let result = "";

	    const crore = Math.floor(num / 10000000);
	    num %= 10000000;
	    if (crore) result += threeDigits(crore) + " Crore ";

	    const lakh = Math.floor(num / 100000);
	    num %= 100000;
	    if (lakh) result += threeDigits(lakh) + " Lakh ";

	    const thousand = Math.floor(num / 1000);
	    num %= 1000;
	    if (thousand) result += threeDigits(thousand) + " Thousand ";

	    if (num > 0) result += (result !== "" ? "and " : "") + threeDigits(num);

	    
	    return result.trim();
	}
	
	function convertNumberToWords(amount) {
	    const a = [
	        '', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine',
	        'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen',
	        'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'
	    ];
	    const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

	    if ((amount = amount.toString()).length > 9) return 'Overflow';
	    let n = ('000000000' + amount).substr(-9).match(/.{1,2}/g);
	    let str = '';
	    str += (n[0] != 0) ? (a[Number(n[0])] || b[n[0][0]] + ' ' + a[n[0][1]]) + ' Crore ' : '';
	    str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + ' Lakh ' : '';
	    str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + ' Thousand ' : '';
	    str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + ' Hundred ' : '';
	    str += (n[4] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + ' ' : '';
	    return str.trim();
	}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
	function openGenerateDcBox(){
		const dispatchModal = new bootstrap.Modal(document.getElementById('generateNewDcDispatchModal'));
	    dispatchModal.show();
	}
	
	function toggleAddProductBox(number){
		var parsedNumber = parseInt(number);
		var icon = 'addRow' + parsedNumber;
		var incrementedNumber = parsedNumber + 1;
		var nextProductBox = 'productBox' + incrementedNumber;
		//alert('productBox'+incrementedNumber);
		document.querySelectorAll('#'+nextProductBox+' input').forEach(input => input.value = "");
		$('#'+icon).hide();
		$('#'+nextProductBox).show();
	}
	
	function toggleDeleteProductBox(number){
		var parsedNumber = parseInt(number);
		var decrementedNumber = parsedNumber - 1;
		var icon = 'addRow' + decrementedNumber;
		var currentProductBox = 'productBox' + parsedNumber;
		document.querySelectorAll('#'+currentProductBox+' input').forEach(input => input.value = "");
		$('#'+icon).show();
		$('#'+currentProductBox).hide();
	}
	
	function fetchProductDetails(number) {
		var parsedNumber = parseInt(number);
		
		var dropdown = document.getElementById("dcProductName" + parsedNumber);
	    var selectedText = dropdown.options[dropdown.selectedIndex].text;
	    var prodName, moduleNo;
	    
	 	// Use regex to extract the parts
	    var match = selectedText.match(/^(.*)\s+\[(.*)\]$/);

	    if (match) {
	    	prodName = match[1].trim();  // Part before the parentheses
	    	moduleNo = match[2].trim(); // Inside the parentheses
	    }
		
	    // var selectedProduct = document.getElementById("dcProductName" + parsedNumber).value;
	    
	    if (prodName && moduleNo) {
	    	fetch(`/getProductDetailsByPrdNameAndModelNo?productName=${encodeURIComponent(prodName)}&modelNo=${encodeURIComponent(moduleNo)}`)
	            .then(response => response.json())
	            .then(data => {
	                document.getElementById("dcRootFirmwareExternal" + parsedNumber).value = data.rootFirmwareExternal || "";
	                document.getElementById("dcRouterFirmwareExternal" + parsedNumber).value = data.routerFirmwareExternal || "";
	                document.getElementById("dcModuleNo" + parsedNumber).value = data.moduleNo || "";
	                document.getElementById("dcRootFirmwareInternal" + parsedNumber).value = data.rootFirmwareInternal || "";
	                document.getElementById("dcRouterFirmwareInternal" + parsedNumber).value = data.routerFirmwareInternal || "";
	                document.getElementById("dcAntennaType" + parsedNumber).value = data.antennaType || "";
	                document.getElementById("dcFirmwareHardwareVersion" + parsedNumber).value = data.firmwareHardwareVersion || "";
	                if(data.uploadFile){
	                	$('#dcUploadedFilePath' + parsedNumber).val(data.uploadFile);
	                }else{
	                	$('#dcUploadedFilePath' + parsedNumber).val("");
	                }
	            });
	    	}
		}
	
	function calculateDcTotalPrice(number){
		var parsedNumber = parseInt(number);
		var price = $('#dcPrice' + parsedNumber).val();
		var qty = $('#dcQuantity' + parsedNumber).val();
		
		if(price || qty){
			var tempTotalPrice = price * qty;
			$('#dcTotalPrice' + parsedNumber).val(tempTotalPrice);
		}
	}
	
	$.ajax({
	    type: 'GET', 
	    url: '/fetchAllDistinctTransportModes', 
	    success: function(data) {
			//alert(JSON.stringify(data));
			updateTransportModeDetailsDataToDropdown(data);
				},
	    error: function(xhr, status, error) {
	        console.error('Error fetching data for transport mode:', error);
	        console.log('Error fetching data for  transport mode. Please try again.');
	    }
	});

	function updateTransportModeDetailsDataToDropdown(datas) {
		let transportModeDropdown = document.getElementById("dcTransportModePopup");
		transportModeDropdown.innerHTML = "";
		
		let defaultOption = document.createElement("option");
		defaultOption.value = "";
		defaultOption.text = "Select Transport Mode";
		transportModeDropdown.appendChild(defaultOption);
		
		datas.forEach(data => {
			let option = document.createElement("option");
			option.value = data.name;
			option.text = data.name;
			transportModeDropdown.appendChild(option);
		});
	}
	
	function fetchCustomerDetailsForDcGenerate() {
	    var selectedCustomer = document.getElementById("dcCustomerNamePopup").value;
	    
	    if (selectedCustomer) {
	        fetch('/getCustomerDetails?customerName=' + encodeURIComponent(selectedCustomer))
	            .then(response => response.json())
	            .then(data => {
	                document.getElementById("dcCompanyNamePopup").value = data.companyName || '';
	                document.getElementById("dcContactNoPopup").value = data.contactNo || '';
	                document.getElementById("dcEmailIdPopup").value = data.emailId || '';
	                document.getElementById("dcCompanyAddressPopup").value = data.companyAddress || '';
	            })
	            .catch(error => console.error('Error fetching customer details:', error));
	    } else {
	        document.getElementById("dcCompanyNamePopup").value = '';
	        document.getElementById("dcContactNoPopup").value = '';
	        document.getElementById("dcEmailIdPopup").value = '';
	        document.getElementById("dcCompanyAddressPopup").value = '';
	    }
	}
	
	function generateNewDC(){
		
		for (let i = 1; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
				let productName = $(`#dcProductName${i}`).val();
			    let price = $(`#dcPrice${i}`).val();
			    let quantity = $(`#dcQuantity${i}`).val();
			    let desc = $(`#dcDescription${i}`).val();
			    
			    if (!productName) {
				      alert(`Please select a product name!`);
				      return;  // stops further execution if validation fails
				    }

			    if (!price) {
			      alert(`Please enter price detail!`);
			      return;  // stops further execution if validation fails
			    }

			    if (!quantity || quantity === '0') {
			      alert(`Please enter quantity detail!`);
			      return;
			    }
			    
			    if (!desc) {
				      alert(`Please enter description!`);
				      return;  // stops further execution if validation fails
				    }
			  	}
			}
		
			if (!$('#dcTaxTypePopup').val()) {
			      alert(`Please select a tax type!`);
			      return;  // stops further execution if validation fails
			   }
		//alert($('#dcNoPopup').val());
		var dispatchData = {};
		
		dispatchData = {
				userName: $('#dcUserNamePopup').val(),
				transportMode: $('#dcTransportModePopup').val(),
				invoiceNo: $('#dcInvoiceNoPopup').val(),
				date: $('#dcDeliveryDatePopup').val(),
				dcNo: $('#dcNoPopup').val(),
				eWayBillNo: $('#dcEWayBillNoPopup').val(),
				//customer details
				customerName: $('#dcCustomerNamePopup').val(),
				companyName: $('#dcCompanyNamePopup').val(),
				contactNo: $('#dcContactNoPopup').val(),
				emailId: $('#dcEmailIdPopup').val(),
				companyAddress: $('#dcCompanyAddressPopup').val(),
				// Product Details
			    productName1: $('#dcProductName1').val() || '',
				rootFirmwareExternal1: $('#dcRootFirmwareExternal1').val() || '',
				routerFirmwareExternal1: $('#dcRouterFirmwareExternal1').val() || '',
				moduleNo1: $('#dcModuleNo1').val() || '',
				rootFirmwareInternal1: $('#dcRootFirmwareInternal1').val() || '',
				routerFirmwareInternal1: $('#dcRouterFirmwareInternal1').val() || '',
				antennaType1: $('#dcAntennaType1').val() || '',
				firmwareHardwareVersion1: $('#dcFirmwareHardwareVersion1').val() || '',
				uploadFile1: $('#dcUploadedFilePath1').val() || '',
				price1: $('#dcPrice1').val() || '',
				total_price1: $('#dcTotalPrice1').val() || '',
				description1: $('#dcDescription1').val() || '',
				quantity1: $('#dcQuantity1').val() || '',
			    // Configuration Details
			    appSKey: $('#dcAppSKeyPopup').val(),
			    nwkSKey: $('#dcNwkSKeyPopup').val(),
			    appEUI: $('#dcAppEUIPopup').val(),
			    deviceAddress: $('#dcDeviceAddressPopup').val(),
			    remarks: $('#dcRemarksPopup').val(),
			    returnedQty: '',
			    returnedDate: '',
			    buyer_address: $('#dcBillerToAddressPopup').val(),
			    delivery_address: $('#dcDeliveryAddressPopup').val(),
			    payment_terms: $('#dcPaymentTermsPopup').val(),
			    terms_condition: $('#dcTermsAndConditionPopup').val(),
			    tax_type: $('#dcTaxTypePopup').val(),
		}
		
		for (let i = 2; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
			    dispatchData[`productName${i}`] = $(`#dcProductName${i}`).val() || '';
			    dispatchData[`rootFirmwareExternal${i}`] = $(`#dcRootFirmwareExternal${i}`).val() || '';
			    dispatchData[`routerFirmwareExternal${i}`] = $(`#dcRouterFirmwareExternal${i}`).val() || '';
			    dispatchData[`moduleNo${i}`] = $(`#dcModuleNo${i}`).val() || '';
			    dispatchData[`rootFirmwareInternal${i}`] = $(`#dcRootFirmwareInternal${i}`).val() || '';
			    dispatchData[`routerFirmwareInternal${i}`] = $(`#dcRouterFirmwareInternal${i}`).val() || '';
			    dispatchData[`antennaType${i}`] = $(`#dcAntennaType${i}`).val() || '';
			    dispatchData[`firmwareHardwareVersion${i}`] = $(`#dcFirmwareHardwareVersion${i}`).val() || '';
			    dispatchData[`uploadFile${i}`] = $(`#dcUploadedFilePath${i}`).val() || '';
			    dispatchData[`price${i}`] = $(`#dcPrice${i}`).val() || '';
			    dispatchData[`total_price${i}`] = $(`#dcTotalPrice${i}`).val() || '';
			    dispatchData[`description${i}`] = $(`#dcDescription${i}`).val() || '';
			    dispatchData[`quantity${i}`] = $(`#dcQuantity${i}`).val() || '';
			  }
			}
		
	     fetch('/insertDispatchDcData', {
	         method: 'POST',
	         headers: {
	             'Content-Type': 'application/json'
	         },
	         body: JSON.stringify(dispatchData)
	     })
	     .then(res => res.text())
	     .then(response => {
	    	 if(response === "successfull"){
	    		 //alert(response);
	    		// now request the PDF
	    	      /* return fetch('/downloadDispatchDcPdf', {
	    	        method: 'POST',
	    	        headers: { 'Content-Type': 'application/json' },
	    	        body: JSON.stringify(dispatchData)
	    	      }); */
	    	      generateNewPdfDetailsWithFile(dispatchData);
	    	    } else {
	    	      throw new Error("Insert failed");
	    	    }
	    	  })
	    	  /* .then(res => {
	    	    if (!res.ok) throw new Error("PDF generation failed");
	    	    return res.blob();
	    	  })
	    	  .then(blob => {
	    	    // create an object URL and download it
	    	    const url = URL.createObjectURL(blob);
	    	    const a = document.createElement('a');
	    	    a.href = url;
	    	    // interpolate the actual company name
	    	    const company = dispatchData.companyName.replace(/\s+/g, '_');
	    	    a.download = `DispatchDeliveryChallan_${company}.pdf`;
	    	    document.body.appendChild(a);
	    	    a.click();
	    	    document.body.removeChild(a);
	    	    URL.revokeObjectURL(url);
	    	  }) */
	     .catch(err => {
	    	 console.error("Error:", err);
	    	  alert("Sorry, something went wrong. Please try again.");
	     });
	}
	
	function viewNewDC(){
		for (let i = 1; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
				let productName = $(`#dcProductName${i}`).val();
			    let price = $(`#dcPrice${i}`).val();
			    let quantity = $(`#dcQuantity${i}`).val();
			    let desc = $(`#dcDescription${i}`).val();
			    
			    if (!productName) {
				      alert(`Please select a product name!`);
				      return;  // stops further execution if validation fails
				    }

			    if (!price) {
			      alert(`Please enter price detail!`);
			      return;  // stops further execution if validation fails
			    }

			    if (!quantity || quantity === '0') {
			      alert(`Please enter quantity detail!`);
			      return;
			    }
			    
			    if (!desc) {
				      alert(`Please enter description!`);
				      return;  // stops further execution if validation fails
				    }
			  	}
			}
		
			if (!$('#dcTaxTypePopup').val()) {
			      alert(`Please select a tax type!`);
			      return;  // stops further execution if validation fails
			   }
		
		var dispatchData = {};
		
		dispatchData = {
				userName: $('#dcUserNamePopup').val(),
				transportMode: $('#dcTransportModePopup').val(),
				invoiceNo: $('#dcInvoiceNoPopup').val(),
				date: $('#dcDeliveryDatePopup').val(),
				dcNo: $('#dcNoPopup').val(),
				eWayBillNo: $('#dcEWayBillNoPopup').val(),
				//customer details
				customerName: $('#dcCustomerNamePopup').val(),
				companyName: $('#dcCompanyNamePopup').val(),
				contactNo: $('#dcContactNoPopup').val(),
				emailId: $('#dcEmailIdPopup').val(),
				companyAddress: $('#dcCompanyAddressPopup').val(),
				// Product Details
			    productName1: $('#dcProductName1').val() || '',
				rootFirmwareExternal1: $('#dcRootFirmwareExternal1').val() || '',
				routerFirmwareExternal1: $('#dcRouterFirmwareExternal1').val() || '',
				moduleNo1: $('#dcModuleNo1').val() || '',
				rootFirmwareInternal1: $('#dcRootFirmwareInternal1').val() || '',
				routerFirmwareInternal1: $('#dcRouterFirmwareInternal1').val() || '',
				antennaType1: $('#dcAntennaType1').val() || '',
				firmwareHardwareVersion1: $('#dcFirmwareHardwareVersion1').val() || '',
				uploadFile1: $('#dcUploadedFilePath1').val() || '',
				price1: $('#dcPrice1').val() || '',
				total_price1: $('#dcTotalPrice1').val() || '',
				description1: $('#dcDescription1').val() || '',
				quantity1: $('#dcQuantity1').val() || '',
			    // Configuration Details
			    appSKey: $('#dcAppSKeyPopup').val(),
			    nwkSKey: $('#dcNwkSKeyPopup').val(),
			    appEUI: $('#dcAppEUIPopup').val(),
			    deviceAddress: $('#dcDeviceAddressPopup').val(),
			    remarks: $('#dcRemarksPopup').val(),
			    returnedQty: '',
			    returnedDate: '',
			    buyer_address: $('#dcBillerToAddressPopup').val(),
			    delivery_address: $('#dcDeliveryAddressPopup').val(),
			    payment_terms: $('#dcPaymentTermsPopup').val(),
			    terms_condition: $('#dcTermsAndConditionPopup').val(),
			    tax_type: $('#dcTaxTypePopup').val(),
		}
		
		for (let i = 2; i <= 25; i++) {
			  if (document.getElementById(`productBox${i}`)?.style.display !== 'none') {
			    dispatchData[`productName${i}`] = $(`#dcProductName${i}`).val() || '';
			    dispatchData[`rootFirmwareExternal${i}`] = $(`#dcRootFirmwareExternal${i}`).val() || '';
			    dispatchData[`routerFirmwareExternal${i}`] = $(`#dcRouterFirmwareExternal${i}`).val() || '';
			    dispatchData[`moduleNo${i}`] = $(`#dcModuleNo${i}`).val() || '';
			    dispatchData[`rootFirmwareInternal${i}`] = $(`#dcRootFirmwareInternal${i}`).val() || '';
			    dispatchData[`routerFirmwareInternal${i}`] = $(`#dcRouterFirmwareInternal${i}`).val() || '';
			    dispatchData[`antennaType${i}`] = $(`#dcAntennaType${i}`).val() || '';
			    dispatchData[`firmwareHardwareVersion${i}`] = $(`#dcFirmwareHardwareVersion${i}`).val() || '';
			    dispatchData[`uploadFile${i}`] = $(`#dcUploadedFilePath${i}`).val() || '';
			    dispatchData[`price${i}`] = $(`#dcPrice${i}`).val() || '';
			    dispatchData[`total_price${i}`] = $(`#dcTotalPrice${i}`).val() || '';
			    dispatchData[`description${i}`] = $(`#dcDescription${i}`).val() || '';
			    dispatchData[`quantity${i}`] = $(`#dcQuantity${i}`).val() || '';
			  }
			}		
		
		setTimeout(function() {
		    viewNewPdfDetailsWithFile(dispatchData);
		}, 500);

	}
	
	function generateNewPdfDetailsWithFile(data) {
        const items = [];
        
        /* const items = [
            {
                prodName: data.productName,
                antennaType: data.antennaType,
                qty: data.quantity,
                rate: data.price,
                totalPrice: data.total_price
            }
        ]; */
        for (let i = 1; i <= 25; i++) {
        	  const prodName = data[`productName${i}`];

        	  if (prodName) {
        	    items.push({
        	      prodName: prodName,
        	      desc: data[`description${i}`] || '-',
        	      qty: data[`quantity${i}`] || '-',
        	      rate: data[`price${i}`] || '-',
        	      totalPrice: data[`total_price${i}`] || '-'
        	    });
        	  }
        	}
	    const { jsPDF } = window.jspdf;
	    const doc = new jsPDF();

	    // Page border
	    doc.setDrawColor(0);
	    doc.rect(3, 3, 203.5, 291); // Full A4 page

	    let xMargin = 7;
	    let currentY = 10;

	    // Company Info
	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(12);
	    doc.text("Melange Systems Private Limited.", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "normal");
	    doc.setFontSize(10);
	    doc.text("No. 4/1, 7th Cross, Kumara Park West, Bangalore 560020", xMargin, currentY);
	    currentY += 5;
	    doc.text("Tel: 080-2356 1023, Telefax: 080-2346 2175", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(9);
	    doc.text("GSTIN: 29AACCM4737H1ZA, CIN: U72200KA2000PTC027922", xMargin, currentY);
	    currentY += 5;
	    doc.text("Udyam Registration Number: UDYAM-KR-03-0101576", xMargin, currentY);
	    currentY += 2;

	    // Logo (top right)
		const logo = new Image();
	    logo.src = "/assets/img/logo.png"; // Use actual base64 if needed

	    logo.onload = function () {
	        doc.addImage(logo, "PNG", 162, 10, 40, 15); // top right logo

	        // DELIVERY CHALLAN BOX
	        const challanBoxTopY = currentY;
	        const challanBoxHeight = 8;
	        doc.setFontSize(11);
	        doc.setFont("helvetica", "bold");
	        doc.rect(3, challanBoxTopY, 203.5, challanBoxHeight);
	        doc.text("DELIVERY CHALLAN", 85, challanBoxTopY + 5.5);
	        currentY += challanBoxHeight;

	     // Shared Y for both sections starting from bottom border of CHALLAN BOX
	        const boxTopY = currentY;
	        let leftY = boxTopY + 7;
	        let rightY = boxTopY + 7;
	        const leftX = 3;
	        const rightX = 104.5;
	        const boxWidth = 101.5;
	        const labelSpacing = 30;

	        // ---- CUSTOMER DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Buyer (Bill to):", leftX + 4, leftY);
	        leftY += 4;
	        
	        let maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress1 = doc.splitTextToSize(data.buyer_address || '-', 65);
	        doc.text(wrappedAddress1, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress1.length - (2 * 19.5);
	        
	        leftY += maxLeftY;
	        
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Address:", leftX + 4, leftY);
	        leftY += 4;
	        
	        maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress2 = doc.splitTextToSize(data.delivery_address || '-', 65);
	        doc.text(wrappedAddress2, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress2.length * 4;
	        
	        /* const customerFields = [
	            { label: "Customer Name:", value: data.customerName || '-' },
	            { label: "Company Name:", value: data.companyName || '-' },
	            { label: "Contact No:", value: data.contactNo || '-' },
	            { label: "Email Id:", value: data.emailId || '-' },
	        ];

	        let maxLeftY = leftY;
	        customerFields.forEach(item => {
	            doc.text(item.label, leftX + 4, maxLeftY);
	            doc.text(item.value, leftX + labelSpacing + 4, maxLeftY);
	            maxLeftY += 5;
	        });

	        // Handle address
	        doc.text("Company Address:", leftX + 4, maxLeftY);
	        const wrappedAddress = doc.splitTextToSize(data.companyAddress || '-', 65);
	        doc.text(wrappedAddress, leftX + labelSpacing + 4, maxLeftY);
	        maxLeftY += wrappedAddress.length * 5; */

	        const customerBottomY = maxLeftY - 2;

	        // ---- EMPLOYEE DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Details", rightX + 4, rightY);
	        rightY += 5;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);

	        const employeeFields = [
	            { label: "DC No", value: ": "+data.dcNo || '-' },
	            { label: "Invoice No", value: ": "+data.invoiceNo || '-' },
	            { label: "Dispatched Date", value: ": "+data.date || '-' },
	            { label: "Transport Mode", value: ": "+data.transportMode || '-' },
	            //{ label: "Remarks:", value: data.remarks || '-' },
	        ];
	        
	        let maxRightY = rightY;

	        employeeFields.forEach(item => {
	            doc.text(item.label, rightX + 4, maxRightY);
	            doc.text(item.value, rightX + labelSpacing + 4, maxRightY);
	            maxRightY += 5;
	        });
	        
	        doc.text("Remarks", rightX + 4, maxRightY);
	        const wrappedRemarks = doc.splitTextToSize(": "+data.remarks || '-', 65);
	        doc.text(wrappedRemarks, rightX + labelSpacing + 4, maxRightY);
	        maxRightY += wrappedRemarks.length * 3.1;

	        const employeeBottomY = maxRightY + 2;

	        // Draw aligned boxes (top edge merged with delivery challan bottom)
	        const sectionHeight = Math.max(customerBottomY, employeeBottomY) - boxTopY;
	        doc.rect(leftX, boxTopY, boxWidth, sectionHeight);
	        doc.rect(rightX, boxTopY, boxWidth+0.5, sectionHeight);
	        
	        //  Table structure setup
	        let startY = boxTopY + sectionHeight;
	        let rowHeight = 6;
	        let tableX = 3;

	        // Column widths
	        const colWidths = {
	            slNo: 14,
	            desc: 48,
	            hsn: 94.5,
	            qty: 10,
	            rate: 15,
	            value: 22
	        };

	        // Draw table headers
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);

	        doc.rect(tableX, startY, colWidths.slNo, rowHeight); // Sl No
	        doc.text("Sl No.", tableX + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo, startY, colWidths.desc, rowHeight); // Description
	        doc.text("Product Name", tableX + colWidths.slNo + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc, startY, colWidths.hsn, rowHeight); // HSN
	        doc.text("Description", tableX + colWidths.slNo + colWidths.desc + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, startY, colWidths.qty, rowHeight); // Quantity
	        doc.text("Qty", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, startY, colWidths.rate, rowHeight); // Rate
	        doc.text("Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, startY, colWidths.value, rowHeight); // Value
	        doc.text("Total Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, startY + 4);

	        // Reset font for content
	        doc.setFont("helvetica", "normal");

	        let currentYY = startY + rowHeight;
	        let slNo = 1;
	        let totalTaxable = 0;

	        items.forEach(item => {
	            const descLines = doc.splitTextToSize(item.prodName, 48);
	            const antennaLines = doc.splitTextToSize(item.desc, 94);

	            // Calculate max number of lines between the two (if others might wrap too, include those)
	            const numLines = Math.max(descLines.length, antennaLines.length);
	            const height = numLines * 4.2; // 6 is line height

	            // Draw Sl No
	            doc.rect(tableX, currentYY, colWidths.slNo, height);
	            doc.text(String(slNo++), tableX + 2, currentYY + 3.5);

	            // Draw Product Name (desc)
	            doc.rect(tableX + colWidths.slNo, currentYY, colWidths.desc, height);
	            doc.text(descLines, tableX + colWidths.slNo + 2, currentYY + 3.5);

	            // Draw Antenna Type (hsn)
	            doc.rect(tableX + colWidths.slNo + colWidths.desc, currentYY, colWidths.hsn, height);
	            doc.text(antennaLines, tableX + colWidths.slNo + colWidths.desc + 2, currentYY + 3.5);

	            // Draw Quantity
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, currentYY, colWidths.qty, height);
	            doc.text(String(item.qty), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, currentYY + 3.5);

	            // Draw Rate
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, currentYY, colWidths.rate, height);
	            doc.text(String(item.rate), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, currentYY + 3.5);

	            // Draw Total Price
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, currentYY, colWidths.value, height);
	            doc.text(String(item.totalPrice), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, currentYY + 3.5);

	            currentYY += height;
	            totalTaxable += parseFloat(item.totalPrice);
	        });

	     	//  Tax values
	        const cgst = +(totalTaxable * 0.09).toFixed(2);
	        const sgst = +(totalTaxable * 0.09).toFixed(2);
	        const igst = +(totalTaxable * 0.18).toFixed(2);
	        const interStateTotalTax = +(cgst + sgst).toFixed(2);
	        const outerStateTotalTax = +(igst).toFixed(2);
	        
	        let taxFields = [], totalAfterTax, netAmount;
	        
	        if(data.tax_type === "Interstate"){
	        	totalAfterTax = +(totalTaxable + interStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "CGST (9%):", value: cgst.toFixed(2) },
		            { label: "SGST (9%):", value: sgst.toFixed(2) },
		            { label: "Total Tax Amount:", value: interStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	        }else if(data.tax_type === "Outerstate"){
	        	totalAfterTax = +(totalTaxable + outerStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "IGST (18%):", value: igst.toFixed(2) },
		            { label: "Total Tax Amount:", value: outerStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	       	}

	        // Dimensions
	        const leftBoxX = tableX;
	        const leftBoxWidth = colWidths.slNo + colWidths.desc + colWidths.hsn - 5; // similar to Customer box
	        const rightBoxX = leftBoxX + leftBoxWidth;
	        const rightBoxWidth = colWidths.rate + colWidths.value + colWidths.qty;
	        const rowHeightt = 6;
	        const taxBoxHeight = taxFields.length * rowHeightt;
	        let taxStartY = currentYY; // merge with product table bottom

	        // Draw Left Box (empty)
	        //doc.rect(leftBoxX + 10, taxStartY, leftBoxWidth - 10, taxBoxHeight);

	        // Draw Right Box (tax table)
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8);

	        let rowY = taxStartY;

	        taxFields.forEach(field => {
	            // Label column
	            doc.rect(rightBoxX - 10, rowY, rightBoxWidth + 15, rowHeightt);
	            doc.text(field.label, rightBoxX - 8, rowY + 4);

	            // Value column
	            //doc.rect(rightBoxX + rightBoxWidth + 5 / 1, rowY, rightBoxWidth / 1, rowHeightt);
	            doc.text(String(field.value), rightBoxX + rightBoxWidth - 14.5, rowY + 4);

	            rowY += rowHeightt;
	        });

	     	// Set font, size, and color
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8.5);

	        // Prepare text
	        const amountWordsText = `TOTAL IN WORDS: ${numberToWords(netAmount)} Rupees Only`;

	        // Get page dimensions
	        const pageWidth = doc.internal.pageSize.getWidth()-10;
	        const amountWordsHeight = 8;
	        const amountWordsY = taxStartY + taxBoxHeight; // Merge with bottom of tax box

	        // Draw full-width rectangle
	        doc.setDrawColor(0); // Black border
	        doc.rect(3, amountWordsY, 203.5, amountWordsHeight - 2);

	        // Center text inside the rectangle
	        const textWidth = doc.getTextWidth(amountWordsText);
	        const textX = (pageWidth - textWidth) / 2;
	        const textY = amountWordsY + 4; // Vertically center text in 10px height box

	        doc.text(amountWordsText, textX, textY);
	        
	     	// === Two Half Boxes Below ===
	        const marginX = 3;
	        const boxWidthh = 101.5;
	        const startYy = amountWordsY + amountWordsHeight - 2;

	        // -- LEFT BOX: Payment Terms --
	        const leftXx = marginX;
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Payment Terms", leftXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedPaymentTerms = doc.splitTextToSize(data.payment_terms || '-', 97); // adjust width
	        doc.text(wrappedPaymentTerms, leftXx + 4, startYy + 10);
	        const leftHeight = wrappedPaymentTerms.length * 4; // approx line height

	        // -- RIGHT BOX: Declaration or other field --
	        const rightXx = marginX + boxWidthh;
	        doc.setFont("helvetica", "bold");
	        doc.text("Terms and Conditions", rightXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        const wrappedDeclaration = doc.splitTextToSize(data.terms_condition || '-', 97);
	        doc.text(wrappedDeclaration, rightXx + 4, startYy + 10);
	        const rightHeight = wrappedDeclaration.length * 4;

	        // -- FINAL HEIGHT --
	        let finalBoxHeight = Math.max(leftHeight, rightHeight) * 3;
	        
	        if(Math.max(leftHeight, rightHeight) > 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 5;
	        }else if(Math.max(leftHeight, rightHeight) > 10 && Math.max(leftHeight, rightHeight) <= 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 6;
	        }

	        // Draw the two rectangles
	        doc.rect(leftXx, startYy, boxWidthh, finalBoxHeight);
	        doc.rect(rightXx, startYy, boxWidthh+0.5, finalBoxHeight);
	        
	     	// Signature section
	        let sigY = amountWordsY + 10;
	        doc.setFont("helvetica", "bold");
	        doc.text("* This is a computer-generated Delivery Challan, no seal and signature required", 40, 293);
	        //doc.line(145, sigY + 12, 200, sigY + 12); // Signature line

	        // Save the PDF
	        const now = new Date();
	        const formattedDateTime = now.toLocaleString('en-GB', {
	          year: 'numeric',
	          month: '2-digit',
	          day: '2-digit',
	          hour: '2-digit',
	          minute: '2-digit',
	          second: '2-digit'
	        }).replace(/[/:]/g, '-').replace(', ', '_');

	        doc.save(`Delivery_Challan_${data.companyName || '001'}_${formattedDateTime}.pdf`);

	    };
	}
	
	function viewNewPdfDetailsWithFile(data) {
		const items = [];
        /* const items = [
            {
                prodName: data.productName,
                antennaType: data.antennaType,
                qty: data.quantity,
                rate: data.price,
                totalPrice: data.total_price
            }
        ]; */
        for (let i = 1; i <= 25; i++) {
        	  const prodName = data[`productName${i}`];

        	  if (prodName) {
        	    items.push({
        	      prodName: prodName,
        	      desc: data[`description${i}`] || '-',
        	      qty: data[`quantity${i}`] || '-',
        	      rate: data[`price${i}`] || '-',
        	      totalPrice: data[`total_price${i}`] || '-'
        	    });
        	  }
        	}
		//console.log(JSON.stringify(data));
	    const { jsPDF } = window.jspdf;
	    const doc = new jsPDF({
		    orientation: 'portrait',
		    unit: 'mm',
		    format: 'a4'
		});

	    // Page border
	    doc.setDrawColor(0);
	    doc.rect(3, 3, 203.5, 291); // Full A4 page

	    let xMargin = 7;
	    let currentY = 10;

	    // Company Info
	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(12);
	    doc.text("Melange Systems Private Limited.", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "normal");
	    doc.setFontSize(10);
	    doc.text("No. 4/1, 7th Cross, Kumara Park West, Bangalore 560020", xMargin, currentY);
	    currentY += 5;
	    doc.text("Tel: 080-2356 1023, Telefax: 080-2346 2175", xMargin, currentY);
	    currentY += 5;

	    doc.setFont("helvetica", "bold");
	    doc.setFontSize(9);
	    doc.text("GSTIN: 29AACCM4737H1ZA, CIN: U72200KA2000PTC027922", xMargin, currentY);
	    currentY += 5;
	    doc.text("Udyam Registration Number: UDYAM-KR-03-0101576", xMargin, currentY);
	    currentY += 2;

	    // Logo (top right)
		const logo = new Image();
	    logo.src = "/assets/img/logo.png"; // Use actual base64 if needed

	    logo.onload = function () {
	        doc.addImage(logo, "PNG", 162, 10, 40, 15); // top right logo

	        // DELIVERY CHALLAN BOX
	        const challanBoxTopY = currentY;
	        const challanBoxHeight = 8;
	        doc.setFontSize(11);
	        doc.setFont("helvetica", "bold");
	        doc.rect(3, challanBoxTopY, 203.5, challanBoxHeight);
	        doc.text("DELIVERY CHALLAN", 85, challanBoxTopY + 5.5);
	        currentY += challanBoxHeight;

	     // Shared Y for both sections starting from bottom border of CHALLAN BOX
	        const boxTopY = currentY;
	        let leftY = boxTopY + 7;
	        let rightY = boxTopY + 7;
	        const leftX = 3;
	        const rightX = 104.5;
	        const boxWidth = 101.5;
	        const labelSpacing = 30;

	        // ---- CUSTOMER DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Buyer (Bill to):", leftX + 4, leftY);
	        leftY += 4;
	        
	        let maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress1 = doc.splitTextToSize(data.buyer_address || '-', 65);
	        doc.text(wrappedAddress1, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress1.length - (2 * 19.5);
	        
	        leftY += maxLeftY;
	        
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Address:", leftX + 4, leftY);
	        leftY += 4;
	        
	        maxLeftY = leftY;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedAddress2 = doc.splitTextToSize(data.delivery_address || '-', 65);
	        doc.text(wrappedAddress2, leftX + 4, maxLeftY);
	        maxLeftY += wrappedAddress2.length * 4;
	        
	        /* const customerFields = [
	            { label: "Customer Name:", value: data.customerName || '-' },
	            { label: "Company Name:", value: data.companyName || '-' },
	            { label: "Contact No:", value: data.contactNo || '-' },
	            { label: "Email Id:", value: data.emailId || '-' },
	        ];

	        let maxLeftY = leftY;
	        customerFields.forEach(item => {
	            doc.text(item.label, leftX + 4, maxLeftY);
	            doc.text(item.value, leftX + labelSpacing + 4, maxLeftY);
	            maxLeftY += 5;
	        });

	        // Handle address
	        doc.text("Company Address:", leftX + 4, maxLeftY);
	        const wrappedAddress = doc.splitTextToSize(data.companyAddress || '-', 65);
	        doc.text(wrappedAddress, leftX + labelSpacing + 4, maxLeftY);
	        maxLeftY += wrappedAddress.length * 5; */

	        const customerBottomY = maxLeftY - 2;

	        // ---- EMPLOYEE DETAILS
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Delivery Details", rightX + 4, rightY);
	        rightY += 5;

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);

	        const employeeFields = [
	            { label: "DC No", value: ": "+data.dcNo || '-' },
	            { label: "Invoice No", value: ": "+data.invoiceNo || '-' },
	            { label: "Dispatched Date", value: ": "+data.date || '-' },
	            { label: "Transport Mode", value: ": "+data.transportMode || '-' },
	            //{ label: "Remarks:", value: data.remarks || '-' },
	        ];
	        
	        let maxRightY = rightY;

	        employeeFields.forEach(item => {
	            doc.text(item.label, rightX + 4, maxRightY);
	            doc.text(item.value, rightX + labelSpacing + 4, maxRightY);
	            maxRightY += 5;
	        });
	        
	        doc.text("Remarks", rightX + 4, maxRightY);
	        const wrappedRemarks = doc.splitTextToSize(": "+data.remarks || '-', 65);
	        doc.text(wrappedRemarks, rightX + labelSpacing + 4, maxRightY);
	        maxRightY += wrappedRemarks.length * 3.1;

	        const employeeBottomY = maxRightY + 2;

	        // Draw aligned boxes (top edge merged with delivery challan bottom)
	        const sectionHeight = Math.max(customerBottomY, employeeBottomY) - boxTopY;
	        doc.rect(leftX, boxTopY, boxWidth, sectionHeight);
	        doc.rect(rightX, boxTopY, boxWidth+0.5, sectionHeight);
	        
	        //  Table structure setup
	        let startY = boxTopY + sectionHeight;
	        let rowHeight = 6;
	        let tableX = 3;

	        // Column widths
	        const colWidths = {
	            slNo: 14,
	            desc: 48,
	            hsn: 94.5,
	            qty: 10,
	            rate: 15,
	            value: 22
	        };

	        // Draw table headers
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);

	        doc.rect(tableX, startY, colWidths.slNo, rowHeight); // Sl No
	        doc.text("Sl No.", tableX + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo, startY, colWidths.desc, rowHeight); // Description
	        doc.text("Product Name", tableX + colWidths.slNo + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc, startY, colWidths.hsn, rowHeight); // HSN
	        doc.text("Description", tableX + colWidths.slNo + colWidths.desc + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, startY, colWidths.qty, rowHeight); // Quantity
	        doc.text("Qty", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, startY, colWidths.rate, rowHeight); // Rate
	        doc.text("Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, startY + 4);

	        doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, startY, colWidths.value, rowHeight); // Value
	        doc.text("Total Price", tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, startY + 4);

	        // Reset font for content
	        doc.setFont("helvetica", "normal");

	        let currentYY = startY + rowHeight;
	        let slNo = 1;
	        let totalTaxable = 0;

	        items.forEach(item => {
	            const descLines = doc.splitTextToSize(item.prodName, 48);
	            const antennaLines = doc.splitTextToSize(item.desc, 94);

	            // Calculate max number of lines between the two (if others might wrap too, include those)
	            const numLines = Math.max(descLines.length, antennaLines.length);
	            const height = numLines * 4.2; // 6 is line height

	            // Draw Sl No
	            doc.rect(tableX, currentYY, colWidths.slNo, height);
	            doc.text(String(slNo++), tableX + 2, currentYY + 3.5);

	            // Draw Product Name (desc)
	            doc.rect(tableX + colWidths.slNo, currentYY, colWidths.desc, height);
	            doc.text(descLines, tableX + colWidths.slNo + 2, currentYY + 3.5);

	            // Draw Antenna Type (hsn)
	            doc.rect(tableX + colWidths.slNo + colWidths.desc, currentYY, colWidths.hsn, height);
	            doc.text(antennaLines, tableX + colWidths.slNo + colWidths.desc + 2, currentYY + 3.5);

	            // Draw Quantity
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn, currentYY, colWidths.qty, height);
	            doc.text(String(item.qty), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + 2, currentYY + 3.5);

	            // Draw Rate
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty, currentYY, colWidths.rate, height);
	            doc.text(String(item.rate), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + 2, currentYY + 3.5);

	            // Draw Total Price
	            doc.rect(tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate, currentYY, colWidths.value, height);
	            doc.text(String(item.totalPrice), tableX + colWidths.slNo + colWidths.desc + colWidths.hsn + colWidths.qty + colWidths.rate + 2, currentYY + 3.5);

	            currentYY += height;
	            totalTaxable += parseFloat(item.totalPrice);
	        });

	     	//  Tax values
	        const cgst = +(totalTaxable * 0.09).toFixed(2);
	        const sgst = +(totalTaxable * 0.09).toFixed(2);
	        const igst = +(totalTaxable * 0.18).toFixed(2);
	        const interStateTotalTax = +(cgst + sgst).toFixed(2);
	        const outerStateTotalTax = +(igst).toFixed(2);
	        
	        let taxFields = [], totalAfterTax, netAmount;
	        
	        if(data.tax_type === "Interstate"){
	        	totalAfterTax = +(totalTaxable + interStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "CGST (9%):", value: cgst.toFixed(2) },
		            { label: "SGST (9%):", value: sgst.toFixed(2) },
		            { label: "Total Tax Amount:", value: interStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	        }else if(data.tax_type === "Outerstate"){
	        	totalAfterTax = +(totalTaxable + outerStateTotalTax).toFixed(2);
		        netAmount = Math.ceil(totalAfterTax);
	        	
	        	// Tax rows
		        taxFields.push( 
		            { label: "Amount (Before Tax):", value: totalTaxable.toFixed(2) },
		            { label: "IGST (18%):", value: igst.toFixed(2) },
		            { label: "Total Tax Amount:", value: outerStateTotalTax.toFixed(2) },
		            { label: "Total Amount after GST:", value: totalAfterTax.toFixed(2) },
		            { label: "Net Amount:", value: netAmount.toFixed(2) }
		        );
	       	}

	        // Dimensions
	        const leftBoxX = tableX;
	        const leftBoxWidth = colWidths.slNo + colWidths.desc + colWidths.hsn - 5; // similar to Customer box
	        const rightBoxX = leftBoxX + leftBoxWidth;
	        const rightBoxWidth = colWidths.rate + colWidths.value + colWidths.qty;
	        const rowHeightt = 6;
	        const taxBoxHeight = taxFields.length * rowHeightt;
	        let taxStartY = currentYY; // merge with product table bottom

	        // Draw Left Box (empty)
	        //doc.rect(leftBoxX + 10, taxStartY, leftBoxWidth - 10, taxBoxHeight);

	        // Draw Right Box (tax table)
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8);

	        let rowY = taxStartY;

	        taxFields.forEach(field => {
	            // Label column
	            doc.rect(rightBoxX - 10, rowY, rightBoxWidth + 15, rowHeightt);
	            doc.text(field.label, rightBoxX - 8, rowY + 4);

	            // Value column
	            //doc.rect(rightBoxX + rightBoxWidth + 5 / 1, rowY, rightBoxWidth / 1, rowHeightt);
	            doc.text(String(field.value), rightBoxX + rightBoxWidth - 14.5, rowY + 4);

	            rowY += rowHeightt;
	        });

	     	// Set font, size, and color
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(8.5);

	        // Prepare text
	        const amountWordsText = `TOTAL IN WORDS: ${numberToWords(netAmount)} Rupees Only`;

	        // Get page dimensions
	        const pageWidth = doc.internal.pageSize.getWidth()-10;
	        const amountWordsHeight = 8;
	        const amountWordsY = taxStartY + taxBoxHeight; // Merge with bottom of tax box

	        // Draw full-width rectangle
	        doc.setDrawColor(0); // Black border
	        doc.rect(3, amountWordsY, 203.5, amountWordsHeight - 2);

	        // Center text inside the rectangle
	        const textWidth = doc.getTextWidth(amountWordsText);
	        const textX = (pageWidth - textWidth) / 2;
	        const textY = amountWordsY + 4; // Vertically center text in 10px height box

	        doc.text(amountWordsText, textX, textY);
	        
	     	// === Two Half Boxes Below ===
	        const marginX = 3;
	        const boxWidthh = 101.5;
	        const startYy = amountWordsY + amountWordsHeight - 2;

	        // -- LEFT BOX: Payment Terms --
	        const leftXx = marginX;
	        doc.setFont("helvetica", "bold");
	        doc.setFontSize(9);
	        doc.text("Payment Terms", leftXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        doc.setFontSize(9);
	        const wrappedPaymentTerms = doc.splitTextToSize(data.payment_terms || '-', 97); // adjust width
	        doc.text(wrappedPaymentTerms, leftXx + 4, startYy + 10);
	        const leftHeight = wrappedPaymentTerms.length * 4; // approx line height

	        // -- RIGHT BOX: Declaration or other field --
	        const rightXx = marginX + boxWidthh;
	        doc.setFont("helvetica", "bold");
	        doc.text("Terms and Conditions", rightXx + 4, startYy + 5);

	        doc.setFont("helvetica", "normal");
	        const wrappedDeclaration = doc.splitTextToSize(data.terms_condition || '-', 97);
	        doc.text(wrappedDeclaration, rightXx + 4, startYy + 10);
	        const rightHeight = wrappedDeclaration.length * 4;

	     	// -- FINAL HEIGHT --
	        let finalBoxHeight = Math.max(leftHeight, rightHeight) * 3;
	        
	        if(Math.max(leftHeight, rightHeight) > 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 5;
	        }else if(Math.max(leftHeight, rightHeight) > 10 && Math.max(leftHeight, rightHeight) <= 30){
	        	finalBoxHeight = Math.max(leftHeight, rightHeight) + 6;
	        }

	        // Draw the two rectangles
	        doc.rect(leftXx, startYy, boxWidthh, finalBoxHeight);
	        doc.rect(rightXx, startYy, boxWidthh + 0.5, finalBoxHeight);
	        
	     	// Signature section
	        let sigY = amountWordsY + 10;
	        doc.setFont("helvetica", "bold");
	        doc.text("* This is a computer-generated Delivery Challan, no seal and signature required", 40, 293);
	        //doc.line(145, sigY + 12, 200, sigY + 12); // Signature line

	        // Open the PDF in a new tab
			window.open(doc.output('bloburl'));  // This will open the generated PDF in a new tab
	    };
	}
</script>
</body>
</html>