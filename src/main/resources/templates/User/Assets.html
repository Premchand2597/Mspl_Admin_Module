<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Asset</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <!--   <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  -->
   <link rel="stylesheet" href="/assets/font/fonts.css"> 
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  
  <!--   <script src="https://code.highcharts.com/highcharts.js"></script> -->
  <script src="assets/js/highcharts.js"></script>
   
  <!--   <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->
  <script src="assets/js/jquery-3.6.4.min.js"></script>
   
  <!--  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
  <script src="assets/js/sweetalert2@11.js"></script>
     
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->
  <link rel="stylesheet" href="/assets/css/all.min.css"> 

  <style>
  
	  .main{
	  	font-size: 14px;
	  }
  
 	 .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-card {
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
		/* Ensure version number appears on a new line */
								.release-note-text {
								  display: flex;
								  flex-direction: column; /* Stacks elements vertically */
								  font-size: 1rem;
								}

								/* Optional: Adjust the version number styling */
								.version-number {
								  font-size: 0.9rem;
								  font-weight: bold;
								  color: #555;
								}
								
        #attendence-chart{
            width: 100%;
            height: 190px; /* Adjust the height as needed */
        }
        /* Example CSS to style disabled items */
		.activity-item .disabled {
		    pointer-events: none; /* Disable interactions */
		    opacity: 0.5; /* Make the item appear grayed out */
		}
		.highlight-row {
        	background-color: #D6EAF8;
        	color: white; /* Optional: Change text color for better contrast */
    	}
        
        #holidayTable2 th {
	        font-size: 12px; /* Adjust as needed */
	        vertical-align: middle; /* Ensures consistent vertical alignment */
	        text-align:center;
	        background-color:#E9EAEC;	       
	    } 
	    
	    #employeeReq th {
	        font-size: 12px; /* Adjust as needed */
	        vertical-align: middle; /* Ensures consistent vertical alignment */
	        text-align:center;
	        background-color:#E9EAEC;	       
	    }
	    #buttonContainer {
		    display: flex;
		    gap: 8px; /* Adjust the spacing between buttons */
		    flex-wrap: nowrap; /* Prevents wrapping to the next line */
		}
		 /* Fix modal height */
    .modal-dialog {
        max-width: 900px; /* Adjust width as needed */
    }

    .modal-content {
        max-height: 80vh; /* Adjust height relative to viewport */
        display: flex;
        flex-direction: column;
    }

    .modal-body {
        flex: 1;
        overflow-y: auto; /* Enable vertical scrolling */
    }

    /* Sticky table header */
    .table thead tr {
        position: sticky;
        top: 0;
        background-color: #fff; /* Ensure header is visible */
        z-index: 2;
    }

    /* Optional: Add border-bottom for header */
    .table thead th {
        border-bottom: 2px solid #ddd;
    }
    
    .btn{
    	padding:6px;
    	margin:0;
    	font-size:14px;
    }


    
  </style> 
</head>
<body>

<!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId>0}">

                <!--  <div class="app-branding" style="width:100%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/dashboard}>
				        <img class="logo-icon" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				</div> --><!-- End Logo -->
	
		   <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/userDashboard}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				    <!-- <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
			</div>
				
   <!--  <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

	<div th:replace="fragments/header :: header" ></div>
	
  </header><!-- End Header -->
  
  <!-- =======Super Admin Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center" th:if="${empDetailsByEmpId.deptId == 0}">

    <div class="d-flex align-items-center logo-container" style="width:45%; margin:0 0 0 10px; padding:5px;">
				    <a class="app-logo" th:href=@{/navbar}>
				        <img class="d-none d-lg-block" src="assets/img/logo.png" alt="logo" style="width:200px; height:50px; max-width:100%; padding:0 2px 0 10px; margin:0;">
				    </a>
				    <!-- <i class="bi bi-chevron-double-left toggle-sidebar-btn" onclick="toggleIconRotation()"></i> -->
	</div><!-- End Logo -->

    <!-- <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div> --><!-- End Search Bar -->

    <div th:replace="fragments/superAdminHeader :: header"></div>

  </header><!-- End Header -->
  <!-- ======= Sidebar ======= -->
  
	<aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
		 
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/userDashboard}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
            </a>
         </li>
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link " th:href="@{/navbar}">
		        <i class="bi bi-grid"></i>
		        <span>Dashboard</span>
		    </a>
	    </li>
	    <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li>
		
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			<a class="nav-link" th:href="@{/Departmentdoc}">
				<i class="bi bi-journal-bookmark"></i>
				<span>MSPL DocVault</span>
			</a>
		</li> 
		<li class="nav-item" th:if="${session.permissions.dispatch && empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/dispatchIframe}">
                <i class="bi bi-truck"></i>
                <span>Dispatched Details</span>
            </a>
        </li>
         <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminProfile(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-person"></i>
                 <span>My Profile</span>
            </a>
        </li>  
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a> 
        </li>      
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-telephone"></i>
                <span>Employee Contacts</span>
            </a>
        </li>
       <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
        </li> -->
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/adminHoliday}">
                <i class="bi bi-calendar4-week"></i>
                <span>Holiday List</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>	
		        <span>Employee</span>
		    </a>
	   </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-card-text"></i>
                <span>Team Leaves</span>
            </a>
        </li>
        
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/events}">
                <i class="bi bi-megaphone"></i>
                <span>Announcement</span>
            </a>
        </li>               
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link active" th:href="@{/asset}">
                <i class="bi bi-wallet"></i>
                <span>Assets</span>
            </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/ongoingProject}">
                <i class="bi bi-card-heading"></i>
                <span>Projects</span>
            </a>
        </li>  
         <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
            <a class="nav-link" th:href="@{/viewAdminPayslip(empid=${empDetailsByEmpId.empid})}">
                <i class="bi bi-file-text"></i>
                <span>Payslip</span>
            </a>
        </li>  -->    
         <!-- Loop through the permissions map -->
       <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.apprisalAccess && empDetailsByEmpId.deptId>0}" >
            <a class="nav-link" id="apprisalLink" th:href="@{/apprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Appraisal</span>
		    </a>
        </li>
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
		    <a class="nav-link" id="apprisalLink" th:href="@{/employeeApprisal(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-file-text"></i>
		        <span>Employee Appraisal</span>
		    </a>
		</li>
		<li class="nav-item" th:if="${empDetailsByEmpId.deptId>0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
        		<li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId>0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(V.0.1.2)</span>
					        </span>
					    </a>
		</li>
        
	    <!-- <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/attendanceLive(email=${empDetailsByEmpId.email})}">
                <i class="bi bi-calendar3"></i>
                <span>Attendence</span>
            </a>
       </li> -->
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/adminHoliday}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Holiday List</span>
		    </a>
	 </li>	
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/addInterComm}">
                <i class="bi bi-telephone"></i>
                <span>Communication</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		     <a class="nav-link" th:href="@{/groupMailId}">
                <i class="bi bi-envelope-open"></i>
                <span>Group Mail Id</span>
            </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/hikeRatingForm}">
			<i class="bi bi-arrow-up-circle"></i><span>Appraisal Ratings</span>
		</a>
	</li>
	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		<a class="nav-link" th:href="@{/apprisalEmployee}">
			<i class="bi bi-check-square"></i><span>Submitted Appraisals</span>
		</a>
	</li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
          <a class="nav-link" href="hrActivity">
	        <i class="bi bi-file-lock"></i><span>Permissions</span>
	    </a>
      </li>
	 <!--  <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:href="@{/InterCommDetails}">
                <i class="bi bi-telephone"></i>
                <span>InterComm Details</span>
            </a>
      </li> --> 
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/viewAdminLeaves(empid=${empDetailsByEmpId.empid})}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Employee Leaves</span>
		    </a>
	 	</li>
	 	<li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/events}">
		        <i class="bi bi-megaphone"></i>
		        <span>Announcement</span>
		    </a>
	 </li> 
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/addDepartment}">
		        <i class="bi bi-calendar4-week"></i>
		        <span>Department</span>
		    </a>
	   </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link"  th:href="@{/addRole}">
		        <i class="bi bi-receipt"></i>
		        <span>Role</span>
		    </a>
	 </li>
	 <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
		    <a class="nav-link" th:href="@{/employee}">
		        <i class="bi bi-people"></i>	
		        <span>Employee</span>
		    </a>
	 </li> 
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link"  th:href="@{/ongoingProject}">
                <i class="bi bi-card-heading"></i>
                <span>Projects</span>
            </a>
      </li>
      <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
            <a class="nav-link" th:classappend="${empDetailsByEmpId.deptId==0} ? ' active'" th:href="@{/asset}">
                <i class="bi bi-calendar3"></i>
                <span>Assets</span>
            </a>
      </li> 
       <li class="nav-item" th:if="${permissions.interviewAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/moatIframe}">
                <i class="bi bi-vector-pen"></i>
                <span>Interview</span>
            </a>
        </li>
              <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#interview-summary-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Interview Summary</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="interview-summary-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
		            <a href="totalCandidatesList">
		              <i class="bi bi-circle"></i><span>Total Candidates</span>
			            </a>
			          </li>
			        <li>
		            <a href="selectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Selected Candidates</span>
		            </a>
		          </li>
		          <li>
		            <a href="rejectedCandidatesList">
		              <i class="bi bi-circle"></i><span>Rejected Candidates</span>
		            </a>
		          </li>
			    </ul>
			</li>
         <li class="nav-item new-feature" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link collapsed" data-bs-target="#presales-submenu" data-bs-toggle="collapse" href="#">
			        <i class="bi bi-layout-text-window-reverse"></i>
			        <span>Pre-sales</span>
			        <i class="bi bi-chevron-down ms-auto"></i>
			    </a> 
			    <ul id="presales-submenu" class="nav-content collapse" data-bs-parent="#sidebar-nav">
			        <li>
			            <a th:href="@{/crm}">
			                <i class="bi bi-circle"></i><span>Activity</span>
			            </a>
			        </li>
			        <li>
			            <a th:href="@{/deals}">
			                <i class="bi bi-circle"></i><span>Pipedrive</span>
			            </a>
			        </li>
			    </ul>
			</li>
        <li class="nav-item" th:if="${permissions.sales && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/sales}">
                <i class="bi bi-cart3"></i>
                <span>Sales</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.accountsAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/accounts}">
                <i class="bi bi-person-vcard"></i>
                <span>Accounts</span>
            </a>
        </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}" >
            <a class="nav-link" th:href="@{/store}">
                <i class="bi bi-shop-window"></i>
                <span>Store</span>
            </a>
        </li>  
        <li class="nav-item" th:if="${empDetailsByEmpId.deptId==0}">
			    <a class="nav-link" href="feedbackReports">
			        <i class="bi bi-chat-square-text"></i>
			        <span>Feedback Reports</span>
			    </a>
		 </li>
        <li class="nav-item" th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
				<a class="nav-link" th:href="@{/my-favorites}">
					<i class="bi bi-layout-text-window-reverse"></i>
					<span>To-Chat & Remind</span><span id="unreadCountBadge" class="badge bg-primary" style="display: none;"></span>
				</a>
		</li>
		<li class="nav-item new-feature"  th:if="${permissions.storeAccess && empDetailsByEmpId.deptId==0}">
					    <a class="nav-link" th:href="@{/releasenotes}">
					        <i class="bi bi-layout-text-window-reverse"></i>
					        <span class="release-note-text">
					            Release Note 
					            <span class="version-number">(Policy Update)</span>
					        </span>
					    </a>
		</li>
    </ul>
</aside>

<main id="main" class="main">

<input type="hidden" id="loggedAdminEmpId2" th:value="${session.loggedAdminEmpId}">
<input type="hidden" id="loggedAdminEmailId2" th:value="${session.email}">

<!-- Edit Asset Modal -->
<div class="modal fade" id="editAssetModal" tabindex="-1" aria-labelledby="editAssetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editAssetModalLabel">Edit Asset</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div id="editAssetError" class="alert alert-danger text-center d-none" role="alert"></div>
            <div class="modal-body">
                <form id="editAssetForm">
                    <input type="hidden" id="editId" name="id">
                    <div class="mb-3">
                        <label for="editAssetName" class="form-label">Asset Type:</label>
                        <input type="text" id="editAssetName" name="asset_name" class="form-control" required readonly>
                    </div>
					

					<div class="mb-3">
					  <div class="d-flex justify-content-between align-items-center mb-2">
					    <label for="editQuantity" class="form-label mb-0">Quantity</label>
					    <small id="availableQuantityDisplay" 
					           class="fw-bold text-dark px-2 py-1 rounded" 
					           style="background-color:#dbeafe;">
					      Available: <span class="fw-bold">0</span>
					    </small>
					  </div>

					  <input type="number" id="editQuantity" name="quantity" 
					         class="form-control shadow-sm" 
					         placeholder="Enter quantity" required>
					</div>




                    <div class="mb-3">
                        <label for="editDescription" class="form-label">Description:</label>
                        <textarea id="editDescription" name="description" class="form-control" required readonly></textarea>
                    </div>
					<div class="mb-3 d-none" id="remarksSection">
					    <label for="editRemarks" class="form-label">Remarks (required for decrease):</label>
					    <textarea id="editRemarks" name="remarks" class="form-control"></textarea>
					</div>

                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-primary" onclick="saveAsset()">Save Changes</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Asset Modal -->
<div class="modal fade" id="deleteAssetModal" tabindex="-1" aria-labelledby="deleteAssetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteAssetModalLabel">Delete Asset</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this asset?</p>
                <input type="hidden" id="deleteAssetId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger m-1" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>
</div>
 
<!-- Info Modal -->
<div class="modal fade" id="infoAssetModal" tabindex="-1" aria-labelledby="infoAssetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="infoAssetModalLabel">Asset Log Details</h5> |&nbsp;&nbsp;<span id="assetIdLogDetails"></span>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body pt-0 mt-0">
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>Modified By</th>
                            
                            <th>Assigned / Modified Date</th>
                            <th>Old Quantity</th>
                            <th>New Quantity</th>
                            <th>Quantity Difference</th>
                            <th>Assigned To</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="assetLogBody">
                        <!-- Data will be populated here via AJAX -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div th:if="${param.error == 'exists'}" class="alert alert-warning text-center">
    Asset with the same description already exists for this type.
</div>


<div id="alertMessage" class="alert" style="display: none;"></div>
<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-success" id="successModalLabel">Success</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="successMessage">Asset updated successfully!</p>
            </div>
             <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="refreshPage()">OK</button>
            </div>
        </div>
    </div>
</div>


		<!-- Assign Asset Modal -->
		<!-- <div class="modal fade" id="assi" tabindex="-1" aria-labelledby="assignAssetModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="assignAssetModalLabel">Assign Asset</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
		      </div>
		      <div class="modal-body">
		        <p>Asset ID: <span id="assignAssetId"></span></p>
		        <p>Asset Name: <span id="assignAssetName"></span></p>
		        <p>Quantity: <span id="assignAssetQty"></span></p>
		        Add your assign form here
		      </div>
		    </div>
		  </div>
		</div> -->

<!-- Assign Asset Modal -->
<div id="assignAssetModal" class="modal fade" tabindex="-1" aria-hidden="true">  
  <div class="modal-dialog modal-dialog-centered modal-lg"> 
    <div class="modal-content border-0 shadow-lg" style="font-size:13px;"> 

      <div class="modal-header bg-dark text-white py-2 px-3">
        <h5 class="modal-title">üßæ Assign Asset</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body bg-light">
        <form id="assignForm" th:action="@{/assigned_assets_save}" th:object="${assignAsset}" method="post" class="p-2">

          <input type="hidden" name="id" id="assignId" />
          <input type="hidden" name="assigned_to" id="empId" />
		  <input type="hidden" name="sourceTab" id="sourceTab" value="requestTab">

          <!-- Asset Info Card -->
          <div class="card mb-3 shadow-sm">
            <div class="card-header bg-primary text-white py-2 px-3">
              Asset Details
            </div>
            <div class="card-body row g-3">
              <div class="col-md-6">
                <label for="assetName" class="form-label">Asset Type</label>
                <select name="asset_type" id="assetName" class="form-select" required onchange="filterDescriptions()" style="font-size:13px;">
                  <option value="">Select Asset</option>
                  <option th:each="asset : ${getAllAssetName}" th:value="${asset}" th:text="${asset}"></option>
                </select>
              </div>

              <div class="col-md-6">
                <label for="description" class="form-label">Description</label>
                <select name="description" id="description" class="form-select" required onchange="fetchAssetId()" style="font-size:13px;">
                  <option value="">Select Description</option>
                </select>
              </div>

              <div class="col-md-12 d-none">
                <label for="assetId" class="form-label">Asset ID</label>
                <input type="text" name="asset_id" id="assetId" class="form-control" readonly>
              </div>
            </div>
          </div>

          <!-- Quantity and Refer ID Card -->
          <div class="card mb-3 shadow-sm">
            <div class="card-header bg-secondary text-white py-2 px-3">
              Assignment Info
            </div>
            <div class="alert alert-info py-1 px-3" role="alert" id="remainingQtyInfo" style="display: none;border-radius:0 0 5px 5px;">
			  Remaining quantity available: <strong id="remainingQtyText">0</strong>
			</div>
            <div class="card-body row g-3">
			

              <div class="col-md-4">
                <label for="quantity" class="form-label">Quantity</label>
                <input type="number" id="quantity" name="quantity" class="form-control" min="1" required>
              </div>

              <div class="col-md-8" id="quantityError" style="display: none;color:red">
                <div class="alert alert-danger p-2" role="alert"></div>
              </div>
            

              <!-- Refer IDs generated dynamically -->
              <div id="referIdsContainer" class="row g-2"></div>
            </div>
          </div>

          <!-- Remarks -->
        <!--  <div class="mb-3">
            <label for="remarks" class="form-label">Remarks</label>
            <textarea id="remarks" name="remarks" class="form-control" placeholder="Optional notes or comments..." style="font-size:13px;"></textarea>
          </div>-->
		  <!-- Remarks -->
		  <div class="mb-3" id="remarksDefault1">
		    <label for="remarks" class="form-label">Remarks</label>
		    <textarea id="remarks" name="remarks" class="form-control" placeholder="Optional notes or comments..." style="font-size:13px;"></textarea>
		  </div>

          <!-- Submit Buttons -->
          <div class="text-center mt-4">
            <button type="submit" class="btn btn-success px-4 me-2">‚úÖ Assign</button>
            <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">‚ùå Cancel</button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>

<!-- Assign Asset Modal without request -->
<div id="assignAssetModalWothoutReques" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg">

      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">üßæ Assign Asset</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body bg-light">
        <form id="assignFormWithoutReq" th:action="@{/assigned_assets_save}" th:object="${assignAsset}" method="post" class="p-2">

          <input type="hidden" name="id" id="assignIdWithoutReq" />
          <input type="hidden" name="sourceTab" id="sourceTab" value="assetTab">
          
          <!-- <input type="hidden" name="assigned_to" id="empId" /> -->
          <div class="mb-3">
         	 <select name="assigned_to" id="empSelect" class="form-select d-none" required>
			  <option value="">Select Employee</option>
			  <option th:each="emp : ${allEmployees}" th:value="${emp.empid}" th:text="${emp.fullName}"></option>
			 </select>
          </div>

          <!-- Asset Info Card -->
          <div class="card mb-3 shadow-sm">
            <div class="card-header bg-primary text-white">
              Asset Details
            </div>
            <div class="card-body row g-3">
              <div class="col-md-6">
                <label for="assetName" class="form-label">Asset Type</label>
               <!--  <select name="asset_type" id="assetName" class="form-select" required onchange="filterDescriptions()">
                  <option value="">Select Asset</option>
                  <option th:each="asset : ${getAllAssetName}" th:value="${asset}" th:text="${asset}"></option>
                </select> -->
                <input type="text" name="asset_type" id="assetName1" class="form-control" >
              </div>

              <div class="col-md-6">
                <label for="description" class="form-label">Description</label>
                <!-- <select name="description" id="description" class="form-select" required onchange="fetchAssetId()">
                  <option value="">Select Description</option>
                </select> -->
                <input type="text" name="description" id="description1" class="form-control">
              </div>

              <div class="col-md-12">
                <label for="assetId" class="form-label">Asset ID</label>
                <input type="text" name="asset_id" id="assetIdWithOutReq" class="form-control" readonly>
              </div>
            </div>
          </div>

          <!-- Quantity and Refer ID Card -->
          <div class="card mb-3 shadow-sm">
            <div class="card-header bg-secondary text-white">
              Assignment Info
            </div>
            <div class="alert alert-info py-1 px-3" role="alert" id="remainingQtyInfo" style="border-radius:0 0 5px 5px;">
			  Remaining quantity available: <strong id="remainingQtyTextwithoutReq">0</strong>
			</div>
            <div class="card-body row g-3">
              <div class="col-md-4">
                <label for="quantity" class="form-label">Quantity</label>
                <input type="number" id="quantityWithoutReq" name="quantity" class="form-control" min="1" required>
              </div>

              <div class="col-md-8" id="quantityErrorWithoutReq" style="display: none;color:red">
                <div class="alert alert-danger p-2" role="alert"></div>
              </div>

              <!-- Refer IDs generated dynamically -->
              <div id="referIdsContainerWithoutReq" class="row g-2"></div>
            </div>
          </div>

		  <!-- Remarks (default hidden) -->
		  <div class="mb-3" id="remarksDefault" style="display:none;">
		    <label for="remarks" class="form-label">Remarks</label>
		    <textarea id="remarks" name="remarks" class="form-control" placeholder="Optional notes or comments..."></textarea>
		  </div>

          <!-- Remarks -->
         <!-- <div class="mb-3">
            <label for="remarks" class="form-label">Remarks</label>
            <textarea id="remarks" name="remarks" class="form-control" placeholder="Optional notes or comments..."></textarea>
          </div>-->

          <!-- Submit Buttons -->
          <div class="text-center mt-4">
            <button type="submit" class="btn btn-success px-4 me-2">‚úÖ Assign</button>
            <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">‚ùå Cancel</button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>

		
		<!-- asset active and inactive Confirm Status Change Modal -->
		<div class="modal fade" id="confirmStatusModal" tabindex="-1" aria-labelledby="confirmStatusModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="confirmStatusModalLabel">Confirm Status Change</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body" id="confirmStatusText">
		        Are you sure you want to change the asset status?
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="revertSwitch()">Cancel</button>
		        <button type="button" class="btn btn-primary m-2" onclick="confirmStatusChange()">Yes, Change</button>
		      </div>
		    </div>
		  </div>
		</div>
		

		<!-- Reject Confirmation Modal -->
		<div class="modal fade" id="rejectConfirmModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header ">
		        <h5 class="modal-title" id="rejectModalLabel">Confirm Rejection</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        Are you sure you want to reject this asset request?
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
		        <button type="button" id="confirmRejectBtn" class="btn btn-danger" style="margin-left:10px;">Yes, Reject</button>
		      </div>
		    </div>
		  </div>
		</div>

		
		<div class="chat-app" style="display: none;">
                <div id="plist" class="people-list">
                        <div class="input-group mb-3">
                                <input type="text" id="searchInputModal" class="form-control" placeholder="Search..."
                                        aria-label="Search">
                                <span class="input-group-text">
                                        <i class="bi bi-search"></i>
                                </span>

                        </div>
                        <ul id="employeeNames" class="list-unstyled chat-list mt-2 mb-0">
                                <!-- Employee names will be dynamically populated here -->
                        </ul>
                </div>

                <div class="chat">
                        <div class="chat-header clearfix">
                                <div class="row w-100">

                                        <!-- Employee Photo and Name Section -->
                                        <div class="col-lg-6 d-flex align-items-center">
                                                <div class="chat-about d-flex align-items-center">
                                                        <img id="employeePhoto" class="employee-photo" src="default-avatar.png"
                                                                alt="Employee Photo" />
                                                        <h6 class="m-b-0 ml-2" id="employeeName">Select an Employee</h6>
                                                </div>
                                        </div>
                                        <!-- Right aligned three dots (Vertical) -->
                                        <div class="col-lg-6 text-right">
                                                <div class="dropdown custom-dropdown">
                                                        <button class="btn btn-outline-secondary" type="button" id="dropdownMenuButton"
                                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                                <i class="fa fa-ellipsis-v"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                                                <li><a class="dropdown-item" href="#">Delete Chat</a></li>
                                                                <li><a class="dropdown-item" href="#">Mute</a></li>
                                                                <li><a class="dropdown-item" href="#">Contact Info</a></li>
                                                        </ul>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        <div id="chat-window" class="chat-history">
                                <ul class="m-b-0">
                                        <!-- Chat messages will be populated here dynamically -->

                                </ul>
                                <div id="message-icon-container" class="message-icon" style="display: none;">

                                        <!-- Plain square message icon SVG (behind) -->
                                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                                <g id="SVGRepo_iconCarrier">
                                                        <path
                                                                d="M10 9H17M10 13H17M7 9H7.01M7 13H7.01M21 20L17.6757 18.3378C17.4237 18.2118 17.2977 18.1488 17.1656 18.1044C17.0484 18.065 16.9277 18.0365 16.8052 18.0193C16.6672 18 16.5263 18 16.2446 18H6.2C5.07989 18 4.51984 18 4.09202 17.782C3.71569 17.5903 3.40973 17.2843 3.21799 16.908C3 16.4802 3 15.9201 3 14.8V7.2C3 6.07989 3 5.51984 3.21799 5.09202C3.40973 4.71569 3.71569 4.40973 4.09202 4.21799C4.51984 4 5.0799 4 6.2 4H17.8C18.9201 4 19.4802 4 19.908 4.21799C20.2843 4.40973 20.5903 4.71569 20.782 5.09202C21 5.51984 21 6.0799 21 7.2V20Z"
                                                                stroke="#94b7db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                                </g>
                                        </svg>

                                        <!-- SVG with animation -->
                                        <svg class="animated-icon" viewBox="0 0 374 374" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0)">
                                                        <path
                                                                d="M318.084 132.622C311.339 101.37 287.642 82 256.652 82C238.423 82 217.459 89.3248 197.954 102.509C191.574 106.904 182.642 106.904 176.079 102.672C155.298 88.9992 135.246 82 116.652 82C85.6626 82 61.9647 101.533 55.2199 133.111C44.2824 183.896 80.923 252.26 187.017 291C292.746 251.446 329.204 183.082 318.084 132.622Z" />
                                                        <path
                                                                d="M187.466 0C187.366 0 187.166 0 186.866 0C85.666 0 3.36603 82.3 3.36603 183.5C3.36603 224.8 17.466 264.9 43.266 297.2L16.566 359.3C14.366 364.4 16.766 370.3 21.766 372.4C23.566 373.2 25.566 373.4 27.466 373.1L125.366 355.9C144.966 363 165.566 366.6 186.366 366.5C287.566 366.5 369.866 284.2 369.866 183C370.066 82.1 288.366 0.1 187.466 0ZM192.966 269.8C188.966 271.3 184.666 271.3 180.666 269.8C149.066 257.1 124.466 238.3 109.466 215.4C95.966 194.7 90.766 171.4 94.866 149.9C100.466 121.4 121.866 102.3 148.266 102.3C160.966 102.3 173.866 106.5 186.766 114.7C199.366 106.5 212.466 102.3 225.066 102.3C251.866 102.3 272.866 120.9 278.466 149.6C286.066 188.8 262.666 241.3 192.966 269.8Z" />
                                                </g>
                                                <defs>
                                                        <clipPath id="clip0">
                                                                <rect width="373.232" height="373.232" fill="white" />
                                                        </clipPath>
                                                </defs>
                                        </svg> 
                                        <!-- Dots Animation -->
                                        <div class="dots">
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                                <div class="dot"></div>
                                        </div> 
                                </div>
                        </div>
                        <!-- Move the paragraph outside the chat window -->
                        <p id="logo-text"
                                style="text-align: center; font-size: 14px; color: #6c757d; margin-top: 10px; display: none;">
                                "Reach out to your colleagues and stay on top of your projects with quick, seamless communication."
                        </p>
                        <div class="chat-message clearfix">
                                <div class="custom-input-group mb-0">
                                        <input type="text" id="message" class="custom-form-control" placeholder="Enter your message..." />
                                        <div class="custom-input-group-append">
                                                <button class="custom-send-btn" onclick="sendMessage()">
                                                        <i class="ri ri-send-plane-2-fill"></i>
                                                </button>
                                        </div>
                                </div>

                        </div>
                </div>
        </div>
        <input type="hidden" th:value="${empDetailsByEmpId.email}" id="loggedInMail">
		<input type="hidden" id="employeeId1" name="empId" th:value="${empDetailsByEmpId.empid}" />
		<input type="hidden" id="emp_idSessionValue" th:value="${empDetailsByEmpId.empid}">
		<input type="hidden" id="loggedEmpEmail" th:value="${empDetailsByEmpId.email}">
		
		<!-- Success Modal -->
		<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="successModalLabel" style="color:green">Success</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        Request forwarded to store successfully!
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="successModalOkBtn">OK</button>
		      </div>
		    </div>
		  </div>
		</div>
		
		
		<!-- Error Modal -->
		<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="errorModalLabel">Error</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
		        Something went wrong. Please try again later.
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		      </div>
		    </div>
		  </div>
		</div>
		<!-- Available Date Modal -->
		<div class="modal fade" id="availableDateModal" tabindex="-1" aria-labelledby="availableDateModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="availableDateModalLabel">Enter Available Date</h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <label for="availableDate" class="form-label">Available Date:</label>
		                <input type="date" class="form-control" id="availableDate" required>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
		                <button type="button" class="btn btn-primary" id="submitAvailableDate">Submit</button>
		            </div>
		        </div>
		    </div>
		</div>
				<!-- Feedback Modal -->
				<input type="hidden" id="loggedInDeptName" th:value="${empDetailsByEmpId.deptName}">
			<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
			    <div class="modal-dialog">
			        <div class="modal-content rounded-4 shadow-lg">
			            <div class="modal-header border-0">
			                <h5 class="modal-title" id="feedbackModalLabel">Feedback Form</h5>
			                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			            </div>
			            <div class="modal-body">
			                <form id="feedbackForm" method="post" enctype="multipart/form-data">
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackName" class="form-label fw-bold">Your Name</label>
			                        <input type="text" class="form-control" id="feedbackName" name="name" th:value="${empDetailsByEmpId.fullName}" readonly>
			                    </div>
			                    <div class="mb-3" style="display: none;">
			                        <label for="feedbackEmail" class="form-label fw-bold">Your Email</label>
			                        <input type="email" class="form-control" id="feedbackEmail" name="email" th:value="${empDetailsByEmpId.email}" readonly>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackEmailyy" class="form-label fw-bold">To</label>
			                        <div class="to-field-container">
			                            <span class="to-field rounded-pill px-3 py-2 shadow-sm">bugs_msplconnect@melangesystems.com</span>
			                        </div>
			                    </div>
								<div class="mb-3">
								    <label for="bugType" class="form-label fw-bold">Bug Type</label>
								    <select class="form-control" id="bugType" name="bugType" required>
								        <option value="About Application">About Application</option>
								        <option value="New Feature">New Feature</option>
								    </select>
								</div>

			                    <div class="mb-3">
			                        <label for="feedbackMessage" class="form-label fw-bold">Message</label>
			                        <textarea class="form-control" id="feedbackMessage" name="message" rows="4" placeholder="Enter your feedback here..." required></textarea>
			                    </div>
			                    <div class="mb-3">
			                        <label for="feedbackAttachment" class="form-label fw-bold">Attachment (optional)</label>
			                        <input type="file" class="form-control" id="feedbackAttachment" name="attachment" accept=".png, .jpg, .jpeg" multiple>
			                        <small class="text-muted">Max size: 5MB. You can upload multiple images.</small>
			                    </div>
			                    <button type="submit" class="btn btn-primary w-100 mt-3 py-2 shadow-sm" id="submitFeedbackBtn">Submit Feedback</button>
			                </form>
			            </div>
			        </div>
			    </div>
			</div>
			
			<!-- Add Asset Modal -->
			<div id="addAssetModal" class="modal fade" tabindex="-1" aria-hidden="true">
			    <div class="modal-dialog">
			        <div class="modal-content">
			            <div class="modal-header">
			                <h5 class="modal-title">Add Asset</h5>
			                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">&times;</button>
			            </div>
			            <div class="modal-body">
			            <!-- Success/Error Alerts -->
						<div id="responseMessage" class="alert text-center mt-3" style="display:none;"></div>
			            
			                <form id="assetForm">
			                     
			                    <div class="form-group">
			                        <label>Asset Type:</label>
			                        <input type="text" name="asset_name" class="form-control" required>
			                    </div>	
			                    <div class="form-group">
			                        <label>Quantity:</label>
			                        <input type="number" name="quantity" class="form-control" required>
			                    </div>			
			                    <div class="form-group">
			                        <label>Description:</label>
			                        <textarea rows="5" cols="5" name="description" class="form-control"></textarea>
			                    </div>									
			                    <div class="text-center mt-3">
			                        <button type="submit" class="btn btn-success">Save Asset</button>
			                    </div>	 
			                </form>
			            </div>
			        </div>
			    </div>
			</div>
			
			<!-- Assigned Asset Details Modal --> 
			<!-- <div class="modal fade" id="assignedAssetsModal" tabindex="-1" aria-labelledby="assignedAssetsModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-lg modal-dialog-centered">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="assignedAssetsModalLabel">Assigned Asset Details</h5>
			        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			      </div>
			      <div  style="max-height: 400px; overflow-y: auto; padding:0 10px;">
			        <table class="table table-bordered table-striped">
			          <thead>
			            <tr>
			              <th>Sl</th>
			              <th>Asset ID</th>
			              <th>Asset Type</th>
			              <th>Assigned Asset ID</th>
			              <th>Assigned To</th>
			              <th>Employee Name</th>
			              <th>Quantity</th>
			            </tr>
			          </thead>
			          <tbody id="assignedAssetsTableBody">
			            Rows will be injected here
			          </tbody>
			        </table>
			      </div>
			    </div>
			  </div>
			</div> -->
			
			<!-- Assigned Asset Details Modal -->
			<div class="modal fade" id="assignedAssetsModal" tabindex="-1" aria-labelledby="assignedAssetsModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-xl modal-dialog-centered">
			    <div class="modal-content"  style="padding-bottom:10px;">
			      <div class="modal-header">
			        <h5 class="modal-title">Assigned Asset Details</h5>
			        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			      </div>
			
			      <div class="modal-body">
			        <!-- Tabs -->
			        <ul class="nav nav-tabs" id="assetTab" role="tablist">
			          <li class="nav-item">
			            <button class="nav-link active" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summaryTab" type="button" role="tab">Summary</button>
			          </li>
			          <li class="nav-item">
			            <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#detailsTab" type="button" role="tab">Details</button>
			          </li>
			        </ul>
			
			        <!-- Tab Content -->
			        <div class="tab-content mt-3">
			          <!-- Summary Tab -->
			          <div class="tab-pane fade show active" id="summaryTab" role="tabpanel">
			            <div id="summaryContent" class="row g-3">
			              <!-- Filled via JS -->
			            </div>
			          </div>
			
			          <!-- Details Tab -->
			          <div class="tab-pane fade" id="detailsTab" role="tabpanel">
			            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
			              <table class="table table-bordered table-striped align-middle">
			                <thead class="table-light sticky-top">
			                  <tr>
			                    <th>#</th>
			                    <th>Asset ID</th>
			                    <th>Asset Type</th>
			                    <th>Assigned Asset ID</th>
			                    <th>Emp ID</th>
			                    <th>Employee Name</th> 
								<th>Ref Asset ID</th> <!-- üîπ New column -->
								<th>Remarks</th> <!-- üîπ New column -->
			                  </tr>
			                </thead>
			                <tbody id="assignedAssetsTableBody">
			                  <!-- Rows via JS -->
			                </tbody>
			              </table>
			            </div>
			          </div>
			        </div>
			
			      </div>
			    </div>
			  </div>
			</div>
	

    <div class="pagetitle d-flex mb-0 justify-content-between"  th:if="${empDetailsByEmpId.deptId==0}">
	 <div class='d-flex'>
	 	 <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px;cursor:pointer;"></i>
	      <nav>
	        <ol class="breadcrumb d-flex justify-content-between">
		          <li class="breadcrumb-item"><a th:href="@{/navbar}">Home</a></li>
		          <li class="breadcrumb-item active">Assets</li>
	        </ol>
	      </nav>
	 </div>
	 <div class="d-flex gap-2" id="buttonContainer">
	   <button class="btn btn-primary mb-1 action-btn" id="addAssets" onclick="openAssetForm()">Add Asset</button>
	   <button type="button" class="btn btn-primary mb-1" id="addProjectButton" onclick="requestAsset()">Request</button>
	   <button type="button" class="btn btn-primary mb-1" id="viewListButton" onclick="viewProject()" style="display:none">View List</button>
	 </div>
     
    </div><!-- End Page Title -->
   
     <div class="pagetitle d-flex mb-0 justify-content-between"  th:if="${empDetailsByEmpId.deptId>0}">
       <div class="d-flex">
          <i class="bi bi-chevron-double-left toggle-sidebar-btn mb-1" onclick="toggleIconRotation()" style="font-size:24px;color:#2F73B9;padding:0 10px;margin-left:-10px;margin-top:-10px;cursor:pointer;"></i>
	      <nav>
	        <ol class="breadcrumb d-flex justify-content-between">
		          <li class="breadcrumb-item"><a th:href="@{/userDashboard}">Home</a></li>
		          <li class="breadcrumb-item active">Assets</li>
	        </ol>
	      </nav>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-primary mb-1 action-btn" id="addAssets" onclick="openAssetForm()">Add Asset</button>
	    <button type="button" class="btn btn-primary mb-1" id="addProjectButton" onclick="requestAsset()">Request</button>
		<button type="button" class="btn btn-primary mb-1" id="viewListButton" onclick="viewProject()" style="display:none">View List</button>
      </div>
     
    </div><!-- End Page Title -->
    
    <input type="hidden" id="roleValue" th:value="${session.role_name}">
    
    <section class="section dashboard">
      <div class="row">
				<div class="col-lg-12" id="groupMailIdTable">
					<div class="row">
						<div class="col-lg-12">	
							<div class="card">
							

							    <div class="card-body table-responsive p-0" id="AssetList">
									<!-- Title row with search to the right -->
									<!-- Title row with search to the right -->
									<div class="d-flex justify-content-between align-items-center mb-3">
									  <h5 class="card-title mt-0 pt-0 mb-0">Assets</h5>

									  <div class="input-group" style="width: 250px;">
									    <span class="input-group-text bg-light border-end-0">
									      <i class="bi bi-search"></i>   <!-- Bootstrap Icons -->
									    </span>
									    <input type="text"
									           id="assetSearch"
									           class="form-control border-start-0 rounded-end-pill"
									           placeholder="Search in current tab...">
									  </div>
									</div>

									 <!-- Bordered Tabs Justified -->
						              <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist">
						                
						                <li class="nav-item flex-fill" role="presentation">
									        <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-assets" type="button" role="tab" aria-controls="assets" aria-selected="true">Assets</button>
									    </li>
									    <li class="nav-item flex-fill" role="presentation">
									        <button class="nav-link w-100" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home" aria-selected="true">Assets Requests</button>
									    </li>
										<li class="nav-item flex-fill" role="presentation">
																														  <button class="nav-link w-100" id="return-tab" data-bs-toggle="tab" 
																														    data-bs-target="#bordered-justified-return" type="button" role="tab" aria-controls="return" aria-selected="false">
																														    Return Requests
																														  </button>
																														</li>
										<li class="nav-item flex-fill" role="presentation">
										      <button class="nav-link w-100" id="asset-details-tab" 
										              data-bs-toggle="tab" data-bs-target="#bordered-justified-asset-details" 
										              type="button" role="tab" aria-controls="asset-details" aria-selected="false">
										          Asset Details
										      </button>
										  </li>
									    <li class="nav-item flex-fill" role="presentation">
									        <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab" data-bs-target="#bordered-justified-profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Admin</button>
									    </li>
									    
									  </ul>
									
									<div class="tab-content pt-2" id="borderedTabJustifiedContent">
									    <!-- Home Tab Content -->
									    <div class="tab-pane fade show active" id="bordered-justified-assets" role="tabpanel" aria-labelledby="assets-tab">
										
											<div style="min-height: 200px; max-height:85%; overflow-y: auto;">
												<div style="max-height: 550px; overflow-y: auto;" class="table-responsive">

												<table class="table table-hover mb-0 holidayTable text-center">
													<thead>
									                        <tr>
									                            <th>ID</th>
									                            <th>Asset Id</th>
									                            <th>Asset Type</th>
									                            <th>In-hand Quantity</th>
									                            <th>Assigned Qyantity</th>
									                            <th></th>
									                            <th  style="width: 200px;">Description</th>
									                            <th>Action</th>
									                        </tr>
									                    </thead>
									                    <tbody>
									                        <tr th:each="asset, stat : ${allAsset}">
									                            <td th:text="${stat.index + 1}"></td>
									                            <td th:text="${asset.asset_id}"></td>
									                            <td th:text="${asset.asset_name}"></td>
									                            <td th:text="${asset.quantity}"></td>
									                           
									                           <!--  <td th:text="${assignedQtyMap[asset.asset_id] != null ? assignedQtyMap[asset.asset_id] : 0}"></td> -->
									                           <td>
									                           
																    <a href="#" 
																       th:text="${assignedQtyMap[asset.asset_id] != null ? assignedQtyMap[asset.asset_id] : 0}"
																        th:attr="data-asset-id=${asset.asset_id}"
																        class="assigned-qty"
																       style="cursor: pointer;">
																    </a>
																</td>
																<td>
																    <a href="#"
																	   th:attr="data-id=${asset.id}, data-name=${asset.asset_name}, data-description=${asset.description}, data-inhandQty=${asset.quantity}"
																	   onclick="handleOpenAssetAssign(this)"
																	   data-bs-toggle="modal"
																	   data-bs-placement="top"
																	   title="Assign"
																	   style="cursor: pointer;">
																	   <i class="fas fa-exchange-alt"></i>
																	</a>
																</td>
									                            
									                            <td style="width: 200px;" th:text="${asset.description}"></td>
									                            <td>
																    <a href="#" th:attr="onclick='openAssetEditModal(' + ${asset.id} + ', \'' + ${asset.asset_name} + '\', ' + ${asset.quantity} + ', \'' + ${asset.description} + '\')'" 
																       data-bs-toggle="modal"
																       data-bs-target="#editAssetModal"
																       data-bs-toogle="tooltip"
																       data-bs-placement="top"
																       title="Edit">
																        <i class="fas fa-edit text-primary"></i>
																    </a>
																    <!-- ‚úÖ New Assign Button -->
																	    <!-- <a href="#"
																	       th:onclick="|openAssignModal('${asset.asset_id}', '${asset.asset_name}', ${asset.quantity})|"
																	       data-bs-toggle="modal"
																	       data-bs-target="#assignAssetModal"
																	       title="Assign">
																	        <i class="fas fa-user-check text-success" style="margin-left: 20px;"></i>
																	    </a> -->
																		<a href="#" 
																		   th:attr="onclick='openAssetDeleteModal(' + ${asset.id} + ')'" 
																		   data-bs-toggle="modal"
																		   data-bs-target="#deleteAssetModal"
																		   title="Delete">  <!-- Tooltip applied via title -->
																		    <i class="fas fa-trash text-danger" style="margin-left:20px;"></i>
																		</a>
																		    <!-- Info Icon -->
																		    <a href="#" 
																		       th:onclick = "openAssetInfoModal([[${asset.asset_id}]])"
																		       data-bs-toggle="modal"
																		       data-bs-target="#infoAssetModal"
																		       title="Info">
																		        <i class="fas fa-info-circle text-info" style="margin-left: 20px;"></i>
																		    </a>
																		    <!-- Active/Inactive Switch -->
																		   <!--  <div class="form-check form-switch d-inline-block" style="margin-left: 20px;">
																		        <input class="form-check-input" type="checkbox"
																		               th:attr="id='switch' + ${asset.id}"
																		               th:checked="${asset.active_inactive_status == 1}"
																		               th:onclick="'toggleAssetStatus(' + ${asset.id} + ', this.checked)'">
																			        <label th:attr="for='switch' + ${asset.id}" class="form-check-label">
																			        </label>
																		    </div> -->
																</td>
																<!-- <td>
																  <a href="#"
																     th:text="${assignedQtyMap[asset.asset_id] != null ? assignedQtyMap[asset.asset_id] : 0}"
																     th:attr="onclick='openAssetDeleteModal(' + ${asset.id} + ')'" 
																     data-bs-toggle="modal"
																     data-bs-target="#assignAssetModal"
																     style="cursor: pointer;"
																     class="badge bg-success text-light">
																     Assign
																  </a>
																</td> -->
																
									                        </tr>
									                        <!-- If list is empty, display 'No data available' message -->
												            <tr th:if="${#lists.isEmpty(allAsset)}">
												                <td colspan="6" class="text-center text-muted">No data available</td>
												            </tr>
									                    </tbody>
									                </table>
													</div>
											</div>
										
										</div>
									    <!-- Assets requests Tab Content -->
									    <div class="tab-pane fade" id="bordered-justified-home" role="tabpanel" aria-labelledby="home-tab">
										    <div style="min-height: 200px; max-height: 400px; overflow-y: auto;">
										        
										         <!-- Requested Assets Tab -->
									            <!-- <div class="tab-pane fade show active" id="requested-assets" role="tabpanel"> -->
									                <table class="table table-hover mb-0 holidayTable text-center">
									                    <thead>
									                        <tr>
									                            <th>ID</th>
									                            <th>Emp</th>
									                            <th>Asset Type</th>
									                            <th>Requested Quantity</th>
									                            <th>Assigned Quantity</th>
									                            <th style="width:200px;">Description</th>
									                            <th>Requested by</th>
									                            <th>Requested Date</th>
									                            <th>Status</th>
									                            <th></th>
									                        </tr>
									                    </thead>
									                    <tbody>
									                        <tr th:each="request,stat : ${requests}">
									                            <td th:text="${stat.index + 1}"></td>
									                            <td th:text="${request.emp_name}"></td>
									                            <td th:text="${request.asset_type}"></td>
									                            <td th:text="${request.quantity}"></td>
									                            <td th:text="${request.assigned_asset_qty}"></td>
									                            <td style="width:200px;" th:text="${request.description}"></td>
									                            <td th:text="${#strings.isEmpty(request.approver_name) ? '-' : request.approver_name}"></td>
									                            <td th:text="${request.req_date}"></td>
																<td>
																    <span th:switch="${request.status}">
																        <span th:case="0" class="badge bg-success">New</span>
																        <span th:case="1" class="badge bg-info text-dark">Modified</span>
																        <span th:case="2" class="badge bg-primary">Approved</span>
																        <span th:case="3" class="badge bg-success">Assigned</span>
																        <span th:case="4" class="badge bg-danger">Rejected</span>
																        <span th:case="*" class="badge bg-dark">Unknown</span>
																    </span>
																</td>
																<td>
																    <!-- Asset Admin: Show "Approve" button if not approved -->
																	<!--     <button th:if="${permissions.asset_admin and request.asset_approved != 1}"
																            class="btn btn-primary"
																            th:attr="onclick=|approveRequest('${request.id}')|">
																        Approve
																    </button> -->
																    <span class="d-flex align-items-center gap-2">
																    <!-- Approve Icon -->
																	<i th:if="${permissions.asset_admin and request.asset_approved != 1}"
																	   class="bx bx-check text-success"
																	   role="button"
																	   th:attr="onclick=|approveRequest('${request.id}')|"
																	   title="Approve" style="font-size: 22px;cursor: pointer;"></i>
																     
																    <!-- Assign Icon -->
																	<i th:if="${permissions.asset_admin and request.asset_approved == 1}"
																	   class="bi bi-person-check text-success"
																	   role="button"
																	   th:data-id="${request.id}"
																	   th:data-emp-id="${request.emp_id}"
																	   th:data-asset-type="${request.asset_type}"
																	   th:data-quantity="${request.quantity}"
																	   th:data-description="${request.description}"
																	   onclick="openAssignFormFromElement(this)"
																	   title="Assign"
																	   style="font-size: 22px;cursor: pointer;"></i>
																    
																
																    <!-- Admin: Always show "Assign" button but disable it if not approved -->
																    <i th:if="${!permissions.asset_admin}"
																            class="bi bi-person-check text-success"
																            role="button"
																                th:data-id="${request.id}"
																		        th:data-emp-id="${request.emp_id}"
																		        th:data-asset-type="${request.asset_type}"
																		        th:data-quantity="${request.quantity}"
																		        th:data-description="${request.description}"
																		        onclick="openAssignFormFromElement(this)"
																            th:disabled="${request.asset_approved != 1}"
																            style="font-size: 22px;cursor: pointer;">
																        Assign
																    </i>
																    
																    <!-- Button -->
																	<i th:if="${permissions.asset_admin and request.status != 4}"
																	        class="bx bx-x text-danger"
																	        role="button"
																	        th:data-id="${request.id}"
																	        th:data-emp-id="${request.emp_id}"
																	        th:data-asset-type="${request.asset_type}"
																	        th:data-quantity="${request.quantity}"
																	        th:data-description="${request.description}"
																	        onclick="openRejectModal(this)"
																	        th:disabled="${request.asset_approved != 1}"
																	        style="font-size: 22px;cursor: pointer;">
																	</i>
																    </span>
																</td>

									                        </tr>
									                        <!-- If list is empty, display 'No data available' message -->
												            <tr th:if="${#lists.isEmpty(requests)}">
												                <td colspan="6" class="text-center text-muted">No data available</td>
												            </tr>
									                    </tbody>
									                </table> 
									        </div>
									    </div>
										
										<div class="tab-pane fade" id="bordered-justified-asset-details" role="tabpanel" aria-labelledby="asset-details-tab">
											
										    <div class="table-responsive mt-0" style="max-height: 400px; overflow-y: auto;">
										        <table class="table table-hover" id="assignedAssetsTable" style="border-collapse: collapse;">
										            <thead class="table-light" style="border-bottom: none;">
										                <tr>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">ID</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Asset ID</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Assigned Asset ID</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Assigned To</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Asset Type</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Quantity</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Description</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Remarks</th>
										                    <th style="position: sticky; top: 0; z-index: 2;  border: none;">Ref Asset ID</th>
										                </tr>
										            </thead>
										            <tbody>
										                <tr th:each="asset : ${assignedAssets}" style="border-bottom: none;">
										                    <td th:text="${asset.id}" style="border: none;"></td>
										                    <td th:text="${asset.asset_id}" style="border: none;"></td>
										                    <td th:text="${asset.assigned_asset_id}" style="border: none;"></td>
										                    <td th:text="${asset.empName}" style="border: none;"></td>
										                    <td th:text="${asset.asset_type}" style="border: none;"></td>
										                    <td th:text="${asset.quantity}" style="border: none;"></td>
										                    <td th:text="${asset.description}" style="border: none;"></td>
										                    <td th:text="${asset.remarks}" style="border: none;"></td>
										                    <td th:text="${asset.ref_asset_id}" style="border: none;"></td>
										                </tr>
										            </tbody>
										        </table>
										    </div>
										</div>
										<!-- Remarks Modal -->
																			<div class="modal fade" id="remarksModal" tabindex="-1" aria-hidden="true">
																			  <div class="modal-dialog modal-dialog-centered">
																			    <div class="modal-content">
																			      <div class="modal-header">
																			        <h5 class="modal-title" id="remarksModalLabel">Add Remarks</h5>
																			        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
																			      </div>
																			      <div class="modal-body">
																			        <input type="hidden" id="modalRequestId">
																			        <input type="hidden" id="modalActionType">
																			        <div class="mb-3">
																			          <label for="remarksInput" class="form-label">Remarks</label>
																			          <textarea class="form-control" id="remarksInput" rows="3"></textarea>
																			        </div>
																			      </div>
																			      <div class="modal-footer">
																			        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
																			        <button type="button" class="btn btn-primary" onclick="submitRemarks()">Submit</button>
																			      </div>
																			    </div>
																			  </div>
																			</div>

									
																			  <div class="tab-pane fade" id="bordered-justified-return" role="tabpanel">
																				<div class="table-responsive mt-0" style="max-height: 400px; overflow-y: auto;">
																			    <table class="table table-bordered table-striped table-hover align-middle" id="returnRequestsTable">
																			      <thead class="table-light">
																			        <tr>
																			          <th>ID</th>
																			          <th>Asset ID</th>
																			          <th>Type</th>
																			          <th>Quantity</th>
																			          <th>Description</th>
																			          <th>Requested by</th>
																					  <th>Remarks</th>
																					  <th>Reject Reason</th>
																					  <th>Returned At</th> 
																			          <th>Status</th>
																			        
																			        </tr>
																			      </thead>
																			      <tbody></tbody>
																			    </table>
																				</div>
																			  </div>
																	



									    <!--Admin Assets Requests Tab Content -->
									    <div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" th:if="${empDetailsByEmpId.deptId!=74}" aria-labelledby="profile-tab">
									        <div style="min-height: 200px; max-height: 400px; overflow-y: auto;">
										        <table class="table table-hover mb-0 holidayTable text-center">
									                    <thead>
									                        <tr>
									                            <th>ID</th>
									                            <!-- <th>EmpId</th> -->
									                            <th>Asset Type</th>
									                            <th>Quantity</th>
									                            <th>Description</th>
									                        </tr>
									                    </thead>
									                    <tbody>
									                        <tr th:each="request,stat : ${getLoogedAdminAssetsRequestandAssets}">
									                            <td th:text="${stat.index + 1}"></td>
									                            <!-- <td th:text="${request.empId}"></td> -->
									                            <td th:text="${request.assetType}"></td>
									                            <td th:text="${request.quantity}"></td>
									                            <td th:text="${request.description}"></td>
									                            <!-- <td>
																	<button class="btn btn-primary"
																		th:attr="onclick=|openAssignForm('${request.id}', '${request.empId}', '${request.assetType}', '${request.quantity}', '${request.description}')|">
																		Assign
																	</button>
																</td> -->
									                        </tr> 
									                        <!-- If list is empty, display 'No data available' message -->
												            <tr th:if="${#lists.isEmpty(getLoogedAdminAssetsRequestandAssets)}">
												                <td colspan="6" class="text-center text-muted">No data available</td>
												            </tr>
									                    </tbody>
									                </table>
									        </div>
									    </div>
									    
									     <!-- Employyee assets table for Store -->
									    <div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" aria-labelledby="profile-tab">
									        
									    </div>
									</div>

								</div>
								<!-- Reject Modal -->
																<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
																  <div class="modal-dialog modal-sm modal-dialog-centered">
																    <div class="modal-content rounded-3 shadow-sm">
																      
																      <!-- Header -->
																      <div class="modal-header bg-danger text-white py-2">
																        <h6 class="modal-title d-flex align-items-center mb-0" id="rejectModalLabel">
																          <i class="bx bx-x-circle me-2 fs-5"></i> Reject Request
																        </h6>
																        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
																      </div>
																      
																      <!-- Body -->
																      <div class="modal-body p-2">
																        <textarea id="rejectRemarks"
																                  class="form-control form-control-sm"
																                  placeholder="Reason for rejection..."
																                  rows="3"></textarea>
																      </div>
																      
																      <!-- Footer -->
																      <div class="modal-footer py-2 d-flex justify-content-between">
																        <button type="button" class="btn btn-outline-secondary btn-sm me-2" data-bs-dismiss="modal">Cancel</button>
																        <button type="button" class="btn btn-danger btn-sm" id="submitRejectBtn">Reject</button>
																      </div>
																      
																    </div>
																  </div>
																</div>
								<div class="card-body table-responsive p-0" id="assetRequestForm" style="display:none;">
									<h5 class="card-title mt-0 pt-0">Request Asset</h5>
									
									     <form id="assetRequestForm1">
						                    <div class="mb-3">
						                        <label>Asset Type:</label>
						                        <input type="text" class="form-control" name="assetType" required placeholder="Enter Asset Type">
						                    </div>
						
						                    <div class="mb-3">
						                        <label>Quantity:</label>
						                        <input type="number" class="form-control" name="quantity" required placeholder="Enter Quantity">
						                    </div>
						
						                    <div class="mb-3">
						                        <label>Description:</label>
						                        <textarea class="form-control" name="description" required placeholder="Enter Description"></textarea>
						                    </div>
						
						                    <div class="text-center mt-3">
						                        <button type="submit" class="btn btn-primary">Submit Request</button>
						                    </div>
						                </form>  
						                
								</div>
							</div>
						</div>
					</div>
				</div>
			</div><!-- End Left side columns -->
    </section>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
       Copyright &copy; <span id="currentYear"></span> <strong><span>Melange Systems Private Limited</span></strong>. All Rights Reserved
    </div>
  </footer>
  
  <script>
      var currentYear = new Date().getFullYear();
      document.getElementById("currentYear").innerHTML = currentYear;
  </script>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
 
  <script>
	document.addEventListener("DOMContentLoaded", function () {
	    const searchInput = document.getElementById("assetSearch");

	    searchInput.addEventListener("keyup", function () {
	        const filter = this.value.trim().toLowerCase();

	        // ‚úÖ always re-find the active pane
	        const activePane = document.querySelector(
	            '#borderedTabJustifiedContent .tab-pane.show.active'
	        );

	        if (!activePane) {
	            console.warn("No active tab found");
	            return;
	        }

	        // find all rows inside that active pane only
	        const rows = activePane.querySelectorAll("table tbody tr");
	        let visibleCount = 0;

	        rows.forEach(row => {
	            const text = row.innerText.toLowerCase();
	            const match = text.includes(filter);
	            row.style.display = match ? "" : "none";
	            if (match) visibleCount++;
	        });

	        console.log(
	            "Active tab ID:", activePane.id,
	            "Rows matching search:", visibleCount
	        );
	    });
	});


  </script>

<script>


</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    loadReturnRequests();
});

function loadReturnRequests() {
    fetch("/api/asset-returns")
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector("#returnRequestsTable tbody");
            tbody.innerHTML = "";

            data.forEach(req => {
                let statusHtml;
                if (req.status === "Approved") {
                    statusHtml = `<span class="badge bg-success">Approved</span>`;
                } else if (req.status === "Rejected") {
                    statusHtml = `<span class="badge bg-danger">Rejected</span>`;
                } else {
                    statusHtml = `
                        <span class="badge bg-primary">Pending</span>
                        <i class="bx bx-check text-success fs-5 ms-2" style="cursor:pointer;"
                           title="Approve" onclick="approveRequestReturn(${req.id})"></i>
                        <i class="bx bx-x text-danger fs-5 ms-2" style="cursor:pointer;"
                           title="Reject" onclick="rejectRequestReturn(${req.id})"></i>`;
                }

                const row = `
                    <tr>
                        <td>${req.id}</td>
                        <td>${req.assetId}</td>
                        <td>${req.assetType}</td>
                        <td>${req.quantity}</td>
                        <td>${req.description || ""}</td>
						<td>${req.senderName || ""}</td>  
                        <td>${req.remarks || ""}</td>
                      <td>${req.rejectionRemarks ? req.rejectionRemarks : "-"}</td> <!-- ‚úÖ show reject reason -->
					  <td>${formatDateTime(req.returnedAt)}</td>
                        <td>${statusHtml}</td>
                    </tr>`;
                tbody.insertAdjacentHTML("beforeend", row);
            });
        });
}

function formatDateTime(dateTimeString) {
    if (!dateTimeString) return "-";
    const date = new Date(dateTimeString);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');
    return `${day}-${month}-${year} ${hours}:${minutes}:${seconds}`;
}

function approveRequestReturn(id) {
    const empId = document.getElementById("employeeId1").value; // get logged-in emp id

    Swal.fire({
        title: 'Are you sure?',
        text: 'Do you really want to approve this return request?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#28a745',    // green
        cancelButtonColor: '#d33',        // red
        confirmButtonText: 'Yes, approve!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/api/asset-returns/${id}/approve?empId=${empId}`, {
                method: "POST"
            })
            .then(res => {
                if (!res.ok) throw new Error("Network error");
                return res.json();
            })
            .then(() => {
                loadReturnRequests();
                Swal.fire({
                    title: 'Approved!',
                    text: 'The return request has been successfully approved.',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
            })
            .catch(err => {
                Swal.fire('Error', 'Something went wrong while approving.', 'error');
            });
        }
    });
}


/*function approveRequestReturn(id) {
    Swal.fire({
        title: 'Are you sure?',
        text: 'Do you really want to approve this return request?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#28a745',    // green
        cancelButtonColor: '#d33',        // red
        confirmButtonText: 'Yes, approve!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/api/asset-returns/${id}/approve`, { method: "POST" })
                .then(res => {
                    if (!res.ok) throw new Error("Network error");
                    return res;
                })
                .then(() => {
                    loadReturnRequests();
                    Swal.fire({
                        title: 'Approved!',
                        text: 'The return request has been successfully approved.',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                })
                .catch(err => {
                    Swal.fire('Error', 'Something went wrong while approving.', 'error');
                });
        }
    });
}*/



let currentRejectId = null;

function rejectRequestReturn(id) {
    currentRejectId = id;
    const rejectModal = new bootstrap.Modal(document.getElementById("rejectModal"));
    rejectModal.show();
}

document.getElementById("submitRejectBtn").addEventListener("click", function () {
    const remarks = document.getElementById("rejectRemarks").value.trim();

    if (!remarks) {
        Swal.fire("Error", "Please enter rejection remarks.", "error");
        return;
    }

    fetch(`/api/asset-returns/${currentRejectId}/reject`, {
        method: "POST",
		headers: { "Content-Type": "text/plain" },  // note plain text
		   body: remarks  // just the string  // send as JSON object
    })
    .then(res => {
        if (!res.ok) throw new Error("Failed to reject");
        return res.json();
    })
    .then(() => {
        Swal.fire("Rejected!", "The request has been rejected successfully.", "success");
        document.getElementById("rejectRemarks").value = ""; // reset
        const rejectModalEl = document.getElementById("rejectModal");
        const modal = bootstrap.Modal.getInstance(rejectModalEl);
        modal.hide();
        loadReturnRequests();
    })
    .catch(() => {
        Swal.fire("Error", "Something went wrong. Try again.", "error");
    });
});

</script>
<script>

	
var formattedDate;

$.ajax({
    type: 'GET', 
    url: 'fetchGroupMailIdData', 
    success: function(data) {
		//console.log(JSON.stringify(data));
		updateGroupMailIdDetails(data);
		},
    error: function(xhr, status, error) {
        console.error('Error fetching data:', error);
        console.log('Error fetching data. Please try again.');
    }
});
  
function updateGroupMailIdDetails(data) {
    const tbody = $('#viewEmpDetailsTBody');
    tbody.empty();

    let currentMainMailId = null;
    let mainMailIdRowSpan = 0;
    let mainMailIdIndex = 0;

    data.forEach((item, index) => {
        if (item.main_mail_id !== currentMainMailId) {
            if (mainMailIdRowSpan > 1) {
                tbody.find(`tr:eq(${mainMailIdIndex}) td:eq(1)`).attr('rowspan', mainMailIdRowSpan);
            }

            currentMainMailId = item.main_mail_id;
            mainMailIdRowSpan = 1;
            mainMailIdIndex = tbody.children().length;

            tbody.append(`
                <tr>
                    <td class="cell border">${index + 1}</td>
                    <td class="cell border">${item.main_mail_id}</td>
                    <td class="cell border">${item.sub_mail_id || '-'}</td>
                    <td class="cell border">${formatGroupMailIds(item.group_mail_id)}</td>
                </tr>
            `);
        } else {
            mainMailIdRowSpan++;
            tbody.append(`
                <tr>
                    <td class="cell border">${index + 1}</td>
                    <td class="cell border" style="display: none;"></td>
                    <td class="cell border">${item.sub_mail_id || '-'}</td>
                    <td class="cell border">${formatGroupMailIds(item.group_mail_id)}</td>
                </tr>
            `);
        }
    });

    if (mainMailIdRowSpan > 1) {
        tbody.find(`tr:eq(${mainMailIdIndex}) td:eq(1)`).attr('rowspan', mainMailIdRowSpan);
    }
}

function formatGroupMailIds(groupMailIds) {
    if (!groupMailIds) return '';
    const ids = groupMailIds.split(',');
    let formatted = '<ul>';
    ids.forEach(id => {
        formatted += `<li>${id}</li>`;
    });
    formatted += '</ul>';
    return formatted;
}
  
</script>

<script>
	var loggedInRole = document.getElementById('roleValue').value;
	
	if(loggedInRole === "HR"){
		document.getElementById('employeeLink').style.display="block";
		document.getElementById('groupMailIdForm').style.display="block";
		//document.getElementById('compProjectLink').style.display="none";
		//document.getElementById('addEmployeeLink').style.display="block";
	}else if(loggedInRole === "Super Admin"){
		document.getElementById('employeeLink').style.display="none";
		document.getElementById('groupMailIdForm').style.display="none";
		document.getElementById('groupMailIdTable').style.width="100%";
		//document.getElementById('addEmployeeLink').style.display="none";
	}
</script>  

<!-- script to notification -->
<!-- <script>
// Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
        var leaveRequestCountValue = response;
        
        // If total notification count is greater than 0, show the bell icon and notifications
        if (leaveRequestCountValue.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        } else {
            //If total notification count is 0, hide the bell icon and notification
            $("#notificationBellIcon").hide();
        }
    });
}

// Periodically fetch flag value every second (adjust as needed)
setInterval(fetchFlag, 1000);

</script> -->

<!-- script to apply the background color for pending leave requests -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Select all rows with the 'highlight-row' class
        var rows = document.querySelectorAll('.highlight-row');

        // Apply additional styles if needed
        rows.forEach(function(row) {
            row.style.backgroundColor = '#EBF5FB'; // Ensure background color
            row.style.color = 'black'; // Ensure text color																	
        });
        
        
        
    });
</script>

<!-- script to notification link redirect -->

<!-- script to notification link redirect -->
<!-- <script th:inline="javascript">
    function redirectToLeaveRequest() {
        var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/viewAdminLeaves?empid=' + empid;
    }
    function redirectToAsset() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/asset';
    }
    function redirectToProject() {
        //var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
        window.location.href = '/ongoingProject';
    }    
    function redirectToAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/apprisal?empid=' + empid;
    }    
    function redirectToemployeeAppraisal() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/employeeApprisal?empid=' + empid;
    }    
    function redirectToAnnouncement() {
    	var empid = /*[[${empDetailsByEmpId.empid}]]*/ 'defaultEmpId';
    	window.location.href = '/events';
    }
    
    function redirectToAttendence() {
    	var email = /*[[${empDetailsByEmpId.email}]]*/ 'defaultEmpId';
    	window.location.href = '/attendanceLive?email=' +email;
    }
</script> -->


<!-- script to hide and display the RequestAssets and display assets -->
<script>
	
	/*document.addEventListener("DOMContentLoaded", function () {
	    const assetDetailsTab = document.getElementById("asset-details-tab");

	    assetDetailsTab.addEventListener("click", function () {
	        console.log("Fetching assigned assets...");

	        fetch("/assigned") // backend endpoint
	            .then(response => {
	                if (!response.ok) throw new Error("Failed to fetch assigned assets");
	                return response.json();
	            })
	            .then(data => {
	                console.log("Assigned assets:", data);

	                const tbody = document.querySelector("#assignedAssetsTable tbody");
	                tbody.innerHTML = ""; // Clear old rows

	                if (!data || data.length === 0) {
	                    tbody.innerHTML = `
	                        <tr>
	                            <td colspan="7" class="text-center text-muted">No assigned assets available</td>
	                        </tr>`;
	                } else {
	                    data.forEach(asset => {
	                        const row = document.createElement("tr");
	                        row.innerHTML = `
	                            <td>${asset.id}</td>
								<td>${asset.asset_id || '-'}</td>
	                            <td>${asset.assigned_asset_id || '-'}</td>
								<td>${asset.empName || '-'}</td>

	                            <td>${asset.asset_type || '-'}</td>
	                            <td>${asset.quantity || 0}</td>
	                            <td>${asset.description || '-'}</td>
	                            <td>${asset.remarks || '-'}</td>
	                           
	                            <td>${asset.ref_asset_id || '-'}</td>
	                        `;
	                        tbody.appendChild(row);
	                    });
	                }
	            })
	            .catch(error => {
	                console.error("Error fetching assets:", error);
	            });
	    });
	});*/

	
function requestAsset() {
    // Show the form and hide the content  
    document.getElementById('assetRequestForm').style.display = 'block';
    document.getElementById('AssetList').style.display = 'none';
    document.getElementById('addProjectButton').style.display = 'none';
    document.getElementById('addAssets').style.display = 'none';
    document.getElementById('viewListButton').style.display = 'block';
}

function viewProject() {
    document.getElementById('assetRequestForm').style.display = 'none';
    document.getElementById('AssetList').style.display = 'block';
    document.getElementById('addProjectButton').style.display = 'inline-block';
    document.getElementById('addAssets').style.display = 'inline-block';
    document.getElementById('viewListButton').style.display = 'none';
}

</script>


<!-- script is to add multiple assets request -->
<script>
    let assetCount = 1; // Initialize the counter for asset fields

    function addAssetField() {
        const assetFieldsDiv = document.getElementById("assetFields");
        const newAssetField = `
            <div class="row asset-entry mt-3">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="empid" class="form-label">Employee ID</label>
                        <input type="text" class="form-control" th:field="*{[${assetCount}].empid}" readonly>
                    </div>
                    <div class="form-group mb-3">
                        <label for="asset" class="form-label">Asset</label>
                        <input type="text" class="form-control" th:field="*{[${assetCount}].asset}" placeholder="Enter Asset Name">
                    </div>
                    <div class="form-group mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" th:field="*{[${assetCount}].quantity}" placeholder="Enter Quantity">
                    </div>
                    
                </div>
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" th:field="*{[${assetCount}].description}" rows="5" placeholder="Enter Description"></textarea>
                    </div>
                </div>
            </div>
        `;
        assetFieldsDiv.insertAdjacentHTML('beforeend', newAssetField);
        assetCount++; // Increment the counter
    }
</script>

<!-- script to update the request value in table when user click on forward to store button -->
<script>
function forwardToStore(assetId) {
    // Construct the proper URL with the assetId
    fetch(`/forwardToStore/${assetId}`, {
        method: 'POST',
    })
    .then(response => {
        if (response.ok) {
            // Trigger success modal
            var successModal = new bootstrap.Modal(document.getElementById('successModal'), {});
            successModal.show();
            
            // Reload the page when the user clicks "OK"
            document.getElementById('successModalOkBtn').addEventListener('click', function () {
                location.reload();  // Reload the page
            });
        } else {
            // If the response is not ok, trigger error modal
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
            errorModal.show();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        // Trigger error modal in case of a network error
        var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
        errorModal.show();
    });
}
</script>

<!-- script to update the asset available status flag value -->
<script>
function updateAssetAvailable(assetId) {
    // Construct the proper URL with the assetId
    fetch(`/updateAssetAvailable`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            id: assetId
        }),
    })
    .then(response => {
        if (response.ok) {
            // Trigger success modal
            var successModal = new bootstrap.Modal(document.getElementById('successModal'), {});
            successModal.show();
            
            // Reload the page when the user clicks "OK"
            document.getElementById('successModalOkBtn').addEventListener('click', function () {
                location.reload();  // Reload the page
            });
        } else {
            // If the response is not ok, trigger error modal
            var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
            errorModal.show();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        // Trigger error modal in case of a network error
        var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
        errorModal.show();
    });
}
</script>

<!-- script to update the asset available status flag value -->
<script>
function updateAssetDelay(assetId) {
    // Show the available date modal
    var availableDateModal = new bootstrap.Modal(document.getElementById('availableDateModal'), {});
    availableDateModal.show();

    // Attach event listener to the submit button
    document.getElementById('submitAvailableDate').onclick = function () {
        // Get the entered available date
        var availableDate = document.getElementById('availableDate').value;

        if (availableDate) {
            // Construct the proper URL with the assetId
            fetch(`/updateAssetDelay`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: assetId,
                    availableDate: availableDate // Send the available date
                }),
            })
            .then(response => {
                if (response.ok) {
                    // Trigger success modal
                    var successModal = new bootstrap.Modal(document.getElementById('successModal'), {});
                    successModal.show();
                    
                    // Reload the page when the user clicks "OK"
                    document.getElementById('successModalOkBtn').addEventListener('click', function () {
                        location.reload();  // Reload the page
                    });
                } else {
                    // If the response is not ok, trigger error modal
                    var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
                    errorModal.show();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Trigger error modal in case of a network error
                var errorModal = new bootstrap.Modal(document.getElementById('errorModal'), {});
                errorModal.show();
            });

            // Hide the modal after submitting
            availableDateModal.hide();
        } else {
            // Handle case where date is not entered
            alert("Please enter a valid available date.");
        }
    };
}
</script>
<!-- script to notification -->
<!-- <script>
//Function to fetch flag value from the backend
function fetchFlag() {
    $.get("/flag", function(response) {
    	console.log("admin");
        var leaveRequestCountValue = response;
        console.log(leaveRequestCountValue);
       // If total notification count is greater than 0, show the bell icon
        if (leaveRequestCountValue.totalNotificationCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
        } else {
            $("#notificationBellIcon").hide();  // Hide bell icon if no notifications
        }

        if (leaveRequestCountValue.leaveRequestFlagCount > 0) {
            $("#notificationBellIcon").show();  // Show bell icon
            $("#leaveRequestNotification").show();  // Show specific notification
            
            $("#leaveRequestMessage").text(leaveRequestCountValue.leaveRequestFlagCount + " leave request(s)");
            $(".badge-number").text(leaveRequestCountValue.leaveRequestFlagCount);
            $("#leaveRequestFlagCount").text(leaveRequestCountValue.leaveRequestFlagCount);
        }
        //display the asset notifu=ication based on asset count value
        if(leaveRequestCountValue.asseteRequestFlagCount>0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#assetRequestNotification").show();  // Show specific notification
              
             $("#assetRequestMessage").text(leaveRequestCountValue.asseteRequestFlagCount + " asset request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#asseteRequestFlagCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        	 	
        }
        
        //display the new project notification based on asset count value
        if(leaveRequestCountValue.newPrjectValueCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newProjectNotification").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.newPrjectValueCount + " project request(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        //display the appraisal from HR notification ]
        if(leaveRequestCountValue.appraisalCount>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#hrAppraisal").show();  // Show specific notification
             
             $("#newProjectMessage").text(leaveRequestCountValue.appraisalCount + " Appraisal Form");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
      //display the appraisal from employee notification 
        if(leaveRequestCountValue.empAppraisalflag>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalempNotification").text(leaveRequestCountValue.empAppraisalflag + " employees sent appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
        
        //display the appraisal Due date notification 
        if(leaveRequestCountValue.adminAppraisalDuedate>0){
        	 $("#dueAppraisal").show();  // Show bell icon
             $("#empAppraisal").show();  // Show specific notification
             
             $("#apprisalDueNotification").text("Tomorrow is the due date for submit appraisal");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
             $("#newPrjectValueCount").text(leaveRequestCountValue.asseteRequestFlagCount);
        }
      //display the announcement notification based on asset count value
        if(leaveRequestCountValue.announcementNotification>0){
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#newAnnouncementNotification").show();  // Show specific notification
             
             $("#newannouncement").text(leaveRequestCountValue.announcementNotification + " announcement(s)");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);
        }
        //display the leave request status change notification
        if(leaveRequestCountValue.leaveRequestStatusChangeValue > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#leaveRequestSatusChangeNotification").show();  // Show specific notification
             
             $("#leaveRequestSatusChangeMessage").text("Your leave request status has been");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 	
        } 
        //display the new feature notification
        if(leaveRequestCountValue.newFeatureNotification > 0){
        	 
        	 $("#notificationBellIcon").show();  // Show bell icon
             $("#new-feature").show();  // Show specific notification
             
             $("#new-featuretext").text("Latest Update, There is " + leaveRequestCountValue.newFeatureNotification + " new feature(s) update is now available.");
             $(".badge-number").text(leaveRequestCountValue.totalNotificationCount);             
        	 
        } 
       
    });
}

// Periodically fetch flag value every second (adjust as needed)
setInterval(fetchFlag, 1000);
</script>
 -->
<!-- script for profile pic -->
<script>
$.ajax({
    type: "GET",
    url: "fetchEmployeeDocumentDetailsOnlyByEmpId",
    data: {
        "emp_id": $('#emp_idSessionValue').val()
    },
    success: function(data) {
    	//console.log("++++data"+JSON.stringify(data));
        $('#dynamicProfilePic').attr('src', `${data.profilePicPath}`);
    },
    error: function(xhr, status, error) {
        console.error("Error invoking data:", error);
    }
});
</script>

<!-- script to notification on bottom of the page-->
<!--CHAT BOOT-->

		<!-- Include SockJS and Stomp.js libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- script to notification on bottom of the page-->
<script>
		//CODE FOR CHATBOOT NOTIFICATION 
		var stompClient = null;
		var employeeMap = {}; // To store the mapping of employee names to emails
		let employeePhotoMap = {};
		let emailToNameMap = {}; // New map for email -> name lookup
		var email = null;
		var visibilityState = document.visibilityState; // Track tab visibility
		var heartbeatInterval = null; // Track heartbeat interval

		function connectWebSocket() {
			
			var socket = new SockJS('/chat-websocket');
						  stompClient = Stomp.over(socket);

						  var email = document.getElementById('loggedInMail').value;
						  console.log(`Connecting WebSocket as: ${email}`);

						  stompClient.connect({ 'email': email }, function (frame) {
						      console.log('Connected to WebSocket:', frame);

							 // subscribeToTypingEvents();
						      // Mark user as active
						      stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));

						      // Subscribe to active users list
						      stompClient.subscribe('/topic/activeUsers', function (message) {
						          var activeUsers = JSON.parse(message.body);
						          updateActiveUserUI(activeUsers);
						      });
							  // Subscribe to user messages
							        stompClient.subscribe('/user/queue/messages', function (message) {
									//	loadMessages();
									//	alert("po2");
							            console.log('Raw WebSocket Message:11', message);
							            var msg = JSON.parse(message.body);
										//alert(msg);
							            console.log('Parsed Messag111e:', msg);
							            console.log(`Received messagesdsd: ${JSON.stringify(msg)}`);
										//alert("(message.read"+msg.read);
									
							            // Display message if it matches the selected employee
							            if (selectedEmployee === msg.senderEmail || selectedEmployee === msg.recipientEmail) {
											console.log(`New message fromss ${msg.senderEmail}: ${msg.content}`);
											console.log("plk "+selectedEmployee);
											console.log("plk "+msg.senderEmail);
											console.log("plk "+msg.recipientEmail);
											//loadMessages();
							                showMessage(
							                    msg.id,               // Message ID
							                    msg.senderEmail,      // Sender's email
							                    msg.content,          // Message content
							                    msg.recipientEmail,   // Recipient's email
							                    msg.timestamp,        // Message timestamp
							                    email,
												msg.read                    // Logged-in user's email
							                );
							            }
								
										loadEmployees();
										loadMessages();
									 	
							        });

							        // Subscribe to notifications
							        stompClient.subscribe('/user/queue/notifications', function (notification) {
										//alert("00");
							            console.log('New Notification:', notification.body);
							            showToastNotification(notification.body);
										loadEmployees();
										//alert("01");
							        });

									//alert("Subscribing to chat updates...");
									stompClient.subscribe('/user/queue/messages', function (message) {
									    console.log('WebSocket Chat Update Received:', message.body); // Log raw message

									    let parsedMessage = JSON.parse(message.body);
									    console.log('Parsed Message:', parsedMessage); // Log parsed JSON

									    if (Array.isArray(parsedMessage)) {
									        parsedMessage.forEach(msg => {
									            console.log(`Message ID: ${msg.id}, Read: ${msg.read}`);
									            if (msg.read) {
									                updateMessageUI(msg);
									            }
									        });
									    } else {
									        console.log("Unexpected message format:", parsedMessage);
									    }

									    // Refresh messages after a delay
									    setTimeout(() => {
									        console.log("Refreshing messages...");
									        loadMessages();
									    }, 3000);
									});

									stompClient.subscribe('/topic/typing', function (message) {
									    console.log("üì© Typing notification received:", message.body);

									    let typingData;
									    try {
									        typingData = JSON.parse(message.body);
									        console.log("‚úÖ Parsed Typing Data:", typingData);
									    } catch (error) {
									        console.error("‚ùå Error parsing typing notification message:", error);
									        return;
									    }

									    let loggedInUserEmail = document.getElementById('loggedInMail')?.value;
									    if (!loggedInUserEmail) return;

									    if (loggedInUserEmail === typingData.recipientEmail && typingData.senderEmail === selectedEmployee) {
									        // Fetch actual typing status from the backend
									        fetch(`/getTypingStatus?senderEmail=${typingData.senderEmail}&recipientEmail=${typingData.recipientEmail}`)
									            .then(response => response.json())
									            .then(data => {
									                console.log("üéØ Actual Typing Status from DB:", data.typing);
													console.log("üéØ Actual Typing Status from DB:", data);
													                console.log("‚ÑπÔ∏è Typing Status (0 or 1):", data.typing);
													                
									                let chatMessages = document.querySelector(".chat-history ul");
									                let chatContainer = document.querySelector(".chat-history"); // The scrollable chat area

									                let typingIndicator = document.getElementById("typingIndicator");
									                
									                if (!typingIndicator) {
									                    typingIndicator = document.createElement("li");
									                    typingIndicator.id = "typingIndicator";
									                    typingIndicator.classList.add("typing-indicator");
									                    typingIndicator.innerHTML = `
									                        <img src="${employeePhotoMap[selectedEmployee] || 'default-profile.jpg'}" alt="User Photo" class="typing-photo">
									                        <span>Typing...</span>
									                    `;
									                    chatMessages.appendChild(typingIndicator);
									                }

									                if (data.typing === 1) { // Ensure it checks the latest typing status
									                    typingIndicator.style.display = "flex";

									                    // Move typing indicator to the bottom
									                    chatMessages.appendChild(typingIndicator);

									                    // Auto-scroll to the bottom
									                    setTimeout(() => {
									                        chatContainer.scrollTop = chatContainer.scrollHeight;
									                    }, 100);
									                } else {
									                    typingIndicator.style.display = "none";
									                }
									            })
									            .catch(error => console.error("‚ùå Error fetching typing status:", error));
									    }
									});


						      // Start heartbeat initially
						      heartbeatInterval = setInterval(() => {
						          if (stompClient && stompClient.connected) {
						              stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						              console.log("Heartbeat sent for user: " + email);
						          }
						      }, 20000); // 30 seconds

						      // Detect tab visibility change
						  /*    document.addEventListener("visibilitychange", function () {
						          if (document.hidden) {
						              console.log("User switched to another tab. Marking as inactive.");
						              stompClient.send("/app/userInactive", {}, JSON.stringify({ email }));
						              clearInterval(heartbeatInterval); // Stop heartbeat
						              heartbeatInterval = null;
						          } else {
						              console.log("User returned to the application tab. Marking as active.");
						              stompClient.send("/app/userConnected", {}, JSON.stringify({ email }));
						              if (!heartbeatInterval) {
						                  heartbeatInterval = setInterval(() => {
						                      if (stompClient && stompClient.connected) {
						                          stompClient.send("/app/userHeartbeat", {}, JSON.stringify({ email }));
						                          console.log("Heartbeat sent for user: " + email);
						                      }
						                  }, 30000);
						              }
						          }
						      });*/

						      // Detect tab close or WebSocket disconnect
						      socket.onclose = function () {
						          console.log("WebSocket disconnected. Updating user status.");
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      };

						      window.addEventListener('beforeunload', function () {
						          stompClient.send("/app/userDisconnected", {}, JSON.stringify({ email }));
						      });

						  });
		}

		function updateActiveUserUI(activeUsers) {
		//	alert("1");
		    const employeeItems = document.getElementById('employeeNames').getElementsByTagName('li');

		    Array.from(employeeItems).forEach(item => {
		        const employeeName = item.querySelector('span').textContent;
		        const email = employeeMap[employeeName]; 
		        const statusIndicator = item.querySelector('.status-indicator'); // Get the status dot

		        if (activeUsers.includes(email)) {
		            item.classList.add('active-user');
		            statusIndicator.style.backgroundColor = '#66cc66'; // Green for active users
		        } else {
		            item.classList.remove('active-user');
		            statusIndicator.style.backgroundColor = '#ff6666'; // Red for inactive users
		        }

		        // If this employee is currently selected, update chat header status
				if (selectedEmployee === email) {
				           const chatStatusIndicator = document.getElementById('chatStatusIndicator');
				           if (activeUsers.includes(email)) {
				               chatStatusIndicator.style.backgroundColor = '#66cc66'; // Green (Online)
				           } else {
				               chatStatusIndicator.style.backgroundColor = '#ff6666'; // Red (Offline)
				           }
				       }
		    });
		}


		// Select an employee to chat with
		function selectEmployee(employeeName) {
			selectedEmployee = employeeMap[employeeName]; // Get the email from the map
			//console.log(`Employee selected: ${selectedEmployee}`);

			// Highlight the selected employee
			var employeeItems = document.querySelectorAll('#employeeNames li');
			employeeItems.forEach(function (item) {
				item.classList.remove('active');
			});
			var selectedItem = Array.from(employeeItems).find(item => item.innerHTML === employeeName);
			if (selectedItem) {
				selectedItem.classList.add('active');
			}

			// Update chat header with employee name and photo
			document.querySelector('.chat-about h6').innerText = employeeName;
			document.querySelector('#employeePhoto').src = employeePhotoMap[selectedEmployee] || 'default-profile.jpg';

			// Hide the message icon and dots when an employee is selected
			document.getElementById('message-icon-container').style.display = 'none';
			// Hide the paragraph when an employee is selected
			document.getElementById('logo-text').style.display = 'none';

			// Load messages for the selected employee
			loadMessages();
		}

		function loadEmployees() {
			//console.log("Loading employee names...");

			// Fetch employee names from the endpoint
			fetch('/employees/names')
				.then(response => {
					//console.log("Response received:", response);
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					return response.json();
				})
				.then(data => {
					//console.log("Employee data fetched:", data); // Log the raw data

					const employeeList = document.getElementById('employeeNames');
					if (!employeeList) {
						//console.error("Element with ID 'employeeNames' not found.");
						return;
					}

					employeeList.innerHTML = ''; // Clear the list before adding new items

					// Iterate through employee data
					data.forEach(employee => {
						//console.log("Processing employee:", employee);

						// Create a list item for each employee
						const li = document.createElement('li');
						li.classList.add('d-flex', 'align-items-center', 'employee-item');

						// Handle missing or empty profile photo paths
						const profilePic = employeePhotoMap[employee.email] || '/static/default-profile.jpg';
						//console.log(`Profile picture for ${employee.name}: ${profilePic}`);

						li.innerHTML = `
			                    <img src="${profilePic}" 
			                         alt="Employee Photo" 
			                         class="employee-photo mr-2" />
			                    <span>${employee.name}</span>
			                `;

						// Map employee name to email
						employeeMap[employee.name] = employee.email;
						//console.log("Mapped employee:", employee.name, "->", employee.email);
						// Add new reverse mapping (email -> name)
						emailToNameMap[employee.email] = employee.name;
						// Add click event to list item
						li.onclick = () => {
							//console.log(`Selected employee: ${employee.name}`);
							selectEmployee(employee.name);
						};

						// Append the list item to the employee list
						employeeList.appendChild(li);

					});

					//console.log("Employee names loaded successfully. Employee map:", employeeMap);
					// Call the unread messages function after loading employee data
					fetchUnreadMessages();

					// Set interval to check for new messages every 10 seconds
						setInterval(fetchUnreadMessages, 10000);
				})
				.catch(error => {
					console.error("Error loading employees:", error);
				});
		}


		function loadMessages() {
			// alert("Loading messages...");
			// Get the logged-in user's email and selected employee's email
			var loggedInEmail = document.getElementById('loggedInMail').value;
			var selectedEmployeeEmail = selectedEmployee; // Email is already stored in selectedEmployee

			//console.log(`Loading messages between: ${loggedInEmail} and ${selectedEmployeeEmail}`);

			fetch(`/messages?loggedInEmail=${encodeURIComponent(loggedInEmail)}&selectedEmployeeEmail=${encodeURIComponent(selectedEmployeeEmail)}`)
				.then(response => response.json())
				.then(data => {
					//console.log("Chat messages loaded:", data);
					// Clear the chat window before displaying messages
					var chatWindow = document.getElementById('chat-window').querySelector('ul');
					chatWindow.innerHTML = '';

					// Display messages
					data.forEach(function (msg) {
						// showMessage(msg.senderEmail, msg.content, msg.recipientEmail, loggedInEmail);
						showMessage(msg.id, msg.senderEmail, msg.content, msg.recipientEmail, msg.timestamp, loggedInEmail);
					});
				})
				.catch(error => console.error("Error loading chat messages:", error));
		}
		let activeDeleteDropdown = null;
		function showMessage(id, senderEmail, message, recipientEmail, timestamp, loggedInEmail) {
			//console.log("Message ID:", id);
			//console.log(`LoggedInEmailrrr: ${loggedInEmail}, SenderEmail: ${senderEmail}`);

			const isSender = senderEmail === loggedInEmail;
			const senderName = isSender ? "Me" : Object.keys(employeeMap).find(name => employeeMap[name] === senderEmail) || senderEmail;
			const senderPhoto = employeePhotoMap[senderEmail] || 'default-avatar.png';
			const formattedTime = new Date(timestamp).toLocaleString(); // Format timestamp

			//console.log(`Message ID: ${id}, Time: ${formattedTime}, From: ${senderEmail}, To: ${recipientEmail}, Content: "${message}"`);

			var chatWindow = document.getElementById('chat-window').querySelector('ul');
			var li = document.createElement('li');
			li.className = isSender ? 'clearfix right' : 'clearfix left';

			li.innerHTML = `
					    <div class="message-container" data-message-id="${id}" onclick="toggleDeleteOption(this)">
					        <img class="sender-photo" src="${senderPhoto}" alt="Sender Photo" />
					        <div class="message ${isSender ? 'my-message' : 'other-message'}">
					            <strong>${senderName}:</strong> ${message}
					        </div>
					    </div>
					    <div class="timestamp" style="text-align: ${isSender ? 'right' : 'left'};">
					        ${formattedTime}
					    </div>
					    ${isSender ? `
					        <div class="message-action-dropdown" >
					            <a class="dropdown-item" href="#" onclick="deleteMessage(this, ${id})">Delete Message</a>
					        </div>
					    ` : ''}`;

			chatWindow.appendChild(li);
			chatWindow.scrollTop = chatWindow.scrollHeight;
		}
		
		/*function fetchUnreadMessages() {
			console.log("Fetching unread messages...");
			var loggedInEmail = document.getElementById('loggedInMail').value;

			fetch(`/unread?email=${loggedInEmail}`)
				.then(response => response.json())
				.then(messages => {
					messages.forEach(message => {
						let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;

						// Show notification with sender's email as a parameter
						showToastNotification(`New message from ${senderName}: ${message.content}`, message.senderEmail);
					});
				})
				.catch(error => console.error("Error fetching unread messages:", error));
		}*/

		let displayedMessageIds = new Set(); // Track displayed messages
		let closedMessageIds = new Set(); // Track closed messages

		function fetchUnreadMessages() {
		    //console.log("Fetching unread messages...");
		    var loggedInEmail = document.getElementById('loggedInMail').value;

		    fetch(`/unread?email=${loggedInEmail}`)
		        .then(response => response.json())
		        .then(messages => {
		            messages.forEach(message => {
		                //console.log("Processing message ID:", message.id); // Print message ID to console
		                
		                // Ignore messages that were previously closed
		                if (!displayedMessageIds.has(message.id) && !closedMessageIds.has(message.id)) {
							//alert(1);
		                    let senderName = emailToNameMap[message.senderEmail] || message.senderEmail;
		                    showToastNotification(`New message from ${senderName}: ${message.content}`, message.id, message.senderEmail);
		                    displayedMessageIds.add(message.id); // Mark message as displayed
		                }
						//alert(2);
		            });
		        })
		        .catch(error => console.error("Error fetching unread messages:", error));
		}
		// Global flag to track if the user manually dismissed notifications
		
		/*function showToastNotification(message, senderEmail) {
			
			var toastContainer = document.createElement('div');
			toastContainer.className = 'toast-notification';

			// Add message and close button
			toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">‚úñ</span>`;

			document.body.appendChild(toastContainer);

			// Animate in
			setTimeout(() => {
				toastContainer.classList.add('show');
			}, 100);

			// Auto-hide after 8 seconds
			let autoHideTimeout = setTimeout(() => closeToast(toastContainer), 10000);

			// Prevent opening chat when clicking the close button
			toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
				event.stopPropagation(); // Prevent click from bubbling to toastContainer
				clearTimeout(autoHideTimeout);
				
				closeToast(toastContainer);
			});

			// Open chat when clicking on the notification
			toastContainer.addEventListener('click', () => {
				openChatWithSender(senderEmail);
				closeToast(toastContainer); // Remove notification when chat opens
			});
		}*/
		function showToastNotification(message, messageId, senderEmail) {
			//alert(1);
		    var toastContainer = document.createElement('div');
		    toastContainer.className = 'toast-notification';
		    toastContainer.innerHTML = `<p>${message}</p> <span class="toast-close">‚úñ</span>`;

		    document.body.appendChild(toastContainer);

		    // Animate in
		    setTimeout(() => {
		        toastContainer.classList.add('show');
		    }, 100);

		    // Auto-hide after 8 seconds
		    let autoHideTimeout = setTimeout(() => closeToast(toastContainer, messageId), 8000);

		    // Prevent opening chat when clicking the close button
		    toastContainer.querySelector('.toast-close').addEventListener('click', (event) => {
		        event.stopPropagation(); // Prevent click from bubbling to toastContainer
		        clearTimeout(autoHideTimeout);
		        closedMessageIds.add(messageId); // Mark as closed so it won't be shown again
		        closeToast(toastContainer, messageId);
		    });

		    // Open chat when clicking on the notification
		    toastContainer.addEventListener('click', () => {
		        openChatWithSender(senderEmail);
		        closeToast(toastContainer, messageId); // Remove notification when chat opens
		    });
		}

		// Function to handle toast closing
		/*function closeToast(toast) {
			toast.classList.remove('show');
			setTimeout(() => toast.remove(), 300); // Faster fade-out
		}*/
		// Function to handle toast closing and mark as dismissed
		// Function to handle toast closing
		function closeToast(toast, messageId) {
		    toast.classList.remove('show');
		    setTimeout(() => toast.remove(), 300); // Faster fade-out
		}
		/*	function openChatWithSender(senderEmail) {
				console.log("Opening chat with:", senderEmail);
			    
				// Construct the URL for the UserFavorite page with the senderEmail as a query parameter
				const url = `/my-favorites?email=${encodeURIComponent(senderEmail)}`;
			    
				// Redirect to the UserFavorite page
				window.location.href = url;
			}*/

		function openChatWithSender(senderEmail) {
			//console.log("Opening chat with:", senderEmail);

			// Store sender email in sessionStorage
			sessionStorage.setItem("chatSenderEmail", senderEmail);

			// Redirect to the UserFavorite page
			window.location.href = `/my-favorites`;
		}

		// Connect to the WebSocket server and load employees when the page is loaded
		document.addEventListener('DOMContentLoaded', function () {
			//fetchUnreadMessages();
			loadEmployees();
			connectWebSocket();
		});

	</script>
	
	<!-- script to open assign modal -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
	
	<script>
	function openAssignFormFromElement(button) {
	    const id = button.dataset.id;
	    const empId = button.dataset.empId;
	    const assetType = button.dataset.assetType;
	    const quantity = button.dataset.quantity;
	    const description = button.dataset.description;

	    openAssignForm(id, empId, assetType, quantity, description);
	}

	function openAssignForm(id, empId, assetType, quantity, description) {
	    
		// Populate hidden form fields
		document.getElementById("assignId").value = id;
		document.getElementById("empId").value = empId;
		//document.getElementById("quantity").value = quantity;
		document.getElementById("description").value = description;
  		
		// Open the modal
		var myModal = new bootstrap.Modal(document.getElementById("assignAssetModal"));
		myModal.show();
		
	}
		 
		function filterDescriptions() {
		 
			let assetType = document.getElementById("assetName").value;
			let descriptionDropdown = document.getElementById("description");
			descriptionDropdown.innerHTML = '<option value="">Select Description</option>';
			 
			if (assetType) {
			 
					fetch(window.location.origin + "/get-descriptions-asset-type?assetType=" + assetType)
						.then(response => response.json())
						.then(data => {
							data.forEach(description => {
							let option = document.createElement("option");
							option.value = description;
							option.textContent = description;
							descriptionDropdown.appendChild(option);
						});
					})
					.catch(error => console.error('Error fetching descriptions:', error));
			} 
		} 
		
		function fetchAssetId() {
		    let assetType = document.getElementById("assetName").value;
		    let description = document.getElementById("description").value;
		    let assetIdInput = document.getElementById("assetId");
		    let remainingQuantity = document.getElementById("remainingQuantity");

		    assetIdInput.value = ""; // Clear current value

		    if (assetType && description) {
		        fetch(`/get-asset-id?assetType=${encodeURIComponent(assetType)}&description=${encodeURIComponent(description)}`)
		            .then(response => response.json())
		            .then(data => {
		                assetIdInput.value = data.assetId;//
		                document.getElementById("remainingQtyInfo").style.display = "block";
		                document.getElementById("remainingQtyText").textContent = data.remainingQty;
		            })
		            .catch(error => console.error('Error fetching asset ID:', error));
		    }
		}

		function assignAssetId(assetType) {
		 
			let assetIdField = document.getElementById("assetId");
			let baseId = "MSPL/PCO101/";
			switch (assetType.toLowerCase()) {
			 
				case "laptop":
				 	assetIdField.value = baseId + "LP";
					break;
				case "mouse":
					assetIdField.value = baseId + "MS";
					break;
				case "monitor":
					assetIdField.value = baseId + "MR";
					break;
				case "keyboard":
					assetIdField.value = baseId + "KB";
					break;
				default:
					assetIdField.value = baseId + "__";
					break;
				}
		}
		 
	</script>
	
	
	<!-- script to add assets request -->
	<script>
	 function openAssetForm() {
		 
	        // Show the modal
	        $("#addAssetModal").modal("show");
	        
	    }
	</script>
	
	<!-- script to edit asset  -->
	<script>
	

	function openAssetEditModal(id, name, quantity, description) {
		// alert(name);
	    // Set values in the modal form
	    document.getElementById("editId").value = id;
	    document.getElementById("editAssetName").value = name;
		document.getElementById("availableQuantityDisplay").innerText = "Available: " +quantity;
	    //document.getElementById("editQuantity").value = quantity;
	    document.getElementById("editDescription").value = description;
	    document.getElementById("editAssetId").value = description;
	}
	document.getElementById("editQuantity").addEventListener("input", function () {
	    const availableText = document.getElementById("availableQuantityDisplay").innerText;
	    const available = parseInt(availableText.replace(/[^0-9]/g, "")) || 0;
	    const entered = parseInt(this.value) || 0;

	    if (entered < 0) {
	        document.getElementById("remarksSection").classList.remove("d-none");
	        document.getElementById("editRemarks").setAttribute("required", "true");
	    } else {
	        document.getElementById("remarksSection").classList.add("d-none");
	        document.getElementById("editRemarks").removeAttribute("required");
	    }
	});
	function saveAsset() {
	    let assetData = {
	        id: document.getElementById("editId").value,
	        asset_name: document.getElementById("editAssetName").value,
	        quantity: document.getElementById("editQuantity").value,
	        description: document.getElementById("editDescription").value,
			remarks: document.getElementById("editRemarks").value.trim()
	    };

	    fetch("/updateAsset", {
	        method: "POST",
	        headers: {
	            "Content-Type": "application/json"
	        },
	        body: JSON.stringify(assetData)
	    })
	    .then(response => {
	        if (!response.ok) {
	            throw new Error("Failed to update asset");
	        }
	        return response.json(); // Expecting a JSON response
	    })
	    .then(data => {
	        showMessage("success", data.message); // Show success modal
	        $("#editAssetModal").modal("hide"); // Hide modal
	    })
	    .catch(error => {
	        showMessage("error", "Error updating asset: " + error.message);
	    });
	}

	function showMessage(type, message) {
	    if (type === "success") {
	        document.getElementById("successMessage").innerText = message;
	        $("#successModal").modal("show"); // Show success modal
	    } else {
	        alert(message); // Fallback for error messages
	    }
	}
	
	function refreshPage() {
	    location.reload(); // Reloads the page
	}
	
	</script>
	<!-- script to delete asset -->
	<script>
	    // Open delete modal and store asset ID
	    function openAssetDeleteModal(id) {
	        document.getElementById("deleteAssetId").value = id;
	    }
	
	    // Confirm and delete the asset
	    function confirmDelete() {
	        let assetId = document.getElementById("deleteAssetId").value;
	
	        fetch("/deleteAsset/" + assetId, {
	            method: "DELETE",
	        })
	        .then(response => {
	            if (!response.ok) {
	                throw new Error("Failed to delete asset");
	            }
	            return response.text();
	        })
	        .then(message => {
	        	
	        	// Hide delete modal
	            let deleteModal = bootstrap.Modal.getInstance(document.getElementById("deleteAssetModal"));
	            deleteModal.hide();
	            // Show success modal with message
	            location.reload(); // Refresh the page after deletion
	            
	        })
	        .catch(error => {
	            alert("Error deleting asset: " + error.message);
	        });
	    }
	
	    // Initialize Bootstrap tooltip
	    document.addEventListener("DOMContentLoaded", function () {
	        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
	            return new bootstrap.Tooltip(tooltipTriggerEl);
	        });
	    });
	</script>


<!-- script to display asset info -->
<script>
function openAssetInfoModal(assetId) {
	
    $.ajax({
    	url: '/getAssetLogs?assetId=' + encodeURIComponent(assetId),// Backend endpoint to fetch asset logs
        type: 'GET',
        dataType: 'json',
        success: function(response) {
        	//console.log("responsessss",response);
            // Clear previous data in modal
            $('#assetLogBody').empty();

            if (response.length > 0) {
            	   // Set assetId in modal title
                document.getElementById("assetIdLogDetails").textContent = response[0].assetId;
                // Loop through the response and append logs to modal body
                response.forEach(log => {
                	let actionColor = log.action.toLowerCase() === 'assigned' ? 'text-primary' : 
                        log.action.toLowerCase() === 'modified' ? 'text-success' : '';
                	
                	let assignedTo = log.assignedTo ? log.assignedTo : '-';
                	let oldQty = parseInt(log.oldQuantity) || 0;
                	let newQty = parseInt(log.newQuantity) || 0;
                	let qtyDiff = newQty - oldQty;
                	
                	let diffColor = qtyDiff > 0 ? 'text-success' : 
                         qtyDiff < 0 ? 'text-danger' : 
                         'text-muted';  // for zero difference

                         
                    $('#assetLogBody').append(`
                        <tr>
                            <td>${log.modified_by_name}</td>
                            
                            <td>${log.newModifiedDate}</td>
                            <td>${log.oldQuantity}</td>
                            <td>${log.newQuantity}</td>
                            <td class="${diffColor}">${qtyDiff}</td><!-- Difference displayed here -->
                            <td>${log.assigned_to_name}</td>
                            <td class="${actionColor}">${log.action}</td>
                        </tr> 
                    `);
                });
            } else {
                // Show message if no logs found
                $('#assetLogBody').append('<tr><td colspan="4" class="text-center text-muted">No logs available</td></tr>');
            }

            // Show the modal
            $('#infoAssetModal').modal('show');
            
        },
        error: function(xhr, status, error) {
            console.error('Error fetching asset logs:', error);
        }
    });
}

</script>

<!-- script to approve approveRequest -->
<script>
function approveRequest(requestId) {
    if (confirm("Are you sure you want to approve this request?")) {
        fetch('/approveAssetRequest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ requestId: requestId })
        })
        .then(response => {
            if (response.ok) {
                return response.text(); // or .json() if your backend returns JSON
            } else {
                throw new Error('Request failed');
            }
        })
        .then(data => {
            //console.log('Success:', data);
            alert("Request approved successfully!");
            window.location.href = window.location.pathname + '?tab=assetRequests';
        })
        .catch(error => {
            console.error('Error:', error);
            alert("Something went wrong while approving the request.");
        });
    }
}
</script>

<!-- script to active and inactive the assets -->
<script>
let tempAssetId = null;
let tempIsActive = null;
let tempSwitchElement = null;

function toggleAssetStatus(assetId, isActive) {
    // Store the values temporarily
    tempAssetId = assetId;
    tempIsActive = isActive;
    
    // Save the checkbox element to revert it if user cancels
    tempSwitchElement = event.target;

    // Update modal message
    const statusText = isActive ? 'activate' : 'deactivate';
    document.getElementById('confirmStatusText').innerText = 
        `Are you sure you want to ${statusText} this asset?`;

    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('confirmStatusModal'));
    modal.show();
}

function confirmStatusChange() {
    // Send AJAX request
    fetch('/updateAssetActiveInactiveStatus', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ assetId: tempAssetId, active: tempIsActive })
    })
    .then(response => {
        if (response.ok) {
            console.log('Status updated successfully');
        } else {
            alert('Failed to update status');
            // Revert switch toggle on failure
            if (tempSwitchElement) {
                tempSwitchElement.checked = !tempIsActive;
            }
        }
    });

    // Hide modal after action
    const modalEl = document.getElementById('confirmStatusModal');
    const modalInstance = bootstrap.Modal.getInstance(modalEl);
    modalInstance.hide();
}

// If you want the switch to go back to its original state when the user cancels
function revertSwitch() {
    if (tempSwitchElement) {
        tempSwitchElement.checked = !tempIsActive;
    }
}

</script>

<!-- script to validate asset quatity is available or not while assigning -->
<script>
    const assetTypeEl = document.getElementById("assetName");
    const descriptionEl = document.getElementById("description");
    const quantityEl = document.getElementById("quantity");
    const assignBtn = document.querySelector("#assignForm button[type='submit']");

    // Disable button initially
    assignBtn.disabled = true;

    function validateAvailability() {
        const assetType = assetTypeEl.value;
        const description = descriptionEl.value;
        const quantity = parseInt(quantityEl.value);
        const errorEl = document.getElementById("quantityError");

        if (assetType && description && quantity > 0) {
            fetch(`/validate-asset-availability?assetType=${encodeURIComponent(assetType)}&description=${encodeURIComponent(description)}&quantity=${quantity}`)
                .then(response => response.json())
                .then(isAvailable => {
                    assignBtn.disabled = !isAvailable;

                    if (!isAvailable) {
                        assignBtn.title = "Asset not available in sufficient quantity";
                        errorEl.textContent = "Requested quantity is not available.";
                        errorEl.style.display = "block";
                    } else {
                        assignBtn.title = "";
                        errorEl.textContent = "";
                        errorEl.style.display = "none";
                    }
                })
                .catch(err => {
                    console.error("Validation error:", err);
                    assignBtn.disabled = true;
                    errorEl.textContent = "Error checking availability.";
                    errorEl.style.display = "block";
                });
        } else {
            assignBtn.disabled = true;
            errorEl.style.display = "none";
        }
    }

    assetTypeEl.addEventListener("change", validateAvailability);
    descriptionEl.addEventListener("change", validateAvailability);
    quantityEl.addEventListener("input", validateAvailability);
    
</script>
<script>
  function updateButtonVisibility() {
    const requestButton = document.getElementById("addProjectButton");
    const addAssetButton = document.getElementById("addAssets");
    const activeTab = document.querySelector("#borderedTabJustified .nav-link.active");

    if (activeTab && activeTab.getAttribute("data-bs-target") === "#bordered-justified-profile") {
      // Admin tab
      requestButton.style.display = "inline-block";
      addAssetButton.style.display = "none";
    } else {
      // Other tabs
      requestButton.style.display = "none";
      addAssetButton.style.display = "inline-block";
    }
  }

  // Listen for tab changes
  document.querySelectorAll('#borderedTabJustified .nav-link').forEach(tab => {
    tab.addEventListener('shown.bs.tab', updateButtonVisibility);
  });

  // Run once on page load
  document.addEventListener('DOMContentLoaded', updateButtonVisibility);
</script>

<!-- script to fetch assigned details based on select asset id -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".assigned-qty").forEach(function (element) {
        element.addEventListener("click", function (event) {
            event.preventDefault();
            const assetId = this.getAttribute("data-asset-id");
            fetchAssignedDetails(assetId);
        });
    });
});
function fetchAssignedDetails(assetId) {
	  fetch(`/getAssignedAssetById?assetId=${encodeURIComponent(assetId)}`)
	    .then(response => {
	      if (!response.ok) throw new Error("Network error");
	      return response.json();
	    })
	    .then(data => {
	    	if (!data || data.length === 0) {
	            alert("No records found for the selected asset.");
	            return; // Exit the function early
	          }
	      const tbody = document.getElementById('assignedAssetsTableBody');
	      const summary = document.getElementById('summaryContent');
	      tbody.innerHTML = '';
	      summary.innerHTML = '';

	      // --- Populate table ---
	      data.forEach((item, index) => {
	        const row = `
	          <tr>
	            <td>${index + 1}</td>
	            <td>${item.assetId}</td>
	            <td>${item.assetType}</td>
	            <td>${item.assignedAssetId}</td>
	            <td>${item.assignedTo}</td>
	            <td>${item.empName}</td> 
				<td>${item.ref_asset_id || '-'}</td> <!-- üîπ New field -->
				<td>${item.remarks || '-'}</td> <!-- üîπ New field -->
	          </tr>
	        `;
	        tbody.insertAdjacentHTML('beforeend', row);
	      });

	      // --- Prepare summary data ---
	      const totalAssigned = data.length;
	      const totalQuantity = data.reduce((sum, item) => sum + (item.quantity || 0), 0);
	      const uniqueEmployees = new Set(data.map(item => item.assignedTo)).size;

	      const summaryHTML = `
	        <div class="col-md-4"><div class="card border-primary"><div class="card-body">
	          <h6 class="card-title">Total Records</h6><p class="card-text">${totalAssigned}</p>
	        </div></div></div>
	        <div class="col-md-4"><div class="card border-success"><div class="card-body">
	          <h6 class="card-title">Total Quantity</h6><p class="card-text">${totalQuantity}</p>
	        </div></div></div>
	        <div class="col-md-4">
	        <div class="card border-warning" id="uniqueEmployeesCard" style="cursor: pointer;">
	          <div class="card-body">
	            <h6 class="card-title">Unique Employees</h6>
	            <p class="card-text">${uniqueEmployees}</p>
	          </div>
	        </div>
	      </div>
	      `;
		   
	      summary.insertAdjacentHTML('beforeend', summaryHTML);
		  	
	      // Show the modal
	      new bootstrap.Modal(document.getElementById('assignedAssetsModal')).show();
	    })
	    .catch(error => {
	      console.error("Error:", error);
	      alert("Failed to fetch assigned details.");
	    });
	}

</script>

<!-- script to submit the asset request -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("assetRequestForm1");

    form.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent normal form submission

        const formData = new FormData(form);
		
        fetch("/save", {
            method: "POST",
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // ‚úÖ Reload the page after successful submission
                location.reload();
            } else {
                return response.text().then(text => { throw new Error(text); });
            }
        })
        .catch(error => {
            console.error("Request failed:", error);
            alert("Failed to submit asset request.");
        });
    });
});
</script>

<!-- scrip to add asset -->
<script>
document.getElementById("assetForm").addEventListener("submit", function(e) {
    e.preventDefault(); // Prevent default form submission

    const form = e.target;
    const formData = new FormData(form);

    fetch('/assets_save', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) return response.text();  // Or response.json() if backend sends JSON 
        else throw new Error("Asset already exists or error occurred");
    })
    .then(data => {
        // Show success message
        const msg = document.getElementById("responseMessage");
        msg.className = "alert alert-success text-center mt-3";
        msg.textContent = "Asset saved successfully!";
        msg.style.display = "block";

        const addAssetModalElement = document.getElementById("addAssetModal");
        const modalInstance = bootstrap.Modal.getInstance(addAssetModalElement);
        if(modalInstance){
        	modalInstance.hide();
        }
        
        location.reload();
        // Auto-hide
        setTimeout(() => msg.style.display = "none", 2000);
    })
    .catch(error => {
        const msg = document.getElementById("responseMessage");
        msg.className = "alert alert-danger text-center mt-3";
        msg.textContent = error.message || "Something went wrong!";
        msg.style.display = "block";

        setTimeout(() => msg.style.display = "none", 3000);
    });
});
</script>
<!-- script to create dynamic input field based asset quantity while assiging assets to user -->
<script>
	
document.getElementById("quantity").addEventListener("input", function () {
	//alert("hii2");
  const quantity = parseInt(this.value);
  const container = document.getElementById("referIdsContainer");
  container.innerHTML = ""; // Clear old inputs

  
  
  if (!isNaN(quantity) && quantity > 0) {
    for (let i = 0; i < quantity; i++) {
      const col = document.createElement("div");
      col.className = "col-md-6";

      const label = document.createElement("label");
      label.className = "form-label";
      label.textContent = `Refer Asset ID ${i + 1}`;

      const input = document.createElement("input");
      input.type = "text";
      input.name = "referAssetIds"; // Submit as array
      input.className = "form-control";
      input.required = true;

      col.appendChild(label);
      col.appendChild(input);
      container.appendChild(col);
    }
  }
});



// for assign asset without req modal
/*document.getElementById("quantityWithoutReq").addEventListener("input", function () {
	  const quantity = parseInt(this.value);
	  const container = document.getElementById("referIdsContainerWithoutReq");
	  container.innerHTML = ""; // Clear old inputs

	  if (!isNaN(quantity) && quantity > 0) {
	    for (let i = 0; i < quantity; i++) {
	      const col = document.createElement("div");
	      col.className = "col-md-6";

	      const label = document.createElement("label");
	      label.className = "form-label";
	      label.textContent = `Refer Asset ID ${i + 1}`;

	      const input = document.createElement("input");
	      input.type = "text";
	      input.name = "referAssetIds"; // Submit as array
	      input.className = "form-control";
	      input.required = true;

		  
	      col.appendChild(label);
	      col.appendChild(input);
	      container.appendChild(col);
	    }
	  }
	});*/
	
	document.getElementById("quantityWithoutReq").addEventListener("input", function () {
	  const quantity = parseInt(this.value);
	  const container = document.getElementById("referIdsContainerWithoutReq");
	  container.innerHTML = ""; // Clear old inputs

	  // Hide the default remarks block
	  document.getElementById("remarksDefault").style.display = "none";

	  if (!isNaN(quantity) && quantity > 0) {
	    for (let i = 0; i < quantity; i++) {
	      const wrapper = document.createElement("div");
	      wrapper.className = "col-md-12 border p-2 mb-2 rounded";

	      // Refer Asset ID
	      const refLabel = document.createElement("label");
	      refLabel.className = "form-label";
	      refLabel.textContent = `Refer Asset ID ${i + 1}`;

	      const refInput = document.createElement("input");
	      refInput.type = "text";
	      refInput.name = "referAssetIds"; // submit as array
	      refInput.className = "form-control";
	      refInput.required = true;

	      // Remarks
	      const remarksLabel = document.createElement("label");
	      remarksLabel.className = "form-label mt-2";
	      remarksLabel.textContent = `Remarks ${i + 1}`;

	      const remarksInput = document.createElement("textarea");
	      remarksInput.id = `remarks${i + 1}`;
	      remarksInput.name = "remarks"; // array
	      remarksInput.className = "form-control";
	      remarksInput.placeholder = "Optional notes or comments...";

	      wrapper.appendChild(refLabel);
	      wrapper.appendChild(refInput);
	      wrapper.appendChild(remarksLabel);
	      wrapper.appendChild(remarksInput);

	      container.appendChild(wrapper);
	    }
	  }
	});


</script>
<script>
document.getElementById("quantity").addEventListener("input", function () {
  const quantity = parseInt(this.value);
  const container = document.getElementById("referIdsContainer");
  container.innerHTML = ""; // Clear old inputs

  if (!isNaN(quantity) && quantity > 0) {
    for (let i = 0; i < quantity; i++) {
      const col = document.createElement("div");
      col.className = "col-md-6";

      const label = document.createElement("label");
      label.className = "form-label";
      label.textContent = `Refer Asset ID ${i + 1}`;

      const input = document.createElement("input");
      input.type = "text";
      input.name = "referAssetIds"; // Submit as array
      input.className = "form-control";
      input.required = true;

      col.appendChild(label);
      col.appendChild(input);
      container.appendChild(col);
    }
  }
});
</script>
<script>
/*document.getElementById("quantity").addEventListener("input", function () {
  const quantity = parseInt(this.value);
  const container = document.getElementById("referIdsContainer");
  container.innerHTML = ""; // Clear old inputs

  if (!isNaN(quantity) && quantity > 0) {
    for (let i = 0; i < quantity; i++) {
      const col = document.createElement("div");
      col.className = "col-md-6";

      const label = document.createElement("label");
      label.className = "form-label";
      label.textContent = `Refer Asset ID ${i + 1}`;

      const input = document.createElement("input");
      input.type = "text";
      input.name = "referAssetIds"; // To bind as array in Spring
      input.className = "form-control";
      input.required = true;

      col.appendChild(label);
      col.appendChild(input);
      container.appendChild(col);
    }
  }
});*/

document.getElementById("quantity").addEventListener("input", function () {
//	alert("hii1");
  const quantity = parseInt(this.value);
  const container = document.getElementById("referIdsContainer");
  const defaultRemarksBlock = document.getElementById("remarksDefault1"); // use ID now ‚úÖ

  container.innerHTML = ""; // Clear old inputs

  if (!isNaN(quantity) && quantity > 0) {
    // Hide default remarks
    defaultRemarksBlock.style.display = "none";

    for (let i = 0; i < quantity; i++) {
      const wrapper = document.createElement("div");
      wrapper.className = "col-md-12 border p-2 mb-2 rounded";

      // Refer Asset ID
      const refLabel = document.createElement("label");
      refLabel.className = "form-label";
      refLabel.textContent = `Refer Asset ID ${i + 1}`;

      const refInput = document.createElement("input");
      refInput.type = "text";
      refInput.name = "referAssetIds"; // submit as array
      refInput.className = "form-control";
      refInput.required = true;

      // Remarks
      const remarksLabel = document.createElement("label");
      remarksLabel.className = "form-label mt-2";
      remarksLabel.textContent = `Remarks ${i + 1}`;

      const remarksInput = document.createElement("textarea");
      remarksInput.name = "remarks"; // submit as array
      remarksInput.className = "form-control";
      remarksInput.placeholder = "Optional notes or comments...";
      remarksInput.style.fontSize = "13px";

      wrapper.appendChild(refLabel);
      wrapper.appendChild(refInput);
      wrapper.appendChild(remarksLabel);
      wrapper.appendChild(remarksInput);

      container.appendChild(wrapper);
    }
  } else {
    // If quantity is empty or invalid -> show default remarks back
    defaultRemarksBlock.style.display = "block";
  }
});

</script>
<!-- script to assign asset  without request-->
<script>
function handleOpenAssetAssign(el) {
	
	  const id = el.getAttribute("data-id");
	  const name = el.getAttribute("data-name");
	  const desc = el.getAttribute("data-description");
	  const dataInhandQty = el.getAttribute("data-inhandQty");
	 
	  document.getElementById("remainingQtyTextwithoutReq").textContent = dataInhandQty;
	  
	  openAssetAssignForm(id, '', name, '', desc);
	  
	}
function openAssetAssignForm(id, empId, assetType, quantity, description) {
	
    // Show employee select
    document.getElementById("empSelect").classList.remove("d-none");
    // Set hidden ID
    document.getElementById("assignIdWithoutReq").value = 0;
    document.getElementById("assetName1").value = assetType;
    document.getElementById("description1").value = description;
    fetchAssetIdWithOutReq(assetType,description);
    // Show modal
    const myModal = new bootstrap.Modal(document.getElementById("assignAssetModalWothoutReques"));
    myModal.show();
}
function fetchAssetIdWithOutReq(assetType,description) {
   // let assetType = document.getElementById("assetName").value;
   // let description = document.getElementById("description").value;
  
   let assetIdInput = document.getElementById("assetIdWithOutReq");

    //assetIdInput.value = ""; // Clear current value
    
    if (assetType && description) {
        fetch(`/get-asset-id?assetType=${encodeURIComponent(assetType)}&description=${encodeURIComponent(description)}`)
            .then(response => response.json())
            .then(data => {
            	//alert(JSON.stringify(data));
                assetIdInput.value = data.assetId;
            })
            .catch(error => console.error('Error fetching asset ID:', error));
    }
}
</script>
<!-- script to validate asset quatity is available or not while assigning While assigning asset to employee without requesy -->
<script> 
document.addEventListener("DOMContentLoaded", function () {
  const assetTypeEl1 = document.getElementById("assetName1");
  const descriptionEl1 = document.getElementById("description1");
  const quantityEl1 = document.getElementById("quantityWithoutReq");
  const assignBtn = document.querySelector("#assignFormWithoutReq button[type='submit']");

  assignBtn.disabled = true;

  function validateAvailability1() {
     
    const assetType1 = assetTypeEl1.value;
    const description1 = descriptionEl1.value;
    const quantity1 = parseInt(quantityEl1.value);
    const errorEl1 = document.getElementById("quantityErrorWithoutReq");

    if (assetType1 && description1 && quantity1 > 0) {
      fetch(`/validate-asset-availability?assetType=${encodeURIComponent(assetType1)}&description=${encodeURIComponent(description1)}&quantity=${quantity1}`)
        .then(response => response.json())
        .then(isAvailable => {
          assignBtn.disabled = !isAvailable;

          if (!isAvailable) {
            assignBtn.title = "Asset not available in sufficient quantity";
            errorEl1.textContent = "Requested quantity is not available.";
            errorEl1.style.display = "block";
          } else {
            assignBtn.title = "";
            errorEl1.textContent = "";
            errorEl1.style.display = "none";
          }
        })
        .catch(err => {
          console.error("Validation error:", err);
          assignBtn.disabled = true;
          errorEl1.textContent = "Error checking availability.";
          errorEl1.style.display = "block";
        });
    } else {
      assignBtn.disabled = true;
      errorEl1.style.display = "none";
    }
  }

  assetTypeEl1.addEventListener("change", validateAvailability1);
  descriptionEl1.addEventListener("change", validateAvailability1);
  quantityEl1.addEventListener("input", validateAvailability1);
});

// Global event listener for all "referAssetIds"
document.addEventListener("input", function (event) {
  if (event.target && event.target.name === "referAssetIds") {
    validateUniqueRefIds(event.target);
  }
});

function validateUniqueRefIds(changedInput) {
  const form = changedInput.closest("form"); // üîπ find which form this input belongs to
  const inputs = form.querySelectorAll("input[name='referAssetIds']");
  const assignBtn = form.querySelector("button[type='submit']");
  const errorEl = form.querySelector("[id^='quantityError']"); // works for both modals
 

  // Try to get both <input> and <select> types for asset_type and description
  const assetTypeEl = form.querySelector("input[name='asset_type'], select[name='asset_type']");
  const descriptionEl = form.querySelector("input[name='description'], select[name='description']");

  if (!assetTypeEl || !descriptionEl) {
    console.error("Asset type or description not found in the form");
    return;
  }

  const assetType = assetTypeEl.value.trim();
  const description = descriptionEl.value.trim();


  const seen = new Set();
  let hasDuplicate = false;

  inputs.forEach(input => {
    input.classList.remove("is-invalid");
    const value = input.value.trim();

    if (value) {
      if (seen.has(value)) {
        input.classList.add("is-invalid");
        hasDuplicate = true;
      } else {
        seen.add(value);

        // üîπ Check in DB if already assigned
       //fetch(`/validate-ref-id?refId=${encodeURIComponent(value)}`)
	   // Pass assetType and description to backend
	         fetch(`/validate-ref-id?refId=${encodeURIComponent(value)}&assetType=${encodeURIComponent(assetType)}&description=${encodeURIComponent(description)}`)
		.then(response => {
		  alert("Raw response: " + response); // alert the Response object
		  return response.json(); // then parse it as JSON
		})
          .then(isAvailable => {
            if (!isAvailable) {
              input.classList.add("is-invalid");
              hasDuplicate = true;
              errorEl.style.display = "block";
              errorEl.innerHTML = `<div class="alert alert-danger p-2">Refer Asset ID "${value}" is already assigned.</div>`;
              assignBtn.disabled = true;
            }
          });
      }
    }
  });

  if (hasDuplicate) {
    assignBtn.disabled = true;
    errorEl.style.display = "block";
    errorEl.innerHTML = `<div class="alert alert-danger p-2">Duplicate Refer Asset IDs are not allowed.</div>`;
  } else {
    errorEl.style.display = "none";
    assignBtn.disabled = false;
  }
}

</script>
 <!-- active assets request tab after assign the asset to user -->
 <script>
 document.addEventListener("DOMContentLoaded", function () {
	    const urlParams = new URLSearchParams(window.location.search);
	    const activeTab = urlParams.get("tab");

	    if (activeTab === "requestTab") {
	        const requestsTab = document.querySelector('[data-bs-target="#bordered-justified-home"]');
	        const tab = new bootstrap.Tab(requestsTab);
	        tab.show();
	    } else if (activeTab === "assetTab") {
	        const assetsTab = document.querySelector('[data-bs-target="#bordered-justified-assets"]');
	        const tab = new bootstrap.Tab(assetsTab);
	        tab.show();
	    }
	});
</script>

<!-- script to reject asset request -->
 <script>
  let selectedRequest = {};

  function openRejectModal(button) {
    selectedRequest = {
      id: button.getAttribute('data-id'),
      empId: button.getAttribute('data-emp-id'),
      assetType: button.getAttribute('data-asset-type'),
      quantity: button.getAttribute('data-quantity'),
      description: button.getAttribute('data-description')
    };

    // Show modal (Bootstrap 5)
    const rejectModal = new bootstrap.Modal(document.getElementById('rejectConfirmModal'));
    rejectModal.show();
  }

  document.getElementById('confirmRejectBtn').addEventListener('click', function () {
 
    fetch('/asset/reject', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(selectedRequest)
    })
    .then(response => {
      if (response.ok) {
    	  window.location.href = window.location.pathname + '?tab=assetRequests';
      } else {
        alert("Failed to reject request");
      }
    })
    .catch(error => {
      console.error("Error:", error);
      alert("Error rejecting request");
    });
    
  });
</script>

<!-- script to active the tab after reject the asset requests -->
 <script>
  document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('tab');

    if (activeTab === 'assetRequests') {
      // Deactivate all tabs
      document.querySelectorAll('.nav-link').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active', 'show'));

      // Activate Assets Requests tab
      document.querySelector('[data-bs-target="#bordered-justified-home"]')?.classList.add('active');
      document.querySelector('#bordered-justified-home')?.classList.add('active', 'show');
    }
  });
</script>

	<script>
		document.getElementById("feedbackForm").addEventListener("submit", function (event) {
			    event.preventDefault(); // Prevent default form submission

			    $.ajax({
			        url: 'recentlySavedTicketNumber',
			        type: 'GET',
			        success: function (response) {
			            let recentlyInsertedTicketIdData = response;

			            // Get the current date
			            var today = new Date();
			            var year = today.getFullYear();
			            var month = today.getMonth() + 1; // JavaScript months are 0-based

			            // Calculate the financial year
			            var financialYearStart = month >= 4 ? year : year - 1; // Fiscal year starts in April
			            var financialYearEnd = financialYearStart + 1;

			            // Format as FYY-YY
			            var financialYear = `F${financialYearStart % 100}-${financialYearEnd % 100}`;

			            // Department Name
			            var loggedInDeptName = $('#loggedInDeptName').val();

			            let incrementedNumber = "0001"; // Default number if response is empty or null

			            // Check if recentlyInsertedTicketIdData is not empty or null
			            if (recentlyInsertedTicketIdData) {
			                // Extract the last part of the ticket (e.g., 0001)
			                let ticketParts = recentlyInsertedTicketIdData.split("/");
			                let lastPart = ticketParts[ticketParts.length - 1];

			                // Increment the extracted number
			                let numericValue = parseInt(lastPart, 10) + 1;
			                incrementedNumber = numericValue.toString().padStart(4, '0'); // Pad with leading zeros
			            }

			            // Construct the feedback ticket
			            var feedbackTicket = `MSPL/FT/${financialYear}/${loggedInDeptName}/${incrementedNumber}`;

			            // Add feedback ticket to the form data
			            let formData = new FormData(document.getElementById("feedbackForm"));
			            formData.append("id", feedbackTicket);
			            formData.append("emp_id", $('#emp_idSessionValue').val());

			            const submitButton = document.getElementById("submitFeedbackBtn");
			            submitButton.disabled = true; // Disable the submit button to prevent multiple submissions

			            const loadingSwal = Swal.fire({
			                title: 'Submitting feedback...',
			                text: 'Please wait while we submit your feedback.',
			                showConfirmButton: false,
			                allowOutsideClick: false, // Prevent closing when clicking outside
			                            allowEscapeKey: false, // Prevent closing when pressing escape key
			                didOpen: () => {
			                    Swal.showLoading(); // Display the loading spinner
			                }
			            });

			            // Append files to form data
			            let files = document.getElementById("feedbackAttachment").files;
			            if (files.length > 0) {
			                for (let i = 0; i < files.length; i++) {
			                    formData.append(`attachment[${i}]`, files[i]); // Use unique keys
			                }
			            }

			            let bugType = document.getElementById("bugType").value;
			            formData.append("bugTypeff", bugType); // Add the bug type to the form data

			            // Debugging: Log formData entries before the fetch call
			            console.log("Logging formData entries:");
			            for (let [key, value] of formData.entries()) {
			                if (value instanceof File) {
			                    console.log(`Key: ${key}, File Name: ${value.name}, Size: ${value.size}`);
			                } else {
			                    console.log(`Key: ${key}, Value: ${value}`);
			                }
			            }

			            // Make AJAX request to submit feedback
			            fetch("/submitFeedback", {
			                method: "POST",
			                body: formData
			            })
			                .then(response => response.json())
			                .then(data => {
			                    loadingSwal.close();
			                    submitButton.disabled = false; // Re-enable the button
			                    if (data.success) {
			                        $('#feedbackModal').modal('hide');
			                        Swal.fire({
			                            title: 'Success!',
			                            text: 'Your feedback has been submitted successfully.',
			                            icon: 'success',
			                            allowOutsideClick: false, // Prevent closing when clicking outside
			                                        allowEscapeKey: false, // Prevent closing when pressing escape key
			                            customClass: {
			                                popup: 'custom-swal-font'
			                            },
			                            confirmButtonText: 'OK'
			                        }).then((result) => {
			                            if (result.isConfirmed) {
			                                    Swal.fire({
			                                            html: 'We sincerely appreciate your feedback! Please find your feedback ticket details below.<br><br>' + 
			                                    '<strong>' + feedbackTicket + '</strong>', // Display the feedback ticket on a new line
			                                    allowOutsideClick: false, // Prevent closing when clicking outside
			                                                allowEscapeKey: false, // Prevent closing when pressing escape key
			                                    customClass: {
			                                        popup: 'custom-swal-font'
			                                    },
			                                    confirmButtonText: 'OK'
			                                });
			                            }
			                        });
			                    } else {
			                        Swal.fire({
			                            title: 'Error!',
			                            text: 'There was an error submitting your feedback.',
			                            icon: 'error',
			                            allowOutsideClick: false, // Prevent closing when clicking outside
			                                        allowEscapeKey: false, // Prevent closing when pressing escape key
			                            customClass: {
			                                popup: 'custom-swal-font'
			                            },
			                            confirmButtonText: 'OK'
			                        });
			                    }
			                })
			                .catch(error => {
			                    console.error('Error:', error);
			                    loadingSwal.close();
			                    submitButton.disabled = false; // Re-enable the button
			                    Swal.fire({
			                        title: 'Error!',
			                        text: 'There was an error submitting your feedback.',
			                        icon: 'error',
			                        allowOutsideClick: false, // Prevent closing when clicking outside
			                                    allowEscapeKey: false, // Prevent closing when pressing escape key
			                        customClass: {
			                            popup: 'custom-swal-font'
			                        },
			                        confirmButtonText: 'OK'
			                    });
			                });
			        },
			        error: function (xhr, status, error) {
			            alert('Failed to fetch recently inserted feedback ticket: ' + error);
			        }
			    });
			});


			   // Clear form fields when the modal is closed
			   document.getElementById('feedbackModal').addEventListener('hidden.bs.modal', function () {
			       const feedbackForm = document.getElementById('feedbackForm');
			       feedbackForm.reset(); // Reset the form fields
			       document.getElementById('feedbackAttachment').value = ""; // Clear file input manually
			   });
	</script>
 
</body>
</html>